!function(e){function t(t){for(var r,i,l=t[0],s=t[1],c=t[2],d=0,p=[];d<l.length;d++)i=l[d],n[i]&&p.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(u&&u(t);p.length;)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},n={0:0},o=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;o.push([678,2]),a()}({1057:function(e,t,a){var r={"./en-SG":544,"./en-SG.js":544,"./en-au":545,"./en-au.js":545,"./en-ca":546,"./en-ca.js":546,"./en-gb":547,"./en-gb.js":547,"./en-ie":548,"./en-ie.js":548,"./en-il":549,"./en-il.js":549,"./en-nz":550,"./en-nz.js":550};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=1057},111:function(e,t,a){e.exports=a.p+"images/redash_icon_small.png"},1323:function(e,t,a){},1324:function(e,t,a){},1328:function(e,t,a){},1331:function(e,t,a){},1332:function(e,t,a){},1333:function(e,t,a){},1334:function(e,t,a){},1335:function(e,t,a){},1336:function(e,t,a){},1378:function(e,t,a){},1379:function(e,t,a){},1380:function(e,t,a){},1381:function(e,t,a){},1421:function(e,t,a){},1423:function(e,t,a){},1424:function(e,t,a){},1425:function(e,t,a){},1426:function(e,t,a){},1427:function(e,t,a){},1428:function(e,t,a){},1429:function(e,t,a){},1431:function(e,t,a){},1433:function(e,t,a){},1434:function(e,t,a){},1435:function(e,t,a){},1436:function(e,t,a){},1437:function(e,t,a){},1448:function(e,t,a){},1450:function(e,t,a){},1543:function(e,t,a){},1548:function(e,t,a){},1557:function(e,t,a){},1558:function(e,t,a){},1559:function(e,t,a){},1562:function(e,t,a){},1563:function(e,t,a){},1564:function(e,t,a){},1565:function(e,t,a){},1566:function(e,t,a){},1600:function(e,t,a){},1601:function(e,t,a){},1602:function(e,t,a){},1603:function(e,t,a){},1604:function(e,t,a){},1605:function(e,t,a){},1606:function(e,t,a){},1607:function(e,t,a){},1608:function(e,t,a){},1609:function(e,t,a){},1610:function(e,t,a){var r={"./avatar.svg":662,"./db-logos/Cassandra.png":1611,"./db-logos/athena.png":1612,"./db-logos/aws_es.png":1613,"./db-logos/axibasetsd.png":1614,"./db-logos/azure_kusto.png":1615,"./db-logos/bigquery.png":1616,"./db-logos/bigquery_gce.png":1617,"./db-logos/clickhouse.png":1618,"./db-logos/cloudwatch.png":1619,"./db-logos/cloudwatch_insights.png":1620,"./db-logos/cockroach.png":1621,"./db-logos/couchbase.png":1622,"./db-logos/csv.png":1623,"./db-logos/databricks.png":1624,"./db-logos/db2.png":1625,"./db-logos/dgraph.png":1626,"./db-logos/drill.png":1627,"./db-logos/druid.png":1628,"./db-logos/dynamodb_sql.png":1629,"./db-logos/elasticsearch.png":1630,"./db-logos/exasol.png":1631,"./db-logos/google_analytics.png":1632,"./db-logos/google_spreadsheets.png":1633,"./db-logos/graphite.png":1634,"./db-logos/hive.png":1635,"./db-logos/hive_http.png":1636,"./db-logos/impala.png":1637,"./db-logos/influxdb.png":1638,"./db-logos/jirajql.png":1639,"./db-logos/json.png":1640,"./db-logos/kibana.png":1641,"./db-logos/kylin.png":1642,"./db-logos/mapd.png":1643,"./db-logos/memsql.png":1644,"./db-logos/mongodb.png":1645,"./db-logos/mssql.png":1646,"./db-logos/mssql_odbc.png":1647,"./db-logos/mysql.png":1648,"./db-logos/oracle.png":1649,"./db-logos/pg.png":1650,"./db-logos/phoenix.png":1651,"./db-logos/presto.png":1652,"./db-logos/prometheus.png":1653,"./db-logos/python.png":1654,"./db-logos/qubole.png":1655,"./db-logos/rds_mysql.png":1656,"./db-logos/redshift.png":1657,"./db-logos/redshift_iam.png":1658,"./db-logos/results.png":1659,"./db-logos/rockset.png":1660,"./db-logos/salesforce.png":1661,"./db-logos/scylla.png":1662,"./db-logos/snowflake.png":1663,"./db-logos/sqlite.png":1664,"./db-logos/treasuredata.png":1665,"./db-logos/uptycs.png":1666,"./db-logos/url.png":1667,"./db-logos/vertica.png":1668,"./db-logos/yandex_appmetrika.png":1669,"./db-logos/yandex_metrika.png":1670,"./destinations/chatwork.png":1671,"./destinations/email.png":1672,"./destinations/hangouts_chat.png":1673,"./destinations/hipchat.png":1674,"./destinations/mattermost.png":1675,"./destinations/pagerduty.png":1676,"./destinations/slack.png":1677,"./destinations/webhook.png":1678,"./favicon-16x16.png":1679,"./favicon-32x32.png":1680,"./favicon-96x96.png":1681,"./fixtures/map-tile.png":1682,"./google_logo.svg":1683,"./illustrations/alert.svg":1684,"./illustrations/dashboard.svg":1685,"./illustrations/no-query-results.svg":1686,"./illustrations/query.svg":1687,"./logo.png":1688,"./logo_white.png":1689,"./redash_icon_small.png":111};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=1610},1611:function(e,t,a){e.exports=a.p+"images/db-logos/Cassandra.png"},1612:function(e,t,a){e.exports=a.p+"images/db-logos/athena.png"},1613:function(e,t,a){e.exports=a.p+"images/db-logos/aws_es.png"},1614:function(e,t,a){e.exports=a.p+"images/db-logos/axibasetsd.png"},1615:function(e,t,a){e.exports=a.p+"images/db-logos/azure_kusto.png"},1616:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery.png"},1617:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery_gce.png"},1618:function(e,t,a){e.exports=a.p+"images/db-logos/clickhouse.png"},1619:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch.png"},1620:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch_insights.png"},1621:function(e,t,a){e.exports=a.p+"images/db-logos/cockroach.png"},1622:function(e,t,a){e.exports=a.p+"images/db-logos/couchbase.png"},1623:function(e,t,a){e.exports=a.p+"images/db-logos/csv.png"},1624:function(e,t,a){e.exports=a.p+"images/db-logos/databricks.png"},1625:function(e,t,a){e.exports=a.p+"images/db-logos/db2.png"},1626:function(e,t,a){e.exports=a.p+"images/db-logos/dgraph.png"},1627:function(e,t,a){e.exports=a.p+"images/db-logos/drill.png"},1628:function(e,t,a){e.exports=a.p+"images/db-logos/druid.png"},1629:function(e,t,a){e.exports=a.p+"images/db-logos/dynamodb_sql.png"},1630:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch.png"},1631:function(e,t,a){e.exports=a.p+"images/db-logos/exasol.png"},1632:function(e,t,a){e.exports=a.p+"images/db-logos/google_analytics.png"},1633:function(e,t,a){e.exports=a.p+"images/db-logos/google_spreadsheets.png"},1634:function(e,t,a){e.exports=a.p+"images/db-logos/graphite.png"},1635:function(e,t,a){e.exports=a.p+"images/db-logos/hive.png"},1636:function(e,t,a){e.exports=a.p+"images/db-logos/hive_http.png"},1637:function(e,t,a){e.exports=a.p+"images/db-logos/impala.png"},1638:function(e,t,a){e.exports=a.p+"images/db-logos/influxdb.png"},1639:function(e,t,a){e.exports=a.p+"images/db-logos/jirajql.png"},1640:function(e,t,a){e.exports=a.p+"images/db-logos/json.png"},1641:function(e,t,a){e.exports=a.p+"images/db-logos/kibana.png"},1642:function(e,t,a){e.exports=a.p+"images/db-logos/kylin.png"},1643:function(e,t,a){e.exports=a.p+"images/db-logos/mapd.png"},1644:function(e,t,a){e.exports=a.p+"images/db-logos/memsql.png"},1645:function(e,t,a){e.exports=a.p+"images/db-logos/mongodb.png"},1646:function(e,t,a){e.exports=a.p+"images/db-logos/mssql.png"},1647:function(e,t,a){e.exports=a.p+"images/db-logos/mssql_odbc.png"},1648:function(e,t,a){e.exports=a.p+"images/db-logos/mysql.png"},1649:function(e,t,a){e.exports=a.p+"images/db-logos/oracle.png"},1650:function(e,t,a){e.exports=a.p+"images/db-logos/pg.png"},1651:function(e,t,a){e.exports=a.p+"images/db-logos/phoenix.png"},1652:function(e,t,a){e.exports=a.p+"images/db-logos/presto.png"},1653:function(e,t,a){e.exports=a.p+"images/db-logos/prometheus.png"},1654:function(e,t,a){e.exports=a.p+"images/db-logos/python.png"},1655:function(e,t,a){e.exports=a.p+"images/db-logos/qubole.png"},1656:function(e,t,a){e.exports=a.p+"images/db-logos/rds_mysql.png"},1657:function(e,t,a){e.exports=a.p+"images/db-logos/redshift.png"},1658:function(e,t,a){e.exports=a.p+"images/db-logos/redshift_iam.png"},1659:function(e,t,a){e.exports=a.p+"images/db-logos/results.png"},1660:function(e,t,a){e.exports=a.p+"images/db-logos/rockset.png"},1661:function(e,t,a){e.exports=a.p+"images/db-logos/salesforce.png"},1662:function(e,t,a){e.exports=a.p+"images/db-logos/scylla.png"},1663:function(e,t,a){e.exports=a.p+"images/db-logos/snowflake.png"},1664:function(e,t,a){e.exports=a.p+"images/db-logos/sqlite.png"},1665:function(e,t,a){e.exports=a.p+"images/db-logos/treasuredata.png"},1666:function(e,t,a){e.exports=a.p+"images/db-logos/uptycs.png"},1667:function(e,t,a){e.exports=a.p+"images/db-logos/url.png"},1668:function(e,t,a){e.exports=a.p+"images/db-logos/vertica.png"},1669:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_appmetrika.png"},1670:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_metrika.png"},1671:function(e,t,a){e.exports=a.p+"images/destinations/chatwork.png"},1672:function(e,t,a){e.exports=a.p+"images/destinations/email.png"},1673:function(e,t,a){e.exports=a.p+"images/destinations/hangouts_chat.png"},1674:function(e,t,a){e.exports=a.p+"images/destinations/hipchat.png"},1675:function(e,t,a){e.exports=a.p+"images/destinations/mattermost.png"},1676:function(e,t,a){e.exports=a.p+"images/destinations/pagerduty.png"},1677:function(e,t,a){e.exports=a.p+"images/destinations/slack.png"},1678:function(e,t,a){e.exports=a.p+"images/destinations/webhook.png"},1679:function(e,t,a){e.exports=a.p+"images/favicon-16x16.png"},1680:function(e,t,a){e.exports=a.p+"images/favicon-32x32.png"},1681:function(e,t,a){e.exports=a.p+"images/favicon-96x96.png"},1682:function(e,t,a){e.exports=a.p+"images/fixtures/map-tile.png"},1683:function(e,t,a){e.exports=a.p+"images/google_logo.svg"},1684:function(e,t,a){e.exports=a.p+"images/illustrations/alert.svg"},1685:function(e,t,a){e.exports=a.p+"images/illustrations/dashboard.svg"},1686:function(e,t,a){e.exports=a.p+"images/illustrations/no-query-results.svg"},1687:function(e,t,a){e.exports=a.p+"images/illustrations/query.svg"},1688:function(e,t,a){e.exports=a.p+"images/logo.png"},1689:function(e,t,a){e.exports=a.p+"images/logo_white.png"},1690:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=1690},1691:function(e,t,a){},1692:function(e,t,a){},1695:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(17),i=a.n(o),l=(a(6),a(7),a(11),a(2)),s=a.n(l),c=(a(20),a(31),a(27),a(667)),u=a.n(c),d=(a(42),a(144)),p=a.n(d),m=(a(192),a(79),a(223)),f=a.n(m),y=a(677),h=Object(y.a)();function b(e){var t=e.pathname,a=e.search,r=e.hash,n={};return n.path=t,n.search=Object(l.mapValues)(f.a.parse(a),e=>!!Object(l.isNil)(e)||e),n.hash=Object(l.trimStart)(r,"#"),n.url="".concat(t).concat(a).concat(r),n}var g={listen:function(e){return Object(l.isFunction)(e)?h.listen((t,a)=>e(g,a)):()=>{}},confirmChange:function(e){return Object(l.isFunction)(e)?h.block(t=>e(b(t),g)):()=>{}},update:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(l.isObject)(e)&&(e=Object(l.omitBy)({pathname:e.path,search:e.search,hash:e.hash},l.isUndefined),e=Object(l.extend)({pathname:g.path,search:g.search,hash:g.hash},e),Object(l.isObject)(e.search)&&(e.search=Object(l.omitBy)(Object(l.extend)({},g.search,e.search),l.isNil),e.search=Object(l.mapValues)(e.search,e=>!0===e?null:e),e.search=f.a.stringify(e.search))),t?h.replace(e):h.push(e)},url:void 0,path:void 0,setPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g.update({path:e},t)},search:void 0,setSearch:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g.update({search:e},t)},hash:void 0,setHash:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g.update({hash:e},t)}};function v(){Object(l.extend)(g,b(h.location))}h.listen(v),v();var E=g,O={canEdit:function(e){var t=e.user_id||e.user&&e.user.id;return this.hasPermission("admin")||t&&t===this.id},canCreate:function(){return this.hasPermission("create_query")||this.hasPermission("create_dashboard")||this.hasPermission("list_alerts")},hasPermission:function(e){return Object(l.includes)(this.permissions,e)},get isAdmin(){return this.hasPermission("admin")}},w={},j=[],S=p()("redash:auth"),P={loaded:!1};function _(e){S("Updating session to be:",e),Object(l.extend)(P,e,{loaded:!0}),Object(l.extend)(O,P.user),Object(l.extend)(w,P.client_config),Object(l.extend)(j,P.messages)}var k={isAuthenticated:function(){return P.loaded&&P.user.id},login:function(){var e=encodeURI(E.url);S("Calling login with next = %s",e),window.location.href="login?next=".concat(e)},logout:function(){S("Logout."),window.location.href="logout"},loadSession:function(){return S("Loading session"),P.loaded&&P.user.id?(S("Resolving with local value."),Promise.resolve(P)):(k.setApiKey(null),C.get("api/session").then(e=>(_(e),P)))},loadConfig:function(){return S("Loading config"),C.get("/api/config").then(e=>(_({client_config:e.client_config,user:{permissions:[]},messages:[]}),e))},setApiKey:function(e){S("Set API key to: %s",e),k.apiKey=e},getApiKey:function(){return k.apiKey},requireSession:function(){return S("Requested authentication"),k.isAuthenticated()?Promise.resolve(P):k.loadSession().then(()=>{if(k.isAuthenticated())return S("Loaded session"),P;S("Need to login, redirecting"),k.login()}).catch(()=>{S("Need to login, redirecting"),k.login()})}},C=u.a.create({paramsSerializer:e=>f.a.stringify(e)});C.interceptors.response.use(e=>{return e.data}),C.interceptors.request.use(e=>{var t=k.getApiKey();return t&&(e.headers.Authorization="Key ".concat(t)),e});var N=a(49),T=a.n(N),q=a(73),x=a.n(q),R=a(64),A=(a(44),a(1)),D=a.n(A),I=a(127),z=a.n(I);function M(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.objectCounters={}}var t,a,r;return t=e,(a=[{key:"refresh",value:function(){return C.get("api/organization/status").then(e=>(this.objectCounters=e.object_counters,this))}}])&&M(t.prototype,a),r&&M(t,r),e}()),F=a(46),L=a.n(F),U=a(4),B=a.n(U),Q=a(14),W=a.n(Q),G=a(15),H=a.n(G),K=a(26),Y=a.n(K),J=a(23),X=a.n(J),$=a(3),Z=a.n($),ee=a(669),te=a.n(ee);function ae(e){var t=e.message,a=e.icon,r=e.children,o=e.className;return n.a.createElement("div",{className:"p-15 text-center "+o},n.a.createElement("h3",{className:"m-t-0 m-b-0"},n.a.createElement("i",{className:"fa "+a})),n.a.createElement("br",null),t,r)}ae.propTypes={message:D.a.string,icon:D.a.string.isRequired,children:D.a.node,className:D.a.string},ae.defaultProps={message:"",children:null,className:"tiled bg-white"};var re=ae;a(314),a(447);function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ie(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var de=new Map,pe=new Set;var me=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),le(this,se(t).apply(this,arguments))}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){pe.add(this)}},{key:"componentWillUnmount",value:function(){pe.delete(this)}},{key:"render",value:function(){var e=this.props,t=e.name,a=e.children,r=oe(e,["name","children"]),o=de.get(t);return o?n.a.createElement(o,r,a):a}}])&&ie(a.prototype,r),o&&ie(a,o),t}();ue(me,"propTypes",{name:D.a.string.isRequired,children:D.a.node}),ue(me,"defaultProps",{children:null});a(771);function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ee="https://redash.io",Oe="/help",we=2e4,je="iframe_url",Se={HOME:["","Help"],VALUE_SOURCE_OPTIONS:["/user-guide/querying/query-parameters#Value-Source-Options","Guide: Value Source Options"],SHARE_DASHBOARD:["/user-guide/dashboards/sharing-dashboards","Guide: Sharing and Embedding Dashboards"],AUTHENTICATION_OPTIONS:["/user-guide/users/authentication-options","Guide: Authentication Options"],USAGE_DATA_SHARING:["/open-source/admin-guide/usage-data","Help: Anonymous Usage Data Sharing"],DS_ATHENA:["/data-sources/amazon-athena-setup","Guide: Help Setting up Amazon Athena"],DS_BIGQUERY:["/data-sources/bigquery-setup","Guide: Help Setting up BigQuery"],DS_URL:["/data-sources/querying-urls","Guide: Help Setting up URL"],DS_MONGODB:["/data-sources/mongodb-setup","Guide: Help Setting up MongoDB"],DS_GOOGLE_SPREADSHEETS:["/data-sources/querying-a-google-spreadsheet","Guide: Help Setting up Google Spreadsheets"],DS_GOOGLE_ANALYTICS:["/data-sources/google-analytics-setup","Guide: Help Setting up Google Analytics"],DS_AXIBASETSD:["/data-sources/axibase-time-series-database","Guide: Help Setting up Axibase Time Series"],DS_RESULTS:["/user-guide/querying/query-results-data-source","Guide: Help Setting up Query Results"],ALERT_SETUP:["/user-guide/alerts/setting-up-an-alert","Guide: Setting Up a New Alert"],MAIL_CONFIG:["/open-source/setup/#Mail-Configuration","Guide: Mail Configuration"],ALERT_NOTIF_TEMPLATE_GUIDE:["/user-guide/alerts/custom-alert-notifications","Guide: Custom Alerts Notifications"],FAVORITES:["/user-guide/querying/favorites-tagging/#Favorites","Guide: Favorites"],MANAGE_PERMISSIONS:["/user-guide/querying/writing-queries#Managing-Query-Permissions","Guide: Managing Query Permissions"],NUMBER_FORMAT_SPECS:["/user-guide/visualizations/formatting-numbers","Formatting Numbers"]},Pe=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=he(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==fe(o)&&"function"!=typeof o?be(r):o,ve(be(a),"iframeRef",n.a.createRef()),ve(be(a),"iframeLoadingTimeout",null),ve(be(a),"state",{visible:!1,loading:!1,error:!1,currentUrl:null}),ve(be(a),"loadIframe",e=>{clearTimeout(a.iframeLoadingTimeout),a.setState({loading:!0,error:!1}),a.iframeRef.current.src=e,a.iframeLoadingTimeout=setTimeout(()=>{a.setState({error:e,loading:!1})},we)}),ve(be(a),"onIframeLoaded",()=>{a.setState({loading:!1}),clearTimeout(a.iframeLoadingTimeout)}),ve(be(a),"onPostMessageReceived",e=>{if(Object(l.startsWith)(e.origin,Ee)){var t=e.data||{},r=t.type,n=t.message;r===je&&a.setState({currentUrl:n})}}),ve(be(a),"getUrl",()=>{var e=Object(l.get)(Se,a.props.type);return e?Ee+Oe+e[0]:a.props.href}),ve(be(a),"openDrawer",()=>{a.setState({visible:!0}),setTimeout(()=>a.loadIframe(a.getUrl()),300)}),ve(be(a),"closeDrawer",e=>{e&&e.preventDefault(),a.setState({visible:!1}),a.setState({visible:!1,currentUrl:null})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){window.addEventListener("message",this.onPostMessageReceived,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onPostMessageReceived),clearTimeout(this.iframeLoadingTimeout)}},{key:"render",value:function(){var e=Object(l.get)(Se,"".concat(this.props.type,"[1]"),this.props.title),t=Z()("help-trigger",this.props.className),a=this.state.currentUrl,r=Object(l.startsWith)(a||this.getUrl(),Ee);return n.a.createElement(n.a.Fragment,null,n.a.createElement(X.a,{title:this.props.showTooltip?n.a.createElement(n.a.Fragment,null,e,!r&&n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5}})):null},r?n.a.createElement("a",{onClick:this.openDrawer,className:t},this.props.children):n.a.createElement("a",{href:a||this.getUrl(),className:t,rel:"noopener noreferrer",target:"_blank"},this.props.children)),n.a.createElement(te.a,{placement:"right",closable:!1,onClose:this.closeDrawer,visible:this.state.visible,className:"help-drawer",destroyOnClose:!0,width:400},n.a.createElement("div",{className:"drawer-wrapper"},n.a.createElement("div",{className:"drawer-menu"},a&&n.a.createElement(X.a,{title:"Open page in a new window",placement:"left"},n.a.createElement("a",{href:a,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link"}))),n.a.createElement(X.a,{title:"Close",placement:"bottom"},n.a.createElement("a",{onClick:this.closeDrawer},n.a.createElement(W.a,{type:"close"})))),!this.state.error&&n.a.createElement("iframe",{ref:this.iframeRef,title:"Redash Help",src:"about:blank",className:Z()({ready:!this.state.loading}),onLoad:this.onIframeLoaded}),this.state.loading&&n.a.createElement(re,{icon:"fa-spinner fa-2x fa-pulse",message:"Loading...",className:"help-message"}),this.state.error&&n.a.createElement(re,{icon:"fa-exclamation-circle",className:"help-message"},"Something went wrong.",n.a.createElement("br",null),n.a.createElement("a",{href:this.state.error,target:"_blank",rel:"noopener"},"Click here")," ","to open the page in a new window.")),n.a.createElement(me,{name:"HelpDrawerExtraContent",onLeave:this.closeDrawer,openPageUrl:this.loadIframe})))}}])&&ye(a.prototype,r),o&&ye(a,o),t}();ve(Pe,"propTypes",{type:D.a.oneOf(Object.keys(Se)),href:D.a.string,title:D.a.node,className:D.a.string,showTooltip:D.a.bool,children:D.a.node}),ve(Pe,"defaultProps",{type:null,href:null,title:null,className:null,showTooltip:!0,children:n.a.createElement("i",{className:"fa fa-question-circle"})});a(21);var _e=a(25),ke=a.n(_e);a(66);function Ce(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ne(){return(Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Te=D.a.shape({props:D.a.shape({visible:D.a.bool,onOk:D.a.func,onCancel:D.a.func,afterClose:D.a.func}).isRequired,close:D.a.func.isRequired,dismiss:D.a.func.isRequired});function qe(e,t){var a={props:{visible:!0,okButtonProps:{},cancelButtonProps:{},onOk:()=>{},onCancel:()=>{},afterClose:()=>{}},close:()=>{},dismiss:()=>{}},r=null,o={onClose:()=>{},onDismiss:()=>{}},s=document.createElement("div");function c(){i.a.render(n.a.createElement(e,Ne({},t,{dialog:a})),s)}function u(e,t){return a.props.okButtonProps={disabled:!0},a.props.cancelButtonProps={disabled:!0},t(),c(),Promise.resolve(e).then(()=>{a.props.visible=!1}).finally(()=>{a.props.okButtonProps={},a.props.cancelButtonProps={},c()})}function d(e){return r||(r=u(o.onClose(e),()=>{a.props.okButtonProps.loading=!0}).finally(()=>{r=null})),r}function p(e){return r||(r=u(o.onDismiss(e),()=>{a.props.cancelButtonProps.loading=!0}).finally(()=>{r=null})),r}document.body.appendChild(s),a.props.onOk=d,a.props.onCancel=p,a.props.afterClose=function(){setTimeout(()=>{i.a.unmountComponentAtNode(s),document.body.removeChild(s)},10)},a.close=d,a.dismiss=p;var m={close:d,dismiss:p,update:e=>{t=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Ce(e,t,a[t])})}return e}({},t,e),c()},onClose:e=>(Object(l.isFunction)(e)&&(o.onClose=e),m),onDismiss:e=>(Object(l.isFunction)(e)&&(o.onDismiss=e),m)};return c(),m}function xe(e){return{Component:e,showModal:t=>qe(e,t)}}var Re=document.createElement("a");Re.style.display="none",document.body.appendChild(Re);var Ae=["origin","protocol","host","hostname","port","pathname","search","hash","href"];var De={parse:function(e){return Re.setAttribute("href",e),Object(l.pick)(Re,Ae)},stringify:function(e){return Object(l.extend)(Re,Object(l.pick)(e,Ae)),Re.href},normalize:function(e){return Re.setAttribute("href",e),Re.href}},Ie=(a(43),a(670));function ze(e,t){switch(e){case 404:return"It seems like the page you're looking for cannot be found.";case 401:case 403:return"It seems like you don’t have permission to see this page.";default:return t}}function Me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"It seems like we encountered an error. Try refreshing this page or contact your administrator.";if(Object(l.isObject)(e)){if(e.isAxiosError&&Object(l.isObject)(e.response)){var a=Object(l.get)(e,"response.data",{}),r=a.message||a.error||t;return ze(e.response.status,r)}if(e.status)return ze(e.status,t);if(e.message)return e.message}return t}function Ve(e){var t=e.error;return t?(console.error(t),n.a.createElement("div",{className:"fixed-container","data-test":"ErrorMessage"},n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"col-md-8 col-md-push-2"},n.a.createElement("div",{className:"error-state bg-white tiled"},n.a.createElement("div",{className:"error-state__icon"},n.a.createElement("i",{className:"zmdi zmdi-alert-circle-o"})),n.a.createElement("div",{className:"error-state__details"},n.a.createElement("h4",null,Me(t)))))))):null}function Fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Le(e,t,a[t])})}return e}function Le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Be(e){var t=Object(l.trimEnd)(De.normalize(""),"/")+"/";return e=De.normalize(e),!!Object(l.startsWith)(e,t)&&"/"+Object(l.trimStart)(e.substr(t.length),"/")}function Qe(e){var t=e.routes,a=e.onRouteChange,o=Ue(Object(r.useState)(null),2),i=o[0],s=o[1],c=Object(r.useRef)(null),u=Object(r.useRef)();return Object(r.useEffect)(()=>{var e=!1,a=new Ie.a(t,{resolveRoute:function(e,t){var a=e.route;if(Object(l.isFunction)(a.render))return Fe({},a,{routeParams:t})}});function r(t){if(!e){u.current&&u.current.reset();var r=Be(E.path);if(r===c.current)return;if(c.current=r,"REPLACE"===t)return;a.resolve({pathname:r}).then(t=>{e||c.current!==r||s(Fe({},t,{key:Math.random().toString(32).substr(2)}))}).catch(t=>{e||c.current!==r||s({render:e=>n.a.createElement(Ve,e.routeParams),routeParams:{error:t}})})}}r("PUSH");var o=E.listen((e,t)=>r(t));return()=>{e=!0,o()}},[t]),Object(r.useEffect)(()=>{a(i)},[i,a]),i?n.a.createElement(z.a,{ref:u,renderError:e=>n.a.createElement(Ve,{error:e})},i.render(i)):null}function We(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTimeout(()=>{!1===Be(e)?window.location=e:(e=De.parse(e),E.update({path:e.pathname,search:e.search,hash:e.hash},t))},10)}Ve.propTypes={error:D.a.object.isRequired},Qe.propTypes={routes:D.a.arrayOf(D.a.shape({path:D.a.string.isRequired,render:D.a.func,resolve:D.a.objectOf(D.a.any)})),onRouteChange:D.a.func},Qe.defaultProps={routes:[],onRouteChange:()=>{}};var Ge=[],He=Object(l.debounce)(()=>{var e=Ge;Ge=[],C.post("api/events",e)},1e3);function Ke(e,t,a,r){var n={action:e,object_type:t,object_id:a,timestamp:Date.now()/1e3,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)};Object(l.extend)(n,r),Ge.push(n),He()}function Ye(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Je=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,a,r;return t=e,(a=[{key:"refresh",value:function(){return Promise.resolve(this)}},{key:"canCreateDataSource",value:function(){return O.isAdmin}},{key:"isCreateDataSourceEnabled",value:function(){return O.isAdmin}},{key:"canCreateDestination",value:function(){return O.isAdmin}},{key:"isCreateDestinationEnabled",value:function(){return O.isAdmin}},{key:"canCreateDashboard",value:function(){return O.hasPermission("create_dashboard")}},{key:"isCreateDashboardEnabled",value:function(){return O.hasPermission("create_dashboard")}},{key:"canCreateAlert",value:function(){return!0}},{key:"canCreateUser",value:function(){return O.isAdmin}},{key:"isCreateUserEnabled",value:function(){return O.isAdmin}},{key:"isCreateQuerySnippetEnabled",value:function(){return!0}},{key:"getDashboardRefreshIntervals",value:function(){var e=w.dashboardRefreshIntervals;return Object(l.isArray)(e)?e:null}},{key:"getQueryRefreshIntervals",value:function(){var e=w.queryRefreshIntervals;return Object(l.isArray)(e)?e:null}}])&&Ye(t.prototype,a),r&&Ye(t,r),e}());function Xe(){return(Xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ze(e){var t=e.dialog,a=$e(Object(r.useState)(""),2),o=a[0],i=a[1],s=$e(Object(r.useState)(!1),2),c=s[0],u=s[1],d=$e(Object(r.useState)(!1),2),p=d[0],m=d[1],f=Je.isCreateDashboardEnabled();function y(){""!==o&&(m(!0),C.post("api/dashboards",{name:o}).then(e=>{t.close(),We("dashboard/".concat(e.slug,"?edit"))}),Ke("create","dashboard"))}return n.a.createElement(ke.a,Xe({},t.props,f?{}:{footer:null},{title:"New Dashboard",okText:"Save",cancelText:"Close",okButtonProps:{disabled:!c||p,loading:p,"data-test":"DashboardSaveButton"},cancelButtonProps:{disabled:p},onOk:y,closable:!p,maskClosable:!p,wrapProps:{"data-test":"CreateDashboardDialog"}}),n.a.createElement(me,{name:"CreateDashboardDialogExtra",disabled:!f},n.a.createElement(Y.a,{defaultValue:o,onChange:function(e){var t=Object(l.trim)(e.target.value);i(t),u(""!==t)},onPressEnter:y,placeholder:"Dashboard Name",disabled:p,autoFocus:!0})))}Ze.propTypes={dialog:Te.isRequired};var et=xe(Ze),tt=(a(67),{columns:6,rowHeight:50,margins:15,mobileBreakPoint:800,defaultSizeX:3,defaultSizeY:3,minSizeX:1,maxSizeX:6,minSizeY:1,maxSizeY:1e3}),at=a(8),rt=a.n(at);function nt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ot=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.title=t.title,this.name=t.name,this.type=t.type,this.global=t.global,this.parentQueryId=a,this.locals=[],this.urlPrefix="p_"}var t,a,r;return t=e,r=[{key:"getExecutionValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.isObject)(e)&&Object(l.isFunction)(e.getExecutionValue)?e.getExecutionValue(t):null}},{key:"setValue",value:function(e,t){return Object(l.isObject)(e)&&Object(l.isFunction)(e.setValue)?e.setValue(t):null}}],(a=[{key:"isEmptyValue",value:function(e){return Object(l.isNull)(this.normalizeValue(e))}},{key:"normalizeValue",value:function(e){return Object(l.isUndefined)(e)?null:e}},{key:"updateLocals",value:function(){Object(l.isArray)(this.locals)&&Object(l.each)(this.locals,e=>{e.setValue(this.value)})}},{key:"setValue",value:function(e){var t=this.normalizeValue(e);return this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}},{key:"getExecutionValue",value:function(){return this.value}},{key:"setPendingValue",value:function(e){this.pendingValue=this.normalizeValue(e)}},{key:"applyPendingValue",value:function(){this.hasPendingValue&&this.setValue(this.pendingValue)}},{key:"clearPendingValue",value:function(){this.pendingValue=void 0}},{key:"toUrlParams",value:function(){var e,t,a,r=this.urlPrefix;return e={},t="".concat(r).concat(this.name),a=this.isEmpty?null:this.value,t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},{key:"fromUrlParams",value:function(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);Object(l.has)(e,a)&&this.setValue(e[a])}},{key:"toQueryTextFragment",value:function(){return"{{ ".concat(this.name," }}")}},{key:"toSaveableObject",value:function(){return Object(l.omit)(this,["$$value","urlPrefix","pendingValue","parentQueryId"])}},{key:"isEmpty",get:function(){return Object(l.isNull)(this.normalizedValue)}},{key:"hasPendingValue",get:function(){return void 0!==this.pendingValue&&!Object(l.isEqual)(this.pendingValue,this.normalizedValue)}},{key:"normalizedValue",get:function(){return this.$$value}}])&&nt(t.prototype,a),r&&nt(t,r),e}();function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function st(e,t){return!t||"object"!==it(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dt=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=st(this,ct(t).call(this,e,a))).setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){var t=Object(l.toString)(e);return Object(l.isEmpty)(t)?null:t}}])&&lt(a.prototype,r),n&&lt(a,n),t}();function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bt=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ft(this,yt(t).call(this,e,a))).setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){if(Object(l.isNull)(e))return null;var t=Object(l.toNumber)(e);return isNaN(t)?null:t}}])&&mt(a.prototype,r),n&&mt(a,n),t}();a(120);function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jt=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Et(this,Ot(t).call(this,e,a))).enumOptions=e.enumOptions,r.multiValuesOptions=e.multiValuesOptions,r.setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){if(Object(l.isEmpty)(this.enumOptions))return null;var t=this.enumOptions.split("\n")||[];return this.multiValuesOptions?(Object(l.isArray)(e)||(e=[e]),e=Object(l.intersection)(e,t)):e&&!Object(l.isArray)(e)&&Object(l.includes)(t,e)||(e=t[0]),Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e}},{key:"getExecutionValue",value:function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}},{key:"toUrlParams",value:function(){var e,t,a,r=this.urlPrefix,n=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(n=JSON.stringify(this.value)),e={},t="".concat(r).concat(this.name),a=this.isEmpty?null:n,t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},{key:"fromUrlParams",value:function(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}}])&&vt(a.prototype,r),n&&vt(a,n),t}(),St=(a(455),a(224)),Pt=a.n(St);function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ct=p()("redash:services:QueryResult"),Nt=["filter","multi-filter","multiFilter"];function Tt(e){return function(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:Object(l.includes)(Nt,a[1])?a[0]:e}(e).replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var qt=e=>{var t=e.id;return C.get("api/query_results/".concat(t))},xt=e=>C.post((e=>e.id?"api/query_results/".concat(e.id):"api/query_results")(e),e),Rt={WAITING:"waiting",PROCESSING:"processing",DONE:"done",FAILED:"failed",LOADING_RESULT:"loading-result"},At={1:Rt.WAITING,2:Rt.PROCESSING,3:Rt.DONE,4:Rt.FAILED};function Dt(e,t){switch(Object(l.get)(t,"response.status")){case 403:return void e.update(t.response.data);case 400:if("job"in t.response.data)return void e.update(t.response.data);break;case 404:return void e.update({job:{error:"cached query result unavailable, please execute again.",status:4}})}Ct("Unknown error",t),e.update({job:{error:Object(l.get)(t,"response.data.message","Unknown error occurred. Please try again later."),status:4}})}var It=function(){function e(t){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deferred=((a={onStatusChange:e=>{}}).promise=new Promise((e,t)=>{a.resolve=e,a.reject=t}),a),this.job={},this.query_result={},this.status="waiting",this.updatedAt=rt()(),this.isLoadingResult=!1,t&&this.update(t)}var t,a,r;return t=e,r=[{key:"getById",value:function(t,a){var r=new e;return r.isLoadingResult=!0,r.deferred.onStatusChange(Rt.LOADING_RESULT),C.get("api/queries/".concat(t,"/results/").concat(a,".json")).then(e=>{r.isLoadingResult=!1,r.update(e)}).catch(e=>{r.isLoadingResult=!1,Dt(r,e)}),r}},{key:"getByQueryId",value:function(t,a,r){var n=new e;return C.post("api/queries/".concat(t,"/results"),{id:t,parameters:a,max_age:r}).then(e=>{n.update(e),"job"in e&&n.refreshStatus(t,a)}).catch(e=>{Dt(n,e)}),n}},{key:"get",value:function(t,a,r,n,o){var i=new e,l={data_source_id:t,parameters:r,query:a,max_age:n};return void 0!==o&&(l.query_id=o),xt(l).then(e=>{i.update(e),"job"in e&&i.refreshStatus(a,r)}).catch(e=>{Dt(i,e)}),i}}],(a=[{key:"update",value:function(e){if(Object(l.extend)(this,e),"query_result"in e){this.status=Rt.DONE,this.deferred.onStatusChange(Rt.DONE);var t={};Object(l.each)(this.query_result.data.rows,e=>{Object(l.forOwn)(e,(a,r)=>{var n=null;Object(l.isNumber)(a)?n="float":Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}T/)?(e[r]=rt.a.utc(a),n="datetime"):Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}$/)?(e[r]=rt.a.utc(a),n="date"):"object"===_t(a)&&null!==a?e[r]=JSON.stringify(a):n="string",null!==n&&(void 0!==t[r]&&t[r]!==n?t[r]="string":t[r]=n)})}),Object(l.each)(this.query_result.data.columns,e=>{e.name=""+e.name,t[e.name]&&(null!=e.type&&"string"!==e.type||(e.type=t[e.name]))}),this.deferred.resolve(this)}else 3===this.job.status||2===this.job.status?(this.deferred.onStatusChange(Rt.PROCESSING),this.status="processing"):4===this.job.status?(this.status=At[this.job.status],this.deferred.reject(new Gt(this.job.error))):(this.deferred.onStatusChange(void 0),this.status=void 0)}},{key:"getId",value:function(){var e=null;return"query_result"in this&&(e=this.query_result.id),e}},{key:"cancelExecution",value:function(){C.delete("api/jobs/".concat(this.job.id))}},{key:"getStatus",value:function(){return this.isLoadingResult?Rt.LOADING_RESULT:this.status||At[this.job.status]}},{key:"getError",value:function(){if("None"!==this.job.error)return this.job.error}},{key:"getLog",value:function(){return this.query_result.data&&this.query_result.data.log&&0!==this.query_result.data.log.length?this.query_result.data.log:null}},{key:"getUpdatedAt",value:function(){return this.query_result.retrieved_at||1e3*this.job.updated_at||this.updatedAt}},{key:"getRuntime",value:function(){return this.query_result.runtime}},{key:"getRawData",value:function(){return this.query_result.data?this.query_result.data.rows:null}},{key:"getData",value:function(){return this.query_result.data?this.query_result.data.rows:null}},{key:"isEmpty",value:function(){return null===this.getData()||0===this.getData().length}},{key:"getColumns",value:function(){return void 0===this.columns&&this.query_result.data&&(this.columns=this.query_result.data.columns),this.columns}},{key:"getColumnNames",value:function(){return void 0===this.columnNames&&this.query_result.data&&(this.columnNames=this.query_result.data.columns.map(e=>e.name)),this.columnNames}},{key:"getColumnFriendlyNames",value:function(){return this.getColumnNames().map(e=>Tt(e))}},{key:"getFilters",value:function(){if(!this.getColumns())return[];var e=[];return this.getColumns().forEach(t=>{var a=t.name,r=a.split("::")[1]||a.split("__")[1];if(Object(l.includes)(Nt,r)){var n={name:a,friendlyName:Tt(a),column:t,values:[],multiple:"multiFilter"===r||"multi-filter"===r};e.push(n)}},this),this.getRawData().forEach(t=>{e.forEach(e=>{e.values.push(t[e.name]),1===e.values.length&&(e.multiple?e.current=[t[e.name]]:e.current=t[e.name])})}),e.forEach(e=>{e.values=Object(l.uniqBy)(e.values,e=>rt.a.isMoment(e)?e.unix():e)}),e}},{key:"toPromise",value:function(e){return e&&(this.deferred.onStatusChange=e),this.deferred.promise}},{key:"loadLatestCachedResult",value:function(e,t){C.post("api/queries/".concat(e,"/results"),{queryId:e,parameters:t}).then(e=>{this.update(e)}).catch(e=>{Dt(this,e)})}},{key:"loadResult",value:function(e){this.isLoadingResult=!0,this.deferred.onStatusChange(Rt.LOADING_RESULT),qt({id:this.job.query_result_id}).then(e=>{this.update(e),this.isLoadingResult=!1}).catch(t=>{void 0===e&&(e=0),e>3?(Ct("Connection error while trying to load result",t),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}}),this.isLoadingResult=!1):setTimeout(()=>{this.loadResult(e+1)},1e3*Math.pow(2,e))})}},{key:"refreshStatus",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=()=>k.isAuthenticated()?this.loadResult():this.loadLatestCachedResult(e,t);(k.isAuthenticated()?C.get("api/jobs/".concat(this.job.id)):C.get("api/queries/".concat(e,"/jobs/").concat(this.job.id))).then(n=>{if(this.update(n),"processing"===this.getStatus()&&this.job.query_result_id&&"None"!==this.job.query_result_id)r();else if("failed"!==this.getStatus()){setTimeout(()=>{this.refreshStatus(e,t,a+1)},a>10?3e3:500)}}).catch(e=>{Ct("Connection error",e),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}})})}},{key:"getLink",value:function(e,t,a){var r="api/queries/".concat(e,"/results/").concat(this.getId(),".").concat(t);return a&&(r="".concat(r,"?api_key=").concat(a)),r}},{key:"getName",value:function(e,t){return"".concat(e.replace(/ /g,"_")+rt()(this.getUpdatedAt()).format("_YYYY_MM_DD"),".").concat(t)}}])&&kt(t.prototype,a),r&&kt(t,r),e}();function zt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Mt(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Vt(){return(Vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t,a){return t&&Lt(e.prototype,t),a&&Lt(e,a),e}Pt.a.escape=l.identity;var Bt=p()("redash:services:query");var Qt=function(){function e(t){Ft(this,e),Object(l.extend)(this,t),Object(l.has)(this,"options")||(this.options={}),Object(l.isArray)(this.options.parameters)||(this.options.parameters=[])}return Ut(e,[{key:"isNew",value:function(){return void 0===this.id}},{key:"hasDailySchedule",value:function(){return this.schedule&&null!==this.schedule.match(/\d\d:\d\d/)}},{key:"scheduleInLocalTime",value:function(){var e=this.schedule.split(":");return rt.a.utc().hour(e[0]).minute(e[1]).local().format("HH:mm")}},{key:"hasResult",value:function(){return!(!this.latest_query_data&&!this.latest_query_data_id)}},{key:"paramsRequired",value:function(){return this.getParameters().isRequired()}},{key:"hasParameters",value:function(){return this.getParametersDefs().length>0}},{key:"prepareQueryResultExecution",value:function(e,t){var a=this.getParameters(),r=a.getMissing();if(r.length>0){var n="parameter",o="value";return r.length>1&&(n="parameters",o="values"),new It({job:{error:"missing ".concat(o," for ").concat(r.join(", ")," ").concat(n,"."),status:4}})}return a.isRequired()&&(this.latest_query_data=null,this.latest_query_data_id=null),this.latest_query_data&&0!==t?this.queryResult||(this.queryResult=new It({query_result:this.latest_query_data})):this.latest_query_data_id&&0!==t?this.queryResult||(this.queryResult=It.getById(this.id,this.latest_query_data_id)):this.queryResult=e(),this.queryResult}},{key:"getQueryResult",value:function(e){return this.prepareQueryResultExecution(()=>It.getByQueryId(this.id,this.getParameters().getExecutionValues(),e),e)}},{key:"getQueryResultByText",value:function(e,t){var a=t||this.query;if(!a)return new Gt("Can't execute empty query.");var r=this.getParameters().getExecutionValues({joinListValues:!0});return this.prepareQueryResultExecution(()=>It.get(this.data_source_id,a,r,e,this.id),e)}},{key:"getUrl",value:function(e,t){var a="queries/".concat(this.id);e&&(a+="/source");var r={};return this.getParameters().isRequired()&&this.getParametersDefs().forEach(e=>{Object(l.extend)(r,e.toUrlParams())}),Object.keys(r).forEach(e=>null==r[e]&&delete r[e]),""!==(r=Object(l.map)(r,(e,t)=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e))).join("&"))&&(a+="?".concat(r)),t&&(a+="#".concat(t)),a}},{key:"getQueryResultPromise",value:function(){return this.getQueryResult().toPromise()}},{key:"getParameters",value:function(){return this.$parameters||(this.$parameters=new Wt(this,E.search)),this.$parameters}},{key:"getParametersDefs",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getParameters().get(e)}},{key:"favorite",value:function(){return e.favorite(this)}},{key:"unfavorite",value:function(){return e.unfavorite(this)}},{key:"clone",value:function(){var e=Object(l.clone)(this);return e.$parameters=null,e.getParameters(),e}}]),e}(),Wt=function(){function e(t,a){Ft(this,e),this.query=t,this.updateParameters(),this.initFromQueryString(a)}return Ut(e,[{key:"parseQuery",value:function(){var e=()=>Object(l.map)(this.query.options.parameters,e=>e.name),t=[];if(void 0!==this.query.query)try{var a=Pt.a.parse(this.query.query);t=Object(l.uniq)(function e(t){var a=[];return t.forEach(t=>{"name"===t[0]||"&"===t[0]?a.push(t[1].split(".")[0]):"#"===t[0]&&(a=Object(l.union)(a,e(t[4])))}),a}(a))}catch(a){Bt("Failed parsing parameters: ",a),t=e()}else t=e();return t}},{key:"updateParameters",value:function(e){if(this.query.query!==this.cachedQueryText){this.cachedQueryText=this.query.query;var t=e?this.parseQuery():Object(l.map)(this.query.options.parameters,e=>e.name);this.query.options.parameters=this.query.options.parameters||[];var a={};this.query.options.parameters.forEach(e=>{a[e.name]=e}),t.forEach(e=>{Object(l.has)(a,e)||this.query.options.parameters.push(qa({title:e,name:e,type:"text",value:null,global:!1}))});var r=this.query.options.parameters;this.query.options.parameters=r.filter(e=>Object(l.includes)(t,e.name)).map(e=>e instanceof ot?e:qa(e,this.query.id))}else{var n=this.query.options.parameters;Object(l.find)(n,e=>!(e instanceof ot))&&(this.query.options.parameters=Object(l.map)(n,e=>e instanceof ot?e:qa(e,this.query.id)))}}},{key:"initFromQueryString",value:function(e){this.get().forEach(t=>{t.fromUrlParams(e)})}},{key:"get",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.updateParameters(e),this.query.options.parameters}},{key:"add",value:function(e){this.query.options.parameters=this.query.options.parameters.filter(t=>t.name!==e.name);var t=qa(e);return this.query.options.parameters.push(t),t}},{key:"getMissing",value:function(){return Object(l.map)(Object(l.filter)(this.get(),e=>e.isEmpty),e=>e.title)}},{key:"isRequired",value:function(){return!Object(l.isEmpty)(this.get())}},{key:"getExecutionValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.get();return Object(l.zipObject)(Object(l.map)(t,e=>e.name),Object(l.map)(t,t=>t.getExecutionValue(e)))}},{key:"hasPendingValues",value:function(){return Object(l.some)(this.get(),e=>e.hasPendingValue)}},{key:"applyPendingValues",value:function(){Object(l.each)(this.get(),e=>e.applyPendingValue())}},{key:"toUrlParams",value:function(){if(0===this.get().length)return"";var e=Vt.apply(void 0,Mt(this.get().map(e=>e.toUrlParams())));return Object.keys(e).forEach(t=>null==e[t]&&delete e[t]),Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}}]),e}(),Gt=function(){function e(t){Ft(this,e),this.errorMessage=t,this.updatedAt=rt.a.utc()}return Ut(e,[{key:"getUpdatedAt",value:function(){return this.updatedAt}},{key:"getError",value:function(){return this.errorMessage}},{key:"toPromise",value:function(){return Promise.reject(this)}},{key:"getStatus",value:function(){return"failed"}},{key:"getData",value:function(){return null}},{key:"getLog",value:function(){return null}}]),e}(),Ht=e=>new Qt(e),Kt=e=>(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){zt(e,t,a[t])})}return e})({},e,{results:Object(l.map)(e.results,Ht)}),Yt={query:e=>C.get("api/queries",{params:e}).then(Kt),get:e=>C.get("api/queries/".concat(e.id),e).then(Ht),save:e=>C.post((e=>e.id?"api/queries/".concat(e.id):"api/queries")(e),e).then(Ht),delete:e=>C.delete("api/queries/".concat(e.id)),recent:e=>C.get("api/queries/recent",{params:e}).then(e=>Object(l.map)(e,Ht)),archive:e=>C.get("api/queries/archive",{params:e}).then(Kt),myQueries:e=>C.get("api/queries/my",{params:e}).then(Kt),fork:e=>{var t=e.id;return C.post("api/queries/".concat(t,"/fork"),{id:t}).then(Ht)},resultById:e=>C.get("api/queries/".concat(e.id,"/results.json")),asDropdown:e=>C.get("api/queries/".concat(e.id,"/dropdown")),associatedDropdown:e=>{var t=e.queryId,a=e.dropdownQueryId;return C.get("api/queries/".concat(t,"/dropdowns/").concat(a))},favorites:e=>C.get("api/queries/favorites",{params:e}).then(Kt),favorite:e=>C.post("api/queries/".concat(e.id,"/favorite")),unfavorite:e=>C.delete("api/queries/".concat(e.id,"/favorite"))};function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xt(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $t(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zt(e){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ea(e,t){return(ea=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Yt.newQuery=function(){return new Qt({query:"",name:"New Query",schedule:null,user:O,options:{},tags:[],can_edit:!0})},Yt.format=function(e,t){if("json"!==e)return"sql"===e?C.post("api/queries/format",{query:t}).then(e=>e.query):Promise.reject("Query formatting is not supported for your data source syntax.");try{var a=JSON.stringify(JSON.parse(t)," ",4);return Promise.resolve(a)}catch(e){return Promise.reject(String(e))}},Object(l.extend)(Qt,Yt);var ta=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=$t(this,Zt(t).call(this,e,a))).queryId=e.queryId,r.multiValuesOptions=e.multiValuesOptions,r.setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ea(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){return Object(l.isUndefined)(e)||Object(l.isNull)(e)||Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e=this.multiValuesOptions?Object(l.isArray)(e)?e:[e]:Object(l.isArray)(e)?e[0]:e}},{key:"getExecutionValue",value:function(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}},{key:"toUrlParams",value:function(){var e,t,a,r=this.urlPrefix,n=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(n=JSON.stringify(this.value)),e={},t="".concat(r).concat(this.name),a=this.isEmpty?null:n,t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}},{key:"fromUrlParams",value:function(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}},{key:"loadDropdownValues",value:function(){return this.parentQueryId?Qt.associatedDropdown({queryId:this.parentQueryId,dropdownQueryId:this.queryId}).catch(()=>Promise.resolve([])):Qt.asDropdown({id:this.queryId}).catch(Promise.resolve([]))}}])&&Xt(a.prototype,r),n&&Xt(a,n),t}();function aa(e){return(aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ra(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function na(e,t){return!t||"object"!==aa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function oa(e){return(oa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ia(e,t){return(ia=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var la={date:"YYYY-MM-DD","datetime-local":"YYYY-MM-DD HH:mm","datetime-with-seconds":"YYYY-MM-DD HH:mm:ss"},sa="d_",ca={now:{name:"Today/Now",value:()=>rt()()},yesterday:{name:"Yesterday",value:()=>rt()().subtract(1,"day")}},ua=D.a.oneOf(Object(l.values)(ca));function da(e){return Object(l.startsWith)(e,sa)&&Object(l.has)(ca,e.substring(sa.length))}function pa(e){return Object(l.includes)(ca,e)}function ma(e){return da(e)?ca[e.substring(sa.length)]:null}var fa=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=na(this,oa(t).call(this,e,a))).useCurrentDateTime=e.useCurrentDateTime,r.setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ia(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){if(da(e))return ma(e);if(pa(e))return e;var t=rt()(e);return t.isValid()?t:null}},{key:"setValue",value:function(e){var t=this.normalizeValue(e);return pa(t)?this.value=sa+Object(l.findKey)(ca,t):rt.a.isMoment(t)?this.value=t.format(la[this.type]):this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}},{key:"getExecutionValue",value:function(){return this.hasDynamicValue?this.normalizedValue.value().format(la[this.type]):Object(l.isNull)(this.value)&&this.useCurrentDateTime?rt()().format(la[this.type]):this.value}},{key:"hasDynamicValue",get:function(){return pa(this.normalizedValue)}}])&&ra(a.prototype,r),n&&ra(a,n),t}();a(317);function ya(e){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ha(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ba(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ga(e,t){return!t||"object"!==ya(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function va(e,t,a){return(va="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ea(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function Ea(e){return(Ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oa(e,t){return(Oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wa={"date-range":"YYYY-MM-DD","datetime-range":"YYYY-MM-DD HH:mm","datetime-range-with-seconds":"YYYY-MM-DD HH:mm:ss"},ja="d_",Sa={today:{name:"Today",value:()=>[rt()().startOf("day"),rt()().endOf("day")]},yesterday:{name:"Yesterday",value:()=>[rt()().subtract(1,"day").startOf("day"),rt()().subtract(1,"day").endOf("day")]},this_week:{name:"This week",value:()=>[rt()().startOf("week"),rt()().endOf("week")]},this_month:{name:"This month",value:()=>[rt()().startOf("month"),rt()().endOf("month")]},this_year:{name:"This year",value:()=>[rt()().startOf("year"),rt()().endOf("year")]},last_week:{name:"Last week",value:()=>[rt()().subtract(1,"week").startOf("week"),rt()().subtract(1,"week").endOf("week")]},last_month:{name:"Last month",value:()=>[rt()().subtract(1,"month").startOf("month"),rt()().subtract(1,"month").endOf("month")]},last_year:{name:"Last year",value:()=>[rt()().subtract(1,"year").startOf("year"),rt()().subtract(1,"year").endOf("year")]},last_7_days:{name:"Last 7 days",value:()=>[rt()().subtract(7,"days"),rt()()]},last_14_days:{name:"Last 14 days",value:()=>[rt()().subtract(14,"days"),rt()()]},last_30_days:{name:"Last 30 days",value:()=>[rt()().subtract(30,"days"),rt()()]},last_60_days:{name:"Last 60 days",value:()=>[rt()().subtract(60,"days"),rt()()]},last_90_days:{name:"Last 90 days",value:()=>[rt()().subtract(90,"days"),rt()()]}},Pa=D.a.oneOf(Object(l.values)(Sa));function _a(e){return!!Object(l.startsWith)(e,ja)&&!!Sa[e.substring(ja.length)]}function ka(e){return Object(l.includes)(Sa,e)}function Ca(e){return _a(e)?Sa[e.substring(ja.length)]:null}var Na=function(e){function t(e,a){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ga(this,Ea(t).call(this,e,a))).setValue(e.value),r}var a,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oa(e,t)}(t,ot),a=t,(r=[{key:"normalizeValue",value:function(e){return _a(e)?Ca(e):ka(e)?e:(Object(l.isObject)(e)&&!Object(l.isArray)(e)&&(e=[e.start,e.end]),Object(l.isArray)(e)&&2===e.length&&(e=[rt()(e[0]),rt()(e[1])])[0].isValid()&&e[1].isValid()?e:null)}},{key:"setValue",value:function(e){var t=this.normalizeValue(e);return ka(t)?this.value=ja+Object(l.findKey)(Sa,t):Object(l.isArray)(t)?this.value={start:t[0].format(wa[this.type]),end:t[1].format(wa[this.type])}:this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}},{key:"getExecutionValue",value:function(){if(this.hasDynamicValue){var e=ha(this.normalizedValue.value().map(e=>e.format(wa[this.type])),2);return{start:e[0],end:e[1]}}return this.value}},{key:"toUrlParams",value:function(){var e,a,r,n=this.urlPrefix;return Object(l.isObject)(this.value)&&this.value.start&&this.value.end?(e={},a="".concat(n).concat(this.name),r="".concat(this.value.start,"--").concat(this.value.end),a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e):va(Ea(t.prototype),"toUrlParams",this).call(this)}},{key:"fromUrlParams",value:function(e){var t=this.urlPrefix,a="".concat(t).concat(this.name),r="".concat(t).concat(this.name,".start"),n="".concat(t).concat(this.name,".end");if(Object(l.has)(e,a)){var o=e[a].split("--");2===o.length?this.setValue(o):this.setValue(e[a])}else Object(l.has)(e,r)&&Object(l.has)(e,n)&&this.setValue([e[r],e[n]])}},{key:"toQueryTextFragment",value:function(){return"{{ ".concat(this.name,".start }} {{ ").concat(this.name,".end }}")}},{key:"hasDynamicValue",get:function(){return ka(this.normalizedValue)}}])&&ba(a.prototype,r),n&&ba(a,n),t}();function Ta(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function qa(e,t){switch(e.type){case"number":return new bt(e,t);case"enum":return new jt(e,t);case"query":return new ta(e,t);case"date":case"datetime-local":case"datetime-with-seconds":return new fa(e,t);case"date-range":case"datetime-range":case"datetime-range-with-seconds":return new Na(e,t);default:return new dt(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Ta(e,t,a[t])})}return e}({},e,{type:"text"}),t)}}function xa(e){return qa(e,e.parentQueryId)}var Ra=a(47);function Aa(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Da="textbox",Ia="visualization",za="restricted";var Ma,Va,Fa,La={DashboardLevel:"dashboard-level",WidgetLevel:"widget-level",StaticValue:"static-value"},Ua=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object(l.extend)(this,t);var a=function(e){e.width=1;var t={autoHeight:!1,sizeX:Math.round(tt.columns/2),sizeY:tt.defaultSizeY,minSizeX:tt.minSizeX,maxSizeX:tt.maxSizeX,minSizeY:tt.minSizeY,maxSizeY:tt.maxSizeY},a=e.visualization?Ra.registeredVisualizations[e.visualization.type]:null;if(Object(l.isObject)(a)){Object.prototype.hasOwnProperty.call(a,"autoHeight")&&(t.autoHeight=a.autoHeight);var r=parseInt(a.minColumns,10);isFinite(r)&&r>=0&&(t.minSizeX=r);var n=parseInt(a.maxColumns,10);isFinite(n)&&n>=0&&(t.maxSizeX=Math.min(n,tt.columns));var o=parseInt(a.height,10);isFinite(o)&&(t.minSizeY=Math.ceil(o/tt.rowHeight));var i=parseInt(a.minRows,10);isFinite(i)&&(t.minSizeY=i);var s=parseInt(a.maxRows,10);isFinite(s)&&s>=0&&(t.maxSizeY=s);var c=parseInt(a.defaultColumns,10);isFinite(c)&&c>0&&(t.sizeX=c);var u=parseInt(a.defaultRows,10);isFinite(u)&&u>0&&(t.sizeY=u)}return t}(this);this.options=this.options||{},this.options.position=Object(l.extend)({},a,Object(l.pick)(this.options.position,["col","row","sizeX","sizeY","autoHeight"])),this.options.position.sizeY<0&&(this.options.position.autoHeight=!0)}var t,a,r;return t=e,(a=[{key:"getQuery",value:function(){return!this.query&&this.visualization&&(this.query=new Qt(this.visualization.query)),this.query}},{key:"getQueryResult",value:function(){return this.data}},{key:"getName",value:function(){return this.visualization?"".concat(this.visualization.query.name," (").concat(this.visualization.name,")"):Object(l.truncate)(this.text,20)}},{key:"load",value:function(e,t){return this.visualization?((e||void 0===this.queryResult)&&(this.loading=!0,this.refreshStartedAt=rt()(),(void 0===t||e)&&(t=e?0:void 0),this.queryResult=this.getQuery().getQueryResult(t),this.queryResult.toPromise().then(e=>(this.loading=!1,this.data=e,e)).catch(e=>(this.loading=!1,this.data=e,e))),this.queryResult.toPromise()):Promise.resolve()}},{key:"save",value:function(e,t){var a=Object(l.pick)(this,"options","text","id","width","dashboard_id","visualization_id");e&&t&&(a[e]=Object(l.merge)({},a[e],t));var r="api/widgets";return this.id&&(r="".concat(r,"/").concat(this.id)),C.post(r,a).then(e=>(Object(l.each)(e,(e,t)=>{this[t]=e}),this))}},{key:"delete",value:function(){var e="api/widgets/".concat(this.id);return C.delete(e)}},{key:"isStaticParam",value:function(t){return this.getParameterMappings()[t.name].type===e.MappingType.StaticValue}},{key:"getParametersDefs",value:function(){var t=this.getParameterMappings(),a=this.getQuery()?this.getQuery().getParametersDefs():[],r=E.search,n=[e.MappingType.WidgetLevel,e.MappingType.StaticValue];return Object(l.map)(Object(l.filter)(a,e=>n.indexOf(t[e.name].type)>=0),a=>{var n=t[a.name],o=xa(a);return o.title=n.title||a.title,o.locals=[a],o.urlPrefix="p_w".concat(this.id,"_"),n.type===e.MappingType.StaticValue?o.setValue(n.value):o.fromUrlParams(r),o})}},{key:"getParameterMappings",value:function(){Object(l.isObject)(this.options.parameterMappings)||(this.options.parameterMappings={});var t={},a=this.getQuery()?this.getQuery().getParametersDefs(!1):[];Object(l.each)(a,a=>{t[a.name]=!0,Object(l.isObject)(this.options.parameterMappings[a.name])||(this.options.parameterMappings[a.name]={name:a.name,type:a.global?e.MappingType.DashboardLevel:e.MappingType.WidgetLevel,mapTo:a.name,value:null,title:""})});var r=Object(l.difference)(Object(l.keys)(this.options.parameterMappings),Object(l.keys)(t));return Object(l.each)(r,e=>{delete this.options.parameterMappings[e]}),this.options.parameterMappings}},{key:"getLocalParameters",value:function(){return Object(l.filter)(this.getParametersDefs(),e=>!this.isStaticParam(e))}},{key:"type",get:function(){return this.visualization?Ia:this.restricted?za:Da}}])&&Aa(t.prototype,a),r&&Aa(t,r),e}();Fa=La,(Va="MappingType")in(Ma=Ua)?Object.defineProperty(Ma,Va,{value:Fa,enumerable:!0,configurable:!0,writable:!0}):Ma[Va]=Fa;var Ba=Ua;function Qa(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Wa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Ga(e,t,a[t])})}return e}function Ga(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ha(e){var t=Math.max(s.a.chain(e).map(e=>e.options.position.sizeY).max().value(),20)+5;return s.a.chain(e).sortBy(e=>e.options.position.row).groupBy(e=>e.options.position.row).reduce((e,a)=>{var r=1;return s.a.each(a,a=>{r=Math.max(r,a.options.position.autoHeight?t:a.options.position.sizeY),a.options.position.row=e,a.options.position.sizeY<1&&(a.options.position.sizeY=t)}),e+r},0).value(),e=s.a.sortBy(e,e=>e.options.position.col),e=s.a.sortBy(e,e=>e.options.position.row)}function Ka(e){s.a.extend(this,e)}function Ya(e){return Ha(s.a.map(e,e=>new Ba(e)))}function Ja(e){return(e=new Ka(e)).widgets&&(e.widgets=Ya(e.widgets)),e.publicAccessEnabled=void 0!==e.public_url,e}function Xa(e){return e=e.results?Wa({},e,{results:s.a.map(e.results,Ja)}):Ja(e)}var $a={get:e=>{var t=e.slug;return C.get("api/dashboards/".concat(t)).then(Xa)},getByToken:e=>{var t=e.token;return C.get("api/dashboards/public/".concat(t)).then(Xa)},save:e=>C.post((e=>e.slug?"api/dashboards/".concat(e.slug):"api/dashboards")(e),e).then(Xa),delete:e=>{var t=e.slug;return C.delete("api/dashboards/".concat(t)).then(Xa)},query:e=>C.get("api/dashboards",{params:e}).then(Xa),recent:e=>C.get("api/dashboards/recent",{params:e}).then(Xa),favorites:e=>C.get("api/dashboards/favorites",{params:e}).then(Xa),favorite:e=>{var t=e.slug;return C.post("api/dashboards/".concat(t,"/favorite"))},unfavorite:e=>{var t=e.slug;return C.delete("api/dashboards/".concat(t,"/favorite"))}};s.a.extend(Ka,$a),Ka.prepareDashboardWidgets=Ya,Ka.prepareWidgetsForDashboard=Ha,Ka.prototype.canEdit=function(){return O.canEdit(this)||this.can_edit},Ka.prototype.getParametersDefs=function(){var e={},t=E.search;return s.a.each(this.widgets,t=>{if(t.getQuery()){var a=t.getParameterMappings();t.getQuery().getParametersDefs(!1).forEach(t=>{var r=a[t.name];r.type===Ba.MappingType.DashboardLevel&&(e[r.mapTo]||(e[r.mapTo]=xa(t),e[r.mapTo].name=r.mapTo,e[r.mapTo].title=r.title||t.title,e[r.mapTo].locals=[]),e[r.mapTo].locals.push(t))})}}),s.a.values(s.a.each(e,e=>{e.setValue(e.value),e.fromUrlParams(t)}))},Ka.prototype.addWidget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={dashboard_id:this.id,options:Wa({},t,{isHidden:!1,position:{}}),text:"",visualization_id:null,visualization:null};s.a.isString(e)?a.text=e:s.a.isObject(e)&&(a.visualization_id=e.id,a.visualization=e);var r,n,o,i,l=new Ba(a),c=(r=this.widgets,n=l,o=s.a.extend({sizeX:tt.defaultSizeX},s.a.extend({},n.options).position).sizeX,i=s.a.chain(r).map(e=>{var t=s.a.extend({},e.options),a=s.a.extend({row:0,sizeY:0},t.position);return{left:a.col,top:a.row,right:a.col+a.sizeX,bottom:a.row+a.sizeY,width:a.sizeX,height:a.sizeY}}).reduce((e,t)=>{for(var a=Math.max(t.left,0),r=Math.min(t.right,e.length+1),n=a;n<r;n+=1)e[n]=Math.max(e[n],t.bottom);return e},s.a.map(new Array(tt.columns),s.a.constant(0))).value(),s.a.chain(s.a.range(0,tt.columns-o+1)).map(e=>({col:e,row:s.a.chain(i).slice(e,e+o).max().value()})).sortBy("row").first().value());return l.options.position.col=c.col,l.options.position.row=c.row,l.save().then(()=>(this.widgets=[].concat(Qa(this.widgets),[l]),l))},Ka.prototype.favorite=function(){return Ka.favorite(this)},Ka.prototype.unfavorite=function(){return Ka.unfavorite(this)};var Za=a(389),er=a(111),tr=a.n(er);function ar(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function rr(e){var t=e.fetch,a=e.urlTemplate,o=ar(Object(r.useState)(),2),i=o[0],s=o[1],c=ar(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(l.isEmpty)(i),m=Object(r.useMemo)(()=>Object(l.template)(a),[a]),f=Object(r.useCallback)(function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];d(e),t().then(e=>{var t=e.results;s(t)}).finally(()=>{d(!1)})},[t]);Object(r.useEffect)(()=>{f(!1)},[f]);var y=n.a.createElement(H.a,{className:"favorites-dropdown"},p?n.a.createElement(H.a.Item,null,n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:"fa fa-star"})),"No favorites selected yet ",n.a.createElement(Pe,{type:"FAVORITES"})):i.map(e=>n.a.createElement(H.a.Item,{key:e.id},n.a.createElement("a",{href:m(e)},n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:"fa fa-star"})),e.name))));return n.a.createElement(L.a,{disabled:u,trigger:["click"],placement:"bottomLeft",onVisibleChange:e=>e&&f(),overlay:y},u?n.a.createElement(W.a,{type:"loading",spin:!0}):n.a.createElement(W.a,{type:"down"}))}rr.propTypes={fetch:D.a.func.isRequired,urlTemplate:D.a.string.isRequired};a(1323);function nr(e){We("queries?q=".concat(encodeURIComponent(e)))}function or(){var e=Object(r.useCallback)(()=>{et.showModal()},[]);return n.a.createElement("div",{className:"app-header","data-platform":"desktop"},n.a.createElement("div",null,n.a.createElement(H.a,{mode:"horizontal",selectable:!1},O.hasPermission("list_dashboards")&&n.a.createElement(H.a.Item,{key:"dashboards",className:"dropdown-menu-item"},n.a.createElement(B.a,{href:"dashboards"},"Dashboards"),n.a.createElement(rr,{fetch:Ka.favorites,urlTemplate:"dashboard/${slug}"})),O.hasPermission("view_query")&&n.a.createElement(H.a.Item,{key:"queries",className:"dropdown-menu-item"},n.a.createElement(B.a,{href:"queries"},"Queries"),n.a.createElement(rr,{fetch:Qt.favorites,urlTemplate:"queries/${id}"})),O.hasPermission("list_alerts")&&n.a.createElement(H.a.Item,{key:"alerts"},n.a.createElement(B.a,{href:"alerts"},"Alerts"))),O.canCreate()&&n.a.createElement(L.a,{trigger:["click"],overlay:n.a.createElement(H.a,null,O.hasPermission("create_query")&&n.a.createElement(H.a.Item,{key:"new-query"},n.a.createElement("a",{href:"queries/new"},"New Query")),O.hasPermission("create_dashboard")&&n.a.createElement(H.a.Item,{key:"new-dashboard"},n.a.createElement("a",{onMouseUp:e},"New Dashboard")),O.hasPermission("list_alerts")&&n.a.createElement(H.a.Item,{key:"new-alert"},n.a.createElement("a",{href:"alerts/new"},"New Alert")))},n.a.createElement(B.a,{type:"primary","data-test":"CreateButton"},"Create ",n.a.createElement(W.a,{type:"down"})))),n.a.createElement("div",{className:"header-logo"},n.a.createElement("a",{href:"./"},n.a.createElement("img",{src:tr.a,alt:"Redash"}))),n.a.createElement("div",null,n.a.createElement(Y.a.Search,{className:"searchbar",placeholder:"Search queries...","data-test":"AppHeaderSearch",onSearch:nr}),n.a.createElement(H.a,{mode:"horizontal",selectable:!1},n.a.createElement(H.a.Item,{key:"help"},n.a.createElement(Pe,{type:"HOME",className:"menu-item-button"})),O.isAdmin&&n.a.createElement(H.a.Item,{key:"settings"},n.a.createElement(X.a,{title:"Settings"},n.a.createElement(B.a,{href:"data_sources",className:"menu-item-button"},n.a.createElement("i",{className:"fa fa-sliders"})))),n.a.createElement(H.a.Item,{key:"profile"},n.a.createElement(L.a,{overlayStyle:{minWidth:200},placement:"bottomRight",trigger:["click"],overlay:n.a.createElement(H.a,null,n.a.createElement(H.a.Item,{key:"profile"},n.a.createElement("a",{href:"users/me"},"Edit Profile")),O.hasPermission("super_admin")&&n.a.createElement(H.a.Divider,null),O.isAdmin&&n.a.createElement(H.a.Item,{key:"datasources"},n.a.createElement("a",{href:"data_sources"},"Data Sources")),O.hasPermission("list_users")&&n.a.createElement(H.a.Item,{key:"groups"},n.a.createElement("a",{href:"groups"},"Groups")),O.hasPermission("list_users")&&n.a.createElement(H.a.Item,{key:"users"},n.a.createElement("a",{href:"users"},"Users")),O.hasPermission("create_query")&&n.a.createElement(H.a.Item,{key:"snippets"},n.a.createElement("a",{href:"query_snippets"},"Query Snippets")),O.isAdmin&&n.a.createElement(H.a.Item,{key:"destinations"},n.a.createElement("a",{href:"destinations"},"Alert Destinations")),O.hasPermission("super_admin")&&n.a.createElement(H.a.Divider,null),O.hasPermission("super_admin")&&n.a.createElement(H.a.Item,{key:"status"},n.a.createElement("a",{href:"admin/status"},"System Status")),n.a.createElement(H.a.Divider,null),n.a.createElement(H.a.Item,{key:"logout",onClick:()=>k.logout()},"Log out"),n.a.createElement(H.a.Divider,null),n.a.createElement(H.a.Item,{key:"version",disabled:!0},"Version: ",w.version,Za!==w.version&&" (".concat(Za.substring(0,8),")"),w.newVersionAvailable&&O.hasPermission("super_admin")&&n.a.createElement(X.a,{title:"Update Available",placement:"rightTop"}," ",n.a.createElement("a",{href:"https://version.redash.io/",className:"update-available",target:"_blank",rel:"noopener"},n.a.createElement("i",{className:"fa fa-arrow-circle-down"})))))},n.a.createElement(B.a,{"data-test":"ProfileDropdown",className:"profile-dropdown"},n.a.createElement("img",{src:O.profile_image_url,alt:O.name}),n.a.createElement("span",null,O.name),n.a.createElement(W.a,{type:"down"})))))))}function ir(){var e=Object(r.useRef)();return n.a.createElement("div",{className:"app-header","data-platform":"mobile",ref:e},n.a.createElement("div",{className:"header-logo"},n.a.createElement("a",{href:"./"},n.a.createElement("img",{src:tr.a,alt:"Redash"}))),n.a.createElement("div",null,n.a.createElement(L.a,{overlayStyle:{minWidth:200},trigger:["click"],getPopupContainer:()=>e.current,overlay:n.a.createElement(H.a,{mode:"vertical",selectable:!1},O.hasPermission("list_dashboards")&&n.a.createElement(H.a.Item,{key:"dashboards"},n.a.createElement("a",{href:"dashboards"},"Dashboards")),O.hasPermission("view_query")&&n.a.createElement(H.a.Item,{key:"queries"},n.a.createElement("a",{href:"queries"},"Queries")),O.hasPermission("list_alerts")&&n.a.createElement(H.a.Item,{key:"alerts"},n.a.createElement("a",{href:"alerts"},"Alerts")),n.a.createElement(H.a.Item,{key:"profile"},n.a.createElement("a",{href:"users/me"},"Edit Profile")),n.a.createElement(H.a.Divider,null),O.isAdmin&&n.a.createElement(H.a.Item,{key:"settings"},n.a.createElement("a",{href:"data_sources"},"Settings")),O.hasPermission("super_admin")&&n.a.createElement(H.a.Item,{key:"status"},n.a.createElement("a",{href:"admin/status"},"System Status")),O.hasPermission("super_admin")&&n.a.createElement(H.a.Divider,null),n.a.createElement(H.a.Item,{key:"help"},n.a.createElement("a",{href:"https://redash.io/help",target:"_blank",rel:"noopener"},"Help")),n.a.createElement(H.a.Item,{key:"logout",onClick:()=>k.logout()},"Log out"))},n.a.createElement(B.a,null,n.a.createElement(W.a,{type:"menu"})))))}function lr(){return n.a.createElement("nav",{className:"app-header-wrapper"},n.a.createElement(or,null),n.a.createElement(ir,null))}function sr(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function cr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ur(e,t,a[t])})}return e}function ur(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function pr(e){var t=e.bodyClass,a=e.currentRoute,o=e.renderChildren,i=dr(Object(r.useState)(!!k.isAuthenticated()),2),l=i[0],s=i[1];return Object(r.useEffect)(()=>{var e=!1;return Promise.all([k.requireSession(),V.refresh()]).then(()=>{e||s(!!k.isAuthenticated())}).catch(()=>{e||s(!1)}),()=>{e=!0}},[]),Object(r.useEffect)(()=>{if(t)return document.body.classList.toggle(t,!0),()=>{document.body.classList.toggle(t,!1)}},[t]),l?n.a.createElement(n.a.Fragment,null,n.a.createElement(lr,null),n.a.createElement(n.a.Fragment,{key:a.key},n.a.createElement(z.a,{renderError:e=>n.a.createElement(Ve,{error:e})},n.a.createElement(I.ErrorBoundaryContext.Consumer,null,e=>{var t=e.handleError;return o(cr({},a.routeParams,{pageTitle:a.title,onError:t}))})))):null}function mr(e){var t=e.render,a=e.bodyClass;return cr({},sr(e,["render","bodyClass"]),{render:e=>n.a.createElement(pr,{bodyClass:a,currentRoute:e,renderChildren:t})})}function fr(e){var t=e.title;return n.a.createElement("div",{className:"page-header-wrapper row p-l-15 p-r-15 m-b-10 m-l-0 m-r-0"},n.a.createElement("div",{className:"col-sm-9 p-l-0 p-r-0"},n.a.createElement("h3",null,t)))}pr.propTypes={bodyClass:D.a.string,renderChildren:D.a.func},pr.defaultProps={bodyClass:null,renderChildren:()=>null},fr.propTypes={title:D.a.string.isRequired};a(1324);function yr(e){var t=e.activeTab,a=e.children;return n.a.createElement("div",{className:"container admin-page-layout"},n.a.createElement(fr,{title:"Admin"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(x.a,{className:"admin-page-layout-tabs",defaultActiveKey:t,animated:!1,tabBarGutter:0},n.a.createElement(x.a.TabPane,{key:"system_status",tab:n.a.createElement("a",{href:"admin/status"},"System Status")},"system_status"===t?a:null),n.a.createElement(x.a.TabPane,{key:"jobs",tab:n.a.createElement("a",{href:"admin/queries/jobs"},"RQ Status")},"jobs"===t?a:null),n.a.createElement(x.a.TabPane,{key:"outdated_queries",tab:n.a.createElement("a",{href:"admin/queries/outdated"},"Outdated Queries")},"outdated_queries"===t?a:null))))}yr.propTypes={activeTab:D.a.string,children:D.a.node},yr.defaultProps={activeTab:"system_status",children:null};var hr=a(182),br=a.n(hr),gr=a(96),vr=a.n(gr),Er=a(179),Or=a.n(Er),wr=a(60),jr=a.n(wr);function Sr(e){return(Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pr(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t){return!t||"object"!==Sr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kr(e){return(kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cr(e,t){return(Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Tr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_r(this,kr(t).apply(this,arguments))}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(t,n.a.Component),a=t,(r=[{key:"toggleItem",value:function(e,t,a){var r=t.is_favorite?t.unfavorite.bind(t):t.favorite.bind(t),n=t.is_favorite;r().then(()=>{t.is_favorite=!n,this.forceUpdate(),a()})}},{key:"render",value:function(){var e=this.props,t=e.item,a=e.onChange,r=t.is_favorite?"fa fa-star":"fa fa-star-o",o=t.is_favorite?"Remove from favorites":"Add to favorites";return n.a.createElement("a",{title:o,className:"favorites-control btn-favourite",onClick:e=>this.toggleItem(e,t,a)},n.a.createElement("i",{className:r,"aria-hidden":"true"}))}}])&&Pr(a.prototype,r),o&&Pr(a,o),t}();Nr(Tr,"propTypes",{item:D.a.shape({is_favorite:D.a.bool.isRequired}).isRequired,onChange:D.a.func}),Nr(Tr,"defaultProps",{onChange:()=>{}});D.a.shape({syntax:D.a.string,options:D.a.shape({doc:D.a.string,doc_url:D.a.string}),type_name:D.a.string});var qr=D.a.shape({columns:D.a.arrayOf(D.a.string).isRequired}),xr=(D.a.arrayOf(qr),D.a.shape({interval:D.a.number,time:D.a.string,day_of_week:D.a.string,until:D.a.string})),Rr={interval:null,time:null,day_of_week:null,until:null},Ar=D.a.shape({name:D.a.string.isRequired,title:D.a.string,type:D.a.oneOf(["ace","text","textarea","email","password","number","checkbox","file","select","content"]).isRequired,initialValue:D.a.oneOfType([D.a.string,D.a.number,D.a.bool,D.a.arrayOf(D.a.string),D.a.arrayOf(D.a.number)]),content:D.a.node,mode:D.a.string,required:D.a.bool,extra:D.a.bool,readOnly:D.a.bool,autoFocus:D.a.bool,minLength:D.a.number,placeholder:D.a.string,contentAfter:D.a.oneOfType([D.a.node,D.a.func]),loading:D.a.bool,props:D.a.object}),Dr=D.a.shape({name:D.a.string.isRequired,callback:D.a.func.isRequired,type:D.a.string,pullRight:D.a.bool,disabledWhenDirty:D.a.bool}),Ir=D.a.shape({validateFieldsAndScroll:D.a.func}),zr=D.a.shape({id:D.a.number.isRequired,name:D.a.string.isRequired,email:D.a.string.isRequired,profileImageUrl:D.a.string,apiKey:D.a.string,isDisabled:D.a.bool}),Mr=D.a.shape({id:D.a.number.isRequired,name:D.a.string.isRequired,icon:D.a.string.isRequired,type:D.a.string.isRequired}),Vr=D.a.shape({id:D.a.number.isRequired,name:D.a.string.isRequired,description:D.a.string,data_source_id:D.a.number.isRequired,created_at:D.a.string.isRequired,updated_at:D.a.string,user:zr,query:D.a.string,queryHash:D.a.string,is_safe:D.a.bool.isRequired,is_draft:D.a.bool.isRequired,is_archived:D.a.bool.isRequired,api_key:D.a.string.isRequired}),Fr=D.a.shape({column:D.a.string,op:D.a.oneOf([">",">=","<","<=","==","!="]),value:D.a.oneOfType([D.a.string,D.a.number]),custom_subject:D.a.string,custom_body:D.a.string}),Lr=D.a.shape({id:D.a.number,name:D.a.string,created_at:D.a.string,last_triggered_at:D.a.string,updated_at:D.a.string,rearm:D.a.number,state:D.a.oneOf(["ok","triggered","unknown"]),user:zr,query:Vr,options:D.a.shape({column:D.a.string,op:D.a.string,value:D.a.oneOfType([D.a.string,D.a.number])}).isRequired});function Ur(e,t,a,r){var n=t[a],o=e&&null!=n&&rt.a.isMoment(n),i=!e&&(null==n||rt.a.isMoment(n));if(!o&&!i)return new Error("Prop `"+a+"` supplied to `"+r+"` should be a Moment.js instance.")}var Br=Object(l.wrap)(!1,Ur);function Qr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Wr(e){var t=e.date,a=e.placeholder,o=e.autoUpdate,i=function(e){return(e=Object(l.isNil)(e)?null:rt()(e))&&e.isValid()?e:null}(t),s=Qr(Object(r.useState)(null),2),c=s[0],u=s[1],d=Object(r.useMemo)(()=>i?i.format(w.dateTimeFormat):null,[i]);return Object(r.useEffect)(()=>{function e(){u(i?i.fromNow():a)}if(e(),o){var t=setInterval(e,3e4);return()=>clearInterval(t)}},[o,i,a]),n.a.createElement(X.a,{title:d},n.a.createElement("span",{"data-test":"TimeAgo"},c))}function Gr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Br.isRequired=Object(l.wrap)(!0,Ur),Wr.propTypes={date:D.a.oneOfType([D.a.string,D.a.number,D.a.instanceOf(Date),Br]),placeholder:D.a.string,autoUpdate:D.a.bool},Wr.defaultProps={date:null,placeholder:"",autoUpdate:!0};var Hr={NEVER:"Never",SECONDS:"second",MINUTES:"minute",HOURS:"hour",DAYS:"day",WEEKS:"week"};function Kr(e){if(!e)return"";var t=rt()(e);return t.isValid()?t.format(w.dateTimeFormat):"-"}function Yr(e){if(!e)return"";var t=rt()(e);return t.isValid()?t.format(w.dateFormat):"-"}function Jr(e){var t=Gr(e.split(":"),2),a=t[0],r=t[1];return rt.a.utc().hour(a).minute(r).local().format("HH:mm")}function Xr(e){if(!e)return{interval:Hr.NEVER};var t=Hr.SECONDS;return e>=60&&(e/=60,t=Hr.MINUTES),e>=60&&(e/=60,t=Hr.HOURS),e>=24&&t===Hr.HOURS&&(e/=24,t=Hr.DAYS),e>=7&&!(e%7)&&t===Hr.DAYS&&(e/=7,t=Hr.WEEKS),{count:e,interval:t}}function $r(e,t){return e+(1!==t?"s":"")}function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"-";var a="",r=Xr(e),n=r.interval,o=r.count,i=Math.round(o);return 1===i&&t.omitSingleValueNumber||(a="".concat(i," ")),a+=$r(n,i)}function en(e){return e.replace(/_/g," ").replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var tn=["bytes","KB","MB","GB","TB","PB"];function an(e){if(isNaN(parseFloat(e))||!isFinite(e))return"?";for(var t=0;e>=1024;)e/=1024,t+=1;return e.toFixed(3)+" "+tn[t]}function rn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return rt.a.isMoment(e)?"date"===t?Yr(e):Kr(e):"boolean"==typeof e?e.toString():e}function nn(e){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function on(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ln(e,t){return!t||"object"!==nn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sn(e){return(sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function un(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dn(){return Object(l.extend)(this.apply(void 0,arguments),{sorter:!0})}var pn={favorites:function(e){return Object(l.extend)({width:"1%",render:(e,t)=>n.a.createElement(Tr,{item:t})},e)},avatar:function(e,t){return t=Object(l.isFunction)(t)?t:l.identity,Object(l.extend)({width:"1%",render:(e,a)=>n.a.createElement("img",{src:a.user.profile_image_url,className:"profile__image_thumb",alt:t(e.name,a),title:t(e.name,a)})},e)},date:function(e){return Object(l.extend)({render:e=>Yr(e)},e)},dateTime:function(e){return Object(l.extend)({render:e=>Kr(e)},e)},duration:function(e){return Object(l.extend)({width:"1%",className:"text-nowrap",render:e=>Zr(e)},e)},timeAgo:function(e){return Object(l.extend)({render:e=>n.a.createElement(Wr,{date:e})},e)},custom:function(e,t){return Object(l.extend)({render:e},t)}};pn.date.sortable=dn,pn.dateTime.sortable=dn,pn.duration.sortable=dn,pn.timeAgo.sortable=dn,pn.custom.sortable=dn;var mn=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ln(this,sn(t).apply(this,arguments))}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(t,n.a.Component),a=t,(r=[{key:"prepareColumns",value:function(){var e=this.props,t=e.orderByField,a=e.orderByReverse,r=e.toggleSorting,n=a?"descend":"ascend";return Object(l.map)(Object(l.map)(Object(l.filter)(this.props.columns,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable()),e=>Object(l.extend)(e,{orderByField:e.orderByField||e.field})),(e,a)=>{var o=e.sorter?()=>({onClick:()=>r(e.orderByField)}):null,i=Object(l.isFunction)(e.render)?(t,a)=>e.render(t,a.item):l.identity;return Object(l.extend)(Object(l.omit)(e,["field","orderByField","render"]),{key:"column"+a,dataIndex:"item["+JSON.stringify(e.field)+"]",defaultSortOrder:e.orderByField===t?n:null,onHeaderCell:o,render:i})})}},{key:"render",value:function(){var e=this.prepareColumns(),t=Object(l.map)(this.props.items,(e,t)=>({key:"row"+t,item:e})),a=Object(l.isFunction)(this.props.onRowClick)?e=>({onClick:t=>{this.props.onRowClick(t,e.item)}}):null,r=this.props.showHeader;return n.a.createElement(jr.a,{className:Z()("table-data",{"ant-table-headerless":!r}),loading:this.props.loading,columns:e,showHeader:r,dataSource:t,rowKey:e=>e.key,pagination:!1,onRow:a})}}])&&on(a.prototype,r),o&&on(a,o),t}();function fn(e){var t=e.title,a=e.value,r=e.loading;return n.a.createElement(Or.a,{spinning:r},n.a.createElement(vr.a,null,t,n.a.createElement("div",{className:"f-20"},a)))}un(mn,"propTypes",{loading:D.a.bool,items:D.a.arrayOf(D.a.object),columns:D.a.arrayOf(D.a.shape({field:D.a.string,orderByField:D.a.string,render:D.a.func,isAvailable:D.a.func})),showHeader:D.a.bool,onRowClick:D.a.func,orderByField:D.a.string,orderByReverse:D.a.bool,toggleSorting:D.a.func}),un(mn,"defaultProps",{loading:!1,items:[],columns:[],showHeader:!0,onRowClick:null,orderByField:null,orderByReverse:!1,toggleSorting:()=>{}}),fn.propTypes={title:D.a.string.isRequired,value:D.a.oneOfType([D.a.number,D.a.string]),loading:D.a.bool.isRequired},fn.defaultProps={value:""};var yn=[{title:"Queue",dataIndex:"origin"},{title:"Query ID",dataIndex:"meta.query_id"},{title:"Org ID",dataIndex:"meta.org_id"},{title:"Data Source ID",dataIndex:"meta.data_source_id"},{title:"User ID",dataIndex:"meta.user_id"},pn.custom(e=>e.toString(),{title:"Scheduled",dataIndex:"meta.scheduled"}),pn.timeAgo({title:"Start Time",dataIndex:"started_at"}),pn.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],hn=[{title:"Queue",dataIndex:"origin"},{title:"Job Name",dataIndex:"name"},pn.timeAgo({title:"Start Time",dataIndex:"started_at"}),pn.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],bn=[pn.custom(e=>n.a.createElement("span",null,n.a.createElement(br.a,{status:{busy:"processing",idle:"default",started:"success",suspended:"warning"}[e]})," ",e),{title:"State",dataIndex:"state"})].concat(Object(l.map)(["Hostname","PID","Name","Queues","Current Job","Successful Jobs","Failed Jobs"],e=>({title:e,dataIndex:e.toLowerCase().replace(/\s/g,"_")}))).concat([pn.dateTime({title:"Birth Date",dataIndex:"birth_date"}),pn.duration({title:"Total Working Time",dataIndex:"total_working_time"})]),gn=Object(l.map)(["Name","Started","Queued"],e=>({title:e,dataIndex:e.toLowerCase()})),vn={loading:D.a.bool.isRequired,items:D.a.arrayOf(D.a.object).isRequired};function En(e){var t=e.loading,a=e.items;return n.a.createElement(jr.a,{loading:t,columns:bn,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function On(e){var t=e.loading,a=e.items;return n.a.createElement(jr.a,{loading:t,columns:gn,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function wn(e){var t=e.loading,a=e.items;return n.a.createElement(jr.a,{loading:t,columns:yn,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function jn(e){var t=e.loading,a=e.items;return n.a.createElement(jr.a,{loading:t,columns:hn,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Sn(e){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){xn(e,t,a[t])})}return e}function kn(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Cn(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nn(e){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qn(e,t){return(qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}En.propTypes=vn,On.propTypes=vn,wn.propTypes=vn,jn.propTypes=vn;var Rn=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=Nn(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Sn(n)&&"function"!=typeof n?Tn(r):n,xn(Tn(a),"state",{activeTab:E.hash,isLoading:!0,error:null,queueCounters:[],overallCounters:{started:0,queued:0},startedJobs:[],workers:[]}),xn(Tn(a),"_refreshTimer",null),xn(Tn(a),"refresh",()=>{C.get("/api/admin/queries/rq_status").then(e=>a.processQueues(e)).catch(e=>a.handleError(e)),a._refreshTimer=setTimeout(a.refresh,6e4)}),xn(Tn(a),"processQueues",e=>{var t=e.queues,r=e.workers,n=Object(l.values)(t).map(e=>{var t=e.started,a=kn(e,["started"]);return _n({started:t.length},a)}),o=n.reduce((e,t)=>({started:e.started+t.started,queued:e.queued+t.queued}),{started:0,queued:0}),i=Object(l.flatMap)(Object(l.values)(t),e=>e.started.map(e=>_n({},e,{enqueued_at:rt.a.utc(e.enqueued_at),started_at:rt.a.utc(e.started_at)})));a.setState({isLoading:!1,queueCounters:n,startedJobs:i,overallCounters:o,workers:r})}),xn(Tn(a),"handleError",e=>{a.setState({isLoading:!1,error:e})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qn(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ke("view","page","admin/rq_status"),this.refresh()}},{key:"componentWillUnmount",value:function(){clearTimeout(this._refreshTimer),this.processQueues=(()=>{}),this.handleError=(()=>{})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,a=e.error,r=e.queueCounters,o=e.startedJobs,i=e.overallCounters,s=e.workers,c=e.activeTab,u=Pn(Object(l.partition)(o,["name","redash.tasks.queries.execution.execute_query"]),2),d=u[0],p=u[1];return n.a.createElement(yr,{activeTab:"jobs"},n.a.createElement("div",{className:"p-15"},a&&n.a.createElement(T.a,{type:"error",message:"Failed loading status. Please refresh."}),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(R.Row,{gutter:15,className:"m-b-15"},n.a.createElement(R.Col,{span:8},n.a.createElement(fn,{title:"Started Jobs",value:i.started,loading:t})),n.a.createElement(R.Col,{span:8},n.a.createElement(fn,{title:"Queued Jobs",value:i.queued,loading:t}))),n.a.createElement(x.a,{activeKey:c||"queues",onTabClick:e=>{E.setHash(e),this.setState({activeTab:e})},animated:!1},n.a.createElement(x.a.TabPane,{key:"queues",tab:"Queues"},n.a.createElement(On,{loading:t,items:r})),n.a.createElement(x.a.TabPane,{key:"workers",tab:"Workers"},n.a.createElement(En,{loading:t,items:s})),n.a.createElement(x.a.TabPane,{key:"queries",tab:"Queries"},n.a.createElement(wn,{loading:t,items:d})),n.a.createElement(x.a.TabPane,{key:"other",tab:"Other Jobs"},n.a.createElement(jn,{loading:t,items:p}))))))}}])&&Cn(a.prototype,r),o&&Cn(a,o),t}(),An=mr({path:"/admin/queries/jobs",title:"RQ Status",render:e=>n.a.createElement(Rn,e)}),Dn=a(128),In=a.n(Dn),zn=a(221),Mn=a.n(zn);function Vn(e){var t=e.page,a=e.itemsPerPage,r=e.totalCount,o=e.onChange;return r<=a?null:n.a.createElement("div",{className:"paginator-container"},n.a.createElement(Mn.a,{defaultCurrent:t,defaultPageSize:a,total:r,onChange:o}))}Vn.propTypes={page:D.a.number.isRequired,itemsPerPage:D.a.number.isRequired,totalCount:D.a.number.isRequired,onChange:D.a.func},Vn.defaultProps={onChange:()=>{}};var Fn=a(19),Ln=a.n(Fn);function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bn(){return(Bn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qn(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Kn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Yn=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Wn(this,Gn(t).call(this,e))).state={loading:!0,availableTags:[],result:Object(l.uniq)(Object(l.map)(a.props.tags,l.trim))},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this.props.getAvailableTags().then(e=>{this.setState({loading:!1,availableTags:Object(l.uniq)(Object(l.compact)(Object(l.map)(e,l.trim)))})})}},{key:"render",value:function(){var e=this.props.dialog,t=this.state,a=t.loading,r=t.availableTags,o=t.result;return n.a.createElement(ke.a,Bn({},e.props,{onOk:()=>e.close(o),title:"Add/Edit Tags",className:"shortModal",wrapProps:{"data-test":"EditTagsDialog"}}),n.a.createElement(Ln.a,{mode:"tags",className:"w-100",placeholder:"Add some tags...",defaultValue:o,onChange:e=>this.setState({result:Object(l.compact)(Object(l.map)(e,l.trim))}),autoFocus:!0,disabled:a,loading:a},Object(l.map)(r,e=>n.a.createElement(Ln.a.Option,{key:e},e))))}}])&&Qn(a.prototype,r),o&&Qn(a,o),t}();Kn(Yn,"propTypes",{dialog:Te.isRequired,tags:D.a.arrayOf(D.a.string),getAvailableTags:D.a.func.isRequired}),Kn(Yn,"defaultProps",{tags:[]});var Jn=xe(Yn);function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $n(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Zn(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function eo(e){return(eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function to(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ao(e,t){return(ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ro(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var no=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=eo(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Xn(n)&&"function"!=typeof n?to(r):n,ro(to(a),"editTags",(e,t)=>{Jn.showModal({tags:e,getAvailableTags:t}).onClose(a.props.onEdit)}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ao(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderEditButton",value:function(){var e=Object(l.map)(this.props.tags,l.trim);return n.a.createElement("a",{className:"label label-tag hidden-xs",role:"none",onClick:()=>this.editTags(e,this.props.getAvailableTags),"data-test":"EditTagsButton"},0===e.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5"}),"Add tag"),e.length>0&&n.a.createElement("i",{className:"zmdi zmdi-edit"}))}},{key:"render",value:function(){return n.a.createElement("div",{className:"tags-control "+this.props.className,"data-test":"TagsControl"},this.props.children,Object(l.map)(this.props.tags,e=>n.a.createElement("span",{className:"label label-tag",key:e,title:e,"data-test":"TagLabel"},e)),this.props.canEdit&&this.renderEditButton(),this.props.tagsExtra)}}])&&Zn(a.prototype,r),o&&Zn(a,o),t}();function oo(e){var t=e.archivedTooltip;function a(e){var a=e.isDraft,r=e.isArchived,o=$n(e,["isDraft","isArchived"]);return n.a.createElement(no,o,!r&&a&&n.a.createElement("span",{className:"label label-tag-unpublished"},"Unpublished"),r&&n.a.createElement(X.a,{placement:"right",title:t},n.a.createElement("span",{className:"label label-tag-archived"},"Archived")))}return a.propTypes={isDraft:D.a.bool,isArchived:D.a.bool},a.defaultProps={isDraft:!1,isArchived:!1},a}ro(no,"propTypes",{tags:D.a.arrayOf(D.a.string),canEdit:D.a.bool,getAvailableTags:D.a.func,onEdit:D.a.func,className:D.a.string,tagsExtra:D.a.node,children:D.a.node}),ro(no,"defaultProps",{tags:[],canEdit:!1,getAvailableTags:()=>Promise.resolve([]),onEdit:()=>{},className:"",tagsExtra:null,children:null});var io=oo({archivedTooltip:"This query is archived and can't be used in dashboards, or appear in search results."}),lo=oo({archivedTooltip:"This dashboard is archived and won't be listed in dashboards nor search results."});a(595);function so(e){return(so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function co(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function uo(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function po(e,t){return!t||"object"!==so(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mo(e){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fo(e,t){return(fo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function yo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ho=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),po(this,mo(t).apply(this,arguments))}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fo(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){if(this.props.isNew)return"Never";var e=co(this.content,2),t=e[0],a=e[1],r=a?n.a.createElement(X.a,{title:a},t):t;return this.props.isLink?n.a.createElement("a",{className:"schedule-phrase",onClick:this.props.onClick},r):r}},{key:"content",get:function(){var e=(this.props.schedule||t.defaultProps.schedule).interval;if(!e)return["Never"];var a=Zr(e,{omitSingleValueNumber:!0}),r="Every ".concat(a),n="Refreshes every ".concat(a),o=this.props.schedule,i=o.time,l=o.day_of_week;return i&&(n+=" at ".concat(Jr(i))),l&&(n+=" on ".concat(l)),[r,n]}}])&&uo(a.prototype,r),o&&uo(a,o),t}();yo(ho,"propTypes",{schedule:xr,isNew:D.a.bool.isRequired,isLink:D.a.bool,onClick:D.a.func}),yo(ho,"defaultProps",{schedule:Rr,isLink:!1,onClick:()=>{}});var bo=a(385),go=a.n(bo);function vo(e){return(vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Eo(){return(Eo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Oo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function wo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ko(e,t,a[t])})}return e}function jo(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function So(e,t){return!t||"object"!==vo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Po(e){return(Po=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _o(e,t){return(_o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ko(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Co=D.a.shape({params:D.a.object.isRequired,isLoaded:D.a.bool.isRequired,isEmpty:D.a.bool.isRequired,searchTerm:D.a.string,updateSearch:D.a.func.isRequired,selectedTags:D.a.array.isRequired,updateSelectedTags:D.a.func.isRequired,orderByField:D.a.string,orderByReverse:D.a.bool.isRequired,toggleSorting:D.a.func.isRequired,page:D.a.number.isRequired,itemsPerPage:D.a.number.isRequired,totalItemsCount:D.a.number.isRequired,pageSizeOptions:D.a.arrayOf(D.a.number).isRequired,pageItems:D.a.array.isRequired,updatePagination:D.a.func.isRequired,handleError:D.a.func.isRequired});function No(e,t,a){var r=function(r){function o(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),r=So(this,Po(o).call(this,e));var n=a(),i=t();r._itemsSource=i,i.setState(wo({},n.getState(),{validate:!1})),i.getCallbackContext=(()=>r.state),i.onBeforeUpdate=(()=>{var e=i.getState();n.setState(e),r.setState(r.getState(wo({},e,{isLoaded:!1})))}),i.onAfterUpdate=(()=>{var e=i.getState();r.setState(r.getState(wo({},e,{isLoaded:!0})))}),i.onError=(e=>r.props.onError(e));var s=r.getState(wo({},i.getState(),{isLoaded:!1})),c=i.updatePagination,u=i.toggleSorting,d=i.updateSearch,p=i.updateSelectedTags,m=i.update,f=i.handleError;return r.state=wo({},s,{toggleSorting:u,updateSearch:Object(l.debounce)(d,200),updateSelectedTags:p,updatePagination:c,update:m,handleError:f}),r}var i,s,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_o(e,t)}(o,n.a.Component),i=o,(s=[{key:"componentDidMount",value:function(){this.state.update()}},{key:"componentWillUnmount",value:function(){this._itemsSource.onBeforeUpdate=(()=>{}),this._itemsSource.onAfterUpdate=(()=>{}),this._itemsSource.onError=(()=>{})}},{key:"getState",value:function(e){var t=e.isLoaded,a=e.totalCount,r=e.pageItems,n=e.params;return wo({},Oo(e,["isLoaded","totalCount","pageItems","params"]),{params:wo({},n,Object(l.omit)(this.props,["onError","children"])),isLoaded:t,isEmpty:!t||0===a,totalItemsCount:t?a:0,pageSizeOptions:w.pageSizeOptions,pageItems:t?r:[]})}},{key:"render",value:function(){var t=this.props,a=t.children,r=(t.onError,Oo(t,["children","onError"]));return n.a.createElement(e,Eo({},r,{controller:this.state}),a)}}])&&jo(i.prototype,s),c&&jo(i,c),o}();return ko(r,"propTypes",{onError:D.a.func,children:D.a.node}),ko(r,"defaultProps",{onError:e=>{setTimeout(()=>{throw e})},children:null}),go()(r,e),r}function To(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qo(e,t,a){return t&&To(e.prototype,t),a&&To(e,a),e}function xo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ro=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.page,r=t.itemsPerPage,n=t.totalCount,o=t.validate,i=void 0===o||o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),xo(this,"page",1),xo(this,"itemsPerPage",20),xo(this,"totalCount",0),this.setItemsPerPage(r,i),this.setTotalCount(n,i),this.setPage(a,i)}return qo(e,[{key:"setPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||1,this.page=t?e>=1&&e<=this.totalPages?e:1:e>=1?e:1)}},{key:"setItemsPerPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||20,this.itemsPerPage=e>=1?e:1,t&&this.setPage(this.page,t))}},{key:"setTotalCount",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||0,this.totalCount=e,t&&this.setPage(this.page,t))}},{key:"totalPages",get:function(){return Math.ceil(this.totalCount/this.itemsPerPage)}}]),qo(e,[{key:"getItemsForPage",value:function(e){var t=this.itemsPerPage*(this.page-1),a=t+this.itemsPerPage;return e.slice(t,a)}}]),e}();a(368);function Ao(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Do(e,t,a){return t&&Ao(e.prototype,t),a&&Ao(e,a),e}function Io(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var zo="-";function Mo(e,t){return e?t?zo+e:e:null}function Vo(e){var t=(e=Object(l.isString)(e)?e:"").startsWith(zo);return t&&(e=e.substring(1)),{field:""!==e?e:null,reverse:t}}var Fo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.orderByField,r=t.orderByReverse;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Io(this,"field",null),Io(this,"reverse",!1),this.setField(a),this.setReverse(r)}return Do(e,[{key:"setField",value:function(e){this.field=Object(l.isString)(e)&&""!==e?e:null}},{key:"setReverse",value:function(e){this.reverse=!!e}},{key:"compiled",get:function(){return Mo(this.field,this.reverse)},set:function(e){var t=Vo(e),a=t.field,r=t.reverse;this.field=a,this.reverse=r}}]),Do(e,[{key:"toggleField",value:function(e){Object(l.isString)(e)&&""!==e&&(e===this.field?this.reverse=!this.reverse:(this.field=e,this.reverse=!1))}},{key:"sort",value:function(e){if(this.field)return e=Object(l.sortBy)(e,this.field),this.reverse&&e.reverse(),e}}]),e}();a(1326);function Lo(e){return(Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t){return!t||"object"!==Lo(t)&&"function"!=typeof t?Bo(e):t}function Bo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qo(e,t,a){return(Qo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Wo(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function Wo(e){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Go(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ho(e,t)}function Ho(e,t){return(Ho=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ko(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yo(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jo(e,t,a){return t&&Yo(e.prototype,t),a&&Yo(e,a),e}var Xo=function(){function e(t){var a=t.getRequest,r=t.doRequest,n=t.processResults;Ko(this,e),this._originalGetRequest=Object(l.isFunction)(a)?a:l.identity,this._originalDoRequest=r,this._originalProcessResults=Object(l.isFunction)(n)?n:l.identity}return Jo(e,[{key:"_getRequest",value:function(e,t){return this._originalGetRequest({},t)}},{key:"_processResults",value:function(e,t,a){var r=e.results,n=e.count;return{results:this._originalProcessResults(r,a),count:n}}}]),Jo(e,[{key:"fetch",value:function(e,t,a){var r=this._getRequest(t,a);return this._originalDoRequest(r,a).then(e=>this._processResults(e,t,a))}}]),e}(),$o=function(e){function t(){var e,a,r,n,o;Ko(this,t);for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return a=Uo(this,(e=Wo(t)).call.apply(e,[this].concat(l))),r=Bo(a),o=[],(n="_allItems")in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,a}return Go(t,Xo),Jo(t,[{key:"_getRequest",value:function(e,t){var a=e.searchTerm,r=e.selectedTags;return this._originalGetRequest({q:Object(l.isString)(a)&&""!==a?a:void 0,tags:r},t)}},{key:"_processResults",value:function(e,t,a){var r=t.paginator,n=t.sorter;return this._allItems=this._originalProcessResults(e,a),this._allItems=n.sort(this._allItems),{results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems}}},{key:"fetch",value:function(e,a,r){if(Object(l.isNil)(e)||e.tags||e.sorting)return Qo(Wo(t.prototype),"fetch",this).call(this,e,a,r);var n=a.paginator,o=a.sorter;return e.sorting&&(this._allItems=o.sort(this._allItems)),Promise.resolve({results:n.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems})}}]),t}(),Zo=function(e){function t(){return Ko(this,t),Uo(this,Wo(t).apply(this,arguments))}return Go(t,Xo),Jo(t,[{key:"_getRequest",value:function(e,t){var a=e.paginator,r=e.sorter,n=e.searchTerm,o=e.selectedTags;return this._originalGetRequest({page:a.page,page_size:a.itemsPerPage,order:r.compiled,q:Object(l.isString)(n)&&""!==n?n:void 0,tags:o},t)}}]),t}();function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ai(e){return(ai=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ri(e,t){return(ri=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ni(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function oi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ci(e,t,a[t])})}return e}function ii(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function li(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function si(e,t,a){return t&&li(e.prototype,t),a&&li(e,a),e}function ci(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ui=function(){function e(t){var a=t.getRequest,r=t.doRequest,n=t.processResults,o=t.isPlainList,i=void 0!==o&&o,s=ni(t,["getRequest","doRequest","processResults","isPlainList"]);ii(this,e),ci(this,"onBeforeUpdate",null),ci(this,"onAfterUpdate",null),ci(this,"onError",null),ci(this,"getCallbackContext",()=>null),ci(this,"updatePagination",e=>{var t=e.page,a=e.itemsPerPage,r=this._paginator,n=r.page,o=r.itemsPerPage;this._paginator.setItemsPerPage(a),this._paginator.setPage(t),this._changed({pagination:{page:n!==this._paginator.page,itemsPerPage:o!==this._paginator.itemsPerPage}})}),ci(this,"toggleSorting",e=>{this._sorter.toggleField(e),this._savedOrderByField=this._sorter.field,this._changed({sorting:!0})}),ci(this,"updateSearch",e=>{this._searchTerm=e,""===e?this._sorter.setField(this._savedOrderByField):this._sorter.setField(null),this._paginator.setPage(1),this._changed({search:!0,pagination:{page:!0}})}),ci(this,"updateSelectedTags",e=>{this._selectedTags=e,this._paginator.setPage(1),this._changed({tags:!0,pagination:{page:!0}})}),ci(this,"update",()=>this._changed()),ci(this,"handleError",e=>{Object(l.isFunction)(this.onError)&&this.onError(e)}),Object(l.isFunction)(a)||(a=l.identity),this._fetcher=i?new $o({getRequest:a,doRequest:r,processResults:n}):new Zo({getRequest:a,doRequest:r,processResults:n}),this.setState(s),this._pageItems=[],this._params={}}return si(e,[{key:"_beforeUpdate",value:function(){return Object(l.isFunction)(this.onBeforeUpdate)?Promise.resolve(this.onBeforeUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}},{key:"_afterUpdate",value:function(){return Object(l.isFunction)(this.onAfterUpdate)?Promise.resolve(this.onAfterUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}},{key:"_changed",value:function(e){var t={paginator:this._paginator,sorter:this._sorter,searchTerm:this._searchTerm,selectedTags:this._selectedTags},a={},r=oi({},this.getCallbackContext(),{setCustomParams:e=>{Object(l.extend)(a,e)}});return this._beforeUpdate().then(()=>this._fetcher.fetch(e,t,r).then(e=>{var t=e.results,r=e.count,n=e.allResults;return this._pageItems=t,this._allItems=n||null,this._paginator.setTotalCount(r),this._params=oi({},this._params,a),this._afterUpdate()}).catch(e=>this.handleError(e)))}}]),si(e,[{key:"getState",value:function(){return{page:this._paginator.page,itemsPerPage:this._paginator.itemsPerPage,orderByField:this._sorter.field,orderByReverse:this._sorter.reverse,searchTerm:this._searchTerm,selectedTags:this._selectedTags,totalCount:this._paginator.totalCount,pageItems:this._pageItems,allItems:this._allItems,params:this._params}}},{key:"setState",value:function(e){this._paginator=new Ro(e),this._sorter=new Fo(e),this._searchTerm=e.searchTerm||"",this._selectedTags=e.selectedTags||[],this._savedOrderByField=this._sorter.field}}]),e}(),di=function(e){function t(e){var a=e.getResource,r=e.getItemProcessor,n=ni(e,["getResource","getItemProcessor"]);return ii(this,t),r=Object(l.isFunction)(r)?r:()=>null,ti(this,ai(t).call(this,oi({},n,{doRequest:(e,t)=>{return a(t)(e)},processResults:(e,t)=>{var a=r(t);return a=Object(l.isFunction)(a)?a:l.identity,Object(l.map)(e,e=>a(e,t))}})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ri(e,t)}(t,ui),t}();function pi(e){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mi(e,t){return!t||"object"!==pi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fi(e,t,a){return(fi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yi(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function yi(e){return(yi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hi(e,t){return(hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vi(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ei(e,t,a){return t&&vi(e.prototype,t),a&&vi(e,a),e}var Oi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};gi(this,e),this._state=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){bi(e,t,a[t])})}return e}({},t)}return Ei(e,[{key:"getState",value:function(){return Object(l.defaults)(this._state,{page:1,itemsPerPage:w.pageSize,orderByField:"created_at",orderByReverse:!1,searchTerm:"",tags:[]})}},{key:"setState",value:function(){}}]),e}(),wi=function(e){function t(){return gi(this,t),mi(this,yi(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(t,Oi),Ei(t,[{key:"getState",value:function(){var e=fi(yi(t.prototype),"getState",this).call(this),a=E.search,r=a.q||"",n=""!==r?"":Mo(e.orderByField,e.orderByReverse),o=Vo(a.order||n),i=o.field,l=o.reverse;return{page:parseInt(a.page,10)||e.page,itemsPerPage:parseInt(a.page_size,10)||e.itemsPerPage,orderByField:i,orderByReverse:l,searchTerm:r}}},{key:"setState",value:function(e){var t=e.page,a=e.itemsPerPage,r=e.orderByField,n=e.orderByReverse,o=e.searchTerm;E.setSearch({page:t,page_size:a,order:Mo(r,n),q:""!==o?o:null},!0)}}]),t}();function ji(){return(ji=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Si(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(re,ji({icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."},e)))}function Pi(e){return e.tags||[]}function _i(e){return C.get(e).then(Pi)}a(1328);function ki(e){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ci(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ni(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ti(e,t){return!t||"object"!==ki(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qi(e){return(qi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xi(e,t){return(xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ri(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ai=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Ti(this,qi(t).call(this,e))).state={allTags:[],selectedTags:new Set},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xi(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){_i(this.props.tagsUrl).then(e=>{this.setState({allTags:e})})}},{key:"toggleTag",value:function(e,t){var a=this.state.selectedTags;e.shiftKey?a.has(t)?a.delete(t):a.add(t):a.has(t)&&1===a.size?a.clear():(a.clear(),a.add(t)),this.forceUpdate(),this.props.onUpdate(Ci(this.state.selectedTags))}},{key:"render",value:function(){var e=this.state,t=e.allTags,a=e.selectedTags;return t.length>0?n.a.createElement("div",{className:"m-t-10 tags-list tiled"},n.a.createElement(H.a,{className:"invert-stripe-position",mode:"inline",selectedKeys:Ci(a)},Object(l.map)(t,e=>n.a.createElement(H.a.Item,{key:e.name,className:"m-0"},n.a.createElement("a",{className:"d-flex align-items-center justify-content-between",onClick:t=>this.toggleTag(t,e.name)},n.a.createElement("span",{className:"max-character col-xs-11"},e.name),n.a.createElement(br.a,{count:e.count})))))):null}}])&&Ni(a.prototype,r),o&&Ni(a,o),t}();function Di(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ii(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zi(e){var t=e.placeholder,a=e.value,o=e.showIcon,i=e.onChange,l=Ii(Object(r.useState)(a),2),s=l[0],c=l[1];Object(r.useEffect)(()=>{c(a)},[a]);var u=Object(r.useCallback)(e=>{var t=e.target.value;c(t),i(t)},[i]),d=o?Y.a.Search:Y.a;return n.a.createElement("div",{className:"m-b-10"},n.a.createElement(d,{className:"form-control",placeholder:t,value:s,onChange:u}))}function Mi(e){var t=e.items,a=e.selected;return 0===(t=Object(l.filter)(t,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable())).length?null:n.a.createElement("div",{className:"m-b-10 tags-list tiled"},n.a.createElement(H.a,{className:"invert-stripe-position",mode:"inline",selectable:!1,selectedKeys:[a]},Object(l.map)(t,e=>n.a.createElement(H.a.Item,{key:e.key,className:"m-0"},n.a.createElement("a",{href:e.href},Object(l.isString)(e.icon)&&""!==e.icon&&n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:e.icon,"aria-hidden":"true"})),Object(l.isFunction)(e.icon)&&(e.icon(e)||null),e.title)))))}function Vi(e){var t=e.icon;return n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:t,"aria-hidden":"true"}))}function Fi(e){var t=e.user;return Object(l.isString)(t.profile_image_url)&&""!==t.profile_image_url?n.a.createElement("img",{src:t.profile_image_url,className:"profile__image--sidebar m-r-5",width:"13",alt:t.name}):null}function Li(e){var t=e.url,a=e.onChange;return""===t?null:n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Ai,{tagsUrl:t,onUpdate:a}))}function Ui(e){var t=e.options,a=e.value,r=e.onChange,o=Di(e,["options","value","onChange"]);return n.a.createElement("div",o,n.a.createElement(Ln.a,{className:"w-100",defaultValue:a,onChange:r},Object(l.map)(t,e=>n.a.createElement(Ln.a.Option,{key:e,value:e},e," results"))))}function Bi(){return(Bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qi(e){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wi(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gi(e){return(Gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ki(e,t){return(Ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Ri(Ai,"propTypes",{tagsUrl:D.a.string.isRequired,onUpdate:D.a.func}),Ri(Ai,"defaultProps",{onUpdate:()=>{}}),zi.propTypes={placeholder:D.a.string,value:D.a.string.isRequired,showIcon:D.a.bool,onChange:D.a.func.isRequired},zi.defaultProps={placeholder:"Search...",showIcon:!1},Mi.propTypes={items:D.a.arrayOf(D.a.shape({key:D.a.string.isRequired,href:D.a.string.isRequired,title:D.a.string.isRequired,icon:D.a.func,isAvailable:D.a.func})),selected:D.a.string},Mi.defaultProps={items:[],selected:null},Vi.propTypes={icon:D.a.string.isRequired},Fi.propTypes={user:D.a.shape({profile_image_url:D.a.string,name:D.a.string}).isRequired},Li.propTypes={url:D.a.string.isRequired,onChange:D.a.func.isRequired},Ui.propTypes={options:D.a.arrayOf(D.a.number).isRequired,value:D.a.number.isRequired,onChange:D.a.func.isRequired};var Ji=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return r=this,o=(e=Gi(t)).call.apply(e,[this].concat(l)),a=!o||"object"!==Qi(o)&&"function"!=typeof o?Hi(r):o,Yi(Hi(a),"listColumns",[{title:"ID",field:"id",width:"1%",align:"right",sorter:!0},pn.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(io,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),pn.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),pn.dateTime.sortable({title:"Created At",field:"created_at"}),pn.duration.sortable({title:"Runtime",field:"runtime"}),pn.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at"}),pn.custom.sortable((e,t)=>n.a.createElement(ho,{schedule:t.schedule,isNew:t.isNew()}),{title:"Update Schedule",field:"schedule"})]),Yi(Hi(a),"state",{autoUpdate:!0}),Yi(Hi(a),"_updateTimer",null),Yi(Hi(a),"update",function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&a.state.autoUpdate&&a.props.controller.update(),a._updateTimer=setTimeout(a.update,6e4)}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ki(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ke("view","page","admin/queries/outdated"),this.update(!0)}},{key:"componentWillUnmount",value:function(){clearTimeout(this._updateTimer)}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement(yr,{activeTab:e.params.currentPage},n.a.createElement(R.Row,{className:"m-15"},n.a.createElement(R.Col,{span:16},n.a.createElement("div",null,n.a.createElement("label",{htmlFor:"auto-update-switch",className:"m-0"},"Auto update"),n.a.createElement(In.a,{id:"auto-update-switch",className:"m-l-10",checked:this.state.autoUpdate,onChange:e=>this.setState({autoUpdate:e})})),e.params.lastUpdatedAt&&n.a.createElement("div",{className:"m-t-5"},"Last updated: ",n.a.createElement(Wr,{date:1e3*e.params.lastUpdatedAt}))),n.a.createElement(R.Col,{span:8},e.isLoaded&&!e.isEmpty&&n.a.createElement(Ui,{options:e.pageSizeOptions,value:e.itemsPerPage,onChange:t=>e.updatePagination({itemsPerPage:t})}))),!e.isLoaded&&n.a.createElement(Si,null),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center p-15"},"There are no outdated queries."),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))}}])&&Wi(a.prototype,r),o&&Wi(a,o),t}();Yi(Ji,"propTypes",{controller:Co.isRequired});var Xi=No(Ji,()=>new ui({doRequest:function(e,t){return C.get("/api/admin/queries/outdated").then(e=>{var a=e.queries,r=e.updated_at;return t.setCustomParams({lastUpdatedAt:parseFloat(r)}),a})},processResults:function(e){return Object(l.map)(e,e=>new Qt(e))},isPlainList:!0}),()=>new Oi({orderByField:"created_at",orderByReverse:!0})),$i=mr({path:"/admin/queries/outdated",title:"Outdated Queries",render:e=>n.a.createElement(Xi,Bi({},e,{currentPage:"outdated_queries"}))}),Zi=a(50),el=a.n(Zi);function tl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function al(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(vr.a,{title:"General",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(el.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=tl(e,2),a=t[0],r=t[1];return n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},r)},en(a))}}))}function rl(e){var t=e.info;return n.a.createElement(vr.a,{title:"Redash Database",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(el.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=tl(e,2),a=t[0],r=t[1];return n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},an(r))},a)}}))}function nl(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(vr.a,{title:"Queues",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(el.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=tl(e,2),a=t[0],r=t[1];return n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},r.size)},a)}}))}function ol(e){var t=e.info,a=t?[n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Wr,{date:t.lastRefreshAt,placeholder:"n/a"}))},"Last Refresh"),n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Wr,{date:t.startedAt,placeholder:"n/a"}))},"Started"),n.a.createElement(el.a.Item,{extra:n.a.createElement("span",{className:"badge"},t.outdatedQueriesCount)},"Outdated Queries Count")]:[];return n.a.createElement(vr.a,{title:"Manager",size:"small"},!t&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t&&n.a.createElement(el.a,{size:"small",itemLayout:"vertical",dataSource:a,renderItem:e=>e}))}a(1331);function il(e){return(il="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ll(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sl(e){return(sl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ul(e,t){return(ul=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var pl=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=sl(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==il(n)&&"function"!=typeof n?cl(r):n,dl(cl(a),"state",{queues:[],manager:null,databaseMetrics:{},status:{}}),dl(cl(a),"_refreshTimer",null),dl(cl(a),"refresh",()=>{C.get("/status.json").then(e=>{a.setState({queues:e.manager.queues,manager:{startedAt:1e3*e.manager.started_at,lastRefreshAt:1e3*e.manager.last_refresh_at,outdatedQueriesCount:e.manager.outdated_queries_count},databaseMetrics:e.database_metrics.metrics||[],status:Object(l.omit)(e,["workers","manager","database_metrics"])})}).catch(e=>a.props.onError(e)),a._refreshTimer=setTimeout(a.refresh,6e4)}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ul(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ke("view","page","admin/status"),this.refresh()}},{key:"componentWillUnmount",value:function(){clearTimeout(this._refreshTimer)}},{key:"render",value:function(){return n.a.createElement(yr,{activeTab:"system_status"},n.a.createElement("div",{className:"system-status-page"},n.a.createElement("div",{className:"system-status-page-blocks"},n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(al,{info:this.state.status})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(ol,{info:this.state.manager})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(nl,{info:this.state.queues})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(rl,{info:this.state.databaseMetrics})))))}}])&&ll(a.prototype,r),o&&ll(a,o),t}();dl(pl,"propTypes",{onError:D.a.func}),dl(pl,"defaultProps",{onError:()=>{}});var ml=mr({path:"/admin/status",title:"System Status",render:e=>n.a.createElement(pl,e)}),fl=a(276),yl=a.n(fl);function hl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){bl(e,t,a[t])})}return e}function bl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yl.a.config({placement:"bottomRight",duration:3});var gl={};["success","error","info","warning","warn"].forEach(e=>{gl[e]=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return yl.a[e](hl({},r,{message:t,description:a}))}});var vl=hl({},yl.a,gl);function El(){return(El=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Ol={"greater than":">","less than":"<",equals:"="},wl=e=>Object(l.merge)({},e,{options:{op:Ol[e.options.op]||e.options.op}}),jl={query:()=>C.get("api/alerts"),get:e=>{var t=e.id;return C.get("api/alerts/".concat(t)).then(wl)},save:e=>C.post((e=>e.id?"api/alerts/".concat(e.id):"api/alerts")(e),(e=>{var t=El({},e);return void 0===t.query_id&&(t.query_id=t.query.id,t.destination_id=t.destinations,delete t.query,delete t.destinations),t})(e)),delete:e=>C.delete("api/alerts/".concat(e.id)),mute:e=>C.post("api/alerts/".concat(e.id,"/mute")),unmute:e=>C.delete("api/alerts/".concat(e.id,"/mute"))};function Sl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pl(e){var t=e.doDelete,a=e.canEdit,o=e.mute,i=e.unmute,l=e.muted,s=Sl(Object(r.useState)(!1),2),c=s[0],u=s[1],d=Object(r.useCallback)(e=>{u(!0),e().finally(()=>{u(!1)})},[]),p=Object(r.useCallback)(()=>{ke.a.confirm({title:"Delete Alert",content:"Are you sure you want to delete this alert?",okText:"Delete",okType:"danger",onOk:()=>{u(!0),t().catch(()=>{u(!1)})},maskClosable:!0,autoFocusButton:null})},[t]);return n.a.createElement(L.a,{className:Z()("m-l-5",{disabled:!a}),trigger:[a?"click":void 0],placement:"bottomRight",overlay:n.a.createElement(H.a,null,n.a.createElement(H.a.Item,null,l?n.a.createElement("a",{onClick:()=>d(i)},"Unmute Notifications"):n.a.createElement("a",{onClick:()=>d(o)},"Mute Notifications")),n.a.createElement(H.a.Item,null,n.a.createElement("a",{onClick:p},"Delete Alert")))},n.a.createElement(B.a,null,c?n.a.createElement(W.a,{type:"loading"}):n.a.createElement(W.a,{type:"ellipsis",rotate:90})))}Pl.propTypes={doDelete:D.a.func.isRequired,canEdit:D.a.bool.isRequired,mute:D.a.func.isRequired,unmute:D.a.func.isRequired,muted:D.a.bool},Pl.defaultProps={muted:!1};var _l=a(30),kl=a.n(_l);a(1332);function Cl(e){var t=e.alert,a=e.editMode,r=e.name,o=e.onChange,i=e.children,l=vc(t);return n.a.createElement("div",{className:"alert-header"},n.a.createElement("div",{className:"alert-title"},n.a.createElement("h3",null,a&&t.query?n.a.createElement(Y.a,{className:"f-inherit",placeholder:l,value:r,onChange:e=>o(e.target.value)}):r||l)),n.a.createElement("div",{className:"alert-actions"},i))}Cl.propTypes={alert:Lr.isRequired,name:D.a.string,children:D.a.node,onChange:D.a.func,editMode:D.a.bool},Cl.defaultProps={name:null,children:null,onChange:null,editMode:!1};var Nl=a(113),Tl=a.n(Nl),ql=(a(1333),{">":">",">=":"≥","<":"<","<=":"≤","==":"=","!=":"≠"}),xl=["==","!="];function Rl(e){var t=e.children,a=e.minWidth;return n.a.createElement("div",{className:"criteria-disabled-input",style:{minWidth:a}},t)}function Al(e){var t=e.columnNames,a=e.resultValues,r=e.alertOptions,o=e.onChange,i=e.editMode,s=Object(l.isEmpty)(a)?null:Object(l.head)(a)[r.column],c=(()=>Object(l.includes)(xl,r.op)?null:isNaN(r.value)?"Value column type doesn't match threshold type.":isNaN(s)?"Value column isn't supported by condition type.":null)(),u=n.a.createElement("small",{className:"alert-criteria-hint"},"Top row value is ",n.a.createElement("code",{className:"p-0"},Object(l.toString)(s)||"unknown"));return n.a.createElement("div",{"data-test":"Criteria"},n.a.createElement("div",{className:"input-title"},n.a.createElement("span",null,"Value column"),i?n.a.createElement(Ln.a,{value:r.column,onChange:e=>o({column:e}),dropdownMatchSelectWidth:!1,style:{minWidth:100}},t.map(e=>n.a.createElement(Ln.a.Option,{key:e},e))):n.a.createElement(Rl,{minWidth:70},r.column)),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",null,"Condition"),i?n.a.createElement(Ln.a,{value:r.op,onChange:e=>o({op:e}),optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:55}},n.a.createElement(Ln.a.Option,{value:">",label:ql[">"]},ql[">"]," greater than"),n.a.createElement(Ln.a.Option,{value:">=",label:ql[">="]},ql[">="]," greater than or equals"),n.a.createElement(Ln.a.Option,{disabled:!0,key:"dv1"},n.a.createElement(Tl.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Ln.a.Option,{value:"<",label:ql["<"]},ql["<"]," less than"),n.a.createElement(Ln.a.Option,{value:"<=",label:ql["<="]},ql["<="]," less than or equals"),n.a.createElement(Ln.a.Option,{disabled:!0,key:"dv2"},n.a.createElement(Tl.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Ln.a.Option,{value:"==",label:ql["=="]},ql["=="]," equals"),n.a.createElement(Ln.a.Option,{value:"!=",label:ql["!="]},ql["!="]," not equal to")):n.a.createElement(Rl,{minWidth:50},ql[r.op])),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",null,"Threshold"),i?n.a.createElement(Y.a,{style:{width:90},value:r.value,onChange:e=>o({value:e.target.value})}):n.a.createElement(Rl,{minWidth:50},r.value)),n.a.createElement("div",{className:"ant-form-explain"},u,n.a.createElement("br",null),c&&n.a.createElement("small",null,n.a.createElement(W.a,{type:"warning",theme:"filled",className:"warning-icon-danger"})," ",c)))}Rl.propTypes={children:D.a.node.isRequired,minWidth:D.a.number.isRequired},Al.propTypes={columnNames:D.a.arrayOf(D.a.string).isRequired,resultValues:D.a.arrayOf(D.a.object).isRequired,alertOptions:Fr.isRequired,onChange:D.a.func,editMode:D.a.bool},Al.defaultProps={onChange:()=>{},editMode:!1};var Dl=a(110),Il=a.n(Dl);a(1334);function zl(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ml(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Vl=[["Second",1],["Minute",60],["Hour",3600],["Day",86400],["Week",604800]];function Fl(e){var t=e.value,a=e.onChange,o=e.editMode,i=Ml(Object(r.useState)(),2),s=i[0],c=i[1],u=Ml(Object(r.useState)(),2),d=u[0],p=u[1];if(Object(r.useEffect)(()=>{for(var e=Vl.length-1;e>=0;e-=1){var a=Ml(Vl[e],2)[1];if(t%a==0){c(e),p(t/a);break}}},[t]),!Object(l.isNumber)(d)||!Object(l.isNumber)(s))return null;var m=1!==d?"s":"";if(o)return n.a.createElement(n.a.Fragment,null,n.a.createElement(Il.a,{value:d,onChange:e=>{p(e),a(e*Vl[s][1])},min:1,precision:0}),n.a.createElement(Ln.a,{value:s,onChange:e=>{c(e),a(d*Vl[e][1])}},Vl.map((e,t)=>{var a=Ml(e,1)[0];return n.a.createElement(Ln.a.Option,{value:t,key:a},a,m)})));var f=Ml(Vl[s],1)[0];return d+" "+Object(l.toLower)(f)+m}function Ll(e){var t=e.value,a=e.onChange,o=Ml(Object(r.useState)(t<2?t:2),2),i=o[0],l=o[1];return n.a.createElement("div",{className:"alert-rearm"},n.a.createElement(Ln.a,{optionLabelProp:"label",defaultValue:i||0,dropdownMatchSelectWidth:!1,onChange:e=>{l(e),a(e<2?e:3600)}},n.a.createElement(Ln.a.Option,{value:0,label:"Just once"},"Just once ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Ln.a.Option,{value:1,label:"Each time alert is evaluated"},"Each time alert is evaluated ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Ln.a.Option,{value:2,label:"At most every"},"At most every ... ",n.a.createElement("em",null,"when alert is evaluated"))),2===i&&t&&n.a.createElement(Fl,{value:t,onChange:a,editMode:!0}))}function Ul(e){var t=e.value,a="";switch(t){case 0:a="just once, until back to normal";break;case 1:a="each time alert is evaluated, until back to normal";break;default:a=n.a.createElement(n.a.Fragment,null,"at most every ",n.a.createElement(Fl,{value:t,editMode:!1}),", when alert is evaluated")}return n.a.createElement("span",null,"Notifications are sent ",a,".")}function Bl(e){var t=e.editMode,a=zl(e,["editMode"]);return t?n.a.createElement(Ll,a):n.a.createElement(Ul,a)}Fl.propTypes={onChange:D.a.func,value:D.a.number.isRequired,editMode:D.a.bool.isRequired},Fl.defaultProps={onChange:()=>{}},Ll.propTypes={onChange:D.a.func.isRequired,value:D.a.number.isRequired},Ul.propTypes={value:D.a.number.isRequired},Bl.propTypes={onChange:D.a.func,value:D.a.number.isRequired,editMode:D.a.bool},Bl.defaultProps={onChange:null,editMode:!1};var Ql=a(1711);function Wl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Gl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.initialResults,n=void 0===a?null:a,o=t.debounceTimeout,i=void 0===o?200:o,l=Wl(Object(r.useState)(n),2),s=l[0],c=l[1],u=Wl(Object(r.useState)(!1),2),d=u[0],p=u[1],m=Object(r.useRef)(null),f=Object(r.useRef)(!1),y=Wl(Object(Ql.a)(t=>{p(!0),m.current=t,e(t).catch(()=>n).then(e=>{t!==m.current||f.current||(c(e),p(!1))})},i),1)[0];return Object(r.useEffect)(()=>()=>{f.current=!0},[]),[y,s,d]}function Hl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Kl=Ln.a.Option;function Yl(e){return null===e?Promise.resolve(null):e?Qt.query({q:e}).then(e=>{return e.results}):Qt.recent().then(e=>e.filter(e=>!e.is_draft))}function Jl(e){var t=Hl(Object(r.useState)(""),2),a=t[0],o=t[1],i=Hl(Object(r.useState)(),2),s=i[0],c=i[1],u=Hl(Gl(Yl,{initialResults:[]}),3),d=u[0],p=u[1],m=u[2],f="Search a query by name",y=n.a.createElement("i",{className:"fa fa-times hide-in-percy",onClick:()=>b(null)}),h=n.a.createElement("i",{className:Z()("fa fa-spinner fa-pulse hide-in-percy",{hidden:!m})});function b(t){var a=null;t&&((a=Object(l.find)(p,{id:t}))||vl.error("Something went wrong...","Couldn't select query")),o(a?null:""),c(a),e.onChange(a)}if(Object(r.useEffect)(()=>{d(a)},[d,a]),Object(r.useEffect)(()=>{e.selectedQuery&&c(e.selectedQuery)},[e.selectedQuery]),e.disabled)return n.a.createElement(Y.a,{value:s&&s.name,placeholder:f,disabled:!0});if("select"===e.type){var g=s?y:null,v=s?s.name:a;return n.a.createElement(Ln.a,{showSearch:!0,dropdownMatchSelectWidth:!1,placeholder:f,value:v||void 0,onSearch:o,onChange:b,suffixIcon:m?h:g,notFoundContent:null,filterOption:!1,defaultActiveFirstOption:!1,className:e.className,"data-test":"QuerySelector"},p&&p.map(e=>{var t=e.is_draft;return n.a.createElement(Kl,{value:e.id,key:e.id,disabled:t,className:"query-selector-result","data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(io,{isDraft:e.is_draft,tags:e.tags,className:Z()("inline-tags-control",{disabled:t})}))}))}return n.a.createElement("span",{"data-test":"QuerySelector"},s?n.a.createElement(Y.a,{value:s.name,suffix:y,readOnly:!0}):n.a.createElement(Y.a,{placeholder:f,value:a,onChange:e=>o(e.target.value),suffix:h}),n.a.createElement("div",{className:"scrollbox",style:{maxHeight:"50vh",marginTop:15}},p&&(p.length?n.a.createElement("div",{className:"list-group"},p.map(e=>n.a.createElement("a",{className:Z()("query-selector-result","list-group-item",{inactive:e.is_draft}),key:e.id,onClick:()=>b(e.id),"data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(io,{isDraft:e.is_draft,tags:e.tags,className:"inline-tags-control"})))):n.a.createElement("div",{className:"text-muted"},"No results matching search term."))))}Jl.propTypes={onChange:D.a.func.isRequired,selectedQuery:D.a.object,type:D.a.oneOf(["select","default"]),className:D.a.string,disabled:D.a.bool},Jl.defaultProps={selectedQuery:null,type:"default",className:null,disabled:!1};a(1335);function Xl(e){var t=e.query,a=e.queryResult,r=e.onChange,o=e.editMode,i=t&&t.schedule?n.a.createElement("small",null,"Scheduled to refresh"," ",n.a.createElement("i",{className:"alert-query-schedule"},n.a.createElement(ho,{schedule:t.schedule,isNew:!1}))):n.a.createElement("small",null,n.a.createElement(W.a,{type:"warning",theme:"filled",className:"warning-icon-danger"})," This query has no ",n.a.createElement("i",null,"refresh schedule"),"."," ",n.a.createElement(X.a,{title:"A query schedule is not necessary but is highly recommended for alerts. An Alert without a query schedule will only send notifications if a user in your organization manually executes this query."},n.a.createElement("a",null,"Why it's recommended ",n.a.createElement(W.a,{type:"question-circle",theme:"twoTone"}))));return n.a.createElement(n.a.Fragment,null,o?n.a.createElement(Jl,{onChange:r,selectedQuery:t,className:"alert-query-selector",type:"select"}):n.a.createElement(X.a,{title:"Open query in a new tab."},n.a.createElement("a",{href:"queries/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"alert-query-link"},t.name,n.a.createElement("i",{className:"fa fa-external-link"}))),n.a.createElement("div",{className:"ant-form-explain"},t&&i),t&&!a&&n.a.createElement("div",{className:"m-t-30"},n.a.createElement(W.a,{type:"loading",className:"m-r-5"})," Loading query data"))}function $l(){return($l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zl(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function es(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ts(e){var t=e.items,a=e.renderItem,o=e.onItemClick,i=Object(r.useCallback)(e=>{var t=a(e),r=t.content,i=t.className,l=t.isDisabled;return n.a.createElement(el.a.Item,{className:Z()("p-l-10","p-r-10",{clickable:!l,disabled:l},i),onClick:l?null:()=>o(e)},r)},[a,o]);return n.a.createElement(el.a,{size:"small",dataSource:t,renderItem:i})}function as(e){var t=e.dialog,a=e.dialogTitle,o=e.inputPlaceholder,i=e.itemKey,s=e.renderItem,c=e.renderStagedItem,u=e.searchItems,d=e.selectedItemsTitle,p=e.width,m=e.showCount,f=e.extraFooterContent,y=es(Object(r.useState)([]),2),h=y[0],b=y[1],g=es(Gl(u,{initialResults:[]}),3),v=g[0],E=g[1],O=g[2],w=E.length>0;Object(r.useEffect)(()=>{v()},[v]);var j=Object(r.useCallback)(e=>{var t=i(e);return!!Object(l.find)(h,e=>i(e)===t)},[h,i]),S=Object(r.useCallback)(e=>{if(j(e)){var t=i(e);b(Object(l.filter)(h,e=>i(e)!==t))}else b([].concat(Zl(h),[e]))},[h,i,j]),P=Object(r.useCallback)(()=>{t.close(h).catch(e=>{e&&vl.error("Failed to save some of selected items.")})},[t,h]);return n.a.createElement(ke.a,$l({},t.props,{className:"select-items-dialog",width:p,title:a,footer:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"flex-fill m-r-5",style:{textAlign:"left",color:"rgba(0, 0, 0, 0.5)"}},f),n.a.createElement(B.a,$l({},t.props.cancelButtonProps,{onClick:t.dismiss}),"Cancel"),n.a.createElement(B.a,$l({},t.props.okButtonProps,{onClick:P,disabled:0===h.length||t.props.okButtonProps.disabled,type:"primary"}),"Save",m&&!Object(l.isEmpty)(h)?" (".concat(Object(l.size)(h),")"):null))}),n.a.createElement("div",{className:"d-flex align-items-center m-b-10"},n.a.createElement("div",{className:"flex-fill"},n.a.createElement(Y.a.Search,{onChange:e=>v(e.target.value),placeholder:o,autoFocus:!0})),c&&n.a.createElement("div",{className:"w-50 m-l-20"},n.a.createElement("h5",{className:"m-0"},d))),n.a.createElement("div",{className:"d-flex align-items-stretch",style:{minHeight:"30vh",maxHeight:"50vh"}},n.a.createElement("div",{className:"flex-fill scrollbox"},O&&n.a.createElement(Si,{className:""}),!O&&!w&&n.a.createElement(re,{icon:"fa-search",message:"No items match your search.",className:""}),!O&&w&&n.a.createElement(ts,{items:E,renderItem:e=>s(e,{isSelected:j(e)}),onItemClick:S})),c&&n.a.createElement("div",{className:"w-50 m-l-20 scrollbox"},h.length>0&&n.a.createElement(ts,{items:h,renderItem:e=>c(e,{isSelected:!0}),onItemClick:S}))))}Xl.propTypes={query:Vr,queryResult:D.a.object,onChange:D.a.func,editMode:D.a.bool},Xl.defaultProps={query:null,queryResult:null,onChange:()=>{},editMode:!1},ts.propTypes={items:D.a.array,renderItem:D.a.func,onItemClick:D.a.func},ts.defaultProps={items:[],renderItem:()=>{},onItemClick:()=>{}},as.propTypes={dialog:Te.isRequired,dialogTitle:D.a.string,inputPlaceholder:D.a.string,selectedItemsTitle:D.a.string,searchItems:D.a.func.isRequired,itemKey:D.a.func,renderItem:D.a.func,renderStagedItem:D.a.func,width:D.a.oneOfType([D.a.string,D.a.number]),extraFooterContent:D.a.node,showCount:D.a.bool},as.defaultProps={dialogTitle:"Add Items",inputPlaceholder:"Search...",selectedItemsTitle:"Selected items",itemKey:e=>e.id,renderItem:()=>"",renderStagedItem:null,width:"80%",extraFooterContent:null,showCount:!1};var rs=xe(as),ns="/static/images/destinations",os={query:()=>C.get("api/destinations"),get:e=>{var t=e.id;return C.get("api/destinations/".concat(t))},types:()=>C.get("api/destinations/types"),create:e=>C.post("api/destinations",e),save:e=>C.post("api/destinations/".concat(e.id),e),delete:e=>{var t=e.id;return C.delete("api/destinations/".concat(t))}},is={query:e=>{var t=e.alertId;return C.get("api/alerts/".concat(t,"/subscriptions"))},create:e=>C.post("api/alerts/".concat(e.alert_id,"/subscriptions"),e),delete:e=>C.delete("api/alerts/".concat(e.alert_id,"/subscriptions/").concat(e.id))};function ls(e){var t=e.isSelected,a=e.isStaged,r=e.alreadyInGroup,o=e.deselectedIcon;return a?n.a.createElement("i",{className:"fa fa-remove"}):r?n.a.createElement(X.a,{title:"Already selected"},n.a.createElement("i",{className:"fa fa-check"})):t?n.a.createElement("i",{className:"fa fa-check"}):n.a.createElement("i",{className:"fa ".concat(o)})}function ss(e){var t=e.featureName,a=e.className,r=e.mode,o=e.adminOnly;if(!w.mailSettingsMissing)return null;if(o&&!O.isAdmin)return null;var i=n.a.createElement("span",null,"Your mail server isn't configured correctly, and is needed for ",t," to work."," ",n.a.createElement(Pe,{type:"MAIL_CONFIG",className:"f-inherit"}));return"icon"===r?n.a.createElement(X.a,{title:i},n.a.createElement("i",{className:Z()("fa fa-exclamation-triangle",a)})):n.a.createElement(T.a,{message:i,type:"error",className:a})}ls.propTypes={isSelected:D.a.bool,isStaged:D.a.bool,alreadyInGroup:D.a.bool,deselectedIcon:D.a.string},ls.defaultProps={isSelected:!1,isStaged:!1,alreadyInGroup:!1,deselectedIcon:"fa-angle-double-right"},ss.propTypes={featureName:D.a.string.isRequired,className:D.a.string,mode:D.a.oneOf(["alert","icon"]),adminOnly:D.a.bool},ss.defaultProps={className:null,mode:"alert",adminOnly:!1};a(1336);function cs(e){return(cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function us(){return(us=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ds(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ps(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ms(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fs(e){return(fs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ys(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hs(e,t){return(hs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var gs=-1;function vs(e){return e.destination||(e.destination={id:gs,name:e.user.email,icon:"DEPRECATED",type:"email"}),e}function Es(e){var t=e.destination,a=t.name,r=t.type,o=e.user,i=e.unsubscribe,l=O.isAdmin||O.id===o.id;return n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(ns,"/").concat(r,".png"),className:"destination-icon",alt:a}),n.a.createElement("span",{className:"flex-fill"},a),"email"===r&&n.a.createElement(ss,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),l&&n.a.createElement(X.a,{title:"Remove",mouseEnterDelay:.5},n.a.createElement(W.a,{type:"close",className:"remove-button",onClick:i})))}Es.propTypes={destination:Mr.isRequired,user:zr.isRequired,unsubscribe:D.a.func.isRequired};var Os=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=fs(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==cs(o)&&"function"!=typeof o?ys(r):o,bs(ys(a),"state",{dests:[],subs:null}),bs(ys(a),"showAddAlertSubDialog",()=>{var e=a.state,t=e.dests,r=e.subs;rs.showModal({width:570,showCount:!0,extraFooterContent:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-info-circle"})," Create new destinations in"," ",n.a.createElement(X.a,{title:"Opens page in a new tab."},n.a.createElement("a",{href:"destinations/new",target:"_blank"},"Alert Destinations"))),dialogTitle:"Add Existing Alert Destinations",inputPlaceholder:"Search destinations...",searchItems:e=>(e=Object(l.toLower)(e),Promise.resolve(t.filter(t=>Object(l.includes)(Object(l.toLower)(t.name),e)))),renderItem:(e,t)=>{var a=t.isSelected,o=!!Object(l.find)(r,t=>t.destination.id===e.id);return{content:n.a.createElement("div",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(ns,"/").concat(e.type,".png"),className:"destination-icon",alt:e.name}),n.a.createElement("span",{className:"flex-fill"},e.name),n.a.createElement(ls,{isSelected:a,alreadyInGroup:o,deselectedIcon:"fa-plus"})),isDisabled:o,className:a||o?"selected":""}}}).onClose(e=>{var t=Object(l.map)(e,e=>a.subscribe(e));return Promise.all(t).then(()=>{vl.success("Subscribed.")}).catch(()=>(vl.error("Failed saving subscription."),Promise.reject(null)))})}),bs(ys(a),"onUserEmailToggle",e=>{e?a.unsubscribe(e):a.subscribe()}),bs(ys(a),"subscribe",e=>{var t={alert_id:a.props.alertId};return e&&(t.destination_id=e.id),is.create(t).then(e=>{var t=a.state.subs;a.setState({subs:[].concat(ps(t),[vs(e)])})})}),bs(ys(a),"unsubscribe",e=>{is.delete(e).then(()=>{var t=a.state.subs;a.setState({subs:Object(l.without)(t,e)})}).catch(()=>{vl.error("Failed unsubscribing.")})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hs(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){var e=this.props.alertId;Promise.all([os.query(),is.query({alertId:e})]).then(e=>{var t=ds(e,2),a=t[0],r=t[1];r=r.map(vs),this.setState({dests:a,subs:r})})}},{key:"render",value:function(){if(!this.props.alertId)return null;var e=this.state.subs,t=Object(l.find)(e,{destination:{id:gs},user:{id:O.id}}),a=Object(l.without)(e,t),r=w.mailSettingsMissing;return n.a.createElement("div",{className:"alert-destinations","data-test":"AlertDestinations"},n.a.createElement(X.a,{title:'Click to add an existing "Alert Destination"',mouseEnterDelay:.5},n.a.createElement(B.a,{"data-test":"ShowAddAlertSubDialog",type:"primary",size:"small",className:"add-button",onClick:this.showAddAlertSubDialog},n.a.createElement("i",{className:"fa fa-plus f-12 m-r-5"})," Add")),n.a.createElement("ul",null,n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("i",{className:"destination-icon fa fa-envelope"}),n.a.createElement("span",{className:"flex-fill"},O.email),n.a.createElement(ss,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),!r&&n.a.createElement(In.a,{size:"small",className:"toggle-button",checked:!!t,loading:!e,onChange:()=>this.onUserEmailToggle(t),"data-test":"UserEmailToggle"})),a.map(e=>n.a.createElement(Es,us({key:e.id,unsubscribe:()=>this.unsubscribe(e)},e)))))}}])&&ms(a.prototype,r),o&&ms(a,o),t}();function ws(){return(ws=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function js(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ss(e){var t=e.children,a=e.label,r=e.className,o=js(e,["children","label","className"]),i={span:16};return a||(i.offset=4),r=Z()("alert-form-item",r),n.a.createElement(kl.a.Item,ws({labelCol:{span:4},wrapperCol:i,label:a,className:r},o),t)}bs(Os,"propTypes",{alertId:D.a.number.isRequired}),Ss.propTypes={children:D.a.node,label:D.a.string,className:D.a.string},Ss.defaultProps={children:null,label:null,className:null};a(1378);function Ps(e){var t=e.show,a=e.completed,r=e.text,o=e.url,i=e.urlText,l=e.onClick;return t?n.a.createElement("li",{className:Z()({done:a})},n.a.createElement("a",{href:o,onClick:l},i)," ",r):null}function _s(e){var t=e.icon,a=e.header,o=e.description,i=e.illustration,s=e.helpLink,c=e.onboardingMode,u={dataSource:!0,query:!0,alert:e.showAlertStep,dashboard:e.showDashboardStep,inviteUsers:e.showInviteStep},d={dataSource:V.objectCounters.data_sources>0,query:V.objectCounters.queries>0,alert:V.objectCounters.alerts>0,dashboard:V.objectCounters.dashboards>0,inviteUsers:V.objectCounters.users>1},p=Object(r.useCallback)(()=>{et.showModal()},[]);return!c||Object(l.some)(Object(l.keys)(u),e=>u[e]&&!d[e])?n.a.createElement("div",{className:"empty-state bg-white tiled"},n.a.createElement("div",{className:"empty-state__summary"},a&&n.a.createElement("h4",null,a),n.a.createElement("h2",null,n.a.createElement("i",{className:t})),n.a.createElement("p",null,o),n.a.createElement("img",{src:"/static/images/illustrations/"+i+".svg",alt:i+" Illustration",width:"75%"})),n.a.createElement("div",{className:"empty-state__steps"},n.a.createElement("h4",null,"Let's get started"),n.a.createElement("ol",null,O.isAdmin&&n.a.createElement(Ps,{show:u.dataSource,completed:d.dataSource,url:"data_sources/new",urlText:"Connect",text:"a Data Source"}),!O.isAdmin&&n.a.createElement(Ps,{show:u.dataSource,completed:d.dataSource,text:"Ask an account admin to connect a data source"}),n.a.createElement(Ps,{show:u.query,completed:d.query,url:"queries/new",urlText:"Create",text:"your first Query"}),n.a.createElement(Ps,{show:u.alert,completed:d.alert,url:"alerts/new",urlText:"Create",text:"your first Alert"}),n.a.createElement(Ps,{show:u.dashboard,completed:d.dashboard,onClick:p,urlText:"Create",text:"your first Dashboard"}),n.a.createElement(Ps,{show:u.inviteUsers,completed:d.inviteUsers,url:"users/new",urlText:"Invite",text:"your team members"})),n.a.createElement("p",null,"Need more support?"," ",n.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"See our Help",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}))))):null}Ps.propTypes={show:D.a.bool.isRequired,completed:D.a.bool.isRequired,text:D.a.string.isRequired,url:D.a.string,urlText:D.a.string,onClick:D.a.func},Ps.defaultProps={url:null,urlText:null,onClick:null},_s.propTypes={icon:D.a.string,header:D.a.string,description:D.a.string.isRequired,illustration:D.a.string.isRequired,helpLink:D.a.string.isRequired,onboardingMode:D.a.bool,showAlertStep:D.a.bool,showDashboardStep:D.a.bool,showInviteStep:D.a.bool},_s.defaultProps={icon:null,header:null,onboardingMode:!1,showAlertStep:!1,showDashboardStep:!1,showInviteStep:!1};var ks=_s;function Cs(){return(Cs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ns(e){return(Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ts(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qs(e){return(qs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rs(e,t){return(Rs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function As(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ds={unknown:"label-warning",ok:"label-success",triggered:"label-danger"},Is=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,a=!(o=(e=qs(t)).call.apply(e,[this].concat(s)))||"object"!==Ns(o)&&"function"!=typeof o?xs(r):o,As(xs(a),"listColumns",[pn.custom.sortable((e,t)=>n.a.createElement("i",{className:"fa fa-bell-".concat(t.options.muted?"slash":"o"," p-r-0")}),{title:n.a.createElement("i",{className:"fa fa-bell p-r-0"}),field:"muted",width:"1%"}),pn.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("a",{className:"table-main-title",href:"alerts/"+t.id},t.name)),{title:"Name",field:"name"}),pn.custom((e,t)=>t.user.name,{title:"Created By"}),pn.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("span",{className:"label ".concat(Ds[t.state])},Object(l.toUpper)(t.state))),{title:"State",field:"state",width:"1%"}),pn.timeAgo.sortable({title:"Last Updated At",field:"updated_at",className:"text-nowrap",width:"1%"}),pn.dateTime.sortable({title:"Created At",field:"created_at",className:"text-nowrap",width:"1%"})]),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rs(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{className:"page-alerts-list"},n.a.createElement("div",{className:"container"},n.a.createElement(fr,{title:e.params.pageTitle}),n.a.createElement("div",{className:"m-l-15 m-r-15"},!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(ks,{icon:"fa fa-bell-o",illustration:"alert",description:"Get notified on certain events",helpLink:"https://redash.io/help/user-guide/alerts/",showAlertStep:!0}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive bg-white tiled"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}])&&Ts(a.prototype,r),o&&Ts(a,o),t}();As(Is,"propTypes",{controller:Co.isRequired});var zs=No(Is,()=>new di({isPlainList:!0,getRequest:function(){return{}},getResource:function(){return jl.query.bind(jl)}}),()=>new Oi({orderByField:"created_at",orderByReverse:!0,itemsPerPage:20})),Ms=mr({path:"/alerts",title:"Alerts",render:e=>n.a.createElement(zs,Cs({},e,{currentPage:"alerts"}))});function Vs(e){return(Vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fs(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ls(e){return(Ls=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Us(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bs(e,t){return(Bs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ws(e){var t=e.state,a=e.lastTriggered;return n.a.createElement("div",{className:"alert-state"},n.a.createElement("span",{className:"alert-state-indicator label ".concat(Ds[t])},"Status: ",t),"unknown"===t&&n.a.createElement("div",{className:"ant-form-explain"},"Alert condition has not been evaluated."),a&&n.a.createElement("div",{className:"ant-form-explain"},"Last triggered"," ",n.a.createElement("span",{className:"alert-last-triggered"},n.a.createElement(Wr,{date:a}))))}Ws.propTypes={state:D.a.string.isRequired,lastTriggered:D.a.string},Ws.defaultProps={lastTriggered:null};var Gs=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=Ls(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Vs(n)&&"function"!=typeof n?Us(r):n,Qs(Us(a),"state",{unmuting:!1}),Qs(Us(a),"unmute",()=>{a.setState({unmuting:!0}),a.props.unmute().finally(()=>{a.setState({unmuting:!1})})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bs(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props,t=e.alert,a=e.queryResult,r=e.canEdit,o=e.onEdit,i=e.menuButton,l=t.query,s=t.name,c=t.options,u=t.rearm;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Cl,{name:s,alert:t},n.a.createElement(X.a,{title:r?"":"You do not have sufficient permissions to edit this alert"},n.a.createElement(B.a,{type:"default",onClick:r?o:null,className:Z()({disabled:!r})},n.a.createElement("i",{className:"fa fa-edit m-r-5"}),"Edit"),i)),n.a.createElement("div",{className:"row bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex col-md-8"},n.a.createElement(kl.a,{className:"flex-fill"},n.a.createElement(Ss,null,n.a.createElement(Ws,{state:t.state,lastTriggered:t.last_triggered_at})),n.a.createElement(Ss,{label:"Query"},n.a.createElement(Xl,{query:l,queryResult:a})),a&&c&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Ss,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(Al,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:c})),n.a.createElement(Ss,{label:"Notifications",className:"form-item-line-height-normal"},n.a.createElement(Bl,{value:u||0}),n.a.createElement("br",null),"Set to ",c.custom_subject||c.custom_body?"custom":"default"," notification template.")))),n.a.createElement("div",{className:"col-md-4"},c.muted&&n.a.createElement(T.a,{className:"m-b-20",message:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell-slash-o"})," Notifications are muted"),description:n.a.createElement(n.a.Fragment,null,"Notifications for this alert will not be sent.",n.a.createElement("br",null),r&&n.a.createElement(n.a.Fragment,null,"To restore notifications click",n.a.createElement(B.a,{size:"small",type:"primary",onClick:this.unmute,loading:this.state.unmuting,className:"m-t-5 m-l-5"},"Unmute"))),type:"warning"}),n.a.createElement("h4",null,"Destinations"," ",n.a.createElement(X.a,{title:"Open Alert Destinations page in a new tab."},n.a.createElement("a",{href:"destinations",target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link f-13"})))),n.a.createElement(Os,{alertId:t.id}))))}}])&&Fs(a.prototype,r),o&&Fs(a,o),t}();Gs.propTypes={alert:Lr.isRequired,queryResult:D.a.object,canEdit:D.a.bool.isRequired,onEdit:D.a.func.isRequired,menuButton:D.a.node.isRequired,unmute:D.a.func},Gs.defaultProps={queryResult:null,unmute:null};a(1379);function Hs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ks(e){var t=e.alert,a=e.query,o=e.columnNames,i=e.resultValues,s=e.subject,c=e.setSubject,u=e.body,d=e.setBody,p=!(!s&&!u),m=Hs(Object(r.useState)(p?1:0),2),f=m[0],y=m[1],h=Hs(Object(r.useState)(!1),2),b=h[0],g=h[1],v=function(e,t,a,r){var n=Object(l.isEmpty)(r)?null:Object(l.head)(r)[e.options.column];return{ALERT_STATUS:"TRIGGERED",ALERT_CONDITION:e.options.op,ALERT_THRESHOLD:e.options.value,ALERT_NAME:e.name,ALERT_URL:"".concat(window.location.origin,"/alerts/").concat(e.id),QUERY_NAME:t.name,QUERY_URL:"".concat(window.location.origin,"/queries/").concat(t.id),QUERY_RESULT_VALUE:Object(l.isNull)(n)||Object(l.isUndefined)(n)?"UNKNOWN":n,QUERY_RESULT_ROWS:r,QUERY_RESULT_COLS:a}}(t,a,o,i),E=e=>Pt.a.render(e||"",v);return n.a.createElement("div",{className:"alert-template"},n.a.createElement(Ln.a,{value:f,onChange:e=>{e||!p?(y(e),g(!1)):ke.a.confirm({title:"Are you sure?",content:"Switching to default template will discard your custom template.",onOk:()=>{c(null),d(null),y(e),g(!1)},maskClosable:!0,autoFocusButton:null})},optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:"fit-content"}},n.a.createElement(Ln.a.Option,{value:0,label:"Use default template"},"Default template"),n.a.createElement(Ln.a.Option,{value:1,label:"Use custom template"},"Custom template")),!!f&&n.a.createElement("div",{className:"alert-custom-template","data-test":"AlertCustomTemplate"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("h5",{className:"flex-fill"},"Subject / Body"),"Preview"," ",n.a.createElement(In.a,{size:"small",className:"alert-template-preview",value:b,onChange:g})),n.a.createElement(Y.a,{value:b?E(s):s,onChange:e=>c(e.target.value),disabled:b,"data-test":"CustomSubject"}),n.a.createElement(Y.a.TextArea,{value:b?E(u):u,autosize:{minRows:9},onChange:e=>d(e.target.value),disabled:b,"data-test":"CustomBody"}),n.a.createElement(Pe,{type:"ALERT_NOTIF_TEMPLATE_GUIDE",className:"f-13"},n.a.createElement("i",{className:"fa fa-question-circle"})," Formatting guide")))}Ks.propTypes={alert:Lr.isRequired,query:Vr.isRequired,columnNames:D.a.arrayOf(D.a.string).isRequired,resultValues:D.a.arrayOf(D.a.any).isRequired,subject:D.a.string,setSubject:D.a.func.isRequired,body:D.a.string,setBody:D.a.func.isRequired},Ks.defaultProps={subject:"",body:""};var Ys=Ks;function Js(e){return(Js="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xs(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $s(e){return($s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ec(e,t){return(ec=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ac=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=$s(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Js(n)&&"function"!=typeof n?Zs(r):n,tc(Zs(a),"_isMounted",!1),tc(Zs(a),"state",{saving:!1}),tc(Zs(a),"save",()=>{a.setState({saving:!0}),a.props.save().catch(()=>{a._isMounted&&a.setState({saving:!1})})}),tc(Zs(a),"cancel",()=>{a.props.cancel()}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ec(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=e.menuButton,l=this.props,s=l.onQuerySelected,c=l.onNameChange,u=l.onRearmChange,d=l.onCriteriaChange,p=t.query,m=t.name,f=t.options,y=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Cl,{name:m,alert:t,onChange:c,editMode:!0},n.a.createElement(B.a,{className:"m-r-5",onClick:()=>this.cancel()},n.a.createElement("i",{className:"fa fa-times m-r-5"}),"Cancel"),n.a.createElement(B.a,{type:"primary",onClick:()=>this.save()},y?n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5"}):n.a.createElement("i",{className:"fa fa-check m-r-5"}),"Save Changes"),i),n.a.createElement("div",{className:"row bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(kl.a,{className:"flex-fill"},n.a.createElement(Ss,{label:"Query"},n.a.createElement(Xl,{query:p,queryResult:a,onChange:s,editMode:!0})),a&&f&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Ss,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(Al,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:f,onChange:d,editMode:!0})),n.a.createElement(Ss,{label:"When triggered, send notification"},n.a.createElement(Bl,{value:r||0,onChange:u,editMode:!0})),n.a.createElement(Ss,{label:"Template"},n.a.createElement(Ys,{alert:t,query:p,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:f.custom_subject,setSubject:e=>o({custom_subject:e}),body:f.custom_body,setBody:e=>o({custom_body:e})})))),n.a.createElement("div",null,n.a.createElement(Pe,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle"}))))))}}])&&Xs(a.prototype,r),o&&Xs(a,o),t}();function rc(e){return(rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nc(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oc(e){return(oc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ic(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lc(e,t){return(lc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}ac.propTypes={alert:Lr.isRequired,queryResult:D.a.object,pendingRearm:D.a.number,menuButton:D.a.node.isRequired,save:D.a.func.isRequired,cancel:D.a.func.isRequired,onQuerySelected:D.a.func.isRequired,onNameChange:D.a.func.isRequired,onCriteriaChange:D.a.func.isRequired,onRearmChange:D.a.func.isRequired,onNotificationTemplateChange:D.a.func.isRequired},ac.defaultProps={queryResult:null,pendingRearm:null};var cc=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=oc(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==rc(n)&&"function"!=typeof n?ic(r):n,sc(ic(a),"state",{saving:!1}),sc(ic(a),"save",()=>{a.setState({saving:!0}),a.props.save().catch(()=>{a.setState({saving:!1})})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lc(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=this.props,l=i.onQuerySelected,s=i.onNameChange,c=i.onRearmChange,u=i.onCriteriaChange,d=t.query,p=t.name,m=t.options,f=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Cl,{alert:t,name:p,onChange:s,editMode:!0}),n.a.createElement("div",{className:"row bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(kl.a,{className:"flex-fill"},n.a.createElement("div",{className:"m-b-30"},"Start by selecting the query that you would like to monitor using the search bar.",n.a.createElement("br",null),"Keep in mind that Alerts do not work with queries that use parameters."),n.a.createElement(Ss,{label:"Query"},n.a.createElement(Xl,{query:d,queryResult:a,onChange:l,editMode:!0})),a&&m&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Ss,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(Al,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:m,onChange:u,editMode:!0})),n.a.createElement(Ss,{label:"When triggered, send notification"},n.a.createElement(Bl,{value:r||0,onChange:c,editMode:!0})),n.a.createElement(Ss,{label:"Template"},n.a.createElement(Ys,{alert:t,query:d,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:m.custom_subject,setSubject:e=>o({custom_subject:e}),body:m.custom_body,setBody:e=>o({custom_body:e})}))),n.a.createElement(Ss,null,n.a.createElement(B.a,{type:"primary",onClick:this.save,disabled:!d,className:"btn-create-alert"},f&&n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5"}),"Create Alert"))),n.a.createElement(Pe,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle"})))))}}])&&nc(a.prototype,r),o&&nc(a,o),t}();function uc(e){return(uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dc(){return(dc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function pc(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mc(e){return(mc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yc(e,t){return(yc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}cc.propTypes={alert:Lr.isRequired,queryResult:D.a.object,pendingRearm:D.a.number,onQuerySelected:D.a.func.isRequired,save:D.a.func.isRequired,onNameChange:D.a.func.isRequired,onRearmChange:D.a.func.isRequired,onCriteriaChange:D.a.func.isRequired,onNotificationTemplateChange:D.a.func.isRequired},cc.defaultProps={queryResult:null,pendingRearm:null};var bc={NEW:0,VIEW:1,EDIT:2},gc=Object(l.template)("<%= query.name %>: <%= options.column %> <%= options.op %> <%= options.value %>");function vc(e){return e.query?gc(e):"New Alert"}var Ec=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=mc(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==uc(n)&&"function"!=typeof n?fc(r):n,hc(fc(a),"_isMounted",!1),hc(fc(a),"state",{alert:null,queryResult:null,pendingRearm:null,canEdit:!1,mode:null}),hc(fc(a),"save",()=>{var e=a.state,t=e.alert,r=e.pendingRearm;return t.name=Object(l.trim)(t.name)||vc(t),t.rearm=r||null,jl.save(t).then(e=>{vl.success("Saved."),We("alerts/".concat(e.id),!0),a.setState({alert:e,mode:bc.VIEW})}).catch(()=>{vl.error("Failed saving alert.")})}),hc(fc(a),"onQuerySelected",e=>{a.setState(t=>{return{alert:dc(t.alert,{query:e}),queryResult:null}}),e&&new Qt(e).getQueryResultPromise().then(e=>{if(a._isMounted){a.setState({queryResult:e});var t=a.state.alert.options.column,r=e.getColumnNames();t&&Object(l.includes)(r,t)||(t=Object(l.head)(e.getColumnNames())),a.setAlertOptions({column:t})}})}),hc(fc(a),"onNameChange",e=>{var t=a.state.alert;a.setState({alert:dc(t,{name:e})})}),hc(fc(a),"onRearmChange",e=>{a.setState({pendingRearm:e})}),hc(fc(a),"setAlertOptions",e=>{var t=a.state.alert,r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){hc(e,t,a[t])})}return e}({},t.options,e);a.setState({alert:dc(t,{options:r})})}),hc(fc(a),"delete",()=>{var e=a.state.alert;return jl.delete(e).then(()=>{vl.success("Alert deleted successfully."),We("alerts")}).catch(()=>{vl.error("Failed deleting alert.")})}),hc(fc(a),"mute",()=>{var e=a.state.alert;return jl.mute(e).then(()=>{a.setAlertOptions({muted:!0}),vl.warn("Notifications have been muted.")}).catch(()=>{vl.error("Failed muting notifications.")})}),hc(fc(a),"unmute",()=>{var e=a.state.alert;return jl.unmute(e).then(()=>{a.setAlertOptions({muted:!1}),vl.success("Notifications have been restored.")}).catch(()=>{vl.error("Failed restoring notifications.")})}),hc(fc(a),"edit",()=>{var e=a.state.alert.id;We("alerts/".concat(e,"/edit"),!0),a.setState({mode:bc.EDIT})}),hc(fc(a),"cancel",()=>{var e=a.state.alert.id;We("alerts/".concat(e),!0),a.setState({mode:bc.VIEW})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yc(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this._isMounted=!0;var e=this.props.mode;if(this.setState({mode:e}),e===bc.NEW)this.setState({alert:{options:{op:">",value:1,muted:!1}},pendingRearm:0,canEdit:!0});else{var t=this.props.alertId;jl.get({id:t}).then(e=>{if(this._isMounted){var t=O.canEdit(e);t||(this.setState({mode:bc.VIEW}),vl.warn("You cannot edit this alert","You do not have sufficient permissions to edit this alert, and have been redirected to the view-only page.",{duration:0})),this.setState({alert:e,canEdit:t,pendingRearm:e.rearm}),this.onQuerySelected(e.query)}}).catch(e=>{this._isMounted&&this.props.onError(e)})}}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this.state.alert;if(!e)return n.a.createElement(Si,{className:"m-t-30"});var t=!!e.options.muted,a=this.state,r=a.queryResult,o=a.mode,i=a.canEdit,l=a.pendingRearm,s=n.a.createElement(Pl,{doDelete:this.delete,muted:t,mute:this.mute,unmute:this.unmute,canEdit:i}),c={alert:e,queryResult:r,pendingRearm:l,save:this.save,menuButton:s,onQuerySelected:this.onQuerySelected,onRearmChange:this.onRearmChange,onNameChange:this.onNameChange,onCriteriaChange:this.setAlertOptions,onNotificationTemplateChange:this.setAlertOptions};return n.a.createElement("div",{className:"alert-page"},n.a.createElement("div",{className:"container"},o===bc.NEW&&n.a.createElement(cc,c),o===bc.VIEW&&n.a.createElement(Gs,dc({canEdit:i,onEdit:this.edit,muted:t,unmute:this.unmute},c)),o===bc.EDIT&&n.a.createElement(ac,dc({cancel:this.cancel},c))))}}])&&pc(a.prototype,r),o&&pc(a,o),t}();hc(Ec,"propTypes",{mode:D.a.oneOf(Object(l.values)(bc)),alertId:D.a.string,onError:D.a.func}),hc(Ec,"defaultProps",{mode:null,alertId:null,onError:()=>{}});var Oc=[mr({path:"/alerts/new",title:"New Alert",render:e=>n.a.createElement(Ec,dc({},e,{mode:bc.NEW}))}),mr({path:"/alerts/:alertId([0-9]+)",title:"Alert",render:e=>n.a.createElement(Ec,dc({},e,{mode:bc.VIEW}))}),mr({path:"/alerts/:alertId([0-9]+)/edit",title:"Alert",render:e=>n.a.createElement(Ec,dc({},e,{mode:bc.EDIT}))})];a(1380);function wc(){return(wc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jc(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Sc={className:D.a.string,children:D.a.node},Pc={className:null,children:null};function _c(e){var t=e.className,a=e.children,r=jc(e,["className","children"]);return n.a.createElement("div",wc({className:Z()("layout-sidebar",t)},r),n.a.createElement("div",null,a))}function kc(e){var t=e.className,a=e.children,r=jc(e,["className","children"]);return n.a.createElement("div",wc({className:Z()("layout-content",t)},r),n.a.createElement("div",null,a))}function Cc(e){var t=e.className,a=e.children,r=jc(e,["className","children"]);return n.a.createElement("div",wc({className:Z()("layout-with-sidebar",t)},r),a)}function Nc(e){var t=e.objectType,a=e.tags;return n.a.createElement(re,{icon:"fa-tags"},"No ",t," found tagged with ",n.a.createElement(no,{className:"inline-tags-control",tags:Array.from(a)}),".")}function Tc(e){var t=e.page,a=e.searchTerm,r=e.selectedTags;if(""!==a)return n.a.createElement(re,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(r.length>0)return n.a.createElement(Nc,{objectType:"dashboards",tags:r});switch(t){case"favorites":return n.a.createElement(re,{message:"Mark dashboards as Favorite to list them here.",icon:"fa-star"});default:return n.a.createElement(ks,{icon:"zmdi zmdi-view-quilt",description:"See the big picture",illustration:"dashboard",helpLink:"https://help.redash.io/category/22-dashboards",showDashboardStep:!0})}}_c.propTypes=Sc,_c.defaultProps=Pc,kc.propTypes=Sc,kc.defaultProps=Pc,Cc.propTypes=Sc,Cc.defaultProps=Pc,Cc.Sidebar=_c,Cc.Content=kc,Nc.propTypes={objectType:D.a.string.isRequired,tags:D.a.oneOfType([D.a.array,D.a.objectOf(Set)]).isRequired},Tc.propTypes={page:D.a.string.isRequired,searchTerm:D.a.string.isRequired,selectedTags:D.a.array.isRequired};a(1381);function qc(){return(qc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xc(e){return(xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rc(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ac(e){return(Ac=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ic(e,t){return(Ic=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Mc=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return r=this,a=!(o=(e=Ac(t)).call.apply(e,[this].concat(l)))||"object"!==xc(o)&&"function"!=typeof o?Dc(r):o,zc(Dc(a),"sidebarMenu",[{key:"all",href:"dashboards",title:"All Dashboards"},{key:"favorites",href:"dashboards/favorites",title:"Favorites",icon:()=>n.a.createElement(Vi,{icon:"fa fa-star"})}]),zc(Dc(a),"listColumns",[pn.favorites({className:"p-r-0"}),pn.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{className:"table-main-title",href:"dashboard/"+t.slug,"data-test":t.slug},t.name),n.a.createElement(lo,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),pn.custom((e,t)=>t.user.name,{title:"Created By"}),pn.dateTime.sortable({title:"Created At",field:"created_at",className:"text-nowrap",width:"1%"})]),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ic(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{className:"page-dashboard-list"},n.a.createElement("div",{className:"container"},n.a.createElement(fr,{title:e.params.pageTitle}),n.a.createElement(Cc,{className:"m-l-15 m-r-15"},n.a.createElement(Cc.Sidebar,{className:"m-b-0"},n.a.createElement(zi,{placeholder:"Search Dashboards...",value:e.searchTerm,onChange:e.updateSearch}),n.a.createElement(Mi,{items:this.sidebarMenu,selected:e.params.currentPage}),n.a.createElement(Li,{url:"api/dashboards/tags",onChange:e.updateSelectedTags}),n.a.createElement(Ui,{className:"m-b-10",options:e.pageSizeOptions,value:e.itemsPerPage,onChange:t=>e.updatePagination({itemsPerPage:t})})),n.a.createElement(Cc.Content,null,e.isLoaded?n.a.createElement("div",{"data-test":"DashboardLayoutContent"},e.isEmpty?n.a.createElement(Tc,{page:e.params.currentPage,searchTerm:e.searchTerm,selectedTags:e.selectedTags}):n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})}))):n.a.createElement(Si,null)))))}}])&&Rc(a.prototype,r),o&&Rc(a,o),t}();zc(Mc,"propTypes",{controller:Co.isRequired});var Vc=No(Mc,()=>new di({getResource:function(e){var t=e.params.currentPage;return{all:Ka.query.bind(Ka),favorites:Ka.favorites.bind(Ka)}[t]},getItemProcessor:function(){return e=>new Ka(e)}}),()=>new wi({orderByField:"created_at",orderByReverse:!0})),Fc=[mr({path:"/dashboards",title:"Dashboards",render:e=>n.a.createElement(Vc,qc({},e,{currentPage:"all"}))}),mr({path:"/dashboards/favorites",title:"Favorite Dashboards",render:e=>n.a.createElement(Vc,qc({},e,{currentPage:"favorites"}))})],Lc=a(57),Uc=a.n(Lc),Bc=(a(609),a(390)),Qc=a(131),Wc=a(129),Gc=a.n(Wc),Hc=a(181),Kc=a(391),Yc=a.n(Kc);a(1395);function Jc(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Xc=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Cmd":"Ctrl",$c=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Option":"Alt";var Zc={};function eu(e,t){e.preventDefault(),e.retunValue=!1,Object(l.each)(Zc[t],e=>e())}var tu={modKey:Xc,altKey:$c,bind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Zc[t]=[].concat(Jc(Object(l.without)(Zc[t],e)),[e]),Yc.a.bindGlobal(t,eu)})})},unbind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Zc[t]=Object(l.without)(Zc[t],e),0===Zc[t].length&&(Zc[t]=void 0,Yc.a.unbind(t))})})}};function au(e){var t=e.paramCount,a=e.onClick,r=t?"check":"spinner fa-pulse";return n.a.createElement("div",{className:"parameter-apply-button","data-show":!!t,"data-test":"ParameterApplyButton"},n.a.createElement(br.a,{count:t},n.a.createElement(X.a,{title:t?"".concat(tu.modKey," + Enter"):null},n.a.createElement("span",null,n.a.createElement(B.a,{onClick:a},n.a.createElement("i",{className:"fa fa-".concat(r)})," Apply Changes")))))}au.propTypes={onClick:D.a.func.isRequired,paramCount:D.a.number.isRequired};var ru=au,nu=a(112),ou=a.n(nu);function iu(){return(iu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function lu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var su=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,l=lu(e,["defaultValue","value","onSelect","className"]),s=w.dateFormat||"YYYY-MM-DD",c={};return a&&a.isValid()&&(c.defaultValue=a),(null===r||r&&r.isValid())&&(c.value=r),n.a.createElement(ou.a,iu({ref:t,className:i},c,{format:s,placeholder:"Select Date",onChange:o},l))});su.propTypes={defaultValue:Br,value:Br,onSelect:D.a.func,className:D.a.string},su.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var cu=su;function uu(){return(uu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function du(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var pu=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,l=e.className,s=du(e,["defaultValue","value","withSeconds","onSelect","className"]),c=(w.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),u={};return a&&a.isValid()&&(u.defaultValue=a),(null===r||r&&r.isValid())&&(u.value=r),n.a.createElement(ou.a,uu({ref:t,className:l,showTime:!0},u,{format:c,placeholder:"Select Date and Time",onChange:i},s))});pu.propTypes={defaultValue:Br,value:Br,withSeconds:D.a.bool,onSelect:D.a.func,className:D.a.string},pu.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var mu=pu,fu=a(78),yu=a.n(fu),hu=(a(1421),yu.a.Text);function bu(e){var t=e.options,a=e.selectedDynamicValue,o=e.onSelect,i=e.enabled,s=n.a.createElement(H.a,{className:"dynamic-menu",onClick:e=>{var a=e.key;return o(Object(l.get)(t,a,"static"))},selectedKeys:["".concat(Object(l.findIndex)(t,{value:a}))],"data-test":"DynamicButtonMenu"},t.map((e,t)=>n.a.createElement(H.a.Item,{key:t},e.name," ",e.label&&n.a.createElement("em",null,Object(l.isFunction)(e.label)?e.label():e.label))),i&&n.a.createElement(H.a.Divider,null),i&&n.a.createElement(H.a.Item,null,n.a.createElement(W.a,{type:"arrow-left"}),n.a.createElement(hu,{type:"secondary"},"Back to Static Value"))),c=Object(r.useRef)(null);return n.a.createElement("div",{ref:c},n.a.createElement("a",{onClick:e=>e.stopPropagation()},n.a.createElement(L.a.Button,{overlay:s,className:"dynamic-button",placement:"bottomRight",trigger:["click"],icon:n.a.createElement(W.a,{type:"thunderbolt",theme:i?"twoTone":"outlined",className:"dynamic-icon"}),getPopupContainer:()=>c.current,"data-test":"DynamicButton"})))}bu.propTypes={options:D.a.arrayOf(D.a.object),selectedDynamicValue:D.a.oneOfType([ua,Pa]),onSelect:D.a.func,enabled:D.a.bool},bu.defaultProps={options:[],selectedDynamicValue:null,onSelect:()=>{},enabled:!1};var gu=bu;a(626);function vu(e){return(vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Eu(){return(Eu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ou(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wu(e){return(wu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ju(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Su(e,t){return(Su=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _u=[{name:"Today/Now",value:ma("d_now"),label:()=>ma("d_now").value().format("MMM D")},{name:"Yesterday",value:ma("d_yesterday"),label:()=>ma("d_yesterday").value().format("MMM D")}],ku=function(e){function t(e){var a,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=wu(t).call(this,e),a=!o||"object"!==vu(o)&&"function"!=typeof o?ju(r):o,Pu(ju(a),"onDynamicValueSelect",e=>{var t=a.props,r=t.onSelect,n=t.parameter;if("static"===e){var o=n.getExecutionValue();r(o?rt()(o):null)}else r(e.value);a.dateComponentRef.current.focus()}),a.dateComponentRef=n.a.createRef(),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Su(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props,t=e.type,a=e.value,r=e.className,o=e.onSelect,i=pa(a),s=Object(l.includes)(t,"datetime"),c={},u=cu;if(s&&(u=mu,Object(l.includes)(t,"with-seconds")&&(c.withSeconds=!0)),(rt.a.isMoment(a)||null===a)&&(c.value=a),i){var d=a;c.placeholder=d&&d.name,c.value=null}return n.a.createElement(u,Eu({ref:this.dateComponentRef,className:Z()("redash-datepicker",{"dynamic-value":i},r),onSelect:o,suffixIcon:n.a.createElement(gu,{options:_u,selectedDynamicValue:i?a:null,enabled:i,onSelect:this.onDynamicValueSelect})},c))}}])&&Ou(a.prototype,r),o&&Ou(a,o),t}();Pu(ku,"propTypes",{type:D.a.string,className:D.a.string,value:D.a.any,parameter:D.a.any,onSelect:D.a.func}),Pu(ku,"defaultProps",{type:"",className:"",value:null,parameter:null,onSelect:()=>{}});var Cu=ku;function Nu(){return(Nu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Tu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var qu=ou.a.RangePicker,xu=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,s=Tu(e,["defaultValue","value","onSelect","className"]),c=w.dateFormat||"YYYY-MM-DD",u={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(u.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(u.value=r),n.a.createElement(qu,Nu({ref:t,className:i},u,{format:c,onChange:o},s))});xu.propTypes={defaultValue:D.a.arrayOf(Br),value:D.a.arrayOf(Br),onSelect:D.a.func,className:D.a.string},xu.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var Ru=xu;function Au(){return(Au=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Du(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Iu=ou.a.RangePicker,zu=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,s=e.className,c=Du(e,["defaultValue","value","withSeconds","onSelect","className"]),u=(w.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),d={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(d.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(d.value=r),n.a.createElement(Iu,Au({ref:t,className:s,showTime:!0},d,{format:u,onChange:i},c))});zu.propTypes={defaultValue:D.a.arrayOf(Br),value:D.a.arrayOf(Br),withSeconds:D.a.bool,onSelect:D.a.func,className:D.a.string},zu.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var Mu=zu;function Vu(e){return(Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fu(){return(Fu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lu(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Uu(e){return(Uu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qu(e,t){return(Qu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Gu=[{name:"This week",value:Ca("d_this_week"),label:()=>Ca("d_this_week").value()[0].format("MMM D")+" - "+Ca("d_this_week").value()[1].format("MMM D")},{name:"This month",value:Ca("d_this_month"),label:()=>Ca("d_this_month").value()[0].format("MMMM")},{name:"This year",value:Ca("d_this_year"),label:()=>Ca("d_this_year").value()[0].format("YYYY")},{name:"Last week",value:Ca("d_last_week"),label:()=>Ca("d_last_week").value()[0].format("MMM D")+" - "+Ca("d_last_week").value()[1].format("MMM D")},{name:"Last month",value:Ca("d_last_month"),label:()=>Ca("d_last_month").value()[0].format("MMMM")},{name:"Last year",value:Ca("d_last_year"),label:()=>Ca("d_last_year").value()[0].format("YYYY")},{name:"Last 7 days",value:Ca("d_last_7_days"),label:()=>Ca("d_last_7_days").value()[0].format("MMM D")+" - Today"},{name:"Last 14 days",value:Ca("d_last_14_days"),label:()=>Ca("d_last_14_days").value()[0].format("MMM D")+" - Today"},{name:"Last 30 days",value:Ca("d_last_30_days"),label:()=>Ca("d_last_30_days").value()[0].format("MMM D")+" - Today"},{name:"Last 60 days",value:Ca("d_last_60_days"),label:()=>Ca("d_last_60_days").value()[0].format("MMM D")+" - Today"},{name:"Last 90 days",value:Ca("d_last_90_days"),label:()=>Ca("d_last_90_days").value()[0].format("MMM D")+" - Today"}],Hu=[{name:"Today",value:Ca("d_today"),label:()=>Ca("d_today").value()[0].format("MMM D")},{name:"Yesterday",value:Ca("d_yesterday"),label:()=>Ca("d_yesterday").value()[0].format("MMM D")}].concat(Gu),Ku={"date-range":294,"datetime-range":352,"datetime-range-with-seconds":382};var Yu=function(e){function t(e){var a,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=Uu(t).call(this,e),a=!o||"object"!==Vu(o)&&"function"!=typeof o?Bu(r):o,Wu(Bu(a),"onDynamicValueSelect",e=>{var t=a.props,r=t.onSelect,n=t.parameter;if("static"===e){var o=n.getExecutionValue();Object(l.isObject)(o)&&o.start&&o.end?r([rt()(o.start),rt()(o.end)]):r(null)}else r(e.value);a.dateRangeComponentRef.current.focus()}),a.dateRangeComponentRef=n.a.createRef(),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qu(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props,t=e.type,a=e.value,r=e.onSelect,o=e.className,i=Object(l.includes)(t,"datetime-range"),s=ka(a),c=i?Hu:Gu,u={},d=Ru;return i&&(d=Mu,Object(l.includes)(t,"with-seconds")&&(u.withSeconds=!0)),(function(e){return Object(l.isArray)(e)&&2===e.length&&rt.a.isMoment(e[0])&&rt.a.isMoment(e[1])}(a)||null===a)&&(u.value=a),s&&(u.placeholder=[a&&a.name],u.value=null),n.a.createElement(d,Fu({ref:this.dateRangeComponentRef,className:Z()("redash-datepicker date-range-input",{"dynamic-value":s},o),onSelect:r,style:{width:s?195:Ku[t]},suffixIcon:n.a.createElement(gu,{options:c,selectedDynamicValue:s?a:null,enabled:s,onSelect:this.onDynamicValueSelect})},u))}}])&&Lu(a.prototype,r),o&&Lu(a,o),t}();Wu(Yu,"propTypes",{type:D.a.string,className:D.a.string,value:D.a.any,parameter:D.a.any,onSelect:D.a.func}),Wu(Yu,"defaultProps",{type:"",className:"",value:null,parameter:null,onSelect:()=>{}});var Ju=Yu;a(1422);function Xu(e){return(Xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $u(){return($u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zu(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ed(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function td(e,t){return!t||"object"!==Xu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ad(e){return(ad=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rd(e,t){return(rd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var od=Ln.a.Option,id=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=td(this,ad(t).call(this,e))).state={options:[],value:null,loading:!1},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rd(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this._loadOptions(this.props.queryId)}},{key:"componentDidUpdate",value:function(e){this.props.queryId!==e.queryId&&this._loadOptions(this.props.queryId),this.props.value!==e.value&&this.setValue(this.props.value)}},{key:"setValue",value:function(e){var t=this.state.options;if("multiple"===this.props.mode){e=Object(l.isArray)(e)?e:[e];var a=Object(l.map)(t,e=>e.value),r=Object(l.intersection)(e,a);return this.setState({value:r}),r}return e=void 0!==Object(l.find)(t,e=>e.value===this.props.value)?e:Object(l.get)(Object(l.first)(t),"value"),this.setState({value:e}),e}},{key:"_loadOptions",value:function(e){var t;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e||e===this.state.queryId){a.next=6;break}return this.setState({loading:!0}),a.next=4,regeneratorRuntime.awrap(this.props.parameter.loadDropdownValues());case 4:t=a.sent,this.props.queryId===e&&this.setState({options:t,loading:!1},()=>{var e=this.setValue(this.props.value);Object(l.isEqual)(e,this.props.value)||this.props.onSelect(e)});case 6:case"end":return a.stop()}},null,this)}},{key:"render",value:function(){var e=this.props,t=e.className,a=(e.value,e.mode),r=e.onSelect,o=Zu(e,["className","value","mode","onSelect"]),i=this.state,s=i.loading,c=i.options;return n.a.createElement("span",null,n.a.createElement(Ln.a,$u({className:t,disabled:s,loading:s,mode:a,value:this.state.value,onChange:r,dropdownMatchSelectWidth:!1,optionFilterProp:"children",showSearch:!0,showArrow:!0,notFoundContent:Object(l.isEmpty)(c)?"No options available":null},o),c.map(e=>n.a.createElement(od,{value:e.value,key:e.value},e.name))))}}])&&ed(a.prototype,r),o&&ed(a,o),t}();nd(id,"propTypes",{parameter:D.a.any,value:D.a.any,mode:D.a.oneOf(["default","multiple"]),queryId:D.a.number,onSelect:D.a.func,className:D.a.string}),nd(id,"defaultProps",{value:null,mode:"default",parameter:null,queryId:null,onSelect:()=>{},className:""});a(1423);function ld(e){return(ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sd(){return(sd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cd(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ud(e){return(ud=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pd(e,t){return(pd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function md(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var fd=Ln.a.Option,yd={maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more")},hd=function(e){function t(e){var a,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=ud(t).call(this,e),a=!n||"object"!==ld(n)&&"function"!=typeof n?dd(r):n,md(dd(a),"componentDidUpdate",e=>{var t=a.props,r=t.value,n=t.parameter;e.value===r&&e.parameter===n||a.setState({value:n.hasPendingValue?n.pendingValue:r,isDirty:n.hasPendingValue})}),md(dd(a),"onSelect",e=>{var t=!Object(l.isEqual)(e,a.props.value);a.setState({value:e,isDirty:t}),a.props.onSelect(e,t)}),a.state={value:e.parameter.hasPendingValue?e.parameter.pendingValue:e.value,isDirty:e.parameter.hasPendingValue},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pd(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderDateParameter",value:function(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(Cu,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}},{key:"renderDateRangeParameter",value:function(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(Ju,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}},{key:"renderEnumInput",value:function(){var e=this.props,t=e.enumOptions,a=e.parameter,r=this.state.value,o=t.split("\n").filter(e=>""!==e);return n.a.createElement(Ln.a,sd({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",optionFilterProp:"children",value:(e=>a.multiValuesOptions&&null===e?[]:e)(r),onChange:this.onSelect,dropdownMatchSelectWidth:!1,showSearch:!0,showArrow:!0,style:{minWidth:60},notFoundContent:Object(l.isEmpty)(o)?"No options available":null},yd),o.map(e=>n.a.createElement(fd,{key:e,value:e},e)))}},{key:"renderQueryBasedInput",value:function(){var e=this.props,t=e.queryId,a=e.parameter,r=this.state.value;return n.a.createElement(id,sd({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",optionFilterProp:"children",parameter:a,value:r,queryId:t,onSelect:this.onSelect,style:{minWidth:60}},yd))}},{key:"renderNumberInput",value:function(){var e=this.props.className,t=this.state.value,a=e=>isNaN(e)?void 0:e;return n.a.createElement(Il.a,{className:e,value:a(t),onChange:e=>this.onSelect(a(e))})}},{key:"renderTextInput",value:function(){var e=this.props.className,t=this.state.value;return n.a.createElement(Y.a,{className:e,value:t,"data-test":"TextParamInput",onChange:e=>this.onSelect(e.target.value)})}},{key:"renderInput",value:function(){switch(this.props.type){case"datetime-with-seconds":case"datetime-local":case"date":return this.renderDateParameter();case"datetime-range-with-seconds":case"datetime-range":case"date-range":return this.renderDateRangeParameter();case"enum":return this.renderEnumInput();case"query":return this.renderQueryBasedInput();case"number":return this.renderNumberInput();default:return this.renderTextInput()}}},{key:"render",value:function(){var e=this.state.isDirty;return n.a.createElement("div",{className:"parameter-input","data-dirty":e||null,"data-test":"ParameterValueInput"},this.renderInput())}}])&&cd(a.prototype,r),o&&cd(a,o),t}();md(hd,"propTypes",{type:D.a.string,value:D.a.any,enumOptions:D.a.string,queryId:D.a.number,parameter:D.a.any,onSelect:D.a.func,className:D.a.string}),md(hd,"defaultProps",{type:"text",value:null,enumOptions:"",queryId:null,parameter:null,onSelect:()=>{},className:""});var bd=hd;function gd(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){vd(e,t,a[t])})}return e}function vd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ed(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Od(){return(Od=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var wd=Ln.a.Option,jd={labelCol:{span:6},wrapperCol:{span:16}};function Sd(e){return Object(l.capitalize)(Object(l.words)(e).join(" "))}function Pd(e){var t=e.name,a=e.type,r=e.onChange,o=e.existingNames,i=e.setValidation,s="",c="";return t?Object(l.includes)(o,t)?(s="Parameter with this name already exists",i(!1),c="error"):(function(e){return/-range/.test(e)}(a)&&(s=n.a.createElement(n.a.Fragment,null,"Appears in query as"," ",n.a.createElement("code",{style:{display:"inline-block",color:"inherit"}},"{{".concat(t,".start}} {{").concat(t,".end}}")))),i(!0)):(s="Choose a keyword for this parameter",i(!1)),n.a.createElement(kl.a.Item,Od({required:!0,label:"Keyword",help:s,validateStatus:c},jd),n.a.createElement(Y.a,{onChange:e=>r(e.target.value),autoFocus:!0}))}function _d(e){var t,a,o,i=Ed(Object(r.useState)(Object(l.clone)(e.parameter)),2),s=i[0],c=i[1],u=Ed(Object(r.useState)(!0),2),d=u[0],p=u[1],m=Ed(Object(r.useState)(),2),f=m[0],y=m[1],h=!e.parameter.name;return Object(r.useEffect)(()=>{var t=e.parameter.queryId;t&&Qt.get({id:t}).then(y)},[e.parameter.queryId]),n.a.createElement(ke.a,Od({},e.dialog.props,{title:h?"Add Parameter":s.name,width:600,footer:[n.a.createElement(B.a,{key:"cancel",onClick:e.dialog.dismiss},"Cancel"),n.a.createElement(B.a,{key:"submit",htmlType:"submit",disabled:!(d&&""!==s.title&&("query"!==s.type||s.queryId)),type:"primary",form:"paramForm","data-test":"SaveParameterSettings"},h?"Add Parameter":"OK")]}),n.a.createElement(kl.a,{layout:"horizontal",onSubmit:function(t){s.title||(s.title=Sd(s.name),c(s)),e.dialog.close(s),t.preventDefault()},id:"paramForm"},h&&n.a.createElement(Pd,{name:s.name,onChange:e=>c(gd({},s,{name:e})),setValidation:p,existingNames:e.existingParams,type:s.type}),n.a.createElement(kl.a.Item,Od({label:"Title"},jd),n.a.createElement(Y.a,{value:Object(l.isNull)(s.title)?Sd(s.name):s.title,onChange:e=>c(gd({},s,{title:e.target.value})),"data-test":"ParameterTitleInput"})),n.a.createElement(kl.a.Item,Od({label:"Type"},jd),n.a.createElement(Ln.a,{value:s.type,onChange:e=>c(gd({},s,{type:e})),"data-test":"ParameterTypeSelect"},n.a.createElement(wd,{value:"text","data-test":"TextParameterTypeOption"},"Text"),n.a.createElement(wd,{value:"number","data-test":"NumberParameterTypeOption"},"Number"),n.a.createElement(wd,{value:"enum"},"Dropdown List"),n.a.createElement(wd,{value:"query"},"Query Based Dropdown List"),n.a.createElement(wd,{disabled:!0,key:"dv1"},n.a.createElement(Tl.a,{className:"select-option-divider"})),n.a.createElement(wd,{value:"date","data-test":"DateParameterTypeOption"},"Date"),n.a.createElement(wd,{value:"datetime-local","data-test":"DateTimeParameterTypeOption"},"Date and Time"),n.a.createElement(wd,{value:"datetime-with-seconds"},"Date and Time (with seconds)"),n.a.createElement(wd,{disabled:!0,key:"dv2"},n.a.createElement(Tl.a,{className:"select-option-divider"})),n.a.createElement(wd,{value:"date-range","data-test":"DateRangeParameterTypeOption"},"Date Range"),n.a.createElement(wd,{value:"datetime-range"},"Date and Time Range"),n.a.createElement(wd,{value:"datetime-range-with-seconds"},"Date and Time Range (with seconds)"))),"enum"===s.type&&n.a.createElement(kl.a.Item,Od({label:"Values",help:"Dropdown list values (newline delimited)"},jd),n.a.createElement(Y.a.TextArea,{rows:3,value:s.enumOptions,onChange:e=>c(gd({},s,{enumOptions:e.target.value}))})),"query"===s.type&&n.a.createElement(kl.a.Item,Od({label:"Query",help:"Select query to load dropdown values from"},jd),n.a.createElement(Jl,{selectedQuery:f,onChange:e=>c(gd({},s,{queryId:e&&e.id})),type:"select"})),("enum"===s.type||"query"===s.type)&&n.a.createElement(kl.a.Item,Od({className:"m-b-0",label:" ",colon:!1},jd),n.a.createElement(Uc.a,{defaultChecked:!!s.multiValuesOptions,onChange:e=>c(gd({},s,{multiValuesOptions:e.target.checked?{prefix:"",suffix:"",separator:","}:null})),"data-test":"AllowMultipleValuesCheckbox"},"Allow multiple values")),("enum"===s.type||"query"===s.type)&&s.multiValuesOptions&&n.a.createElement(kl.a.Item,Od({label:"Quotation",help:n.a.createElement(n.a.Fragment,null,"Placed in query as: ",n.a.createElement("code",null,(t=s.multiValuesOptions,a=t.prefix,o=t.suffix,["value1","value2","value3"].map(e=>"".concat(a).concat(e).concat(o)).join(","))))},jd),n.a.createElement(Ln.a,{value:s.multiValuesOptions.prefix,onChange:e=>c(gd({},s,{multiValuesOptions:gd({},s.multiValuesOptions,{prefix:e,suffix:e})})),"data-test":"QuotationSelect"},n.a.createElement(wd,{value:""},"None (default)"),n.a.createElement(wd,{value:"'"},"Single Quotation Mark"),n.a.createElement(wd,{value:'"',"data-test":"DoubleQuotationMarkOption"},"Double Quotation Mark")))))}Pd.propTypes={name:D.a.string.isRequired,onChange:D.a.func.isRequired,existingNames:D.a.arrayOf(D.a.string).isRequired,setValidation:D.a.func.isRequired,type:D.a.string.isRequired},_d.propTypes={parameter:D.a.object.isRequired,dialog:Te.isRequired,existingParams:D.a.arrayOf(D.a.string)},_d.defaultProps={existingParams:[]};var kd=xe(_d);a(1424);function Cd(e){return(Cd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nd(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Td(e){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xd(e,t){return(xd=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ad(e){var t=Object(l.extend)({},E.search);e.forEach(e=>{Object(l.extend)(t,e.toUrlParams())}),E.setSearch(t,!0)}var Dd=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=Td(t).call(this,e),a=!n||"object"!==Cd(n)&&"function"!=typeof n?qd(r):n,Rd(qd(a),"componentDidUpdate",e=>{var t=a.props,r=t.parameters,n=t.disableUrlUpdate,o=e.parameters!==r,i=e.disableUrlUpdate!==n;o&&a.setState({parameters:r}),!o&&!i||n||Ad(r)}),Rd(qd(a),"handleKeyDown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.stopPropagation(),a.applyChanges())}),Rd(qd(a),"setPendingValue",(e,t,r)=>{var n=a.props.onPendingValuesChange;a.setState(a=>{var o=a.parameters;return r?e.setPendingValue(t):e.clearPendingValue(),n(),{parameters:o}})}),Rd(qd(a),"moveParameter",e=>{var t=e.oldIndex,r=e.newIndex,n=a.props.onParametersEdit;t!==r&&a.setState(e=>{var a=e.parameters;return a.splice(r,0,a.splice(t,1)[0]),n(),{parameters:a}})}),Rd(qd(a),"applyChanges",()=>{var e=a.props,t=e.onValuesChange,r=e.disableUrlUpdate;a.setState(e=>{var a=e.parameters,n=a.filter(e=>e.hasPendingValue);return Object(l.forEach)(a,e=>e.applyPendingValue()),r||Ad(a),t(n),{parameters:a}})}),Rd(qd(a),"showParameterSettings",(e,t)=>{var r=a.props.onParametersEdit;kd.showModal({parameter:e}).onClose(n=>{a.setState(a=>{var o=a.parameters,i=Object(l.extend)(e,n);return o[t]=qa(i,i.parentQueryId),r(),{parameters:o}})})});var o=e.parameters;return a.state={parameters:o},e.disableUrlUpdate||Ad(o),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xd(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderParameter",value:function(e,t){var a=this.props.editable;return n.a.createElement("div",{key:e.name,className:"di-block","data-test":"ParameterName-".concat(e.name)},n.a.createElement("div",{className:"parameter-heading"},n.a.createElement("label",null,e.title||en(e.name)),a&&n.a.createElement("button",{className:"btn btn-default btn-xs m-l-5",onClick:()=>this.showParameterSettings(e,t),"data-test":"ParameterSettings-".concat(e.name),type:"button"},n.a.createElement("i",{className:"fa fa-cog"}))),n.a.createElement(bd,{type:e.type,value:e.normalizedValue,parameter:e,enumOptions:e.enumOptions,queryId:e.queryId,onSelect:(t,a)=>this.setPendingValue(e,t,a)}))}},{key:"render",value:function(){var e=this.state.parameters,t=this.props.editable,a=Object(l.size)(Object(l.filter)(e,"hasPendingValue"));return n.a.createElement(Hc.SortableContainer,{disabled:!t,axis:"xy",useDragHandle:!0,lockToContainerEdges:!0,helperClass:"parameter-dragged",updateBeforeSortStart:this.onBeforeSortStart,onSortEnd:this.moveParameter,containerProps:{className:"parameter-container",onKeyDown:a?this.handleKeyDown:null}},e.map((e,a)=>n.a.createElement(Hc.SortableElement,{key:e.name,index:a},n.a.createElement("div",{className:"parameter-block","data-editable":t||null},t&&n.a.createElement(Hc.DragHandle,{"data-test":"DragHandle-".concat(e.name)}),this.renderParameter(e,a)))),n.a.createElement(ru,{onClick:this.applyChanges,paramCount:a}))}}])&&Nd(a.prototype,r),o&&Nd(a,o),t}();function Id(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zd(e){var t=e.from,a=Object(r.useMemo)(()=>rt()(t).valueOf(),[t]),o=Id(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{function e(){var e=rt.a.now()-a,t=e>36e5?"HH:mm:ss":"mm:ss";l(rt.a.utc(e).format(t))}e();var t=setInterval(e,1e3);return()=>clearInterval(t)},[a]),n.a.createElement("span",{className:"rd-timer"},i)}Rd(Dd,"propTypes",{parameters:D.a.arrayOf(D.a.instanceOf(ot)),editable:D.a.bool,disableUrlUpdate:D.a.bool,onValuesChange:D.a.func,onPendingValuesChange:D.a.func,onParametersEdit:D.a.func}),Rd(Dd,"defaultProps",{parameters:[],editable:!1,disableUrlUpdate:!1,onValuesChange:()=>{},onPendingValuesChange:()=>{},onParametersEdit:()=>{}}),zd.propTypes={from:D.a.oneOfType([D.a.string,D.a.number,D.a.instanceOf(Date),Br])},zd.defaultProps={from:null};a(1425);function Md(e){var t=e.visualization,a=Ra.registeredVisualizations[t.type];return n.a.createElement("span",{className:"visualization-name"},a&&t.name!==a.name?t.name:null)}Md.propTypes={visualization:Ra.VisualizationType.isRequired};var Vd=Md;a(1426);function Fd(e){var t,a=e.query,r=e.visualization,o=e.readOnly;return n.a.createElement("a",{href:o?null:(t=null,r&&(t="TABLE"===r.type?"table":r.id),a.getUrl(!1,t)),className:"query-link"},n.a.createElement(Vd,{visualization:r})," ",n.a.createElement("span",null,a.name))}Fd.propTypes={query:D.a.object.isRequired,visualization:Ra.VisualizationType,readOnly:D.a.bool},Fd.defaultProps={visualization:null,readOnly:!1};var Ld=Fd;function Ud(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Bd(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Qd="###Redash::Filters::SelectAll###",Wd="###Redash::Filters::Clear###",Gd=D.a.shape({name:D.a.string.isRequired,friendlyName:D.a.string.isRequired,multiple:D.a.bool,current:D.a.oneOfType([D.a.any,D.a.arrayOf(D.a.any)]),values:D.a.arrayOf(D.a.any).isRequired}),Hd=D.a.arrayOf(Gd);function Kd(e,t){return(a,r)=>{if(Object(l.isArray)(r))r=Object(l.map)(r,e=>a.values[Object(l.toNumber)(e.key)]||e.key);else{var n=a.values[Object(l.toNumber)(r.key)];r=void 0!==n?n:r.key}a.multiple&&Object(l.includes)(r,Qd)&&(r=Bd(a.values)),a.multiple&&Object(l.includes)(r,Wd)&&(r=[]),e=Object(l.map)(e,e=>e.name===a.name?function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Ud(e,t,a[t])})}return e}({},a,{current:r}):e),t(e)}}function Yd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Object(l.isArray)(e))return[];var a=e;return Object(l.isArray)(t)&&t.length>0&&(a=a.filter(e=>Object(l.every)(t,t=>{var a=e[t.name],r=Object(l.isArray)(t.current)?t.current:[t.current];return Object(l.some)(r,e=>rt.a.isMoment(a)?a.isSame(e):e===a||String(a)===e)}))),a}function Jd(e){var t=e.filters,a=e.onChange;return 0===t.length?null:(a=Kd(t,a),n.a.createElement("div",{className:"filters-wrapper","data-test":"Filters"},n.a.createElement("div",{className:"container bg-white"},n.a.createElement("div",{className:"row"},Object(l.map)(t,e=>{var t=Object(l.map)(e.values,(t,a)=>n.a.createElement(Ln.a.Option,{key:a},rn(t,Object(l.get)(e,"column.type"))));return n.a.createElement("div",{key:e.name,className:"col-sm-6 p-l-0 filter-container","data-test":"FilterName-".concat(e.name)},n.a.createElement("label",null,e.friendlyName),0===t.length&&n.a.createElement(Ln.a,{className:"w-100",disabled:!0,value:"No values"}),t.length>0&&n.a.createElement(Ln.a,{labelInValue:!0,className:"w-100",mode:e.multiple?"multiple":"default",value:Object(l.isArray)(e.current)?Object(l.map)(e.current,t=>({key:"".concat(Object(l.indexOf)(e.values,t)),label:rn(t)})):{key:"".concat(Object(l.indexOf)(e.values,e.current)),label:rn(e.current)},allowClear:e.multiple,optionFilterProp:"children",showSearch:!0,maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more"),onChange:t=>a(e,t)},!e.multiple&&t,e.multiple&&[n.a.createElement(Ln.a.Option,{key:Wd,"data-test":"ClearOption"},n.a.createElement("i",{className:"fa fa-square-o m-r-5"}),"Clear"),n.a.createElement(Ln.a.Option,{key:Qd,"data-test":"SelectAllOption"},n.a.createElement("i",{className:"fa fa-check-square-o m-r-5"}),"Select All"),n.a.createElement(Ln.a.OptGroup,{key:"Values",title:"Values"},t)]))})))))}Jd.propTypes={filters:Hd.isRequired,onChange:D.a.func},Jd.defaultProps={onChange:()=>{}};var Xd=Jd;function $d(e){var t=Object(l.invoke)(e,"getStatus");return Object(r.useMemo)(()=>(function(e){return{status:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Object(l.invoke)(e,"getStatus")||null,columns:Object(l.invoke)(e,"getColumns")||[],rows:Object(l.invoke)(e,"getData")||[],filters:Object(l.invoke)(e,"getFilters")||[],updatedAt:Object(l.invoke)(e,"getUpdatedAt")||null,retrievedAt:Object(l.get)(e,"query_result.retrieved_at",null),log:Object(l.invoke)(e,"getLog")||[],error:Object(l.invoke)(e,"getError")||null,runtime:Object(l.invoke)(e,"getRuntime")||null,metadata:Object(l.get)(e,"query_result.data.metadata",{})}})(e,t),[e,t])}var Zd=a(671),ep=a.n(Zd),tp=a(672),ap=a.n(tp);function rp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function np(e){return function(t){return Object(Ra.updateVisualizationsSettings)(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){rp(e,t,a[t])})}return e}({HelpTriggerComponent:Pe,choroplethAvailableMaps:{countries:{name:"Countries",url:ep.a},subdiv_japan:{name:"Japan/Prefectures",url:ap.a}}},Object(l.pick)(w,["dateFormat","dateTimeFormat","integerFormat","floatFormat","booleanValues","tableCellMaxJSONSize","allowCustomJSVisualization","hidePlotlyModeBar"]))),n.a.createElement(e,t)}}var op=np(Ra.Renderer),ip=np(Ra.Editor);function lp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function sp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){cp(e,t,a[t])})}return e}function cp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function up(e,t){return 0===e.length||0===t.length?e:Object(l.map)(e,e=>{var a=Object(l.find)(t,t=>t.name===e.name);return a?sp({},e,{current:a.current}):e})}function dp(e){var t=$d(e.queryResult),a=lp(Object(r.useState)(t.filters),2),o=a[0],i=a[1],l=Object(r.useRef)();l.current=o,Object(r.useEffect)(()=>{i(up(t.filters,e.filters))},[t.filters,e.filters]),Object(r.useEffect)(()=>{i(up(l.current,e.filters))},[e.filters]);var s=Object(r.useMemo)(()=>({columns:t.columns,rows:Yd(t.rows,o)}),[t,o]),c=e.showFilters,u=e.visualization,d=sp({},u.options);return"TABLE"===u.type&&(d.paginationSize="widget"===e.context?"small":"default"),n.a.createElement(op,{key:"visualization".concat(u.id),type:u.type,options:d,data:s,visualizationName:u.name,addonBefore:c&&n.a.createElement(Xd,{filters:o,onChange:i})})}function pp(){return(pp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mp(e){var t=e.dialog,a=e.widget;return n.a.createElement(ke.a,pp({},t.props,{title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Vd,{visualization:a.visualization})," ",n.a.createElement("span",null,a.getQuery().name)),width:"95%",footer:n.a.createElement(B.a,{onClick:t.dismiss},"Close")}),n.a.createElement(dp,{visualization:a.visualization,queryResult:a.getQueryResult(),context:"widget"}))}dp.propTypes={visualization:Ra.VisualizationType.isRequired,queryResult:D.a.object.isRequired,filters:Hd,showFilters:D.a.bool,context:D.a.oneOf(["query","widget"]).isRequired},dp.defaultProps={filters:[],showFilters:!0},mp.propTypes={dialog:Te.isRequired,widget:D.a.object.isRequired};var fp=xe(mp),yp=a(178),hp=a.n(yp),bp=a(130),gp=a.n(bp),vp=a(72),Ep=a.n(vp);a(1427);function Op(e){return(Op="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wp(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jp(){return(jp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Sp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pp(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _p(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kp(e,t,a){return t&&_p(e.prototype,t),a&&_p(e,a),e}function Cp(e,t){return!t||"object"!==Op(t)&&"function"!=typeof t?Tp(e):t}function Np(e){return(Np=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tp(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qp(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xp(e,t)}function xp(e,t){return(xp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ap=Ln.a.Option,Dp={DashboardAddNew:"dashboard-add-new",DashboardMapToExisting:"dashboard-map-to-existing",WidgetLevel:"widget-level",StaticValue:"static-value"};function Ip(e){return Object(l.fromPairs)(Object(l.map)(e,e=>{var t=Object(l.extend)({},e);switch(e.type){case Dp.DashboardAddNew:case Dp.DashboardMapToExisting:t.type=La.DashboardLevel,t.value=null;break;case Dp.StaticValue:t.type=La.StaticValue,t.param=xa(e.param),t.param.setValue(t.value),t.value=t.param.value;break;case Dp.WidgetLevel:t.type=La.WidgetLevel,t.value=null}return delete t.param,[t.name,t]}))}function zp(e,t){var a=[];return Object(l.each)(e,e=>{e.type===La.DashboardLevel&&Object(l.each)(t,t=>{var r=t.options.parameterMappings;Object(l.each)(r,r=>{r.type===La.DashboardLevel&&r.mapTo===e.mapTo&&r.title!==e.title&&(r.title=e.title,a.push(t))})})}),a}var Mp=function(e){function t(){var e,a;Pp(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Rp(Tp(a=Cp(this,(e=Np(t)).call.apply(e,[this].concat(n)))),"formItemProps",{labelCol:{span:5},wrapperCol:{span:16},className:"form-item"}),Rp(Tp(a),"updateSourceType",e=>{var t=a.props.mapping.mapTo,r=a.props.existingParamNames;e!==Dp.DashboardMapToExisting||Object(l.includes)(r,t)||(t=r[0]),a.updateParamMapping({type:e,mapTo:t})}),Rp(Tp(a),"updateParamMapping",e=>{var t=a.props,r=t.onChange,n=t.mapping,o=Object(l.extend)({},n,e);o.value!==n.value&&(o.param=xa(o.param),o.param.setValue(o.value)),Object(l.has)(e,"type")&&(e.type===Dp.StaticValue?o.value=o.param.value:o.value=null),r(o)}),a}return qp(t,n.a.Component),kp(t,[{key:"renderMappingTypeSelector",value:function(){var e=Object(l.isEmpty)(this.props.existingParamNames);return n.a.createElement(Ep.a.Group,{value:this.props.mapping.type,onChange:e=>this.updateSourceType(e.target.value)},n.a.createElement(Ep.a,{className:"radio",value:Dp.DashboardAddNew,"data-test":"NewDashboardParameterOption"},"New dashboard parameter"),n.a.createElement(Ep.a,{className:"radio",value:Dp.DashboardMapToExisting,disabled:e},"Existing dashboard parameter"," ",e?n.a.createElement(X.a,{title:"There are no dashboard parameters corresponding to this data type"},n.a.createElement(W.a,{type:"question-circle",theme:"filled"})):null),n.a.createElement(Ep.a,{className:"radio",value:Dp.WidgetLevel,"data-test":"WidgetParameterOption"},"Widget parameter"),n.a.createElement(Ep.a,{className:"radio",value:Dp.StaticValue,"data-test":"StaticValueOption"},"Static value"))}},{key:"renderDashboardAddNew",value:function(){var e=this.props.mapping.mapTo;return n.a.createElement(Y.a,{value:e,onChange:e=>this.updateParamMapping({mapTo:e.target.value})})}},{key:"renderDashboardMapToExisting",value:function(){var e=this.props,t=e.mapping,a=e.existingParamNames;return n.a.createElement(Ln.a,{value:t.mapTo,onChange:e=>this.updateParamMapping({mapTo:e}),dropdownMatchSelectWidth:!1},Object(l.map)(a,e=>n.a.createElement(Ap,{value:e,key:e},e)))}},{key:"renderStaticValue",value:function(){var e=this.props.mapping;return n.a.createElement(bd,{type:e.param.type,value:e.param.normalizedValue,enumOptions:e.param.enumOptions,queryId:e.param.queryId,parameter:e.param,onSelect:e=>this.updateParamMapping({value:e})})}},{key:"renderInputBlock",value:function(){switch(this.props.mapping.type){case Dp.DashboardAddNew:return["Key","Enter a new parameter keyword",this.renderDashboardAddNew()];case Dp.DashboardMapToExisting:return["Key","Select from a list of existing parameters",this.renderDashboardMapToExisting()];case Dp.StaticValue:return["Value",null,this.renderStaticValue()];default:return[]}}},{key:"render",value:function(){var e=this.props.inputError,t=Sp(this.renderInputBlock(),3),a=t[0],r=t[1],o=t[2];return n.a.createElement(kl.a,{layout:"horizontal"},n.a.createElement(kl.a.Item,jp({label:"Source"},this.formItemProps),this.renderMappingTypeSelector()),n.a.createElement(kl.a.Item,jp({style:{height:60,visibility:o?"visible":"hidden"},label:a},this.formItemProps,{validateStatus:e?"error":"",help:e||r}),o))}}]),t}();Rp(Mp,"propTypes",{mapping:D.a.object,existingParamNames:D.a.arrayOf(D.a.string),onChange:D.a.func,inputError:D.a.string}),Rp(Mp,"defaultProps",{mapping:{},existingParamNames:[],onChange:()=>{},inputError:null});var Vp=function(e){function t(e){var a;return Pp(this,t),Rp(Tp(a=Cp(this,Np(t).call(this,e))),"onVisibleChange",e=>{e?a.show():a.hide()}),Rp(Tp(a),"onChange",e=>{var t=null;e.type===Dp.DashboardAddNew&&(Object(l.isEmpty)(e.mapTo)?t="Keyword must have a value":Object(l.includes)(a.props.existingParamNames,e.mapTo)&&(t="A parameter with this name already exists")),a.setState({mapping:e,inputError:t})}),Rp(Tp(a),"save",()=>{a.props.onChange(a.props.mapping,a.state.mapping),a.hide()}),Rp(Tp(a),"show",()=>{a.setState({visible:!0,mapping:Object(l.clone)(a.props.mapping)})}),Rp(Tp(a),"hide",()=>{a.setState({visible:!1})}),a.state={visible:!1,mapping:Object(l.clone)(a.props.mapping),inputError:null},a}return qp(t,n.a.Component),kp(t,[{key:"renderContent",value:function(){var e=this.state,t=e.mapping,a=e.inputError;return n.a.createElement("div",{className:"parameter-mapping-editor","data-test":"EditParamMappingPopover"},n.a.createElement("header",null,"Edit Source and Value ",n.a.createElement(Pe,{type:"VALUE_SOURCE_OPTIONS"})),n.a.createElement(Mp,{mapping:t,existingParamNames:this.props.existingParamNames,onChange:this.onChange,inputError:a}),n.a.createElement("footer",null,n.a.createElement(B.a,{onClick:this.hide},"Cancel"),n.a.createElement(B.a,{onClick:this.save,disabled:!!a,type:"primary"},"OK")))}},{key:"render",value:function(){var e=this.state,t=e.visible,a=e.mapping;return n.a.createElement(hp.a,{placement:"left",trigger:"click",content:this.renderContent(),visible:t,onVisibleChange:this.onVisibleChange},n.a.createElement(B.a,{size:"small",type:"dashed","data-test":"EditParamMappingButon-".concat(a.param.name)},n.a.createElement(W.a,{type:"edit"})))}}]),t}();Rp(Vp,"propTypes",{mapping:D.a.object.isRequired,existingParamNames:D.a.arrayOf(D.a.string).isRequired,onChange:D.a.func.isRequired});var Fp=function(e){function t(){var e,a;Pp(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Rp(Tp(a=Cp(this,(e=Np(t)).call.apply(e,[this].concat(n)))),"state",{showPopup:!1,title:""}),Rp(Tp(a),"onPopupVisibleChange",e=>{a.setState({showPopup:e,title:e?a.getMappingTitle():""})}),Rp(Tp(a),"onEditingTitleChange",e=>{a.setState({title:e.target.value})}),Rp(Tp(a),"save",()=>{var e=Object(l.extend)({},a.props.mapping,{title:a.state.title});a.props.onChange(e),a.hide()}),Rp(Tp(a),"hide",()=>{a.setState({showPopup:!1})}),a}return qp(t,n.a.Component),kp(t,[{key:"getMappingTitle",value:function(){var e=this.props.mapping;if(Object(l.isString)(e.title)&&""!==e.title)return e.title;if(e.type===Dp.DashboardMapToExisting){var t=Object(l.find)(this.props.existingParams,{name:e.mapTo});t&&(e=t)}return e.title||e.param.title}},{key:"renderPopover",value:function(){var e=this.props.mapping.param.title;return n.a.createElement("div",{className:"parameter-mapping-title-editor"},n.a.createElement(Y.a,{size:"small",value:this.state.title,placeholder:e,onChange:this.onEditingTitleChange,onPressEnter:this.save,maxLength:100,autoFocus:!0}),n.a.createElement(B.a,{size:"small",type:"dashed",onClick:this.hide},n.a.createElement(W.a,{type:"close"})),n.a.createElement(B.a,{size:"small",type:"dashed",onClick:this.save},n.a.createElement(W.a,{type:"check"})))}},{key:"renderEditButton",value:function(){return this.props.mapping.type===Dp.StaticValue?n.a.createElement(X.a,{placement:"right",title:"Titles for static values don't appear in widgets"},n.a.createElement("i",{className:"fa fa-eye-slash"})):n.a.createElement(hp.a,{placement:"right",trigger:"click",content:this.renderPopover(),visible:this.state.showPopup,onVisibleChange:this.onPopupVisibleChange},n.a.createElement(B.a,{size:"small",type:"dashed"},n.a.createElement(W.a,{type:"edit"})))}},{key:"render",value:function(){var e=this.props.mapping.type===Dp.StaticValue;return n.a.createElement("div",{className:Z()("parameter-mapping-title",{disabled:e})},n.a.createElement("span",{className:"text"},this.getMappingTitle()),this.renderEditButton())}}]),t}();Rp(Fp,"propTypes",{existingParams:D.a.arrayOf(D.a.object),mapping:D.a.object.isRequired,onChange:D.a.func.isRequired}),Rp(Fp,"defaultProps",{existingParams:[]});var Lp=function(e){function t(){return Pp(this,t),Cp(this,Np(t).apply(this,arguments))}return qp(t,n.a.Component),kp(t,[{key:"updateParamMapping",value:function(e,t){var a=wp(this.props.mappings),r=Object(l.findIndex)(a,e);r>=0?a[r]=t:a.push(t),this.props.onChange(a)}},{key:"render",value:function(){var e=this.props.existingParams,t=this.props.mappings.map(e=>({mapping:e}));return n.a.createElement("div",{className:"parameters-mapping-list"},n.a.createElement(jr.a,{dataSource:t,size:"middle",pagination:!1,rowKey:(e,t)=>"row".concat(t)},n.a.createElement(jr.a.Column,{title:"Title",dataIndex:"mapping",key:"title",render:t=>n.a.createElement(Fp,{existingParams:e,mapping:t,onChange:e=>this.updateParamMapping(t,e)})}),n.a.createElement(jr.a.Column,{title:"Keyword",dataIndex:"mapping",key:"keyword",className:"keyword",render:e=>n.a.createElement("code",null,"{{ ".concat(e.name," }}"))}),n.a.createElement(jr.a.Column,{title:"Default Value",dataIndex:"mapping",key:"value",render:e=>this.constructor.getDefaultValue(e,this.props.existingParams)}),n.a.createElement(jr.a.Column,{title:"Value Source",dataIndex:"mapping",key:"source",render:t=>{var a=e.filter(e=>{return e.type===t.param.type}).map(e=>{return e.name});return n.a.createElement(r.Fragment,null,this.constructor.getSourceTypeLabel(t)," ",n.a.createElement(Vp,{mapping:t,existingParamNames:a,onChange:(e,t)=>this.updateParamMapping(e,t)}))}})))}}],[{key:"getStringValue",value:function(e){return e?e instanceof Object&&"start"in e&&"end"in e?"".concat(e.start," ~ ").concat(e.end):"object"===Op(e)?Object(l.map)(e,e=>this.getStringValue(e)).join(", "):e.toString():""}},{key:"getDefaultValue",value:function(e,t){var a=e.type,r=e.mapTo,n=e.name,o=e.param;if(a===Dp.DashboardMapToExisting&&r!==n){var i=Object(l.find)(t,{name:r});i&&(o=i)}else a===Dp.StaticValue&&(o=xa(o).setValue(e.value));var s=ot.getExecutionValue(o);return o.hasDynamicValue&&(s=o.normalizedValue.name),this.getStringValue(s)}},{key:"getSourceTypeLabel",value:function(e){var t=e.type,a=e.mapTo;switch(t){case Dp.DashboardAddNew:case Dp.DashboardMapToExisting:return n.a.createElement(r.Fragment,null,"Dashboard ",n.a.createElement(gp.a,{className:"tag"},a));case Dp.WidgetLevel:return"Widget parameter";case Dp.StaticValue:return"Static value";default:return""}}}]),t}();function Up(e){return(Up="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bp(){return(Bp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qp(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Wp(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gp(e){return(Gp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hp(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kp(e,t){return(Kp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Jp(e,t){return Object(l.map)(Object(l.sortBy)(e,e=>e.name),e=>{var a;switch(e.type){case Dp.StaticValue:return[e.name,e.value];case Dp.WidgetLevel:return[e.name,e.param.value];case Dp.DashboardAddNew:case Dp.DashboardMapToExisting:return a=Object(l.find)(t,t=>t.name===e.mapTo),[e.name,a?a.value:null]}})}Rp(Lp,"propTypes",{mappings:D.a.arrayOf(D.a.object),existingParams:D.a.arrayOf(D.a.object),onChange:D.a.func}),Rp(Lp,"defaultProps",{mappings:[],existingParams:[],onChange:()=>{}});var Xp=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=!(n=Gp(t).call(this,e))||"object"!==Up(n)&&"function"!=typeof n?Hp(r):n,Yp(Hp(a),"originalParamValuesSnapshot",null);var o=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object(l.map)(e,e=>{var r=Object(l.extend)({},e),n=Object(l.includes)(a,e.mapTo);switch(r.param=Object(l.find)(t,t=>t.name===e.name),e.type){case La.DashboardLevel:r.type=n?Dp.DashboardMapToExisting:Dp.DashboardAddNew,r.value=null;break;case La.StaticValue:r.type=Dp.StaticValue,r.param=xa(r.param),r.param.setValue(r.value);break;case La.WidgetLevel:r.type=Dp.WidgetLevel,r.value=null}return r})}(e.widget.options.parameterMappings,e.widget.query.getParametersDefs(),Object(l.map)(a.props.dashboard.getParametersDefs(),e=>e.name));return a.originalParamValuesSnapshot=Jp(o,a.props.dashboard.getParametersDefs()),a.state={saveInProgress:!1,parameterMappings:o},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kp(e,t)}(t,n.a.Component),a=t,(r=[{key:"saveWidget",value:function(){var e=this.props.widget;this.setState({saveInProgress:!0});var t=Ip(this.state.parameterMappings);e.options.parameterMappings=t;var a=!Object(l.isMatch)(this.originalParamValuesSnapshot,Jp(this.state.parameterMappings,this.props.dashboard.getParametersDefs())),r=[e].concat(Qp(zp(e.options.parameterMappings,this.props.dashboard.widgets)));Promise.all(Object(l.map)(r,e=>e.save())).then(()=>{this.props.dialog.close(a)}).catch(()=>{vl.error("Widget cannot be updated")}).finally(()=>{this.setState({saveInProgress:!1})})}},{key:"updateParamMappings",value:function(e){this.setState({parameterMappings:e})}},{key:"render",value:function(){var e=this.props.dialog;return n.a.createElement(ke.a,Bp({},e.props,{title:"Parameters",onOk:()=>this.saveWidget(),okButtonProps:{loading:this.state.saveInProgress},width:700}),this.state.parameterMappings.length>0&&n.a.createElement(Lp,{mappings:this.state.parameterMappings,existingParams:this.props.dashboard.getParametersDefs(),onChange:e=>this.updateParamMappings(e)}))}}])&&Wp(a.prototype,r),o&&Wp(a,o),t}();Yp(Xp,"propTypes",{dashboard:D.a.object.isRequired,widget:D.a.object.isRequired,dialog:Te.isRequired});var $p=xe(Xp);a(1428);function Zp(e){return(Zp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function em(){return(em=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tm(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function am(e){return(am=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rm(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nm(e,t){return(nm=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function om(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function im(e){var t=e.extraOptions,a=e.showDeleteOption,r=e.onDelete,o=n.a.createElement(H.a,{"data-test":"WidgetDropdownButtonMenu"},t,a&&t&&n.a.createElement(H.a.Divider,null),a&&n.a.createElement(H.a.Item,{onClick:r},"Remove from Dashboard"));return n.a.createElement("div",{className:"widget-menu-regular"},n.a.createElement(L.a,{overlay:o,placement:"bottomRight",trigger:["click"]},n.a.createElement("a",{className:"action p-l-15 p-r-15","data-test":"WidgetDropdownButton"},n.a.createElement("i",{className:"zmdi zmdi-more-vert"}))))}function lm(e){var t=e.onClick;return n.a.createElement("div",{className:"widget-menu-remove"},n.a.createElement("a",{className:"action",title:"Remove From Dashboard",onClick:t,"data-test":"WidgetDeleteButton"},n.a.createElement("i",{className:"zmdi zmdi-close"})))}im.propTypes={extraOptions:D.a.node,showDeleteOption:D.a.bool,onDelete:D.a.func},im.defaultProps={extraOptions:null,showDeleteOption:!1,onDelete:()=>{}},lm.propTypes={onClick:D.a.func},lm.defaultProps={onClick:()=>{}};var sm=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=am(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Zp(n)&&"function"!=typeof n?rm(r):n,om(rm(a),"deleteWidget",()=>{var e=a.props,t=e.widget,r=e.onDelete;ke.a.confirm({title:"Delete Widget",content:"Are you sure you want to remove this widget from the dashboard?",okText:"Delete",okType:"danger",onOk:()=>t.delete().then(r),maskClosable:!0,autoFocusButton:null})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nm(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ke("view","widget",this.props.widget.id)}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.children,r=e.header,o=e.footer,i=e.canEdit,s=e.isPublic,c=e.menuOptions,u=e.tileProps,d=!s&&(i||!Object(l.isEmpty)(c));return n.a.createElement("div",{className:"widget-wrapper"},n.a.createElement("div",em({className:Z()("tile body-container",t)},u),n.a.createElement("div",{className:"widget-actions"},d&&n.a.createElement(im,{extraOptions:c,showDeleteOption:i,onDelete:this.deleteWidget}),i&&n.a.createElement(lm,{onClick:this.deleteWidget})),n.a.createElement("div",{className:"body-row widget-header"},r),a,o&&n.a.createElement("div",{className:"body-row tile__bottom-control"},o)))}}])&&tm(a.prototype,r),o&&tm(a,o),t}();om(sm,"propTypes",{widget:D.a.object.isRequired,className:D.a.string,children:D.a.node,header:D.a.node,footer:D.a.node,canEdit:D.a.bool,isPublic:D.a.bool,refreshStartedAt:Br,menuOptions:D.a.node,tileProps:D.a.object,onDelete:D.a.func}),om(sm,"defaultProps",{className:"",children:null,header:null,footer:null,canEdit:!1,isPublic:!1,refreshStartedAt:null,menuOptions:null,tileProps:{},onDelete:()=>{}});var cm=sm;function um(e){return(um="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dm(){return(dm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function pm(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mm(e){return(mm=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fm(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ym(e,t){return(ym=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function bm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function gm(e){var t=e.widget,a=e.canEditDashboard,r=e.onParametersEdit,o=O.hasPermission("view_query"),i=a&&!Object(l.isEmpty)(Object(l.invoke)(t,"query.getParametersDefs")),s=t.getQueryResult(),c=!s||!s.isEmpty||s.isEmpty(),u=e=>s.getLink(t.getQuery().id,e),d=e=>s.getName(t.getQuery().name,e);return Object(l.compact)([n.a.createElement(H.a.Item,{key:"download_csv",disabled:c},c?"Download as CSV File":n.a.createElement("a",{href:u("csv"),download:d("csv"),target:"_self"},"Download as CSV File")),n.a.createElement(H.a.Item,{key:"download_tsv",disabled:c},c?"Download as TSV File":n.a.createElement("a",{href:u("tsv"),download:d("tsv"),target:"_self"},"Download as TSV File")),n.a.createElement(H.a.Item,{key:"download_excel",disabled:c},c?"Download as Excel File":n.a.createElement("a",{href:u("xlsx"),download:d("xlsx"),target:"_self"},"Download as Excel File")),(o||i)&&n.a.createElement(H.a.Divider,{key:"divider"}),o&&n.a.createElement(H.a.Item,{key:"view_query"},n.a.createElement("a",{href:t.getQuery().getUrl(!0,t.visualization.id)},"View Query")),i&&n.a.createElement(H.a.Item,{key:"edit_parameters",onClick:r},"Edit Parameters")])}function vm(e){var t=e.refreshStartedAt;return n.a.createElement("div",{className:"refresh-indicator"},n.a.createElement("div",{className:"refresh-icon"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin"})),n.a.createElement(zd,{from:t}))}function Em(e){var t=e.widget,a=e.refreshStartedAt,r=e.parameters,o=e.onParametersUpdate,i=O.hasPermission("view_query");return n.a.createElement(n.a.Fragment,null,n.a.createElement(vm,{refreshStartedAt:a}),n.a.createElement("div",{className:"t-header widget clearfix"},n.a.createElement("div",{className:"th-title"},n.a.createElement("p",null,n.a.createElement(Ld,{query:t.getQuery(),visualization:t.visualization,readOnly:!i})),!Object(l.isEmpty)(t.getQuery().description)&&n.a.createElement(Gc.a,{className:"text-muted markdown query--description"},Qc.markdown.toHTML(t.getQuery().description||"")))),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Dd,{parameters:r,onValuesChange:o})))}function Om(e){var t=e.widget,a=e.isPublic,o=e.onRefresh,i=e.onExpand,s=t.getQueryResult(),c=Object(l.invoke)(s,"getUpdatedAt"),u=bm(Object(r.useState)(),2),d=u[0],p=u[1],m=e=>{d||(p(e),o().finally(()=>p(null)))};return s?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",null,!a&&!!s&&n.a.createElement("a",{className:"refresh-button hidden-print btn btn-sm btn-default btn-transparent",onClick:()=>m(1),"data-test":"RefreshButton"},n.a.createElement("i",{className:Z()("zmdi zmdi-refresh",{"zmdi-hc-spin":1===d})})," ",n.a.createElement(Wr,{date:c})),n.a.createElement("span",{className:"visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore"})," ",Kr(c)),a&&n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore"})," ",n.a.createElement(Wr,{date:c}))),n.a.createElement("span",null,!a&&n.a.createElement("a",{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:()=>m(2)},n.a.createElement("i",{className:Z()("zmdi zmdi-refresh",{"zmdi-hc-spin":2===d})})),n.a.createElement("a",{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:i},n.a.createElement("i",{className:"zmdi zmdi-fullscreen"})))):null}vm.propTypes={refreshStartedAt:Br},vm.defaultProps={refreshStartedAt:null},Em.propTypes={widget:D.a.object.isRequired,refreshStartedAt:Br,parameters:D.a.arrayOf(D.a.object),onParametersUpdate:D.a.func},Em.defaultProps={refreshStartedAt:null,onParametersUpdate:()=>{},parameters:[]},Om.propTypes={widget:D.a.object.isRequired,isPublic:D.a.bool,onRefresh:D.a.func.isRequired,onExpand:D.a.func.isRequired},Om.defaultProps={isPublic:!1};var wm=function(e){function t(e){var a,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=mm(t).call(this,e),a=!n||"object"!==um(n)&&"function"!=typeof n?fm(r):n,hm(fm(a),"expandWidget",()=>{fp.showModal({widget:a.props.widget})}),hm(fm(a),"editParameterMappings",()=>{var e=a.props,t=e.widget,r=e.dashboard,n=e.onRefresh,o=e.onParameterMappingsChange;$p.showModal({dashboard:r,widget:t}).onClose(e=>{e&&n(),o(),a.setState({localParameters:t.getLocalParameters()})})}),a.state={localParameters:e.widget.getLocalParameters()},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ym(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){var e=this.props,t=e.widget,a=e.onLoad;Ke("view","query",t.visualization.query.id,{dashboard:!0}),Ke("view","visualization",t.visualization.id,{dashboard:!0}),a()}},{key:"renderVisualization",value:function(){var e=this.props,t=e.widget,a=e.filters,r=t.getQueryResult();switch(r&&r.getStatus()){case"failed":return n.a.createElement("div",{className:"body-row-auto scrollbox"},r.getError()&&n.a.createElement("div",{className:"alert alert-danger m-5"},"Error running query: ",n.a.createElement("strong",null,r.getError())));case"done":return n.a.createElement("div",{className:"body-row-auto scrollbox"},n.a.createElement(dp,{visualization:t.visualization,queryResult:r,filters:a,context:"widget"}));default:return n.a.createElement("div",{className:"body-row-auto spinner-container"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x"})))}}},{key:"render",value:function(){var e=this.props,t=e.widget,a=e.isLoading,r=e.isPublic,o=e.canEdit,i=e.onRefresh,l=this.state.localParameters,s=t.getQueryResult(),c=a&&!(!s||!s.getStatus());return n.a.createElement(cm,dm({},this.props,{className:"widget-visualization",menuOptions:gm({widget:t,canEditDashboard:o,onParametersEdit:this.editParameterMappings}),header:n.a.createElement(Em,{widget:t,refreshStartedAt:c?t.refreshStartedAt:null,parameters:l,onParametersUpdate:i}),footer:n.a.createElement(Om,{widget:t,isPublic:r,onRefresh:i,onExpand:this.expandWidget}),tileProps:{"data-refreshing":c}}),this.renderVisualization())}}])&&pm(a.prototype,r),o&&pm(a,o),t}();hm(wm,"propTypes",{widget:D.a.object.isRequired,dashboard:D.a.object.isRequired,filters:Hd,isPublic:D.a.bool,isLoading:D.a.bool,canEdit:D.a.bool,onLoad:D.a.func,onRefresh:D.a.func,onDelete:D.a.func,onParameterMappingsChange:D.a.func}),hm(wm,"defaultProps",{filters:[],isPublic:!1,isLoading:!1,canEdit:!1,onLoad:()=>{},onRefresh:()=>{},onDelete:()=>{},onParameterMappingsChange:()=>{}});var jm=wm;a(1429);function Sm(){return(Sm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Pm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _m(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function km(e){var t=e.dialog,a=e.isNew,o=_m(e,["dialog","isNew"]),i=Pm(Object(r.useState)(Object(l.toString)(o.text)),2),s=i[0],c=i[1],u=Pm(Object(r.useState)(null),2),d=u[0],p=u[1];Object(r.useEffect)(()=>{c(o.text),p(Qc.markdown.toHTML(o.text))},[o.text]);var m=Pm(Object(Ql.a)(()=>{p(Qc.markdown.toHTML(s))},200),1)[0],f=Object(r.useCallback)(e=>{c(e.target.value),m()},[m]),y=Object(r.useCallback)(()=>{t.close(s).catch(()=>{vl.error(a?"Widget could not be added":"Widget could not be saved")})},[t,a,s]);return n.a.createElement(ke.a,Sm({},t.props,{title:a?"Add Textbox":"Edit Textbox",onOk:y,okText:a?"Add to Dashboard":"Save",width:500,wrapProps:{"data-test":"TextboxDialog"}}),n.a.createElement("div",{className:"textbox-dialog"},n.a.createElement(Y.a.TextArea,{className:"resize-vertical",rows:"5",value:s,onChange:f,autoFocus:!0,placeholder:"This is where you write some text"}),n.a.createElement("small",null,"Supports basic"," ",n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.markdownguide.org/cheat-sheet/#basic-syntax"},n.a.createElement(X.a,{title:"Markdown guide opens in new window"},"Markdown")),"."),s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Tl.a,{dashed:!0}),n.a.createElement("strong",{className:"preview-title"},"Preview:"),n.a.createElement(Gc.a,{className:"preview markdown"},d))))}km.propTypes={dialog:Te.isRequired,isNew:D.a.bool,text:D.a.string},km.defaultProps={isNew:!1,text:""};var Cm=xe(km);function Nm(){return(Nm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Tm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function qm(e){var t=e.widget,a=e.canEdit,o=Tm(Object(r.useState)(t.text),2),i=o[0],l=o[1],s=[n.a.createElement(H.a.Item,{key:"edit",onClick:()=>{Cm.showModal({text:t.text}).onClose(e=>(t.text=e,l(e),t.save()))}},"Edit")];return t.width?n.a.createElement(cm,Nm({},e,{menuOptions:a?s:null,className:"widget-text"}),n.a.createElement(Gc.a,{className:"body-row-auto scrollbox t-body p-15 markdown"},Qc.markdown.toHTML(i||""))):null}qm.propTypes={widget:D.a.object.isRequired,canEdit:D.a.bool},qm.defaultProps={canEdit:!1};var xm=qm;function Rm(){return(Rm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Am=function(e){return n.a.createElement(cm,Rm({},e,{className:"d-flex justify-content-center align-items-center widget-restricted"}),n.a.createElement("div",{className:"t-body scrollbox"},n.a.createElement("div",{className:"text-center"},n.a.createElement("h1",null,n.a.createElement("span",{className:"zmdi zmdi-lock"})),n.a.createElement("p",{className:"text-muted"},"This widget requires access to a data source you don't have access to."))))};function Dm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Im(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Mm='[data-widgetid="{0}"]',Vm=[".widget-header",".visualization-renderer",".scrollbox .alert",".spinner-container",".tile__bottom-control"].join(","),Fm=200,Lm=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zm(this,"widgets",{}),zm(this,"interval",null),zm(this,"onHeightChange",null),zm(this,"add",e=>{this.isEmpty()&&this.start();var t=Mm.replace("{0}",e);this.widgets[e]=[function(){var e=document.querySelector(t);if(e){var a=e.querySelectorAll(Vm);return Object(l.reduce)(a,(e,t)=>{return e+(t?t.getBoundingClientRect().height:0)},0)}}]}),zm(this,"remove",e=>{this.exists(e)&&(this.widgets[e.toString()]=!1,this.isEmpty()&&this.stop())}),zm(this,"exists",e=>!!this.widgets[e.toString()]),zm(this,"isEmpty",()=>!Object(l.some)(this.widgets)),zm(this,"checkHeightChanges",()=>{Object.keys(this.widgets).filter(this.exists).forEach(e=>{var t=Dm(this.widgets[e],2),a=t[0],r=t[1],n=a();n&&n!==r&&(this.widgets[e][1]=n,this.onHeightChange(e,n))})}),zm(this,"start",()=>{this.stop(),this.interval=setInterval(this.checkHeightChanges,Fm)}),zm(this,"stop",()=>{clearInterval(this.interval)}),zm(this,"resume",()=>{this.isEmpty()||this.start()}),zm(this,"destroy",()=>{this.stop(),this.widgets=null}),this.onHeightChange=t}var t,a,r;return t=e,(a=[{key:"update",value:function(e){var t=e.filter(e=>e.options.position.autoHeight).map(e=>e.id.toString());t.filter(e=>!Object(l.includes)(Object.keys(this.widgets),e)).forEach(this.add),Object.keys(this.widgets).filter(e=>!Object(l.includes)(t,e)).forEach(this.remove)}}])&&Im(t.prototype,a),r&&Im(t,r),e}();a(1430),a(1431);function Um(e){return(Um="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bm(e){return(Bm=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qm(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wm(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gm(e,t,a){return t&&Wm(e.prototype,t),a&&Wm(e,a),e}function Hm(e,t){return(Hm=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Km(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Ym=Object(Bc.WidthProvider)(Bc.Responsive),Jm=D.a.shape({id:D.a.number.isRequired,options:D.a.shape({position:D.a.shape({col:D.a.number.isRequired,row:D.a.number.isRequired,sizeY:D.a.number.isRequired,minSizeY:D.a.number.isRequired,maxSizeY:D.a.number.isRequired,sizeX:D.a.number.isRequired,minSizeX:D.a.number.isRequired,maxSizeX:D.a.number.isRequired}).isRequired}).isRequired}),Xm="single-column",$m="multi-column",Zm=n.a.memo(function(e){var t=e.widget,a=e.dashboard,r=e.onLoadWidget,o=e.onRefreshWidget,i=e.onRemoveWidget,l=e.onParameterMappingsChange,s=e.canEdit,c=e.isPublic,u=e.isLoading,d=e.filters,p=t.type,m=()=>i(t.id);return p===Ia?n.a.createElement(jm,{widget:t,dashboard:a,filters:d,canEdit:s,isPublic:c,isLoading:u,onLoad:()=>r(t),onRefresh:()=>o(t),onDelete:m,onParameterMappingsChange:l}):p===Da?n.a.createElement(xm,{widget:t,canEdit:s,isPublic:c,onDelete:m}):n.a.createElement(Am,{widget:t})},(e,t)=>e.widget===t.widget&&e.canEdit===t.canEdit&&e.isPublic===t.isPublic&&e.isLoading===t.isLoading&&e.filters===t.filters),ef=function(e){function t(e){var a,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=Bm(t).call(this,e),a=!n||"object"!==Um(n)&&"function"!=typeof n?Qm(r):n,Km(Qm(a),"mode",null),Km(Qm(a),"autoHeightCtrl",null),Km(Qm(a),"onLayoutChange",(e,t)=>{if(t[$m]&&a.setState({layouts:t}),a.mode=document.body.offsetWidth<=tt.mobileBreakPoint?Xm:$m,a.mode!==Xm){var r=Object(l.chain)(t[$m]).keyBy("i").mapValues(a.normalizeTo).value();a.props.onLayoutChange(r)}}),Km(Qm(a),"onBreakpointChange",e=>{a.mode=e,a.props.onBreakpointChange(e===Xm)}),Km(Qm(a),"onWidgetHeightUpdated",(e,t)=>{a.setState(a=>{var r=a.layouts,n=Object(l.cloneDeep)(r[$m]),o=Object(l.find)(n,{i:e.toString()});return o&&(o.h=Math.ceil((t+tt.margins)/tt.rowHeight)),{layouts:Km({},$m,n)}})}),Km(Qm(a),"onWidgetResize",(e,t,r)=>{t.h!==r.h&&a.autoHeightCtrl.remove(Number(r.i)),a.autoHeightCtrl.resume()}),Km(Qm(a),"normalizeTo",e=>({col:e.x,row:e.y,sizeX:e.w,sizeY:e.h,autoHeight:a.autoHeightCtrl.exists(e.i)})),a.state={layouts:{},disableAnimations:!0},a.autoHeightCtrl=new Lm(a.onWidgetHeightUpdated),a.autoHeightCtrl.update(a.props.widgets),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hm(e,t)}(t,n.a.Component),Gm(t,null,[{key:"normalizeFrom",value:function(e){var t=e.id,a=e.options.position;return{i:t.toString(),x:a.col,y:a.row,w:a.sizeX,h:a.sizeY,minW:a.minSizeX,maxW:a.maxSizeX,minH:a.minSizeY,maxH:a.maxSizeY}}}]),Gm(t,[{key:"componentDidMount",value:function(){this.onBreakpointChange(document.body.offsetWidth<=tt.mobileBreakPoint?Xm:$m),setTimeout(()=>{this.setState({disableAnimations:!1})},50)}},{key:"componentDidUpdate",value:function(){this.autoHeightCtrl.update(this.props.widgets)}},{key:"componentWillUnmount",value:function(){this.autoHeightCtrl.destroy()}},{key:"render",value:function(){var e,a,r=Z()("dashboard-wrapper",this.props.isEditing?"editing-mode":"preview-mode"),o=this.props,i=o.onLoadWidget,l=o.onRefreshWidget,s=o.onRemoveWidget,c=o.onParameterMappingsChange,u=o.filters,d=o.dashboard,p=o.isPublic,m=o.widgets;return n.a.createElement("div",{className:r},n.a.createElement(Ym,{className:Z()("layout",{"disable-animations":this.state.disableAnimations}),cols:(e={},Km(e,$m,tt.columns),Km(e,Xm,1),e),rowHeight:tt.rowHeight-tt.margins,margin:[tt.margins,tt.margins],isDraggable:this.props.isEditing,isResizable:this.props.isEditing,onResizeStart:this.autoHeightCtrl.stop,onResizeStop:this.onWidgetResize,layouts:this.state.layouts,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,breakpoints:(a={},Km(a,$m,tt.mobileBreakPoint),Km(a,Xm,0),a)},m.map(e=>n.a.createElement("div",{key:e.id,"data-grid":t.normalizeFrom(e),"data-widgetid":e.id,"data-test":"WidgetId".concat(e.id),className:Z()("dashboard-widget-wrapper",{"widget-auto-height-enabled":this.autoHeightCtrl.exists(e.id)})},n.a.createElement(Zm,{dashboard:d,widget:e,filters:u,isPublic:p,isLoading:e.loading,canEdit:d.canEdit(),onLoadWidget:i,onRefreshWidget:l,onRemoveWidget:s,onParameterMappingsChange:c})))))}}]),t}();Km(ef,"propTypes",{isEditing:D.a.bool.isRequired,isPublic:D.a.bool,dashboard:D.a.object.isRequired,widgets:D.a.arrayOf(Jm).isRequired,filters:Hd,onBreakpointChange:D.a.func,onLoadWidget:D.a.func,onRefreshWidget:D.a.func,onRemoveWidget:D.a.func,onLayoutChange:D.a.func,onParameterMappingsChange:D.a.func}),Km(ef,"defaultProps",{isPublic:!1,filters:[],onLoadWidget:()=>{},onRefreshWidget:()=>{},onRemoveWidget:()=>{},onLayoutChange:()=>{},onBreakpointChange:()=>{},onParameterMappingsChange:()=>{}});var tf=ef;a(1432);function af(){return(af=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){nf(e,t,a[t])})}return e}function nf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function of(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function lf(e){var t=e.query,a=e.visualization,o=e.onChange,i=Object(r.useMemo)(()=>t?Object(l.groupBy)(t.visualizations,"type"):{},[t]),s=Object(r.useCallback)(e=>{var a=t?Object(l.find)(t.visualizations,{id:e}):null;o(a||null)},[t,o]);return t?n.a.createElement("div",null,n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"choose-visualization"},"Choose Visualization"),n.a.createElement(Ln.a,{id:"choose-visualization",className:"w-100",value:a?a.id:void 0,onChange:s},Object(l.map)(i,(e,t)=>n.a.createElement(Ln.a.OptGroup,{key:t,label:t},Object(l.map)(e,e=>n.a.createElement(Ln.a.Option,{key:"".concat(e.id),value:e.id},e.name))))))):null}function sf(e){var t=e.dialog,a=e.dashboard,o=of(Object(r.useState)(null),2),i=o[0],s=o[1],c=of(Object(r.useState)(null),2),u=c[0],d=c[1],p=of(Object(r.useState)([]),2),m=p[0],f=p[1],y=Object(r.useCallback)(e=>{s(null),d(null),f([]),e&&Qt.get({id:e}).then(e=>{if(e){var t=Object(l.map)(a.getParametersDefs(),e=>e.name);s(e),f(Object(l.map)(e.getParametersDefs(),e=>({name:e.name,type:Object(l.includes)(t,e.name)?Dp.DashboardMapToExisting:Dp.DashboardAddNew,mapTo:e.name,value:e.normalizedValue,title:"",param:e}))),e.visualizations.length>0&&d(Object(l.first)(e.visualizations))}})},[a]),h=Object(r.useCallback)(()=>{t.close({visualization:u,parameterMappings:m}).catch(()=>{vl.error("Widget could not be added")})},[t,u,m]),b=a.getParametersDefs();return n.a.createElement(ke.a,af({},t.props,{title:"Add Widget",onOk:h,okButtonProps:rf({},t.props.okButtonProps,{disabled:!i||t.props.okButtonProps.disabled}),okText:"Add to Dashboard",width:700}),n.a.createElement("div",{"data-test":"AddWidgetDialog"},n.a.createElement(Jl,{onChange:e=>y(e?e.id:null)}),i&&n.a.createElement(lf,{query:i,visualization:u,onChange:d}),m.length>0&&[n.a.createElement("label",{key:"parameters-title",htmlFor:"parameter-mappings"},"Parameters"),n.a.createElement(Lp,{key:"parameters-list",id:"parameter-mappings",mappings:m,existingParams:b,onChange:f})]))}lf.propTypes={query:D.a.object,visualization:D.a.object,onChange:D.a.func},lf.defaultProps={query:null,visualization:null,onChange:()=>{}},sf.propTypes={dialog:Te.isRequired,dashboard:D.a.object.isRequired};var cf=xe(sf);function uf(){return(uf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function df(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function pf(e){var t=e.imageUrl,a=e.roundedImage,r=e.title,o=e.body,i=e.children,l=e.className,s=df(e,["imageUrl","roundedImage","title","body","children","className"]);return n.a.createElement("div",uf({},s,{className:l+" w-100 d-flex align-items-center"}),n.a.createElement("img",{src:t,width:"32",height:"32",className:Z()({"profile__image--settings":a},"m-r-5"),alt:"Logo/Avatar"}),n.a.createElement("div",{className:"flex-fill"},n.a.createElement("div",null,r),o&&n.a.createElement("div",{className:"text-muted"},o)),i)}function mf(e){var t=e.user,a=e.withLink,r=e.children,o=df(e,["user","withLink","children"]),i=a?n.a.createElement("a",{href:"users/"+t.id},t.name):t.name;return n.a.createElement(pf,uf({},o,{imageUrl:t.profile_image_url,title:i,body:t.email}),r)}function ff(e){var t=e.dataSource,a=e.withLink,r=e.children,o=df(e,["dataSource","withLink","children"]),i="/static/images/db-logos/".concat(t.type,".png"),l=a?n.a.createElement("a",{href:"data_sources/"+t.id},t.name):t.name;return n.a.createElement(pf,uf({},o,{imageUrl:i,title:l}),r)}pf.propTypes={imageUrl:D.a.string.isRequired,title:D.a.node.isRequired,body:D.a.node,roundedImage:D.a.bool,className:D.a.string,children:D.a.node},pf.defaultProps={body:null,roundedImage:!0,className:"",children:null},mf.propTypes={user:D.a.shape({profile_image_url:D.a.string.isRequired,name:D.a.string.isRequired,email:D.a.string.isRequired}).isRequired,withLink:D.a.bool,children:D.a.node},mf.defaultProps={withLink:!1,children:null},ff.propTypes={dataSource:D.a.shape({name:D.a.string.isRequired,type:D.a.string.isRequired}).isRequired,withLink:D.a.bool,children:D.a.node},ff.defaultProps={withLink:!1,children:null};var yf=a(277),hf=a.n(yf);hf.a.setConfig({ADD_ATTR:["target"]}),hf.a.addHook("afterSanitizeAttributes",function(e){var t=e.getAttribute("target");Object(l.isString)(t)&&"_blank"===t.toLowerCase()?e.setAttribute("rel","noopener noreferrer"):e.removeAttribute("target")});var bf=hf.a.sanitize;function gf(e){return Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"response.statusText"),"Unknown error"],l.isString)}function vf(e){return"api/users/".concat(e.id,"/disable")}var Ef={query:e=>C.get("api/users",{params:e}),get:e=>{var t=e.id;return C.get("api/users/".concat(t))},create:e=>C.post("api/users",e),save:e=>C.post("api/users/".concat(e.id),e),enableUser:function(e){var t=bf(e.name);return C.delete(vf(e)).then(a=>(vl.success("User ".concat(t," is now enabled.")),e.is_disabled=!1,e.profile_image_url=a.profile_image_url,a)).catch(e=>{vl.error("Cannot enable user",gf(e))})},disableUser:function(e){var t=bf(e.name);return C.post(vf(e)).then(a=>(vl.warning("User ".concat(t," is now disabled.")),e.is_disabled=!0,e.profile_image_url=a.profile_image_url,a)).catch(e=>{vl.error("Cannot disable user",gf(e))})},deleteUser:function(e){var t=bf(e.name);return C.delete("api/users/".concat(e.id)).then(e=>(vl.warning("User ".concat(t," has been deleted.")),e)).catch(e=>{vl.error("Cannot delete user",gf(e))})},convertUserInfo:function(e){return{id:e.id,name:e.name,email:e.email,profileImageUrl:e.profile_image_url,apiKey:e.api_key,groupIds:e.groups,isDisabled:e.is_disabled,isInvitationPending:e.is_invitation_pending}},regenerateApiKey:function(e){return C.post("api/users/".concat(e.id,"/regenerate_api_key")).then(e=>(vl.success("The API Key has been updated."),e.api_key)).catch(e=>{vl.error("Failed regenerating API Key",gf(e))})},sendPasswordReset:function(e){return C.post("api/users/".concat(e.id,"/reset_password")).then(e=>{if(w.mailSettingsMissing)return vl.warning("The mail server is not configured."),e.reset_link;vl.success("Password reset email sent.")}).catch(e=>{vl.error("Failed to send password reset email",gf(e))})},resendInvitation:function(e){return C.post("api/users/".concat(e.id,"/invite")).then(e=>{if(w.mailSettingsMissing)return vl.warning("The mail server is not configured."),e.invite_link;vl.success("Invitation sent.")}).catch(e=>{vl.error("Failed to resend invitation",gf(e))})}};a(1433);function Of(){return(Of=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wf(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Sf=Ln.a.Option,Pf=200;var _f=e=>Ef.query({q:e}).then(e=>{return e.results}).catch(()=>[]);function kf(e){var t=e.context;return n.a.createElement(n.a.Fragment,null,"Manage Permissions",n.a.createElement("div",{className:"modal-header-desc"},"Editing this ".concat(t," is enabled for the users in this list and for admins. "),n.a.createElement(Pe,{type:"MANAGE_PERMISSIONS"})))}function Cf(e){var t=e.onSelect,a=e.shouldShowUser,o=jf(Object(r.useState)(!0),2),i=o[0],s=o[1],c=jf(Object(r.useState)([]),2),u=c[0],d=c[1],p=jf(Object(r.useState)(""),2),m=p[0],f=p[1],y=Object(r.useCallback)(Object(l.debounce)(e=>_f(e).then(d).finally(()=>s(!1)),Pf),[]);return Object(r.useEffect)(()=>{s(!0),y(m)},[y,m]),n.a.createElement(Ln.a,{className:"w-100 m-b-10",placeholder:"Add users...",showSearch:!0,onSearch:f,suffixIcon:i?n.a.createElement("i",{className:"fa fa-spinner fa-pulse"}):n.a.createElement("i",{className:"fa fa-search"}),filterOption:!1,notFoundContent:null,value:void 0,getPopupContainer:e=>e.parentNode,onSelect:t},u.filter(a).map(e=>n.a.createElement(Sf,{key:e.id,value:e.id},n.a.createElement(mf,{user:e}))))}function Nf(e){var t,a=e.dialog,o=e.author,i=e.context,s=e.aclUrl,c=jf(Object(r.useState)(!0),2),u=c[0],d=c[1],p=jf(Object(r.useState)([]),2),m=p[0],f=p[1],y=(t=s,{loadGrantees:Object(r.useCallback)(()=>C.get(t).then(e=>{var t=[];return Object(l.each)(e,(e,a)=>{e.forEach(e=>{e.accessType=en(a),t.push(e)})}),t}),[t]),addPermission:Object(r.useCallback)(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return C.post(t,{access_type:a,user_id:e}).catch(()=>vl.error("Could not grant permission to the user"))},[t]),removePermission:Object(r.useCallback)(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return C.delete(t,{data:{access_type:a,user_id:e}}).catch(()=>vl.error("Could not remove permission from the user"))},[t])}),h=y.loadGrantees,b=y.addPermission,g=y.removePermission,v=Object(r.useCallback)(()=>{d(!0),h().then(f).catch(()=>vl.error("Failed to load grantees list")).finally(()=>d(!1))},[h]),E=Object(r.useCallback)(e=>e.id===o.id||!!Object(l.get)(Object(l.find)(m,{id:e.id}),"accessType"),[o.id,m]);return Object(r.useEffect)(()=>{v()},[s,v]),n.a.createElement(ke.a,Of({},a.props,{className:"permissions-editor-dialog",title:n.a.createElement(kf,{context:i}),footer:n.a.createElement(B.a,{onClick:a.dismiss},"Close")}),n.a.createElement(Cf,{onSelect:e=>b(e).then(v),shouldShowUser:e=>!E(e)}),n.a.createElement("div",{className:"d-flex align-items-center m-t-5"},n.a.createElement("h5",{className:"flex-fill"},"Users with permissions"),u&&n.a.createElement("i",{className:"fa fa-spinner fa-pulse"})),n.a.createElement("div",{className:"scrollbox p-5",style:{maxHeight:"40vh"}},n.a.createElement(el.a,{size:"small",dataSource:[o].concat(wf(m)),renderItem:e=>n.a.createElement(el.a.Item,null,n.a.createElement(mf,{key:e.id,user:e},e.id===o.id?n.a.createElement(gp.a,{className:"m-0"},"Author"):n.a.createElement(X.a,{title:"Remove user permissions"},n.a.createElement("i",{className:"fa fa-remove clickable",onClick:()=>g(e.id).then(v)}))))})))}kf.propTypes={context:D.a.oneOf(["query","dashboard"])},kf.defaultProps={context:"query"},Cf.propTypes={onSelect:D.a.func,shouldShowUser:D.a.func},Cf.defaultProps={onSelect:()=>{},shouldShowUser:()=>!0},Nf.propTypes={dialog:Te.isRequired,author:D.a.object.isRequired,context:D.a.oneOf(["query","dashboard"]),aclUrl:D.a.string.isRequired},Nf.defaultProps={context:"query"};var Tf=xe(Nf);function qf(e){return(qf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xf(){return(xf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Rf(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Af(e){return(Af=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Df(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function If(e,t){return(If=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zf=function(e){function t(e){var a,r,o,i,l,s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=Af(t).call(this,e),a=!o||"object"!==qf(o)&&"function"!=typeof o?Df(r):o,i=Df(a),s=(()=>{a.ref.current.select();try{if(!document.execCommand("copy"))throw new Error;a.setState({copied:"Copied!"})}catch(e){a.setState({copied:"Copy failed"})}a.resetCopyState=setTimeout(()=>a.setState({copied:null}),2e3)}),(l="copy")in i?Object.defineProperty(i,l,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[l]=s,a.state={copied:null},a.ref=n.a.createRef(),a.copyFeatureSupported=document.queryCommandSupported("copy"),a.resetCopyState=null,a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&If(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentWillUnmount",value:function(){this.resetCopyState&&clearTimeout(this.resetCopyState)}},{key:"render",value:function(){var e=n.a.createElement(X.a,{title:this.state.copied||"Copy"},n.a.createElement(W.a,{type:"copy",style:{cursor:"pointer"},onClick:this.copy}));return n.a.createElement(Y.a,xf({},this.props,{ref:this.ref,addonAfter:this.copyFeatureSupported&&e}))}}])&&Rf(a.prototype,r),o&&Rf(a,o),t}();function Mf(e){return(Mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vf(){return(Vf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ff(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lf(e){return(Lf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Uf(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bf(e,t){return(Bf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Wf="api/dashboards/{id}/share",Gf=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=Lf(t).call(this,e),a=!n||"object"!==Mf(n)&&"function"!=typeof n?Uf(r):n,Qf(Uf(a),"formItemProps",{labelCol:{span:8},wrapperCol:{span:16},style:{marginBottom:7}}),Qf(Uf(a),"enableAccess",()=>{var e=a.props.dashboard;a.setState({saving:!0}),C.post(a.apiUrl).then(t=>{e.publicAccessEnabled=!0,e.public_url=t.public_url}).catch(()=>{vl.error("Failed to turn on sharing for this dashboard")}).finally(()=>{a.setState({saving:!1})})}),Qf(Uf(a),"disableAccess",()=>{var e=a.props.dashboard;a.setState({saving:!0}),C.delete(a.apiUrl).then(()=>{e.publicAccessEnabled=!1,delete e.public_url}).catch(()=>{vl.error("Failed to turn off sharing for this dashboard")}).finally(()=>{a.setState({saving:!1})})}),Qf(Uf(a),"onChange",e=>{e?a.enableAccess():a.disableAccess()});var o=a.props.dashboard;return a.state={saving:!1},a.apiUrl=Object(l.replace)(Wf,"{id}",o.id),a.enabled=a.props.hasOnlySafeQueries||o.publicAccessEnabled,a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bf(e,t)}(t,n.a.Component),a=t,o=[{key:"headerContent",get:function(){return n.a.createElement(n.a.Fragment,null,"Share Dashboard",n.a.createElement("div",{className:"modal-header-desc"},"Allow public access to this dashboard with a secret address. ",n.a.createElement(Pe,{type:"SHARE_DASHBOARD"})))}}],(r=[{key:"render",value:function(){var e=this.props,t=e.dialog,a=e.dashboard;return n.a.createElement(ke.a,Vf({},t.props,{title:this.constructor.headerContent,footer:null}),n.a.createElement(kl.a,{layout:"horizontal"},!this.props.hasOnlySafeQueries&&n.a.createElement(kl.a.Item,null,n.a.createElement(T.a,{message:"For your security, sharing is currently not supported for dashboards containing queries with text parameters. Consider changing the text parameters in your query to a different type.",type:"error"})),n.a.createElement(kl.a.Item,Vf({label:"Allow public access"},this.formItemProps),n.a.createElement(In.a,{checked:a.publicAccessEnabled,onChange:this.onChange,loading:this.state.saving,disabled:!this.enabled,"data-test":"PublicAccessEnabled"})),a.public_url&&n.a.createElement(kl.a.Item,Vf({label:"Secret address"},this.formItemProps),n.a.createElement(zf,{value:a.public_url,"data-test":"SecretAddress"}))))}}])&&Ff(a.prototype,r),o&&Ff(a,o),t}();Qf(Gf,"propTypes",{dashboard:D.a.object.isRequired,hasOnlySafeQueries:D.a.bool.isRequired,dialog:Te.isRequired});var Hf=xe(Gf);function Kf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Yf(){var e=Kf(Object(r.useState)(Object(l.has)(E.search,"fullscreen")),2),t=e[0],a=e[1];Object(r.useEffect)(()=>{document.body.classList.toggle("headless",t),E.setSearch({fullscreen:!!t||null},!0)},[t]);return[t,()=>a(!t)]}function Jf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Xf(e){var t=Je.getDashboardRefreshIntervals();return Object(l.max)([30,Object(l.min)(t),e])}function $f(e){var t=Jf(Object(r.useState)(function(){var e=parseFloat(E.search.refresh);return Object(l.isNaN)(e)?null:Xf(e)}()),2),a=t[0],n=t[1],o=Object(r.useRef)();return o.current=e,Object(r.useEffect)(()=>{if(E.setSearch({refresh:a||null},!0),a){var e=setInterval(()=>{o.current()},1e3*a);return()=>clearInterval(e)}},[a]),Object(r.useMemo)(()=>[a,e=>n(Xf(e)),()=>n(null)],[a])}function Zf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ey={SAVED:"saved",SAVING:"saving",SAVING_FAILED:"saving_failed"};function ty(e,t){var a=Zf(Object(r.useState)(e&&Object(l.has)(E.search,"edit")),2),n=a[0],o=a[1],i=Zf(Object(r.useState)(ey.SAVED),2),s=i[0],c=i[1],u=Zf(Object(r.useState)([]),2),d=u[0],p=u[1],m=Zf(Object(r.useState)(!1),2),f=m[0],y=m[1];Object(r.useEffect)(()=>{E.setSearch({edit:!!n||null},!0)},[n]),Object(r.useEffect)(()=>{f&&s===ey.SAVED&&(y(!1),o(!1))},[f,s]);var h=Object(r.useCallback)(a=>{if(e){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.pickBy)(t,(t,a)=>{var r=Object(l.find)(e,{id:Number(a)}).options.position;return!Object(l.isMatch)(r,t)})}(t,a);c(ey.SAVING),p(a);var n=Object(l.map)(r,(e,a)=>{var r=Object(l.find)(t,{id:Number(a)});return r?r.save("options",{position:e}):Promise.resolve()});return Promise.all(n).then(()=>c(ey.SAVED)).catch(()=>{c(ey.SAVING_FAILED),vl.error("Error saving changes.")})}c(ey.SAVED)},[e,t]),b=Object(r.useCallback)(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return c(ey.SAVING),Object(l.debounce)(()=>h.apply(void 0,t),2e3)()},[h]),g=Object(r.useCallback)(()=>h(d),[d,h]),v=Object(r.useCallback)(t=>{t||s===ey.SAVED?o(e&&t):y(!0)},[s,e]);return{editingLayout:e&&n,setEditingLayout:v,saveDashboardLayout:n?b:h,retrySaveDashboardLayout:g,doneBtnClickedWhileSaving:f,dashboardStatus:s}}function ay(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ry(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ny(e,t,a[t])})}return e}function ny(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function oy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var iy=function(e){var t=oy(Object(r.useState)(e),2),a=t[0],n=t[1],o=oy(Object(r.useState)([]),2),i=o[0],c=o[1],u=oy(Object(r.useState)(!1),2),d=u[0],p=u[1],m=oy(Object(r.useState)(!1),2),f=m[0],y=m[1],h=Object(r.useMemo)(()=>a.getParametersDefs(),[a]),b=!a.is_archived&&a.can_edit,g=Object(r.useMemo)(()=>!a.is_archived&&Object(l.has)(a,"user.id")&&(O.id===a.user.id||O.hasPermission("admin")),[a]),v=Object(r.useMemo)(()=>Object(l.every)(a.widgets,e=>!e.getQuery()||e.getQuery().is_safe),[a]),w=Object(r.useCallback)(()=>{var e="api/dashboards/".concat(a.id,"/acl");Tf.showModal({aclUrl:e,context:"dashboard",author:a.user})},[a]),j=Object(r.useCallback)(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n(t=>Object(l.extend)({},t,e)),e=ry({},e,{slug:a.id}),t&&(e=ry({},e,{version:a.version})),Ka.save(e).then(t=>n(a=>Object(l.extend)({},a,Object(l.pick)(t,Object(l.keys)(e))))).catch(e=>{var t=Object(l.get)(e,"response.status");403===t?vl.error("Dashboard update failed","Permission Denied."):409===t&&vl.error("It seems like the dashboard has been modified by another user. ","Please copy/backup your changes and reload this page.",{duration:null})})},[a]),S=Object(r.useCallback)(()=>{Ke("toggle_published","dashboard",a.id),j({is_draft:!a.is_draft},!1)},[a,j]),P=Object(r.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getParametersDefs(),n(e=>Object(l.extend)({},e)),e.load(t).finally(()=>n(e=>Object(l.extend)({},e)))},[]),_=Object(r.useCallback)(e=>P(e,!0),[P]),k=Object(r.useCallback)(e=>{n(t=>Object(l.extend)({},t,{widgets:t.widgets.filter(t=>void 0!==t.id&&t.id!==e)}))},[]),C=Object(r.useRef)();C.current=a;var N=Object(r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(l.isEmpty)(t)?e:e.filter(e=>Object.values(e.getParameterMappings()).filter(e=>"dashboard-level"===e.type).some(e=>{var a=e.mapTo;return Object(l.includes)(t.map(e=>e.name),a)}))}(C.current.widgets,t),r=Object(l.compact)(a.map(t=>P(t,e).catch(e=>e)));return Promise.all(r).then(()=>{var e=Object(l.compact)(Object(l.map)(C.current.widgets,e=>e.getQueryResult())),t=function(e,t,a){var r={};return s.a.each(t,t=>{var n=t&&t.getFilters?t.getFilters():[];s.a.each(n,t=>{var n=s.a.has(a,t.name);if(n||e.dashboard_filters_enabled){n&&(t.current=a[t.name]);var o=Wa({},t);s.a.has(r,t.name)?r[o.name].values=s.a.union(r[o.name].values,o.values):r[o.name]=o}})}),s.a.values(r)}(C.current,e,E.search);c(t)})},[P]),T=Object(r.useCallback)(e=>{d||(p(!0),N(!0,e).finally(()=>p(!1)))},[d,N]),q=Object(r.useCallback)(()=>{Ke("archive","dashboard",a.id),Ka.delete(a).then(e=>n(t=>Object(l.extend)({},t,Object(l.pick)(e,["is_archived"]))))},[a]),x=Object(r.useCallback)(()=>{var e=()=>n(e=>Object(l.extend)({},e));Hf.showModal({dashboard:a,hasOnlySafeQueries:v}).onClose(e).onDismiss(e)},[a,v]),R=Object(r.useCallback)(()=>{Cm.showModal({isNew:!0}).onClose(e=>a.addWidget(e).then(()=>n(e=>Object(l.extend)({},e))))},[a]),A=Object(r.useCallback)(()=>{cf.showModal({dashboard:a}).onClose(e=>{var t=e.visualization,r=e.parameterMappings;return a.addWidget(t,{parameterMappings:Ip(r)}).then(e=>{var t=[e].concat(ay(zp(e.options.parameterMappings,a.widgets)));return Promise.all(t.map(e=>e.save())).then(()=>n(e=>Object(l.extend)({},e)))})})},[a]),D=oy($f(T),3),I=D[0],z=D[1],M=D[2],V=oy(Yf(),2),F=V[0],L=V[1],U=ty(!f&&b,a.widgets);return Object(r.useEffect)(()=>{n(e),N()},[e]),Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{N()},[a.dashboard_filters_enabled]),ry({dashboard:a,globalParameters:h,refreshing:d,filters:i,setFilters:c,loadDashboard:N,refreshDashboard:T,updateDashboard:j,togglePublished:S,archiveDashboard:q,loadWidget:P,refreshWidget:_,removeWidget:k,canEditDashboard:b,isDashboardOwnerOrAdmin:g,refreshRate:I,setRefreshRate:z,disableRefreshRate:M},U,{gridDisabled:f,setGridDisabled:y,fullscreen:F,toggleFullscreen:L,showShareDashboardDialog:x,showAddTextboxDialog:R,showAddWidgetDialog:A,managePermissions:w})};function ly(e){return(ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sy(){return(sy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cy(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function uy(e){return(uy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dy(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function py(e,t){return(py=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function my(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var fy=function(e){function t(e){var a,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=uy(t).call(this,e),a=!o||"object"!==ly(o)&&"function"!=typeof o?dy(r):o,my(dy(a),"startEditing",()=>{a.props.isEditable&&a.setState({editing:!0})}),my(dy(a),"stopEditing",e=>{var t=Object(l.trim)(e);a.props.ignoreBlanks&&""===t||t===a.props.value||a.props.onDone(t),a.setState({editing:!1})}),my(dy(a),"handleKeyDown",e=>{13!==e.keyCode||e.shiftKey?27===e.keyCode&&a.setState({editing:!1}):(e.preventDefault(),a.stopEditing(e.target.value))}),my(dy(a),"renderNormal",()=>a.props.value?n.a.createElement("span",{role:"presentation",onFocus:a.startEditing,onClick:a.startEditing,className:a.props.isEditable?"editable":""},a.props.value):n.a.createElement("a",{className:"clickable",onClick:a.startEditing},a.props.placeholder)),my(dy(a),"renderEdit",()=>{var e=a.props,t=e.multiline,r=e.value,o=e.editorProps,i=t?Y.a.TextArea:Y.a;return n.a.createElement(i,sy({defaultValue:r,onBlur:e=>a.stopEditing(e.target.value),onKeyDown:a.handleKeyDown,autoFocus:!0},o))}),a.state={editing:e.defaultEditing},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&py(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidUpdate",value:function(e,t){!this.state.editing&&t.editing&&this.props.onStopEditing()}},{key:"render",value:function(){return n.a.createElement("span",{className:Z()("edit-in-place",{active:this.state.editing},this.props.className)},this.state.editing?this.renderEdit():this.renderNormal())}}])&&cy(a.prototype,r),o&&cy(a,o),t}();my(fy,"propTypes",{ignoreBlanks:D.a.bool,isEditable:D.a.bool,placeholder:D.a.string,value:D.a.string,onDone:D.a.func.isRequired,onStopEditing:D.a.func,multiline:D.a.bool,editorProps:D.a.object,defaultEditing:D.a.bool}),my(fy,"defaultProps",{ignoreBlanks:!1,isEditable:!0,placeholder:"",value:"",onStopEditing:()=>{},multiline:!1,editorProps:{},defaultEditing:!1});a(1434);function yy(){return _i("api/dashboards/tags").then(e=>Object(l.map)(e,e=>e.name))}function hy(e){return e?"primary":"default"}function by(e){var t=e.dashboardOptions,a=t.dashboard,r=t.canEditDashboard,o=t.updateDashboard,i=t.editingLayout;return n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement(Tr,{item:a}),n.a.createElement("h3",null,n.a.createElement(fy,{isEditable:i,onDone:e=>o({name:e}),value:a.name,ignoreBlanks:!0})),n.a.createElement(X.a,{title:a.user.name,placement:"bottom"},n.a.createElement("img",{src:a.user.profile_image_url,className:"profile-image",alt:a.user.name}))),n.a.createElement(lo,{tags:a.tags,isDraft:a.is_draft,isArchived:a.is_archived,canEdit:r,getAvailableTags:yy,onEdit:e=>o({tags:e})}))}function gy(e){var t=e.dashboardOptions,a=t.refreshRate,r=t.setRefreshRate,o=t.disableRefreshRate,i=t.refreshing,s=t.refreshDashboard,c=Je.getDashboardRefreshIntervals(),u=w.dashboardRefreshIntervals;return n.a.createElement(B.a.Group,null,n.a.createElement(X.a,{title:a?"Auto Refreshing every ".concat(Zr(a)):null},n.a.createElement(B.a,{type:hy(a),onClick:()=>s()},n.a.createElement("i",{className:Z()("zmdi zmdi-refresh m-r-5",{"zmdi-hc-spin":i})}),a?Zr(a):"Refresh")),n.a.createElement(L.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(H.a,{onClick:e=>{var t=e.key,a=parseFloat(t);a?(r(a),s()):o()},selectedKeys:["".concat(a)]},u.map(e=>n.a.createElement(H.a.Item,{key:"".concat(e),disabled:!Object(l.includes)(c,e)},Zr(e))),a&&n.a.createElement(H.a.Item,{key:null},"Disable auto refresh"))},n.a.createElement(B.a,{className:"icon-button hidden-xs",type:hy(a)},n.a.createElement("i",{className:"fa fa-angle-down"}),n.a.createElement("span",{className:"sr-only"},"Split button!"))))}function vy(e){var t=e.dashboardOptions,a=t.dashboard,r=t.setEditingLayout,o=t.togglePublished,i=t.archiveDashboard,l=t.managePermissions,s=t.gridDisabled,c=t.isDashboardOwnerOrAdmin;return n.a.createElement(L.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(H.a,{"data-test":"DashboardMoreButtonMenu"},n.a.createElement(H.a.Item,{className:Z()({hidden:s})},n.a.createElement("a",{onClick:()=>r(!0)},"Edit")),w.showPermissionsControl&&c&&n.a.createElement(H.a.Item,null,n.a.createElement("a",{onClick:l},"Manage Permissions")),!a.is_draft&&n.a.createElement(H.a.Item,null,n.a.createElement("a",{onClick:o},"Unpublish")),n.a.createElement(H.a.Item,null,n.a.createElement("a",{onClick:()=>{ke.a.confirm({title:"Archive Dashboard",content:'Are you sure you want to archive the "'.concat(a.name,'" dashboard?'),okText:"Archive",okType:"danger",onOk:i,maskClosable:!0,autoFocusButton:null})}},"Archive")))},n.a.createElement(B.a,{className:"icon-button m-l-5","data-test":"DashboardMoreButton"},n.a.createElement(W.a,{type:"ellipsis",rotate:90})))}function Ey(e){var t=e.dashboardOptions,a=t.dashboard,r=t.togglePublished,o=t.canEditDashboard,i=t.fullscreen,l=t.toggleFullscreen,s=t.showShareDashboardDialog,c=a.is_draft,u=!a.is_draft,d=a.publicAccessEnabled||o&&!a.is_draft,p=o;return n.a.createElement("div",{className:"dashboard-control"},!a.is_archived&&n.a.createElement("span",{className:"hidden-print"},c&&n.a.createElement(B.a,{className:"m-r-5 hidden-xs",onClick:r},n.a.createElement("span",{className:"fa fa-paper-plane m-r-5"})," Publish"),n.a.createElement(gy,{dashboardOptions:t}),u&&n.a.createElement(X.a,{className:"hidden-xs",title:"Enable/Disable Fullscreen display"},n.a.createElement(B.a,{type:hy(i),className:"icon-button m-l-5",onClick:l},n.a.createElement("i",{className:"zmdi zmdi-fullscreen"}))),d&&n.a.createElement(X.a,{title:"Dashboard Sharing Options"},n.a.createElement(B.a,{className:"icon-button m-l-5",type:hy(a.publicAccessEnabled),onClick:s,"data-test":"OpenShareForm"},n.a.createElement("i",{className:"zmdi zmdi-share"}))),p&&n.a.createElement(vy,{dashboardOptions:t})))}function Oy(e){var t,a=e.dashboardOptions,r=a.setEditingLayout,o=a.doneBtnClickedWhileSaving,i=a.dashboardStatus,l=a.retrySaveDashboardLayout;return t=i===ey.SAVED?n.a.createElement("span",{className:"save-status"},"Saved"):i===ey.SAVING?n.a.createElement("span",{className:"save-status","data-saving":!0},"Saving"):n.a.createElement("span",{className:"save-status","data-error":!0},"Saving Failed"),n.a.createElement("div",{className:"dashboard-control"},t,i===ey.SAVING_FAILED?n.a.createElement(B.a,{type:"primary",onClick:l},"Retry"):n.a.createElement(B.a,{loading:o,type:"primary",onClick:()=>r(!1)},!o&&n.a.createElement("i",{className:"fa fa-check m-r-5"})," Done Editing"))}function wy(e){var t=e.dashboardOptions,a=t.editingLayout?Oy:Ey;return n.a.createElement("div",{className:"dashboard-header"},n.a.createElement(by,{dashboardOptions:t}),n.a.createElement(a,{dashboardOptions:t}))}by.propTypes={dashboardOptions:D.a.object.isRequired},gy.propTypes={dashboardOptions:D.a.object.isRequired},vy.propTypes={dashboardOptions:D.a.object.isRequired},Ey.propTypes={dashboardOptions:D.a.object.isRequired},Oy.propTypes={dashboardOptions:D.a.object.isRequired},wy.propTypes={dashboardOptions:D.a.object.isRequired};a(1435);function jy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Sy(e){var t=e.dashboardOptions,a=t.dashboard,r=t.updateDashboard;return n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Uc.a,{checked:!!a.dashboard_filters_enabled,onChange:e=>{var t=e.target;return r({dashboard_filters_enabled:t.checked})},"data-test":"DashboardFiltersCheckbox"},"Use Dashboard Level Filters"))}function Py(e){var t=e.dashboardOptions,a=t.showAddTextboxDialog,r=t.showAddWidgetDialog;return n.a.createElement("div",{className:"add-widget-container"},n.a.createElement("h2",null,n.a.createElement("i",{className:"zmdi zmdi-widgets"}),n.a.createElement("span",{className:"hidden-xs hidden-sm"},"Widgets are individual query visualizations or text boxes you can place on your dashboard in various arrangements.")),n.a.createElement("div",null,n.a.createElement(B.a,{className:"m-r-15",onClick:a,"data-test":"AddTextboxButton"},"Add Textbox"),n.a.createElement(B.a,{type:"primary",onClick:r,"data-test":"AddWidgetButton"},"Add Widget")))}function _y(e){var t=iy(e.dashboard),a=t.dashboard,r=t.filters,o=t.setFilters,i=t.loadDashboard,s=t.loadWidget,c=t.removeWidget,u=t.saveDashboardLayout,d=t.globalParameters,p=t.refreshDashboard,m=t.refreshWidget,f=t.editingLayout,y=t.setGridDisabled;return n.a.createElement(n.a.Fragment,null,n.a.createElement(wy,{dashboardOptions:t}),!Object(l.isEmpty)(d)&&n.a.createElement("div",{className:"dashboard-parameters m-b-10 p-15 bg-white tiled","data-test":"DashboardParameters"},n.a.createElement(Dd,{parameters:d,onValuesChange:p})),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled","data-test":"DashboardFilters"},n.a.createElement(Xd,{filters:r,onChange:o})),f&&n.a.createElement(Sy,{dashboardOptions:t}),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(tf,{dashboard:a,widgets:a.widgets,filters:r,isEditing:f,onLayoutChange:f?u:()=>{},onBreakpointChange:y,onLoadWidget:s,onRefreshWidget:m,onRemoveWidget:c,onParameterMappingsChange:i})),f&&n.a.createElement(Py,{dashboardOptions:t}))}function ky(e){var t=e.dashboardSlug,a=e.onError,o=jy(Object(r.useState)(null),2),i=o[0],l=o[1],s=Object(r.useRef)();return s.current=a,Object(r.useEffect)(()=>{Ka.get({slug:t}).then(e=>{Ke("view","dashboard",e.id),l(e)}).catch(e=>s.current(e))},[t]),n.a.createElement("div",{className:"dashboard-page"},n.a.createElement("div",{className:"container"},i&&n.a.createElement(_y,{dashboard:i})))}Sy.propTypes={dashboardOptions:D.a.object.isRequired},Py.propTypes={dashboardOptions:D.a.object.isRequired},_y.propTypes={dashboard:D.a.object.isRequired},ky.propTypes={dashboardSlug:D.a.string.isRequired,onError:D.a.func},ky.defaultProps={onError:D.a.func};var Cy=mr({path:"/dashboard/:dashboardSlug",render:e=>n.a.createElement(ky,e)});function Ny(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ty(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){qy(e,t,a[t])})}return e}function qy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function xy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ry(e){var t=e.apiKey,a=e.currentRoute,o=e.renderChildren,i=xy(Object(r.useState)(!1),2),l=i[0],s=i[1],c=Object(r.useContext)(I.ErrorBoundaryContext).handleError;return Object(r.useEffect)(()=>{var e=!1;return k.setApiKey(t),k.loadConfig().then(()=>{e||s(!0)}).catch(()=>{e||s(!1)}),()=>{e=!0}},[t]),l?n.a.createElement(n.a.Fragment,{key:a.key},o(Ty({},a.routeParams,{pageTitle:a.title,onError:c,apiKey:t}))):null}function Ay(e){var t=e.render,a=e.getApiKey;return Ty({},Ny(e,["render","getApiKey"]),{render:e=>n.a.createElement(Ry,{apiKey:a(e),currentRoute:e,renderChildren:t})})}Ry.propTypes={apiKey:D.a.string.isRequired,renderChildren:D.a.func},Ry.defaultProps={renderChildren:()=>null};a(1436);function Dy(e){return(Dy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Iy(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zy(e){return(zy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function My(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vy(e,t){return(Vy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ly(e){var t=e.dashboard,a=iy(t),r=a.globalParameters,o=a.filters,i=a.setFilters,s=a.refreshDashboard,c=a.loadWidget,u=a.refreshWidget;return n.a.createElement("div",{className:"container p-t-10 p-b-20"},n.a.createElement(fr,{title:t.name}),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Dd,{parameters:r,onValuesChange:s})),!Object(l.isEmpty)(o)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Xd,{filters:o,onChange:i})),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(tf,{dashboard:t,widgets:t.widgets,filters:o,isEditing:!1,isPublic:!0,onLoadWidget:c,onRefreshWidget:u})))}Ly.propTypes={dashboard:D.a.object.isRequired};var Uy=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,a=!(n=(e=zy(t)).call.apply(e,[this].concat(i)))||"object"!==Dy(n)&&"function"!=typeof n?My(r):n,Fy(My(a),"state",{loading:!0,dashboard:null}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vy(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ka.getByToken({token:this.props.token}).then(e=>this.setState({dashboard:e,loading:!1})).catch(e=>this.props.onError(e))}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.dashboard;return n.a.createElement("div",{className:"public-dashboard-page"},t?n.a.createElement("div",{className:"container loading-message"},n.a.createElement(re,{className:"",icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."})):n.a.createElement(Ly,{dashboard:a}),n.a.createElement("div",{id:"footer"},n.a.createElement("div",{className:"text-center"},n.a.createElement("a",{href:"https://redash.io"},n.a.createElement("img",{alt:"Redash Logo",src:tr.a,width:"38"}))),"Powered by ",n.a.createElement("a",{href:"https://redash.io/?ref=public-dashboard"},"Redash")))}}])&&Iy(a.prototype,r),o&&Iy(a,o),t}();Fy(Uy,"propTypes",{token:D.a.string.isRequired,onError:D.a.func}),Fy(Uy,"defaultProps",{onError:()=>{}});var By=Ay({path:"/public/dashboards/:token",render:e=>n.a.createElement(Uy,e),getApiKey:e=>e.routeParams.token}),Qy=1,Wy="/static/images/db-logos",Gy={query:()=>C.get("api/data_sources"),get:e=>{var t=e.id;return C.get("api/data_sources/".concat(t))},types:()=>C.get("api/data_sources/types"),create:e=>C.post("api/data_sources",e),save:e=>C.post("api/data_sources/".concat(e.id),e),test:e=>C.post("api/data_sources/".concat(e.id,"/test")),delete:e=>{var t=e.id;return C.delete("api/data_sources/".concat(t))},fetchSchema:function(e){var t={};return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t.refresh=!0),C.get("api/data_sources/".concat(e.id,"/schema"),{params:t})}};function Hy(){return(Hy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ky(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(re,Hy({icon:"fa-search",message:"Sorry, we couldn't find anything."},e)))}a(1437);function Yy(e){return(Yy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jy(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xy(e){return(Xy=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zy(e,t){return(Zy=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var th=Y.a.Search,ah=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=Xy(t).call(this,e),a=!n||"object"!==Yy(n)&&"function"!=typeof n?$y(r):n,eh($y(a),"state",{searchText:""}),a.items=[];var o=1;return e.items.forEach(e=>{a.items.push(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){eh(e,t,a[t])})}return e}({id:o},e)),o+=1}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zy(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderListItem",value:function(e){return n.a.createElement("a",{key:"card".concat(e.id),className:"visual-card",onClick:e.onClick,href:e.href},n.a.createElement("img",{alt:e.title,src:e.imgSrc}),n.a.createElement("h3",null,e.title))}},{key:"render",value:function(){var e=this.props.showSearch,t=this.state.searchText,a=this.items.filter(e=>Object(l.isEmpty)(t)||Object(l.includes)(e.title.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{"data-test":"CardsList"},e&&n.a.createElement("div",{className:"row p-10"},n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement(th,{placeholder:"Search...",onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0}))),Object(l.isEmpty)(a)?n.a.createElement(Ky,{className:""}):n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},a.map(e=>this.renderListItem(e)))))}}])&&Jy(a.prototype,r),o&&Jy(a,o),t}();eh(ah,"propTypes",{items:D.a.arrayOf(D.a.shape({title:D.a.string.isRequired,imgSrc:D.a.string.isRequired,onClick:D.a.func,href:D.a.string})),showSearch:D.a.bool}),eh(ah,"defaultProps",{items:[],showSearch:!1});var rh=a(392),nh=a.n(rh),oh=(a(1438),a(1442),a(673)),ih=a.n(oh),lh=a(273),sh=a.n(lh);function ch(){return(ch=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function dh(e){var t=e.collapsed,a=e.children,r=e.className,o=uh(e,["collapsed","children","className"]);return n.a.createElement(sh.a,ch({},o,{activeKey:t?null:"content",className:Z()(r,"ant-collapse-headerless")}),n.a.createElement(sh.a.Panel,{key:"content",header:""},a))}dh.propTypes={collapsed:D.a.bool,children:D.a.node,className:D.a.string},dh.defaultProps={collapsed:!0,children:null,className:""};var ph=a(268),mh=a.n(ph);a(1448);function fh(){return(fh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var yh=Object(r.forwardRef)(function(e,t){return n.a.createElement("div",{className:"ace-editor-input","data-test":e["data-test"]},n.a.createElement(mh.a,fh({ref:t,mode:"sql",theme:"textmate",height:"100px",editorProps:{$blockScrolling:1/0},showPrintMargin:!1},e)))});a(1449);function hh(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var bh={getFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{options:{}},a=e.configuration_schema;!function(e){Object(l.each)(e.properties,(t,a)=>{"password"!==a&&"passwd"!==a||(t.type="password"),a.endsWith("File")&&(t.type="file"),"boolean"===t.type&&(t.type="checkbox"),"string"===t.type&&(t.type="text"),Object(l.isEmpty)(t.enum)||(t.type="select",t.options=Object(l.map)(t.enum,e=>({value:e,name:e}))),Object(l.isEmpty)(t.extendedEnum)||(t.type="select",t.options=t.extendedEnum),t.required=Object(l.includes)(e.required,a),t.extra=Object(l.includes)(e.extra_options,a)}),e.order=e.order||[]}(a),Object.keys(t.options).length>0||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.properties;Object.keys(a).forEach(e=>{var r=a[e];if(Object(l.isUndefined)(r.default)||"checkbox"!==r.type||(t[e]=r.default),"select"===r.type){var n=Object(l.map)(r.options,e=>e.value);t[e]=Object(l.includes)(n,r.default)?r.default:n[0]}})}(a,t.options);var r=!t.id;return[{name:"name",title:"Name",type:"text",required:!0,initialValue:t.name,contentAfter:n.a.createElement("hr"),placeholder:"My ".concat(e.name),autoFocus:r}].concat(hh(function(e,t,a){var r=new Array(t.length);return Object.keys(e).forEach(n=>{var o=t.indexOf(n),i={name:n,title:e[n].title,type:e[n].type,placeholder:Object(l.isNil)(e[n].default)?null:e[n].default.toString(),required:e[n].required,extra:e[n].extra,initialValue:a[n]};"select"===i.type&&(i.placeholder="Select an option",i.options=e[n].options),o>-1?r[o]=i:r.push(i)}),r}(a.properties,a.order,t.options)))},updateTargetWithValues:function(e,t){e.name=t.name,Object.keys(t).forEach(a=>{"name"!==a&&(e.options[a]=t[a])})},getBase64:function(e){return new Promise((t,a)=>{var r=new FileReader;r.readAsDataURL(e),r.onload=(()=>t(r.result.substr(r.result.indexOf(",")+1))),r.onerror=(e=>a(e))})}};a(1450);function gh(e){return(gh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vh(){return(vh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Eh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Oh(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){_h(e,t,a[t])})}return e}function wh(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jh(e){return(jh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sh(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ph(e,t){return(Ph=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var kh=e=>{var t=e.type,a=e.required,r=e.minLength;return[a&&{required:a,message:"This field is required."},r&&Object(l.includes)(["text","email","password"],t)&&{min:r,message:"This field is too short."},"email"===t&&{type:"email",message:"This field must be a valid email."}].filter(e=>e)},Ch=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=jh(t).call(this,e),a=!n||"object"!==gh(n)&&"function"!=typeof n?Sh(r):n,_h(Sh(a),"setActionInProgress",(e,t)=>{a.setState(a=>({inProgressActions:Oh({},a.inProgressActions,_h({},e,t))}))}),_h(Sh(a),"handleSubmit",e=>{a.setState({isSubmitting:!0}),e.preventDefault(),a.props.form.validateFieldsAndScroll((e,t)=>{Object.entries(t).forEach(e=>{var r=Eh(e,2),n=r[0],o=r[1],i=a.props.fields.find(e=>e.name===n).initialValue;null!=i&&""!==i||""!==o||(t[n]=null)}),e?a.setState({isSubmitting:!1}):a.props.onSubmit(t,e=>{var t=a.props.form,r=t.setFieldsValue,n=t.getFieldsValue;a.setState({isSubmitting:!1}),r(n()),vl.success(e)},e=>{a.setState({isSubmitting:!1}),vl.error(e)})})}),_h(Sh(a),"handleAction",e=>{var t=e.target.dataset.action;a.setActionInProgress(t,!0),a.actionCallbacks[t](()=>{a.setActionInProgress(t,!1)})}),_h(Sh(a),"base64File",(e,t)=>{t&&t.fileList[0]&&bh.getBase64(t.file).then(t=>{a.props.form.setFieldsValue(_h({},e,t))})});var o=Object(l.some)(e.fields,e=>{var t=e.extra,a=e.initialValue,r=e.placeholder;return t&&(!Object(l.isEmpty)(a)||Object(l.isNumber)(a)||Object(l.isBoolean)(a)&&a.toString()!==r)}),i={};return e.actions.forEach(e=>i[e.name]=!1),a.state={isSubmitting:!1,showExtraFields:o,inProgressActions:i},a.actionCallbacks=a.props.actions.reduce((e,t)=>Oh({},e,_h({},t.name,t.callback)),null),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ph(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderUpload",value:function(e,t){var a=this.props.form,r=a.getFieldDecorator,o=a.getFieldValue,i=e.name,l=e.initialValue,s={rules:kh(e),initialValue:l,getValueFromEvent:this.base64File.bind(this,i)},c=void 0!==o(i)&&o(i)!==l,u=n.a.createElement(ih.a,vh({},t,{beforeUpload:()=>!1}),n.a.createElement(B.a,{disabled:c},n.a.createElement(W.a,{type:"upload"})," Click to upload"));return r(i,s)(u)}},{key:"renderSelect",value:function(e,t){var a=this.props.form.getFieldDecorator,r=e.name,o=e.options,i=e.mode,l=e.initialValue,s=e.readOnly,c=e.loading,u=Ln.a.Option;return a(r,{rules:kh(e),initialValue:l})(n.a.createElement(Ln.a,vh({},t,{optionFilterProp:"children",loading:c||!1,mode:i,getPopupContainer:e=>e.parentNode}),o&&o.map(e=>n.a.createElement(u,{key:"".concat(e.value),value:e.value,disabled:s},e.name||e.value))))}},{key:"renderField",value:function(e,t){var a=this.props.form.getFieldDecorator,r=e.name,o=e.type,i=e.initialValue,l=e.title||en(r),s={rules:kh(e),valuePropName:"checkbox"===o?"checked":"value",initialValue:i};return"checkbox"===o?a(r,s)(n.a.createElement(Uc.a,t,l)):"file"===o?this.renderUpload(e,t):"select"===o?this.renderSelect(e,t):"content"===o?e.content:"number"===o?a(r,s)(n.a.createElement(Il.a,t)):"textarea"===o?a(r,s)(n.a.createElement(Y.a.TextArea,t)):"ace"===o?a(r,s)(n.a.createElement(yh,t)):a(r,s)(n.a.createElement(Y.a,t))}},{key:"renderFields",value:function(e){return e.map(e=>{var t=kl.a.Item,a=e.name,r=e.title,o=e.type,i=e.readOnly,s=e.autoFocus,c=e.contentAfter,u=r||en(a),d=this.props,p=d.feedbackIcons,m=d.form,f={className:"m-b-10",hasFeedback:"checkbox"!==o&&"file"!==o&&p,label:"checkbox"===o?"":u},y=Oh({},e.props,{className:"w-100",name:a,type:o,readOnly:i,autoFocus:s,placeholder:e.placeholder,"data-test":u});return n.a.createElement(n.a.Fragment,{key:a},n.a.createElement(t,f,this.renderField(e,y)),Object(l.isFunction)(c)?c(m.getFieldValue(a)):c)})}},{key:"renderActions",value:function(){return this.props.actions.map(e=>{var t=this.state.inProgressActions[e.name],a=this.props.form.isFieldsTouched,r={key:e.name,htmlType:"button",className:e.pullRight?"pull-right m-t-10":"m-t-10",type:e.type,disabled:a()&&e.disableWhenDirty,loading:t,onClick:this.handleAction};return n.a.createElement(B.a,vh({},r,{"data-action":e.name}),e.name)})}},{key:"render",value:function(){var e={type:"primary",htmlType:"submit",className:"w-100 m-t-20",disabled:this.state.isSubmitting,loading:this.state.isSubmitting},t=this.props,a=t.id,r=t.hideSubmitButton,o=t.saveText,i=t.fields,s=this.state.showExtraFields,c=!r,u=Object(l.filter)(i,{extra:!0}),d=Object(l.difference)(i,u);return n.a.createElement(kl.a,{id:a,className:"dynamic-form",layout:"vertical",onSubmit:this.handleSubmit},this.renderFields(d),!Object(l.isEmpty)(u)&&n.a.createElement("div",{className:"extra-options"},n.a.createElement(B.a,{type:"dashed",block:!0,className:"extra-options-button",onClick:()=>this.setState({showExtraFields:!s})},"Additional Settings",n.a.createElement("i",{className:Z()("fa m-l-5",{"fa-caret-up":s,"fa-caret-down":!s})})),n.a.createElement(dh,{collapsed:!s,className:"extra-options-content"},this.renderFields(u))),c&&n.a.createElement(B.a,e,o),this.renderActions())}}])&&wh(a.prototype,r),o&&wh(a,o),t}();_h(Ch,"propTypes",{id:D.a.string,fields:D.a.arrayOf(Ar),actions:D.a.arrayOf(Dr),feedbackIcons:D.a.bool,hideSubmitButton:D.a.bool,saveText:D.a.string,onSubmit:D.a.func,form:Ir.isRequired}),_h(Ch,"defaultProps",{id:null,fields:[],actions:[],feedbackIcons:!1,hideSubmitButton:!1,saveText:"Save",onSubmit:()=>{}});var Nh=kl.a.create()(Ch);function Th(e){return(Th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qh(){return(qh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xh(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rh(e){return(Rh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ah(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dh(e,t){return(Dh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ih(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var zh=nh.a.Step,Mh=Y.a.Search,Vh={SELECT_TYPE:0,CONFIGURE_IT:1,DONE:2},Fh=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=Rh(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Th(n)&&"function"!=typeof n?Ah(r):n,Ih(Ah(a),"state",{searchText:"",selectedType:null,savingSource:!1,currentStep:Vh.SELECT_TYPE}),Ih(Ah(a),"selectType",e=>{a.setState({selectedType:e,currentStep:Vh.CONFIGURE_IT})}),Ih(Ah(a),"resetType",()=>{a.state.currentStep===Vh.CONFIGURE_IT&&a.setState({searchText:"",selectedType:null,currentStep:Vh.SELECT_TYPE})}),Ih(Ah(a),"createSource",(e,t,r)=>{var n=a.state,o=n.selectedType;n.savingSource||(a.setState({savingSource:!0,currentStep:Vh.DONE}),a.props.onCreate(o,e).then(e=>{t("Saved."),a.props.dialog.close({success:!0,data:e})}).catch(e=>{a.setState({savingSource:!1,currentStep:Vh.CONFIGURE_IT}),r(Me(e,"Failed saving."))}))}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dh(e,t)}(t,n.a.Component),a=t,(r=[{key:"renderTypeSelector",value:function(){var e=this.props.types,t=this.state.searchText,a=e.filter(e=>Object(l.isEmpty)(t)||Object(l.includes)(e.name.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{className:"m-t-10"},n.a.createElement(Mh,{placeholder:"Search...",onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0,"data-test":"SearchSource"}),n.a.createElement("div",{className:"scrollbox p-5 m-t-10",style:{minHeight:"30vh",maxHeight:"40vh"}},Object(l.isEmpty)(a)?n.a.createElement(Ky,{className:""}):n.a.createElement(el.a,{size:"small",dataSource:a,renderItem:e=>this.renderItem(e)})))}},{key:"renderForm",value:function(){var e=this.props,t=e.imageFolder,a=e.helpTriggerPrefix,r=this.state.selectedType,o=bh.getFields(r),i="".concat(a).concat(Object(l.toUpper)(r.type));return n.a.createElement("div",null,n.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},n.a.createElement("img",{className:"p-5",src:"".concat(t,"/").concat(r.type,".png"),alt:r.name,width:"48"}),n.a.createElement("h4",{className:"m-0"},r.name)),n.a.createElement("div",{className:"text-right"},Se[i]&&n.a.createElement(Pe,{className:"f-13",type:i},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle"}))),n.a.createElement(Nh,{id:"sourceForm",fields:o,onSubmit:this.createSource,feedbackIcons:!0,hideSubmitButton:!0}),"databricks"===r.type&&n.a.createElement("small",null,"By using the Databricks Data Source you agree to the Databricks JDBC/ODBC"," ",n.a.createElement("a",{href:"https://databricks.com/spark/odbc-driver-download",target:"_blank",rel:"noopener noreferrer"},"Driver Download Terms and Conditions"),"."))}},{key:"renderItem",value:function(e){var t=this.props.imageFolder;return n.a.createElement(el.a.Item,{className:"p-l-10 p-r-10 clickable",onClick:()=>this.selectType(e)},n.a.createElement(pf,{title:e.name,imageUrl:"".concat(t,"/").concat(e.type,".png"),roundedImage:!1,"data-test":"PreviewItem","data-test-type":e.type},n.a.createElement("i",{className:"fa fa-angle-double-right"})))}},{key:"render",value:function(){var e=this.state,t=e.currentStep,a=e.savingSource,r=this.props,o=r.dialog,i=r.sourceType;return n.a.createElement(ke.a,qh({},o.props,{title:"Create a New ".concat(i),footer:t===Vh.SELECT_TYPE?[n.a.createElement(B.a,{key:"cancel",onClick:()=>o.dismiss()},"Cancel"),n.a.createElement(B.a,{key:"submit",type:"primary",disabled:!0},"Create")]:[n.a.createElement(B.a,{key:"previous",onClick:this.resetType},"Previous"),n.a.createElement(B.a,{key:"submit",htmlType:"submit",form:"sourceForm",type:"primary",loading:a,"data-test":"CreateSourceButton"},"Create")]}),n.a.createElement("div",{"data-test":"CreateSourceDialog"},n.a.createElement(nh.a,{className:"hidden-xs m-b-10",size:"small",current:t,progressDot:!0},t===Vh.CONFIGURE_IT?n.a.createElement(zh,{title:n.a.createElement("a",null,"Type Selection"),className:"clickable",onClick:this.resetType}):n.a.createElement(zh,{title:"Type Selection"}),n.a.createElement(zh,{title:"Configuration"}),n.a.createElement(zh,{title:"Done"})),t===Vh.SELECT_TYPE&&this.renderTypeSelector(),t!==Vh.SELECT_TYPE&&this.renderForm()))}}])&&xh(a.prototype,r),o&&xh(a,o),t}();Ih(Fh,"propTypes",{dialog:Te.isRequired,types:D.a.arrayOf(D.a.object),sourceType:D.a.string.isRequired,imageFolder:D.a.string.isRequired,helpTriggerPrefix:D.a.string,onCreate:D.a.func.isRequired}),Ih(Fh,"defaultProps",{types:[],helpTriggerPrefix:null});var Lh=xe(Fh);function Uh(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bh(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qh(e,t,a){return t&&Bh(e.prototype,t),a&&Bh(e,a),e}var Wh=function(){function e(t){Uh(this,e),Object(l.extend)(this,{pathPrefix:"/".concat(t.path)},Object(l.omit)(t,["isActive"])),Object(l.isFunction)(t.isActive)&&(this.isActive=t.isActive)}return Qh(e,[{key:"isActive",value:function(e){return e.startsWith(this.pathPrefix)}},{key:"isAvailable",value:function(){return void 0===this.permission||O.hasPermission(this.permission)}}]),e}(),Gh=new(function(){function e(){Uh(this,e),this.items=[]}return Qh(e,[{key:"add",value:function(e){this.items.push(new Wh(e)),this.items=Object(l.sortBy)(this.items,"order")}},{key:"getActiveItem",value:function(e){var t=Be(e);return Object(l.find)(this.items,e=>e.isActive(t))}}]),e}());var Hh=function(e,t){return e&&Gh.add(e),function(e){var a=Gh.getActiveItem(E.path);return n.a.createElement("div",{className:"settings-screen"},n.a.createElement("div",{className:"container"},n.a.createElement(fr,{title:"Settings"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(H.a,{selectedKeys:[a&&a.title],selectable:!1,mode:"horizontal"},Gh.items.filter(e=>e.isAvailable()).map(e=>n.a.createElement(H.a.Item,{key:e.title},n.a.createElement("a",{href:e.path,"data-test":"SettingsScreenItem"},e.title)))),n.a.createElement("div",{className:"p-15"},n.a.createElement("div",null,n.a.createElement(t,e))))))}};function Kh(){return(Kh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Yh(e){return(Yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jh(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xh(e){return(Xh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zh(e,t){return(Zh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var tb=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=Xh(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Yh(n)&&"function"!=typeof n?$h(r):n,eb($h(a),"state",{dataSourceTypes:[],dataSources:[],loading:!0}),eb($h(a),"newDataSourceDialog",null),eb($h(a),"createDataSource",(e,t)=>{var r={options:{},type:e.type};return bh.updateTargetWithValues(r,t),Gy.create(r).then(e=>(a.setState({loading:!0}),Gy.query().then(e=>a.setState({dataSources:e,loading:!1})),e))}),eb($h(a),"showCreateSourceDialog",()=>{Ke("view","page","data_sources/new"),a.newDataSourceDialog=Lh.showModal({types:Object(l.reject)(a.state.dataSourceTypes,"deprecated"),sourceType:"Data Source",imageFolder:Wy,helpTriggerPrefix:"DS_",onCreate:a.createDataSource}),a.newDataSourceDialog.onClose(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.newDataSourceDialog=null,e.success&&We("data_sources/".concat(e.data.id))}).onDismiss(()=>{a.newDataSourceDialog=null,We("data_sources",!0)})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zh(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Promise.all([Gy.query(),Gy.types()]).then(e=>this.setState({dataSources:e[0],dataSourceTypes:e[1],loading:!1},()=>{this.props.isNewDataSourcePage&&(Je.canCreateDataSource()?this.showCreateSourceDialog():We("data_sources",!0))})).catch(e=>this.props.onError(e))}},{key:"componentWillUnmount",value:function(){this.newDataSourceDialog&&this.newDataSourceDialog.dismiss()}},{key:"renderDataSources",value:function(){var e=this.state.dataSources,t=e.map(e=>({title:e.name,imgSrc:"".concat(Wy,"/").concat(e.type,".png"),href:"data_sources/".concat(e.id)}));return Object(l.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},"There are no data sources yet.",Je.isCreateDataSourceEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement("a",{className:"clickable",onClick:this.showCreateSourceDialog},"Click here")," ","to add one.")):n.a.createElement(ah,{items:t})}},{key:"render",value:function(){var e={type:"primary",onClick:Je.isCreateDataSourceEnabled()?this.showCreateSourceDialog:null,disabled:!Je.isCreateDataSourceEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(B.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"New Data Source"),n.a.createElement(me,{name:"DataSourcesListExtra"})),this.state.loading?n.a.createElement(Si,{className:""}):this.renderDataSources())}}])&&Jh(a.prototype,r),o&&Jh(a,o),t}();eb(tb,"propTypes",{isNewDataSourcePage:D.a.bool,onError:D.a.func}),eb(tb,"defaultProps",{isNewDataSourcePage:!1,onError:()=>{}});var ab=Hh({permission:"admin",title:"Data Sources",path:"data_sources",order:1},tb),rb=[mr({path:"/data_sources",title:"Data Sources",render:e=>n.a.createElement(ab,e)}),mr({path:"/data_sources/new",title:"Data Sources",render:e=>n.a.createElement(ab,Kh({},e,{isNewDataSourcePage:!0}))})];function nb(e){return(nb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ob(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ib(e){return(ib=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sb(e,t){return(sb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function cb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ub=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=ib(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==nb(n)&&"function"!=typeof n?lb(r):n,cb(lb(a),"state",{dataSource:null,type:null,loading:!0}),cb(lb(a),"saveDataSource",(e,t,r)=>{var n=a.state.dataSource;bh.updateTargetWithValues(n,e),Gy.save(n).then(()=>t("Saved.")).catch(e=>{var t=Object(l.get)(e,"response.data.message","Failed saving.");r(t)})}),cb(lb(a),"deleteDataSource",e=>{var t=a.state.dataSource;ke.a.confirm({title:"Delete Data Source",content:"Are you sure you want to delete this data source?",okText:"Delete",okType:"danger",onOk:()=>{Gy.delete(t).then(()=>{vl.success("Data source deleted successfully."),We("data_sources")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),cb(lb(a),"testConnection",e=>{var t=a.state.dataSource;Gy.test({id:t.id}).then(t=>{t.ok?vl.success("Success"):vl.error("Connection Test Failed:",t.message,{duration:10}),e()}).catch(()=>{vl.error("Connection Test Failed:","Unknown error occurred while performing connection test. Please try again later.",{duration:10}),e()})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sb(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Gy.get({id:this.props.dataSourceId}).then(e=>{var t=e.type;this.setState({dataSource:e}),Gy.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}},{key:"renderForm",value:function(){var e=this.state,t=e.dataSource,a=e.type,r=bh.getFields(a,t),o="DS_".concat(Object(l.toUpper)(a.type)),i={fields:r,type:a,actions:[{name:"Delete",type:"danger",callback:this.deleteDataSource},{name:"Test Connection",pullRight:!0,callback:this.testConnection,disableWhenDirty:!0}],onSubmit:this.saveDataSource,feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"DataSource"},n.a.createElement("div",{className:"text-right m-r-10"},Se[o]&&n.a.createElement(Pe,{className:"f-13",type:o},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle"}))),n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(Wy,"/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(Nh,i)))}},{key:"render",value:function(){return this.state.loading?n.a.createElement(Si,{className:""}):this.renderForm()}}])&&ob(a.prototype,r),o&&ob(a,o),t}();cb(ub,"propTypes",{dataSourceId:D.a.string.isRequired,onError:D.a.func}),cb(ub,"defaultProps",{onError:()=>{}});var db=Hh(null,ub),pb=mr({path:"/data_sources/:dataSourceId([0-9]+)",title:"Data Sources",render:e=>n.a.createElement(db,e)});function mb(){return(mb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fb(e){return(fb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yb(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hb(e){return(hb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gb(e,t){return(gb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Eb=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=hb(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==fb(n)&&"function"!=typeof n?bb(r):n,vb(bb(a),"state",{destinationTypes:[],destinations:[],loading:!0}),vb(bb(a),"createDestination",(e,t)=>{var r={options:{},type:e.type};return bh.updateTargetWithValues(r,t),os.create(r).then(e=>(a.setState({loading:!0}),os.query().then(e=>a.setState({destinations:e,loading:!1})),e))}),vb(bb(a),"showCreateSourceDialog",()=>{Lh.showModal({types:Object(l.reject)(a.state.destinationTypes,"deprecated"),sourceType:"Alert Destination",imageFolder:ns,onCreate:a.createDestination}).onClose(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.success&&We("destinations/".concat(e.data.id))}).onDismiss(()=>{We("destinations",!0)})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gb(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Promise.all([os.query(),os.types()]).then(e=>this.setState({destinations:e[0],destinationTypes:e[1],loading:!1},()=>{this.props.isNewDestinationPage&&(Je.canCreateDestination()?this.showCreateSourceDialog():We("destinations",!0))})).catch(e=>this.props.onError(e))}},{key:"renderDestinations",value:function(){var e=this.state.destinations,t=e.map(e=>({title:e.name,imgSrc:"".concat(ns,"/").concat(e.type,".png"),href:"destinations/".concat(e.id)}));return Object(l.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},"There are no alert destinations yet.",Je.isCreateDestinationEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement("a",{className:"clickable",onClick:this.showCreateSourceDialog},"Click here")," ","to add one.")):n.a.createElement(ah,{items:t})}},{key:"render",value:function(){var e={type:"primary",onClick:Je.isCreateDestinationEnabled()?this.showCreateSourceDialog:null,disabled:!Je.isCreateDestinationEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(B.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"New Alert Destination")),this.state.loading?n.a.createElement(Si,{className:""}):this.renderDestinations())}}])&&yb(a.prototype,r),o&&yb(a,o),t}();vb(Eb,"propTypes",{isNewDestinationPage:D.a.bool,onError:D.a.func}),vb(Eb,"defaultProps",{isNewDestinationPage:!1,onError:()=>{}});var Ob=Hh({permission:"admin",title:"Alert Destinations",path:"destinations",order:4},Eb),wb=[mr({path:"/destinations",title:"Alert Destinations",render:e=>n.a.createElement(Ob,e)}),mr({path:"/destinations/new",title:"Alert Destinations",render:e=>n.a.createElement(Ob,mb({},e,{isNewDestinationPage:!0}))})];function jb(e){return(jb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sb(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pb(e){return(Pb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kb(e,t){return(kb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Nb=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=Pb(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==jb(n)&&"function"!=typeof n?_b(r):n,Cb(_b(a),"state",{destination:null,type:null,loading:!0}),Cb(_b(a),"saveDestination",(e,t,r)=>{var n=a.state.destination;bh.updateTargetWithValues(n,e),os.save(n).then(()=>t("Saved.")).catch(e=>{var t=Object(l.get)(e,"response.data.message","Failed saving.");r(t)})}),Cb(_b(a),"deleteDestination",e=>{var t=a.state.destination;ke.a.confirm({title:"Delete Alert Destination",content:"Are you sure you want to delete this alert destination?",okText:"Delete",okType:"danger",onOk:()=>{os.delete(t).then(()=>{vl.success("Alert destination deleted successfully."),We("destinations")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kb(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){os.get({id:this.props.destinationId}).then(e=>{var t=e.type;this.setState({destination:e}),os.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}},{key:"renderForm",value:function(){var e=this.state,t=e.destination,a=e.type,r={fields:bh.getFields(a,t),type:a,actions:[{name:"Delete",type:"danger",callback:this.deleteDestination}],onSubmit:this.saveDestination,feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"Destination"},n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(ns,"/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(Nh,r)))}},{key:"render",value:function(){return this.state.loading?n.a.createElement(Si,{className:""}):this.renderForm()}}])&&Sb(a.prototype,r),o&&Sb(a,o),t}();Cb(Nb,"propTypes",{destinationId:D.a.string.isRequired,onError:D.a.func}),Cb(Nb,"defaultProps",{onError:()=>{}});var Tb=Hh(null,Nb),qb=mr({path:"/destinations/:destinationId([0-9]+)",title:"Alert Destinations",render:e=>n.a.createElement(Tb,e)});function xb(e){return(xb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rb(){return(Rb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ab(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Db(e){return(Db=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ib(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zb(e,t){return(zb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Vb=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=Db(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==xb(n)&&"function"!=typeof n?Ib(r):n,Mb(Ib(a),"state",{name:""}),Mb(Ib(a),"save",()=>{a.props.dialog.close({name:a.state.name})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zb(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props.dialog;return n.a.createElement(ke.a,Rb({},e.props,{title:"Create a New Group",okText:"Create",onOk:()=>this.save()}),n.a.createElement(Y.a,{className:"form-control",defaultValue:this.state.name,onChange:e=>this.setState({name:e.target.value}),onPressEnter:()=>this.save(),placeholder:"Group Name",autoFocus:!0}))}}])&&Ab(a.prototype,r),o&&Ab(a,o),t}();Mb(Vb,"propTypes",{dialog:Te.isRequired});var Fb=xe(Vb),Lb={query:()=>C.get("api/groups"),get:e=>{var t=e.id;return C.get("api/groups/".concat(t))},create:e=>C.post("api/groups",e),save:e=>C.post("api/groups/".concat(e.id),e),delete:e=>C.delete("api/groups/".concat(e.id)),members:e=>{var t=e.id;return C.get("api/groups/".concat(t,"/members"))},addMember:(e,t)=>{var a=e.id;return C.post("api/groups/".concat(a,"/members"),t)},removeMember:e=>{var t=e.id,a=e.userId;return C.delete("api/groups/".concat(t,"/members/").concat(a))},dataSources:e=>{var t=e.id;return C.get("api/groups/".concat(t,"/data_sources"))},addDataSource:(e,t)=>{var a=e.id;return C.post("api/groups/".concat(a,"/data_sources"),t)},removeDataSource:e=>{var t=e.id,a=e.dataSourceId;return C.delete("api/groups/".concat(t,"/data_sources/").concat(a))},updateDataSource:(e,t)=>{var a=e.id,r=e.dataSourceId;return C.post("api/groups/".concat(a,"/data_sources/").concat(r),t)}};function Ub(){return(Ub=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Bb(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Qb(e){var t=e.group,a=e.title,r=e.onClick,o=e.children,i=Bb(e,["group","title","onClick","children"]);if(!t)return null;var s=n.a.createElement(B.a,Ub({},i,{type:"danger",onClick:e=>(function(e,t,a){ke.a.confirm({title:"Delete Group",content:"Are you sure you want to delete this group?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{Lb.delete(t).then(()=>{vl.success("Group deleted successfully."),a()})}})})(0,t,r)}),o);return Object(l.isString)(a)&&""!==a?n.a.createElement(X.a,{placement:"top",title:a,mouseLeaveDelay:0},s):s}function Wb(){return(Wb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gb(e){return(Gb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hb(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kb(e){return(Kb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jb(e,t){return(Jb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Qb.propTypes={group:D.a.object,title:D.a.string,onClick:D.a.func,children:D.a.node},Qb.defaultProps={group:null,title:null,onClick:()=>{},children:null};var $b=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return r=this,o=(e=Kb(t)).call.apply(e,[this].concat(l)),a=!o||"object"!==Gb(o)&&"function"!=typeof o?Yb(r):o,Xb(Yb(a),"listColumns",[pn.custom((e,t)=>n.a.createElement("div",null,n.a.createElement("a",{href:"groups/"+t.id},t.name),"builtin"===t.type&&n.a.createElement("span",{className:"label label-default m-l-10"},"built-in")),{field:"name",width:null}),pn.custom((e,t)=>n.a.createElement(B.a.Group,null,n.a.createElement(B.a,{href:"groups/".concat(t.id)},"Members"),O.isAdmin&&n.a.createElement(B.a,{href:"groups/".concat(t.id,"/data_sources")},"Data Sources")),{width:"1%",className:"text-nowrap"}),pn.custom((e,t)=>{var r="builtin"!==t.type;return n.a.createElement(Qb,{className:"w-100",disabled:!r,group:t,title:r?null:"Cannot delete built-in group",onClick:()=>a.onGroupDeleted()},"Delete")},{width:"1%",className:"text-nowrap p-l-0",isAvailable:()=>O.isAdmin})]),Xb(Yb(a),"createGroup",()=>{Fb.showModal().onClose(e=>Lb.create(e).then(e=>We("groups/".concat(e.id))))}),Xb(Yb(a),"onGroupDeleted",()=>{a.props.controller.updatePagination({page:1}),a.props.controller.update()}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jb(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"GroupList"},O.isAdmin&&n.a.createElement("div",{className:"m-b-15"},n.a.createElement(B.a,{type:"primary",onClick:this.createGroup},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"New Group")),!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(Ky,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))}}])&&Hb(a.prototype,r),o&&Hb(a,o),t}();Xb($b,"propTypes",{controller:Co.isRequired});var Zb=Hh({permission:"list_users",title:"Groups",path:"groups",order:3},No($b,()=>new di({isPlainList:!0,getRequest:function(){return{}},getResource:function(){return Lb.query.bind(Lb)}}),()=>new Oi({orderByField:"name",itemsPerPage:10}))),eg=mr({path:"/groups",title:"Groups",render:e=>n.a.createElement(Zb,Wb({},e,{currentPage:"groups"}))});function tg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ag(e){var t=e.group,a=e.onChange,r=tg(e,["group","onChange"]);if(!t)return null;var o=O.isAdmin&&"builtin"!==t.type;return n.a.createElement("h3",r,n.a.createElement(fy,{className:"edit-in-place",isEditable:o,ignoreBlanks:!0,onDone:e=>(function(e,t,a){e.name=t,Lb.save(e),a()})(t,e,a),value:t.name}))}function rg(e){var t=e.controller,a=e.group,r=e.items,o=e.canAddMembers,i=e.onAddMembersClick,l=e.canAddDataSources,s=e.onAddDataSourcesClick,c=e.onGroupDeleted,u=a&&O.isAdmin&&"builtin"!==a.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Mi,{items:r,selected:t.params.currentPage}),n.a.createElement(Ui,{className:"m-b-10",options:t.pageSizeOptions,value:t.itemsPerPage,onChange:e=>t.updatePagination({itemsPerPage:e})}),o&&n.a.createElement(B.a,{className:"w-100 m-t-5",type:"primary",onClick:i},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"Add Members"),l&&n.a.createElement(B.a,{className:"w-100 m-t-5",type:"primary",onClick:s},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"Add Data Sources"),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Tl.a,{dashed:!0,className:"m-t-10 m-b-10"}),n.a.createElement(Qb,{className:"w-100",group:a,onClick:c},"Delete Group")))}function ng(){return(ng=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function og(e){return(og="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ig(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lg(e){return(lg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cg(e,t){return(cg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ug(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}ag.propTypes={group:D.a.shape({name:D.a.string.isRequired}),onChange:D.a.func},ag.defaultProps={group:null,onChange:()=>{}},rg.propTypes={controller:Co.isRequired,group:D.a.object,items:D.a.array.isRequired,canAddMembers:D.a.bool,onAddMembersClick:D.a.func,canAddDataSources:D.a.bool,onAddDataSourcesClick:D.a.func,onGroupDeleted:D.a.func},rg.defaultProps={group:null,canAddMembers:!1,onAddMembersClick:null,canAddDataSources:!1,onAddDataSourcesClick:null,onGroupDeleted:null};var dg=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=lg(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==og(o)&&"function"!=typeof o?sg(r):o,ug(sg(a),"groupId",parseInt(a.props.controller.params.groupId,10)),ug(sg(a),"group",null),ug(sg(a),"sidebarMenu",[{key:"users",href:"groups/".concat(a.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(a.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>O.isAdmin}]),ug(sg(a),"listColumns",[pn.custom((e,t)=>n.a.createElement(ff,{dataSource:t,withLink:!0}),{title:"Name",field:"name",width:null}),pn.custom((e,t)=>{var r=n.a.createElement(H.a,{selectedKeys:[t.view_only?"viewonly":"full"],onClick:e=>a.setDataSourcePermissions(t,e.key)},n.a.createElement(H.a.Item,{key:"full"},"Full Access"),n.a.createElement(H.a.Item,{key:"viewonly"},"View Only"));return n.a.createElement(L.a,{trigger:["click"],overlay:r},n.a.createElement(B.a,{className:"w-100"},t.view_only?"View Only":"Full Access",n.a.createElement(W.a,{type:"down"})))},{width:"1%",className:"p-r-0",isAvailable:()=>O.isAdmin}),pn.custom((e,t)=>n.a.createElement(B.a,{className:"w-100",type:"danger",onClick:()=>a.removeGroupDataSource(t)},"Remove"),{width:"1%",isAvailable:()=>O.isAdmin})]),ug(sg(a),"removeGroupDataSource",e=>{Lb.removeDataSource({id:a.groupId,dataSourceId:e.id}).then(()=>{a.props.controller.updatePagination({page:1}),a.props.controller.update()}).catch(()=>{vl.error("Failed to remove data source from group.")})}),ug(sg(a),"setDataSourcePermissions",(e,t)=>{var r="full"!==t;Lb.updateDataSource({id:a.groupId,dataSourceId:e.id},{view_only:r}).then(()=>{e.view_only=r,a.forceUpdate()}).catch(()=>{vl.error("Failed change data source permissions.")})}),ug(sg(a),"addDataSources",()=>{var e=Gy.query(),t=Object(l.map)(a.props.controller.allItems,e=>e.id);rs.showModal({dialogTitle:"Add Data Sources",inputPlaceholder:"Search data sources...",selectedItemsTitle:"New Data Sources",searchItems:t=>(t=Object(l.toLower)(t),e.then(e=>Object(l.filter)(e,e=>Object(l.includes)(Object(l.toLower)(e.name),t)))),renderItem:(e,a)=>{var r=a.isSelected,o=Object(l.includes)(t,e.id);return{content:n.a.createElement(ff,{dataSource:e},n.a.createElement(ls,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(ff,{dataSource:e},n.a.createElement(ls,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>Lb.addDataSource({id:a.groupId},{data_source_id:e.id}));return Promise.all(t).then(()=>a.props.controller.update())})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cg(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Lb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(ag,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(Cc,null,n.a.createElement(Cc.Sidebar,null,n.a.createElement(rg,{controller:e,group:this.group,items:this.sidebarMenu,canAddDataSources:O.isAdmin,onAddDataSourcesClick:this.addDataSources,onGroupDeleted:()=>We("groups")})),n.a.createElement(Cc.Content,null,!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no data sources in this group yet."),O.isAdmin&&n.a.createElement(B.a,{type:"primary",onClick:this.addDataSources},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"Add Data Sources")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}])&&ig(a.prototype,r),o&&ig(a,o),t}();ug(dg,"propTypes",{controller:Co.isRequired});var pg=Hh(null,No(dg,()=>new di({isPlainList:!0,getRequest:function(e,t){return{id:t.params.groupId}},getResource:function(){return Lb.dataSources.bind(Lb)}}),()=>new Oi({orderByField:"name"}))),mg=mr({path:"/groups/:groupId([0-9]+)/data_sources",title:"Group Data Sources",render:e=>n.a.createElement(pg,ng({},e,{currentPage:"datasources"}))});function fg(){return(fg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function yg(e){return(yg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hg(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bg(e){return(bg=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vg(e,t){return(vg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Eg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Og=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=bg(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==yg(o)&&"function"!=typeof o?gg(r):o,Eg(gg(a),"groupId",parseInt(a.props.controller.params.groupId,10)),Eg(gg(a),"group",null),Eg(gg(a),"sidebarMenu",[{key:"users",href:"groups/".concat(a.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(a.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>O.isAdmin}]),Eg(gg(a),"listColumns",[pn.custom((e,t)=>n.a.createElement(mf,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),pn.custom((e,t)=>a.group?"builtin"===a.group.type&&O.id===t.id?null:n.a.createElement(B.a,{className:"w-100",type:"danger",onClick:e=>a.removeGroupMember(e,t)},"Remove"):null,{width:"1%",isAvailable:()=>O.isAdmin})]),Eg(gg(a),"removeGroupMember",(e,t)=>Lb.removeMember({id:a.groupId,userId:t.id}).then(()=>{a.props.controller.updatePagination({page:1}),a.props.controller.update()}).catch(()=>{vl.error("Failed to remove member from group.")})),Eg(gg(a),"addMembers",()=>{var e=Object(l.map)(a.props.controller.allItems,e=>e.id);rs.showModal({dialogTitle:"Add Members",inputPlaceholder:"Search users...",selectedItemsTitle:"New Members",searchItems:e=>Ef.query({q:e}).then(e=>{return e.results}),renderItem:(t,a)=>{var r=a.isSelected,o=Object(l.includes)(e,t.id);return{content:n.a.createElement(mf,{user:t},n.a.createElement(ls,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(mf,{user:e},n.a.createElement(ls,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>Lb.addMember({id:a.groupId},{user_id:e.id}));return Promise.all(t).then(()=>a.props.controller.update())})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vg(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Lb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(ag,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(Cc,null,n.a.createElement(Cc.Sidebar,null,n.a.createElement(rg,{controller:e,group:this.group,items:this.sidebarMenu,canAddMembers:O.isAdmin,onAddMembersClick:this.addMembers,onGroupDeleted:()=>We("groups")})),n.a.createElement(Cc.Content,null,!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no members in this group yet."),O.isAdmin&&n.a.createElement(B.a,{type:"primary",onClick:this.addMembers},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"Add Members")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}])&&hg(a.prototype,r),o&&hg(a,o),t}();Eg(Og,"propTypes",{controller:Co.isRequired});var wg=Hh(null,No(Og,()=>new di({isPlainList:!0,getRequest:function(e,t){return{id:t.params.groupId}},getResource:function(){return Lb.members.bind(Lb)}}),()=>new Oi({orderByField:"name"}))),jg=mr({path:"/groups/:groupId([0-9]+)",title:"Group Members",render:e=>n.a.createElement(wg,fg({},e,{currentPage:"users"}))}),Sg={get:()=>C.get("api/settings/organization"),save:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Settings changes saved.";return C.post("api/settings/organization",e).then(e=>(vl.success(t),e)).catch(()=>{vl.error("Failed saving changes.")})}};function Pg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _g=yu.a.Text;var kg=function(){var e=Pg(Object(r.useState)(!1),2),t=e[0],a=e[1];if(!w.showBeaconConsentMessage||t)return null;var o=()=>{w.showBeaconConsentMessage=!1,a(!0)},i=e=>{var t="🙏 Thank you.";e||(t="Settings Saved."),Sg.save({beacon_consent:e},t).finally(o)};return n.a.createElement(me,{name:"BeaconConsent"},n.a.createElement("div",{className:"m-t-10 tiled"},n.a.createElement(vr.a,{title:n.a.createElement(n.a.Fragment,null,"Would you be ok with sharing anonymous usage data with the Redash team?"," ",n.a.createElement(Pe,{type:"USAGE_DATA_SHARING"})),bordered:!1},n.a.createElement(_g,null,"Help Redash improve by automatically sending anonymous usage data:"),n.a.createElement("div",{className:"m-t-5"},n.a.createElement("ul",null,n.a.createElement("li",null," Number of users, queries, dashboards, alerts, widgets and visualizations."),n.a.createElement("li",null," Types of data sources, alert destinations and visualizations."))),n.a.createElement(_g,null,"All data is aggregated and will never include any sensitive or private data."),n.a.createElement("div",{className:"m-t-5"},n.a.createElement(B.a,{type:"primary",className:"m-r-5",onClick:()=>i(!0)},"Yes"),n.a.createElement(B.a,{type:"default",onClick:()=>i(!1)},"No")),n.a.createElement("div",{className:"m-t-15"},n.a.createElement(_g,{type:"secondary"},"You can change this setting anytime from the ",n.a.createElement("a",{href:"settings/organization"},"Organization Settings")," ","page.")))))};a(1543);function Cg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ng(){return n.a.createElement(T.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"You have enabled ",n.a.createElement("code",null,"ALLOW_PARAMETERS_IN_EMBEDS"),". This setting is now deprecated and should be turned off. Parameters in embeds are supported by default."," ",n.a.createElement("a",{href:"https://discuss.redash.io/t/support-for-parameters-in-embedded-visualizations/3337",target:"_blank",rel:"noopener noreferrer"},"Read more"),".")})}function Tg(){return n.a.createElement(T.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"We have sent an email with a confirmation link to your email address. Please follow the link to verify your email address."," ",n.a.createElement("a",{className:"clickable",onClick:()=>{C.post("verification_email/").then(e=>{vl.success(e.message)})}},"Resend email"),".")})}function qg(e){var t=e.title,a=e.resource,o=e.itemUrl,i=e.emptyState,s=Cg(Object(r.useState)([]),2),c=s[0],u=s[1],d=Cg(Object(r.useState)(!0),2),p=d[0],m=d[1];return Object(r.useEffect)(()=>{m(!0),a.favorites().then(e=>{var t=e.results;return u(t)}).finally(()=>m(!1))},[a]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex align-items-center m-b-20"},n.a.createElement("p",{className:"flex-fill f-500 c-black m-0"},t),p&&n.a.createElement(W.a,{type:"loading"})),!Object(l.isEmpty)(c)&&n.a.createElement("div",{className:"list-group"},c.map(e=>n.a.createElement("a",{key:o(e),className:"list-group-item",href:o(e)},n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),e.name,e.is_draft&&n.a.createElement("span",{className:"label label-default m-l-5"},"Unpublished")))),Object(l.isEmpty)(c)&&!p&&i)}function xg(){return n.a.createElement("div",{className:"tile"},n.a.createElement("div",{className:"t-body tb-padding"},n.a.createElement("div",{className:"row home-favorites-list"},n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(qg,{title:"Favorite Dashboards",resource:Ka,itemUrl:e=>"dashboard/".concat(e.slug),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement("a",{href:"dashboards"},"Dashboards")," will appear here")})),n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(qg,{title:"Favorite Queries",resource:Qt,itemUrl:e=>"queries/".concat(e.id),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favourite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement("a",{href:"queries"},"Queries")," will appear here")})))))}function Rg(){return Object(r.useEffect)(()=>{Ke("view","page","personal_homepage")},[]),n.a.createElement("div",{className:"home-page"},n.a.createElement("div",{className:"container"},Object(l.includes)(j,"using-deprecated-embed-feature")&&n.a.createElement(Ng,null),Object(l.includes)(j,"email-not-verified")&&n.a.createElement(Tg,null),n.a.createElement(ks,{header:"Welcome to Redash 👋",description:"Connect to any data source, easily visualize and share your data",illustration:"dashboard",helpLink:"https://redash.io/help/user-guide/getting-started",showDashboardStep:!0,showInviteStep:!0,onboardingMode:!0}),n.a.createElement(me,{name:"HomeExtra"}),n.a.createElement(xg,null),n.a.createElement(kg,null)))}qg.propTypes={title:D.a.string.isRequired,resource:D.a.func.isRequired,itemUrl:D.a.func.isRequired,emptyState:D.a.node},qg.defaultProps={emptyState:null};var Ag=mr({path:"/",title:"Redash",render:e=>n.a.createElement(Rg,e)}),Dg=a(132),Ig=a.n(Dg),zg=a(393),Mg=a.n(zg),Vg=a(386);a(1548);function Fg(){return(Fg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ug(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bg(e){var t=e.toggleShortcut,a=e.direction,o=e.sizeAttribute,i=e.children,l=Ug(Object(r.useState)(0),2),s=l[0],c=l[1],u=Object(r.useRef)(),d=Object(r.useRef)(!1),p=Object(r.useRef)(!1),m="horizontal"===a?"width":"height";o=o||m;var f=Object(r.useCallback)(()=>u.current?Math.floor(u.current.getBoundingClientRect()[m]):0,[m]),y=Object(r.useRef)(null),h=Object(r.useCallback)(()=>{if(u.current){var e,t=Mg.a.select(u.current);null===y.current?(e="0px",y.current="".concat(f(),"px")):(e=y.current,y.current=null),t.style(o,y.current||"0px").transition().duration(200).ease("swing").style(o,e),c(parseInt(e)||0)}},[f,o]),b=Object(r.useMemo)(()=>n.a.createElement("span",{className:"react-resizable-handle react-resizable-handle-".concat(a),onClick:()=>{!d.current&&p.current||h(),d.current=!1,p.current=!1}}),[a,h]);Object(r.useEffect)(()=>{if(t){var e=Lg({},t,h);return tu.bind(e),()=>{tu.unbind(e)}}},[t,h]);var g=Object(r.useMemo)(()=>({onResizeStart:()=>{c(f())},onResize:(e,t)=>{Mg.a.select(u.current).style(o,"".concat(t.size[m],"px")),c(t.size[m]),p.current=!0},onResizeStop:()=>{p.current&&(y.current=null)}}),[m,f,o]),v=Object(r.useMemo)(()=>({onMouseDown:e=>{"touchstart"===e.type&&(d.current=!0),c(f())}}),[f]);return i?(i=n.a.createElement(i.type,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Lg(e,t,a[t])})}return e}({},i.props,{ref:u})),n.a.createElement(Vg.Resizable,Fg({className:"resizable-component",axis:"horizontal"===a?"x":"y",resizeHandles:["horizontal"===a?"e":"s"],handle:b,width:"horizontal"===a?s:0,height:"vertical"===a?s:0,minConstraints:[0,0]},g,{draggableOpts:v}),i)):null}Bg.propTypes={direction:D.a.oneOf(["horizontal","vertical"]),sizeAttribute:D.a.string,toggleShortcut:D.a.string,children:D.a.element},Bg.defaultProps={direction:"horizontal",sizeAttribute:null,toggleShortcut:null,children:null};var Qg=a(183),Wg=a.n(Qg),Gg=(a(1549),a(1550),a(1552),a(1553),a(1554),a(1555),a(1556),Wg.a.acequire("ace/ext/language_tools")),Hg=Wg.a.acequire("ace/snippets");function Kg(e){Wg.a.define("ace/snippets/".concat(e),["require","exports","module"],(t,a)=>{a.snippetText="",a.scope=e})}Kg("python"),Kg("sql"),Kg("json"),Kg("yaml");var Yg={};function Jg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Yg[e]=Object(l.isNil)(t)?null:function(e){var t=[],a={},r={};return e.forEach(e=>{t.push({name:e.name,value:e.name,score:100,meta:"Table"}),r[e.name]=function(e){var t=[];return e.columns.forEach(a=>{t.push({caption:a,name:"".concat(e.name,".").concat(a),value:"".concat(e.name,".").concat(a),score:100,meta:"Column",className:"completion"})}),t}(e),e.columns.forEach(e=>{a[e]="Column"})}),{table:t,column:Object(l.map)(a,(e,t)=>({name:t,value:t,score:50,meta:e})),tableColumn:r}}(t)}Gg.setCompleters([Gg.snippetCompleter,Gg.keyWordCompleter,Gg.textCompleter,{identifierRegexps:[/[a-zA-Z_0-9.\-\u00A2-\uFFFF]/],getCompletions:(e,t,a,r,n)=>{var o=Yg[e.id]||{table:[],column:[],tableColumn:[]},i=o.table,l=o.column,s=o.tableColumn;if(0!==r.length&&0!==i.length)if("."!==r[r.length-1])n(null,i.concat(l));else{var c=r.substring(0,r.length-1);n(null,i.concat(s[c]))}else n(null,[])}}]);var Xg=new Map;function $g(){Xg.size>0&&(Xg.forEach((e,t)=>{var a=t.getBoundingClientRect(),r=Math.round(10*a.width),n=Math.round(10*a.height);e.width===r&&e.height===n||(e.width=r,e.height=n,e.callback(t))}),setTimeout($g,100))}function Zg(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ev=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object(l.extend)(this,t)}var t,a,r;return t=e,(a=[{key:"getSnippet",value:function(){var e=this.trigger;return""!==this.description&&(e="".concat(this.trigger,": ").concat(this.description)),{name:e,content:this.snippet,tabTrigger:this.trigger}}}])&&Zg(t.prototype,a),r&&Zg(t,r),e}(),tv=e=>new ev(e),av={get:e=>C.get("api/query_snippets/".concat(e.id)).then(tv),query:()=>C.get("api/query_snippets").then(e=>Object(l.map)(e,tv)),create:e=>C.post("api/query_snippets",e).then(tv),save:e=>C.post("api/query_snippets/".concat(e.id),e).then(tv),delete:e=>C.delete("api/query_snippets/".concat(e.id))};a(1557);function rv(e){var t=e.available,a=e.enabled,o=e.onToggle,i="Live Autocomplete Enabled",l="icon-flash";a||(i="Live Autocomplete Disabled",l="icon-flash-off"),t||(i="Live Autocomplete Not Available (Use Ctrl+Space to Trigger)",l="icon-flash-off");var s=Object(r.useCallback)(()=>{Ke("toggle_autocomplete","screen","query_editor",{state:!a}),o(!a)},[a,o]);return n.a.createElement(X.a,{placement:"top",title:i},n.a.createElement(B.a,{className:"query-editor-controls-button m-r-5",disabled:!t,onClick:s},n.a.createElement("i",{className:"icon "+l})))}rv.propTypes={available:D.a.bool.isRequired,enabled:D.a.bool.isRequired,onToggle:D.a.func.isRequired};a(1558);function nv(){return(nv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ov(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function iv(e){var t=e.title,a=e.shortcut,r=ov(e,["title","shortcut"]);return a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a={mod:Object(l.upperFirst)(Xc),alt:Object(l.upperFirst)($c)};return e=Object(l.toLower)(Object(l.toString)(e)),e=Object(l.filter)(Object(l.map)(e.split(","),l.trim),e=>""!==e).slice(0,t),""!==(e=Object(l.map)(e,e=>(e=Object(l.filter)(Object(l.map)(e.split("+")),e=>""!==e),Object(l.map)(e,e=>a[e]||Object(l.upperFirst)(e)).join(" + "))).join(", "))?e:null}(a,1),t=t&&a?n.a.createElement(n.a.Fragment,null,t," (",n.a.createElement("i",null,a),")"):t||a,n.a.createElement(X.a,nv({placement:"top",title:t},r))}function lv(e){var t=e.addParameterButtonProps,a=e.formatButtonProps,o=e.saveButtonProps,i=e.executeButtonProps,s=e.autocompleteToggleProps,c=e.dataSourceSelectorProps;return Object(r.useEffect)(()=>{var e=Object(l.filter)([t,a,o,i],e=>e.shortcut&&!e.disabled&&Object(l.isFunction)(e.onClick));if(e.length>0){var r=Object(l.fromPairs)(Object(l.map)(e,e=>[e.shortcut,e.onClick]));return tu.bind(r),()=>{tu.unbind(r)}}},[t,a,o,i]),n.a.createElement("div",{className:"query-editor-controls"},!1!==t&&n.a.createElement(iv,{title:t.title,shortcut:t.shortcut},n.a.createElement(B.a,{className:"query-editor-controls-button m-r-5",disabled:t.disabled,onClick:t.onClick},"{{"," ","}}")),!1!==a&&n.a.createElement(iv,{title:a.title,shortcut:a.shortcut},n.a.createElement(B.a,{className:"query-editor-controls-button m-r-5",disabled:a.disabled,onClick:a.onClick},n.a.createElement("span",{className:"zmdi zmdi-format-indent-increase"}),a.text)),!1!==s&&n.a.createElement(rv,{available:s.available,enabled:s.enabled,onToggle:s.onToggle}),!1===c&&n.a.createElement("span",{className:"query-editor-controls-spacer"}),!1!==c&&n.a.createElement(Ln.a,{className:"w-100 flex-fill datasource-small",disabled:c.disabled,value:c.value,onChange:c.onChange},Object(l.map)(c.options,e=>n.a.createElement(Ln.a.Option,{key:"option-".concat(e.value),value:e.value},e.label))),!1!==o&&n.a.createElement(iv,{title:o.title,shortcut:o.shortcut},n.a.createElement(B.a,{className:"query-editor-controls-button m-l-5",disabled:o.disabled,loading:o.loading,onClick:o.onClick,"data-test":"SaveButton"},!o.loading&&n.a.createElement("span",{className:"fa fa-floppy-o"}),o.text)),!1!==i&&n.a.createElement(iv,{title:i.title,shortcut:i.shortcut},n.a.createElement(B.a,{className:"query-editor-controls-button m-l-5",type:"primary",disabled:i.disabled,onClick:i.onClick,"data-test":"ExecuteButton"},n.a.createElement("span",{className:"zmdi zmdi-play"}),i.text)))}iv.propTypes={title:D.a.node,shortcut:D.a.string},iv.defaultProps={title:null,shortcut:null};var sv=D.a.oneOfType([D.a.bool,D.a.shape({title:D.a.node,disabled:D.a.bool,loading:D.a.bool,onClick:D.a.func,text:D.a.node,shortcut:D.a.string})]);lv.propTypes={addParameterButtonProps:sv,formatButtonProps:sv,saveButtonProps:sv,executeButtonProps:sv,autocompleteToggleProps:D.a.oneOfType([D.a.bool,D.a.shape({available:D.a.bool,enabled:D.a.bool,onToggle:D.a.func})]),dataSourceSelectorProps:D.a.oneOfType([D.a.bool,D.a.shape({disabled:D.a.bool,value:D.a.oneOfType([D.a.string,D.a.number]),options:D.a.arrayOf(D.a.shape({value:D.a.oneOfType([D.a.string,D.a.number]),label:D.a.node})),onChange:D.a.func})])},lv.defaultProps={addParameterButtonProps:!1,formatButtonProps:!1,saveButtonProps:!1,executeButtonProps:!1,autocompleteToggleProps:!1,dataSourceSelectorProps:!1};a(1559);function cv(){return(cv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function dv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var pv={$blockScrolling:1/0},mv=n.a.forwardRef(function(e,t){var a=e.className,o=e.syntax,i=e.value,l=e.autocompleteEnabled,s=e.schema,c=e.onChange,u=e.onSelectionChange,d=dv(e,["className","syntax","value","autocompleteEnabled","schema","onChange","onSelectionChange"]),p=uv(Object(r.useState)(null),2),m=p[0],f=p[1],y=uv(Object(r.useState)(null),2),h=y[0],b=y[1],g=uv(Object(r.useState)(i),2),v=g[0],E=g[1];Object(r.useEffect)(()=>{E(i)},[i]);var O=Object(r.useCallback)(e=>{E(e),c(e)},[c]),w=Object(r.useMemo)(()=>({behavioursEnabled:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:l,autoScrollEditorIntoView:!0}),[l]);Object(r.useEffect)(()=>{if(h){var e=h.editor.id;return Jg(e,s),()=>{Jg(e,null)}}},[s,h]),Object(r.useEffect)(()=>{function e(){h&&h.editor.resize()}if(m)return e(),function(e,t){if(e&&!Xg.has(e)){var a=0===Xg.size;return Xg.set(e,{callback:t}),a&&$g(),()=>Xg.delete(e)}return()=>{}}(m,e)},[m,h]);var j=Object(r.useCallback)(e=>{var t=h.editor.session.doc.getTextRange(e.getRange()),a=t.length>1?t:null;u(a)},[h,u]),S=Object(r.useCallback)(e=>{e.commands.bindKey({win:"Ctrl+L",mac:"Cmd+L"},null),e.commands.bindKey({win:"Ctrl+Shift+F",mac:"Cmd+Shift+F"},null),e.commands.bindKey({win:"Ctrl+P",mac:null},null),e.commands.bindKey({win:null,mac:"Ctrl+P"},"golineup"),e.commands.on("afterExec",t=>{"insertstring"===t.command.name&&"."===t.args&&e.completer&&e.completer.showPopup(e)}),av.query().then(e=>{var t=Hg.snippetManager,a={snippetText:""};a.snippets=t.parseSnippetFile(a.snippetText),e.forEach(e=>{a.snippets.push(e.getSnippet())}),t.register(a.snippets||[],a.scope)}),e.focus()},[]);return Object(r.useImperativeHandle)(t,()=>({paste:e=>{if(h){var t=h.editor;t.session.doc.replace(t.selection.getRange(),e);var a=t.selection.getRange();c(t.session.getValue()),t.selection.setRange(a)}},focus:()=>{h&&h.editor.focus()}}),[h,c]),n.a.createElement("div",cv({className:Z()("query-editor-container",a)},d,{ref:f}),n.a.createElement(mh.a,{ref:b,theme:"textmate",mode:o||"sql",value:v,editorProps:pv,width:"100%",height:"100%",setOptions:w,showPrintMargin:!1,wrapEnabled:!1,onLoad:S,onChange:O,onSelectionChange:j}))});mv.propTypes={className:D.a.string,syntax:D.a.string,value:D.a.string,autocompleteEnabled:D.a.bool,schema:D.a.arrayOf(D.a.shape({name:D.a.string.isRequired,size:D.a.number,columns:D.a.arrayOf(D.a.string).isRequired})),onChange:D.a.func,onSelectionChange:D.a.func},mv.defaultProps={className:null,syntax:null,value:null,autocompleteEnabled:!0,schema:[],onChange:()=>{},onSelectionChange:()=>{}},mv.Controls=lv;var fv=mv;function yv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||{view_only:!0},Object(r.useMemo)(()=>({isNew:Object(l.isNil)(e.id),isDraft:e.is_draft,isArchived:e.is_archived,canCreate:O.hasPermission("create_query"),canView:O.hasPermission("view_query"),canEdit:O.hasPermission("edit_query")&&e.can_edit,canViewSource:O.hasPermission("view_source"),canExecute:!Object(l.isEmpty)(e.query)&&(e.is_safe||O.hasPermission("execute_query")&&!t.view_only),canFork:O.hasPermission("edit_query")&&!t.view_only,canSchedule:O.hasPermission("schedule_query")}),[e,t.view_only])}function hv(e,t){var a=Object(r.useRef)();return a.current=Object(l.isFunction)(t)?t:()=>{},Object(r.useCallback)(()=>{new Promise((e,t)=>{ke.a.confirm({title:"Archive Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"Are you sure you want to archive this query?"),n.a.createElement("div",null,"All alerts and dashboard widgets created with its visualizations will be deleted.")),okText:"Archive",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>(function(e){return Qt.delete({id:e.id}).then(()=>Object(l.extend)(e.clone(),{is_archived:!0,schedule:null})).catch(e=>(vl.error("Query could not be archived."),Promise.reject(e)))})(e)).then(e=>{a.current(e)})},[e])}a(1560);function bv(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){vv(e,t,a[t])})}return e}function vv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ev(e){return(Ev="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ov(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wv(e,t){return!t||"object"!==Ev(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jv(e){return(jv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sv(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pv(e,t)}function Pv(e,t){return(Pv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _v(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}var kv=function(e){function t(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Ov(this,t),(a=wv(this,jv(t).call(this,e))).detailedMessage=r,a}return Sv(t,_v(Error)),t}(),Cv=function(e){function t(){return Ov(this,t),wv(this,jv(t).call(this,"Changes not saved",n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Please copy/backup your changes and reload this page."))))}return Sv(t,kv),t}();function Nv(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).canOverwrite,a=void 0!==t&&t;return Object(l.isObject)(e.options)&&e.options.parameters&&(e.options=gv({},e.options,{parameters:Object(l.map)(e.options.parameters,e=>e.toSaveableObject())})),Qt.save(e).catch(t=>409===Object(l.get)(t,"response.status")?a?new Promise((e,t)=>{ke.a.confirm({title:"Overwrite Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Are you sure you want to overwrite the query with your version?")),okText:"Overwrite",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>Qt.save(Object(l.omit)(e,["version"]))).catch(()=>Promise.reject(new Cv)):Promise.reject(new Cv):Promise.reject(new kv("Query could not be saved")))}function Tv(e,t){var a=Object(r.useRef)();return a.current=Object(l.isFunction)(t)?t:()=>{},Object(r.useCallback)(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).successMessage,n=void 0===r?"Query saved":r;if(Object(l.isObject)(t)){if(e.isNew())return void a.current(Object(l.extend)(e.clone(),t));t=gv({},t,{id:e.id,version:e.version})}else t=Object(l.pick)(e,["id","version","schedule","query","description","name","data_source_id","options","latest_query_data_id","is_draft"]);return Nv(t,{canOverwrite:e.can_edit}).then(r=>{Object(l.isNil)(n)||vl.success(n),a.current(Object(l.extend)(e.clone(),r.id!==e.id?r:Object(l.pick)(r,Object(l.uniq)(["id","version"].concat(bv(Object(l.keys)(t)))))))}).catch(e=>{var t={};e instanceof Cv&&(t.duration=null),vl.error(e.message,e.detailedMessage,t)})},[e])}function qv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}a(1562);function xv(e){return(xv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rv(){return(Rv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Av(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Dv(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Iv(e){return(Iv=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zv(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mv(e,t){return(Mv=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Fv=function(e){function t(e){var a,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=Iv(t).call(this,e),a=!o||"object"!==xv(o)&&"function"!=typeof o?zv(r):o,Vv(zv(a),"state",{copied:null}),Vv(zv(a),"copy",()=>{window.getSelection().selectAllChildren(a.ref.current);try{if(!document.execCommand("copy"))throw new Error;a.setState({copied:"Copied!"})}catch(e){a.setState({copied:"Copy failed"})}window.getSelection().removeAllRanges(),a.resetCopyState=setTimeout(()=>a.setState({copied:null}),2e3)}),a.ref=n.a.createRef(),a.copyFeatureEnabled=e.copyable&&document.queryCommandSupported("copy"),a.resetCopyState=null,a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mv(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentWillUnmount",value:function(){this.resetCopyState&&clearTimeout(this.resetCopyState)}},{key:"render",value:function(){var e=this.props,t=(e.copyable,e.children),a=Av(e,["copyable","children"]),r=n.a.createElement(X.a,{title:this.state.copied||"Copy"},n.a.createElement(B.a,{icon:"copy",type:"dashed",size:"small",onClick:this.copy}));return n.a.createElement("div",{className:"code-block"},n.a.createElement("code",Rv({},a,{ref:this.ref}),t),this.copyFeatureEnabled&&r)}}])&&Dv(a.prototype,r),o&&Dv(a,o),t}();Vv(Fv,"propTypes",{copyable:D.a.bool,children:D.a.node}),Vv(Fv,"defaultProps",{copyable:!1,children:null});a(1563);function Lv(){return(Lv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Uv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Qv(e){var t=e.dialog,a=Bv(e,["dialog"]),o=Uv(Object(r.useState)(a.query),2),i=o[0],s=o[1],c=Uv(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useCallback)(()=>{d(!0),C.post("api/queries/".concat(i.id,"/regenerate_api_key")).then(e=>{d(!1),s(Object(l.extend)(i.clone(),{api_key:e.api_key}))}).catch(()=>{d(!1),vl.error("Failed to update API key")})},[i]),m=Object(r.useMemo)(()=>({csvUrl:"".concat(w.basePath,"api/queries/").concat(i.id,"/results.csv?api_key=").concat(i.api_key),jsonUrl:"".concat(w.basePath,"api/queries/").concat(i.id,"/results.json?api_key=").concat(i.api_key)}),[i.id,i.api_key]),f=m.csvUrl,y=m.jsonUrl;return n.a.createElement(ke.a,Lv({},t.props,{width:600,footer:n.a.createElement(B.a,{onClick:()=>t.close(i)},"Close")}),n.a.createElement("div",{className:"query-api-key-dialog-wrapper"},n.a.createElement("h5",null,"API Key"),n.a.createElement("div",{className:"m-b-20"},n.a.createElement(Y.a.Group,{compact:!0},n.a.createElement(Y.a,{readOnly:!0,value:i.api_key}),i.can_edit&&n.a.createElement(B.a,{disabled:u,loading:u,onClick:p},"Regenerate"))),n.a.createElement("h5",null,"Example API Calls:"),n.a.createElement("div",{className:"m-b-10"},n.a.createElement("label",null,"Results in CSV format:"),n.a.createElement(Fv,{copyable:!0},f)),n.a.createElement("div",null,n.a.createElement("label",null,"Results in JSON format:"),n.a.createElement(Fv,{copyable:!0},y))))}Qv.propTypes={dialog:Te.isRequired,query:D.a.shape({id:D.a.number.isRequired,api_key:D.a.string,can_edit:D.a.bool}).isRequired};var Wv=xe(Qv);a(1564);function Gv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Hv(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Kv(){return _i("api/queries/tags").then(e=>Object(l.map)(e,e=>e.name))}function Yv(e){var t=e.query,a=e.dataSource,o=e.sourceMode,i=e.selectedVisualization,s=e.headerExtra,c=e.tagsExtra,u=e.onChange,d=Ig()({minWidth:768}),p=yv(t,a),m=function(e,t){var a=Tv(e,t);return Object(r.useCallback)(t=>{Ke("edit_name","query",e.id);var r={name:t},n={};e.is_draft&&w.autoPublishNamedQueries&&"New Query"!==t&&(r.is_draft=!1,n.successMessage="Query saved and published"),a(r,n)},[e.id,e.is_draft,a])}(t,u),f=function(e,t){var a=Tv(e,t);return Object(r.useCallback)(t=>{Ke("edit_tags","query",e.id),a({tags:t})},[e.id,a])}(t,u),y=hv(t,u),h=function(e,t){var a=Tv(e,t);return Object(r.useCallback)(()=>{Ke("toggle_published","query",e.id),a({is_draft:!1})},[e.id,a])}(t,u),b=function(e,t){var a=Tv(e,t);return Object(r.useCallback)(()=>{Ke("toggle_published","query",e.id),a({is_draft:!0})},[e.id,a])}(t,u),g=Gv(function(e){var t=qv(Object(r.useState)(!1),2),a=t[0],n=t[1],o=Object(r.useCallback)(()=>{var t="duplicatedQueryTab/".concat(Math.random().toString()),a=window.open("",t);n(!0),Qt.fork({id:e.id}).then(e=>{a.location=e.getUrl(!0)}).finally(()=>{n(!1)})},[e.id]);return[a,a?l.noop:o]}(t),2),v=g[0],E=g[1],O=function(e,t){var a=Object(r.useRef)();return a.current=Object(l.isFunction)(t)?t:()=>{},Object(r.useCallback)(()=>{Wv.showModal({query:e}).onClose(e=>{a.current(e)})},[e])}(t,u),j=function(e){return Object(r.useCallback)(()=>{Tf.showModal({aclUrl:"api/queries/".concat(e.id,"/acl"),context:"query",author:e.user})},[e.id,e.user])}(t),S=Object(r.useMemo)(()=>(function(e){var t={},a=Object(l.map)(e,e=>Object(l.filter)(Object(l.map)(e,(e,a)=>(e=Object(l.extend)({isAvailable:!0,isEnabled:!0,onClick:()=>{}},e)).isAvailable?(t[a]=e.onClick,n.a.createElement(H.a.Item,{key:a,disabled:!e.isEnabled},e.title)):null)));return n.a.createElement(H.a,{onClick:e=>{var a=e.key;return t[a]()}},Object(l.reduce)(Object(l.filter)(a,e=>e.length>0),(e,t,a)=>{var r=e.length>0?n.a.createElement(H.a.Divider,{key:"divider".concat(a)}):null;return[].concat(Hv(e),[r],Hv(t))},[]))})([{fork:{isEnabled:!p.isNew&&p.canFork&&!v,title:n.a.createElement(n.a.Fragment,null,"Fork",n.a.createElement("i",{className:"fa fa-external-link m-l-5"})),onClick:E}},{archive:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived,title:"Archive",onClick:y},managePermissions:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived&&w.showPermissionsControl,title:"Manage Permissions",onClick:j},publish:{isAvailable:!d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit,title:"Publish",onClick:h},unpublish:{isAvailable:!p.isNew&&p.canEdit&&!p.isDraft,title:"Unpublish",onClick:b}},{showAPIKey:{isAvailable:!p.isNew,title:"Show API Key",onClick:O}}]),[p.isNew,p.canFork,p.canEdit,p.isArchived,p.isDraft,v,E,y,j,d,h,b,O]);return n.a.createElement("div",{className:"query-page-header"},n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement("div",{className:"d-flex align-items-center"},!p.isNew&&n.a.createElement(Tr,{item:t}),n.a.createElement("h3",null,n.a.createElement(fy,{isEditable:p.canEdit,onDone:m,ignoreBlanks:!0,value:t.name})))),n.a.createElement("div",{className:"query-tags"},n.a.createElement(io,{tags:t.tags,isDraft:p.isDraft,isArchived:p.isArchived,canEdit:p.canEdit,getAvailableTags:Kv,onEdit:f,tagsExtra:c}))),n.a.createElement("div",{className:"header-actions"},s,d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit&&n.a.createElement(B.a,{className:"m-r-5",onClick:h},n.a.createElement("i",{className:"fa fa-paper-plane m-r-5"})," Publish"),!p.isNew&&p.canViewSource&&n.a.createElement("span",null,!o&&n.a.createElement(B.a,{className:"m-r-5",href:t.getUrl(!0,i)},n.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Edit Source")),o&&n.a.createElement(B.a,{className:"m-r-5",href:t.getUrl(!1,i),"data-test":"QueryPageShowDataOnly"},n.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Show Data Only"))),!p.isNew&&n.a.createElement(L.a,{overlay:S,trigger:["click"]},n.a.createElement(B.a,null,n.a.createElement(W.a,{type:"ellipsis",rotate:90})))))}Yv.propTypes={query:D.a.shape({id:D.a.number,name:D.a.string,tags:D.a.arrayOf(D.a.string)}).isRequired,dataSource:D.a.object,sourceMode:D.a.bool,selectedVisualization:D.a.number,headerExtra:D.a.node,tagsExtra:D.a.node,onChange:D.a.func},Yv.defaultProps={dataSource:null,sourceMode:!1,selectedVisualization:null,headerExtra:null,tagsExtra:null,onChange:()=>{}};a(1565);function Jv(e){var t=e.query,a=e.dataSource,r=e.layout,o=e.onEditSchedule;return n.a.createElement("div",{className:"query-metadata query-metadata-".concat(r)},n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.user.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:Z()("query-metadata-label",{"text-muted":t.user.is_disabled})},t.user.name),n.a.createElement("span",{className:"query-metadata-value"},"created"," ",n.a.createElement("strong",null,n.a.createElement(Wr,{date:t.created_at}))))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.last_modified_by.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:Z()("query-metadata-label",{"text-muted":t.last_modified_by.is_disabled})},t.last_modified_by.name),n.a.createElement("span",{className:"query-metadata-value"},"updated"," ",n.a.createElement("strong",null,n.a.createElement(Wr,{date:t.updated_at}))))),n.a.createElement("div",{className:"query-metadata-space"}),a&&n.a.createElement("div",{className:"query-metadata-item"},"Data Source:",n.a.createElement("img",{src:"".concat(Wy,"/").concat(a.type,".png"),width:"20",alt:a.type}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("div",{className:"query-metadata-label"},a.name))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("span",{className:"query-metadata-label"},n.a.createElement("span",{className:"zmdi zmdi-refresh m-r-5"}),"Refresh Schedule"),n.a.createElement("span",{className:"query-metadata-value"},n.a.createElement(ho,{isLink:Object(l.isFunction)(o),isNew:t.isNew(),schedule:t.schedule,onClick:o})))))}Jv.propTypes={layout:D.a.oneOf(["table","horizontal"]),query:D.a.shape({created_at:D.a.oneOfType([D.a.string,Br]).isRequired,updated_at:D.a.oneOfType([D.a.string,Br]).isRequired,user:D.a.shape({name:D.a.string.isRequired,profile_image_url:D.a.string.isRequired,is_disabled:D.a.bool}).isRequired,last_modified_by:D.a.shape({name:D.a.string.isRequired,profile_image_url:D.a.string.isRequired,is_disabled:D.a.bool}).isRequired,schedule:D.a.object}).isRequired,dataSource:D.a.shape({type:D.a.string.isRequired,name:D.a.string.isRequired}),onEditSchedule:D.a.func},Jv.defaultProps={layout:"table",dataSource:null,onEditSchedule:null};a(1566);function Xv(){return(Xv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $v(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Zv=x.a.TabPane;function eE(e){var t=e.title,a=e.message,r=e.refreshButton;return n.a.createElement("div",{className:"query-results-empty-state"},n.a.createElement("div",{className:"empty-state-content"},n.a.createElement("div",null,n.a.createElement("img",{src:"/static/images/illustrations/no-query-results.svg",alt:"No Query Results Illustration"})),n.a.createElement("h3",null,t),n.a.createElement("div",{className:"m-b-20"},a),r))}function tE(e){var t=e.visualizationName,a=e.canDelete,o=e.onDelete,i=$v(e,["visualizationName","canDelete","onDelete"]),l=Object(r.useCallback)(e=>{e.stopPropagation(),ke.a.confirm({title:"Delete Visualization",content:"Are you sure you want to delete this visualization?",okText:"Delete",okType:"danger",onOk:o,maskClosable:!0,autoFocusButton:null})},[o]);return n.a.createElement("span",i,t,a&&n.a.createElement("a",{className:"delete-visualization-button",onClick:l},n.a.createElement("i",{className:"zmdi zmdi-close"})))}eE.propTypes={title:D.a.string.isRequired,message:D.a.string.isRequired,refreshButton:D.a.node},eE.defaultProps={refreshButton:null},tE.propTypes={visualizationName:D.a.string.isRequired,canDelete:D.a.bool,onDelete:D.a.func},tE.defaultProps={canDelete:!1,onDelete:()=>{}};var aE=[{type:"TABLE",name:"Table",id:null,options:{}}];function rE(e){var t=e.queryResult,a=e.selectedTab,o=e.showNewVisualizationButton,i=e.canDeleteVisualizations,s=e.onChangeTab,c=e.onAddVisualization,u=e.onDeleteVisualization,d=e.refreshButton,p=$v(e,["queryResult","selectedTab","showNewVisualizationButton","canDeleteVisualizations","onChangeTab","onAddVisualization","onDeleteVisualization","refreshButton"]),m=Object(r.useMemo)(()=>p.visualizations.length>0?p.visualizations:aE,[p.visualizations]),f={};Object(l.find)(m,{id:a})&&(f.activeKey="".concat(a)),o&&(f.tabBarExtraContent=n.a.createElement(B.a,{className:"add-visualization-button","data-test":"NewVisualization",type:"link",onClick:()=>c()},n.a.createElement("i",{className:"fa fa-plus"}),n.a.createElement("span",{className:"m-l-5 hidden-xs"},"Add Visualization")));var y=Object(r.useMemo)(()=>Object(l.orderBy)(m,["id"]),[m]),h=Object(r.useCallback)(e=>e===y[0].id,[y]),b=Ig()({maxWidth:768});return n.a.createElement(x.a,Xv({},f,{type:"card",className:Z()("query-visualization-tabs card-style"),"data-test":"QueryPageVisualizationTabs",animated:!1,tabBarGutter:0,onChange:e=>s(+e),destroyInactiveTabPane:!0}),y.map(e=>n.a.createElement(Zv,{key:"".concat(e.id),"data-test":"QueryPageVisualization".concat(a),tab:n.a.createElement(tE,{"data-test":"QueryPageVisualizationTab".concat(e.id),canDelete:!b&&i&&!h(e.id),visualizationName:e.name,onDelete:()=>u(e.id)})},t?n.a.createElement(dp,{visualization:e,queryResult:t,context:"query"}):n.a.createElement(eE,{title:"Query Has no Result",message:"Execute/Refresh the query to show results.",refreshButton:d}))))}function nE(e){var t=e.status,a=e.updatedAt,r=e.error,o=e.isCancelling,i=e.onCancel,s="failed"===t?"error":"info",c="failed"!==t&&a,u=Object(l.includes)(["waiting","processing"],t),d=o?n.a.createElement(n.a.Fragment,null,"Cancelling…"):null;switch(t){case"waiting":o||(d=n.a.createElement(n.a.Fragment,null,"Query in queue…"));break;case"processing":o||(d=n.a.createElement(n.a.Fragment,null,"Executing query…"));break;case"loading-result":d=n.a.createElement(n.a.Fragment,null,"Loading results…");break;case"failed":d=n.a.createElement(n.a.Fragment,null,"Error running query: ",n.a.createElement("strong",null,r))}return n.a.createElement(T.a,{"data-test":"QueryExecutionStatus",type:s,message:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"flex-fill p-t-5 p-b-5"},d," ",c&&n.a.createElement(zd,{from:a})),n.a.createElement("div",null,u&&n.a.createElement(B.a,{className:"m-l-10",type:"primary",size:"small",disabled:o,onClick:i},"Cancel")))})}rE.propTypes={queryResult:D.a.object,visualizations:D.a.arrayOf(D.a.object),selectedTab:D.a.number,showNewVisualizationButton:D.a.bool,canDeleteVisualizations:D.a.bool,onChangeTab:D.a.func,onAddVisualization:D.a.func,onDeleteVisualization:D.a.func,refreshButton:D.a.node},rE.defaultProps={queryResult:null,visualizations:[],selectedTab:null,showNewVisualizationButton:!1,canDeleteVisualizations:!1,onChangeTab:()=>{},onAddVisualization:()=>{},onDeleteVisualization:()=>{},refreshButton:null},nE.propTypes={status:D.a.string,updatedAt:D.a.any,error:D.a.string,isCancelling:D.a.bool,onCancel:D.a.func},nE.defaultProps={status:"waiting",updatedAt:null,error:null,isCancelling:!0,onCancel:()=>{}};var oE=a(674),iE=a.n(oE),lE=a(675),sE=a.n(lE);function cE(){return(cE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function dE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){pE(e,t,a[t])})}return e}function pE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mE(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var fE=D.a.shape({name:D.a.string.isRequired,size:D.a.number,columns:D.a.arrayOf(D.a.string).isRequired}),yE=22,hE=18;function bE(e){var t=e.item,a=e.expanded,o=e.onToggle,i=e.onSelect,s=mE(e,["item","expanded","onToggle","onSelect"]),c=Object(r.useCallback)(function(e){e.preventDefault(),e.stopPropagation();for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];i.apply(void 0,a)},[i]);return t?n.a.createElement("div",s,n.a.createElement("div",{className:"table-name",onClick:o},n.a.createElement("i",{className:"fa fa-table m-r-5"}),n.a.createElement("strong",null,n.a.createElement("span",{title:t.name},t.name),!Object(l.isNil)(t.size)&&n.a.createElement("span",null," (",t.size,")")),n.a.createElement("i",{className:"fa fa-angle-double-right copy-to-editor","aria-hidden":"true",onClick:e=>c(e,t.name)})),a&&n.a.createElement("div",null,Object(l.map)(t.columns,e=>n.a.createElement("div",{key:e,className:"table-open"},e,n.a.createElement("i",{className:"fa fa-angle-double-right copy-to-editor","aria-hidden":"true",onClick:t=>c(t,e)}))))):null}function gE(e){var t=e.schema,a=e.onRefresh,o=e.onItemSelect,i=mE(e,["schema","onRefresh","onItemSelect"]),s=uE(Object(r.useState)(""),2),c=s[0],u=s[1],d=Object(r.useMemo)(()=>(function(e,t){var a=Object(l.filter)(t.toLowerCase().split(/\s+/),e=>e.length>0);if(0===a.length)return e;if(1===a.length){var r=a[0],n=a[0];return Object(l.filter)(e,e=>Object(l.includes)(e.name.toLowerCase(),r)||Object(l.some)(e.columns,e=>Object(l.includes)(e.toLowerCase(),n)))}var o=a[0],i=a[1];return Object(l.filter)(Object(l.map)(e,e=>{if(Object(l.includes)(e.name.toLowerCase(),o))return(e=dE({},e,{columns:Object(l.filter)(e.columns,e=>Object(l.includes)(e.toLowerCase(),i))})).columns.length>0?e:null}))})(t,c),[t,c]),p=uE(Object(r.useState)({}),2),m=p[0],f=p[1],y=uE(Object(Ql.a)(u,500),1)[0],h=uE(Object(r.useState)(null),2),b=h[0],g=h[1];if(Object(r.useEffect)(()=>{f({})},[t]),Object(r.useEffect)(()=>{b&&b.recomputeRowHeights()},[b,d,m]),0===t.length)return null;return n.a.createElement("div",cE({className:"schema-container"},i),n.a.createElement("div",{className:"schema-control"},n.a.createElement(Y.a,{className:"m-r-5",placeholder:"Search schema...",disabled:0===t.length,onChange:e=>y(e.target.value)}),n.a.createElement(X.a,{title:"Refresh Schema"},n.a.createElement(B.a,{onClick:a},n.a.createElement("i",{className:"zmdi zmdi-refresh"})))),n.a.createElement("div",{className:"schema-browser"},n.a.createElement(iE.a,null,e=>{var t=e.width,a=e.height;return n.a.createElement(sE.a,{ref:g,width:t,height:a,rowCount:d.length,rowHeight:e=>{var t=e.index,a=d[t],r=m[a.name]?a.columns.length:0;return yE+hE*r},rowRenderer:e=>{var t=e.key,a=e.index,r=e.style,i=d[a];return n.a.createElement(bE,{key:t,style:r,item:i,expanded:m[i.name],onToggle:()=>(function(e){f(dE({},m,pE({},e,!m[e])))})(i.name),onSelect:o})}})})))}bE.propTypes={item:fE,expanded:D.a.bool,onToggle:D.a.func,onSelect:D.a.func},bE.defaultProps={item:null,expanded:!1,onToggle:()=>{},onSelect:()=>{}},gE.propTypes={schema:D.a.arrayOf(fE),onRefresh:D.a.func,onItemSelect:D.a.func},gE.defaultProps={schema:[],onRefresh:()=>{},onItemSelect:()=>{}};a(1600);function vE(e){var t=e.query,a=e.dataSourcesAvailable,r=yv(t),o=null;return r.isNew&&!r.canCreate?o=n.a.createElement(n.a.Fragment,null,n.a.createElement(yu.a.Title,{level:4},"You don't have permission to create new queries on any of the data sources available to you."),n.a.createElement("p",null,n.a.createElement(yu.a.Text,{type:"secondary"},"You can either ",n.a.createElement("a",{href:"queries"},"browse existing queries"),", or ask for additional permissions from your Redash admin."))):a||(o=O.isAdmin?n.a.createElement(n.a.Fragment,null,n.a.createElement(yu.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(yu.a.Text,{type:"secondary"},"Please create one first, and then start querying.")),n.a.createElement("div",{className:"query-source-alerts-actions"},n.a.createElement(B.a,{type:"primary",href:"data_sources/new"},"Create Data Source"),n.a.createElement(B.a,{type:"default",href:"groups"},"Manage Group Permissions"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(yu.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(yu.a.Text,{type:"secondary"},"Please ask your Redash admin to create one first.")))),o?n.a.createElement("div",{className:"query-source-alerts"},n.a.createElement(vr.a,null,n.a.createElement("div",{className:"query-source-alerts-icon"},n.a.createElement(W.a,{type:"warning",theme:"filled"})),o)):null}function EE(){return(EE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function wE(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function jE(e){function t(t){var a=t.queryId,o=t.onError,i=wE(t,["queryId","onError"]),l=OE(Object(r.useState)(null),2),s=l[0],c=l[1],u=Object(r.useRef)();return u.current=o,Object(r.useEffect)(()=>{var e=!1;return(a?Qt.get({id:a}):Promise.resolve(Qt.newQuery())).then(t=>{e||c(t)}).catch(e=>u.current(e)),()=>{e=!0}},[a]),s?n.a.createElement(e,EE({query:s,onError:o},i)):n.a.createElement(Si,{className:"flex-fill"})}return t.propTypes={queryId:D.a.oneOfType([D.a.number,D.a.string])},t.defaultProps={queryId:null},t}vE.propTypes={query:D.a.object.isRequired,dataSourcesAvailable:D.a.bool},vE.defaultProps={dataSourcesAvailable:!1};a(1601);function SE(){return(SE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function PE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _E(e){var t=e.dialog,a=e.visualization,o=PE(Object(r.useState)(""),2),i=o[0],s=o[1],c=PE(Gl(e=>Object(l.isString)(e)&&""!==e?Ka.query({q:e}).then(e=>e.results).catch(()=>[]):Promise.resolve([]),{initialResults:[]}),3),u=c[0],d=c[1],p=c[2],m=PE(Object(r.useState)(null),2),f=m[0],y=m[1],h=PE(Object(r.useState)(!1),2),b=h[0],g=h[1];Object(r.useEffect)(()=>{u(i)},[u,i]);var v=f?[f]:d;return n.a.createElement(ke.a,SE({},t.props,{title:"Add to Dashboard",okButtonProps:{disabled:!f||b,loading:b},cancelButtonProps:{disabled:b},onOk:function(){Ka.get({slug:f.slug}).then(e=>(e.addWidget(a),e)).then(e=>{t.close();var a="notification-".concat(Math.random().toString(36).substr(2,10));vl.success("Widget added to dashboard",n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{href:"dashboard/".concat(e.slug),onClick:()=>vl.close(a)},e.name),n.a.createElement(io,{isDraft:e.is_draft,tags:e.tags})),{key:a})}).catch(()=>{vl.error("Widget not added.")}).finally(()=>{g(!1)})}}),n.a.createElement("label",{htmlFor:"add-to-dashboard-dialog-dashboard"},"Choose the dashboard to add this query to:"),!f&&n.a.createElement(Y.a,{id:"add-to-dashboard-dialog-dashboard",className:"w-100",autoComplete:"off",autoFocus:!0,placeholder:"Search a dashboard by name",value:i,onChange:e=>s(e.target.value),suffix:n.a.createElement(W.a,{type:"close",className:""===i?"hidden":null,onClick:()=>s("")})}),(v.length>0||p)&&n.a.createElement(el.a,{className:f?"add-to-dashboard-dialog-selection":"add-to-dashboard-dialog-search-results",bordered:!0,itemLayout:"horizontal",loading:p,dataSource:v,renderItem:e=>n.a.createElement(el.a.Item,{key:"dashboard-".concat(e.id),actions:f?[n.a.createElement(W.a,{type:"close",onClick:()=>y(null)})]:[],onClick:f?null:()=>y(e)},n.a.createElement("div",{className:"add-to-dashboard-dialog-item-content"},e.name,n.a.createElement(io,{isDraft:e.is_draft,tags:e.tags})))}))}_E.propTypes={dialog:Te.isRequired,visualization:D.a.object.isRequired};var kE=xe(_E);a(1602);function CE(e){return(CE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function NE(){return(NE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function TE(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qE(e){return(qE=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xE(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function RE(e,t){return(RE=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function AE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var DE=function(e){function t(e){var a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=!(n=qE(t).call(this,e))||"object"!==CE(n)&&"function"!=typeof n?xE(r):n,AE(xE(a),"state",{enableChangeIframeSize:!1,iframeWidth:720,iframeHeight:391});var o=e.query,i=e.visualization;return a.embedUrl="".concat(w.basePath,"embed/query/").concat(o.id,"/visualization/").concat(i.id,"?api_key=").concat(o.api_key,"&").concat(o.getParameters().toUrlParams()),window.snapshotUrlBuilder&&(a.snapshotUrl=window.snapshotUrlBuilder(o,i)),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&RE(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props,t=e.query,a=e.dialog,r=this.state,o=r.enableChangeIframeSize,i=r.iframeWidth,l=r.iframeHeight;return n.a.createElement(ke.a,NE({},a.props,{className:"embed-query-dialog",title:"Embed Query",footer:n.a.createElement(B.a,{onClick:a.dismiss},"Close")}),t.is_safe?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",{className:"m-t-0"},"Public URL"),n.a.createElement("div",{className:"m-b-30"},n.a.createElement(Fv,{"data-test":"EmbedIframe",copyable:!0},this.embedUrl)),n.a.createElement("h5",{className:"m-t-0"},"IFrame Embed"),n.a.createElement("div",null,n.a.createElement(Fv,{copyable:!0},'<iframe src="'.concat(this.embedUrl,'" width="').concat(i,'" height="').concat(l,'"></iframe>')),n.a.createElement(kl.a,{className:"m-t-10",layout:"inline"},n.a.createElement(kl.a.Item,null,n.a.createElement(Uc.a,{checked:o,onChange:e=>this.setState({enableChangeIframeSize:e.target.checked})})),n.a.createElement(kl.a.Item,{label:"Width"},n.a.createElement(Il.a,{className:"size-input",value:i,onChange:e=>this.setState({iframeWidth:e}),size:"small",disabled:!o})),n.a.createElement(kl.a.Item,{label:"Height"},n.a.createElement(Il.a,{className:"size-input",value:l,onChange:e=>this.setState({iframeHeight:e}),size:"small",disabled:!o})))),this.snapshotUrl&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,"Image Embed"),n.a.createElement(Fv,{copyable:!0},this.snapshotUrl))):n.a.createElement(T.a,{message:"Currently it is not possible to embed queries that contain text parameters.",type:"error","data-test":"EmbedErrorAlert"}))}}])&&TE(a.prototype,r),o&&TE(a,o),t}();AE(DE,"propTypes",{dialog:Te.isRequired,query:D.a.object.isRequired,visualization:D.a.object.isRequired});var IE=xe(DE);function zE(e){var t="",a=e.query,r=e.queryResult,o=e.fileType,i=r.getId&&r.getId(),l=r.getData&&r.getData();return i&&l&&a.name&&(t=a.id?"api/queries/".concat(a.id,"/results/").concat(i,".").concat(o).concat(e.embed?"?api_key=".concat(e.apiKey):""):"api/query_results/".concat(i,".").concat(o)),n.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",disabled:e.disabled,href:t,download:!0},e.children)}function ME(e){var t=n.a.createElement(H.a,null,!e.query.isNew()&&(!e.query.is_draft||!e.query.is_archived)&&n.a.createElement(H.a.Item,null,n.a.createElement("a",{target:"_self",onClick:()=>e.openAddToDashboardForm(e.selectedTab)},n.a.createElement(W.a,{type:"plus-circle",theme:"filled"})," Add to Dashboard")),!e.query.isNew()&&n.a.createElement(H.a.Item,null,n.a.createElement("a",{onClick:()=>e.showEmbedDialog(e.query,e.selectedTab),"data-test":"ShowEmbedDialogButton"},n.a.createElement(W.a,{type:"share-alt"})," Embed Elsewhere")),n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"csv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(W.a,{type:"file"})," Download as CSV File")),n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"tsv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(W.a,{type:"file"})," Download as TSV File")),n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"xlsx",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(W.a,{type:"file-excel"})," Download as Excel File")));return n.a.createElement(L.a,{trigger:["click"],overlay:t,overlayClassName:"query-control-dropdown-overlay"},n.a.createElement(B.a,{"data-test":"QueryControlDropdownButton"},n.a.createElement(W.a,{type:"ellipsis",rotate:90})))}function VE(e){return n.a.createElement(B.a,{"data-test":"EditVisualization",className:"edit-visualization",onClick:()=>e.openVisualizationEditor(e.selectedTab)},n.a.createElement(W.a,{type:"form"}),n.a.createElement("span",{className:"hidden-xs hidden-s hidden-m"},"Edit Visualization"))}zE.propTypes={query:D.a.object.isRequired,queryResult:D.a.object,fileType:D.a.string,disabled:D.a.bool.isRequired,embed:D.a.bool,apiKey:D.a.string,children:D.a.oneOfType([D.a.arrayOf(D.a.node),D.a.node]).isRequired},zE.defaultProps={queryResult:{},fileType:"csv",embed:!1,apiKey:""},ME.propTypes={query:D.a.object.isRequired,queryResult:D.a.object,queryExecuting:D.a.bool.isRequired,showEmbedDialog:D.a.func.isRequired,embed:D.a.bool,apiKey:D.a.string,selectedTab:D.a.oneOfType([D.a.string,D.a.number]),openAddToDashboardForm:D.a.func.isRequired},ME.defaultProps={queryResult:{},embed:!1,apiKey:"",selectedTab:""},VE.propTypes={openVisualizationEditor:D.a.func.isRequired,selectedTab:D.a.oneOfType([D.a.string,D.a.number])},VE.defaultProps={selectedTab:""};a(1603);function FE(e){var t=e.query,a=e.queryResult,o=e.isQueryExecuting,i=e.selectedVisualization,s=e.showEditVisualizationButton,c=e.onEditVisualization,u=e.extraActions,d=$d(a),p=function(e){return Object(r.useCallback)(t=>{var a=Object(l.find)(e.visualizations,{id:t});kE.showModal({visualization:a})},[e.visualizations])}(t),m=function(e){return Object(r.useCallback)((t,a)=>{var r=Object(l.find)(e.visualizations,{id:a});IE.showModal({query:e,visualization:r})},[e])}(t);return n.a.createElement("div",{className:"query-execution-metadata"},n.a.createElement("span",{className:"m-r-5"},n.a.createElement(ME,{query:t,queryResult:a,queryExecuting:o,showEmbedDialog:m,embed:!1,apiKey:t.api_key,selectedTab:i,openAddToDashboardForm:p})),u,s&&n.a.createElement(VE,{openVisualizationEditor:c,selectedTab:i}),n.a.createElement("span",{className:"m-l-5 m-r-10"},n.a.createElement("span",null,n.a.createElement("strong",null,d.rows.length)," ",$r("row",d.rows.length)),n.a.createElement("span",{className:"m-l-5"},!o&&n.a.createElement(n.a.Fragment,null,n.a.createElement("strong",null,Zr(d.runtime)),n.a.createElement("span",{className:"hidden-xs"}," runtime")),o&&n.a.createElement("span",null,"Running…")),d.metadata.data_scanned&&n.a.createElement("span",{className:"m-l-5"},"Data Scanned",n.a.createElement("strong",null,an(d.metadata.data_scanned)))),n.a.createElement("div",null,n.a.createElement("span",{className:"m-r-10"},n.a.createElement("span",{className:"hidden-xs"},"Refreshed "),n.a.createElement("strong",null,n.a.createElement(Wr,{date:d.retrievedAt,placeholder:"-"})))))}function LE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function UE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function BE(e){var t=Object(r.useMemo)(()=>Object(l.first)(Object(l.orderBy)(e,["id"]))||{},[e]),a=UE(Object(r.useState)(+E.hash||t.id),2),n=a[0],o=a[1];return Object(r.useEffect)(()=>{var e=n!==t.id?"".concat(n):null;return E.hash!==e&&E.setHash(e),E.listen(()=>{E.hash!==e&&o(+E.hash||t.id)})},[t.id,n]),Object(r.useEffect)(()=>{Object(l.find)(e,{id:n})||o(t.id)},[t.id,n,e]),Object(r.useMemo)(()=>[n,o],[n])}FE.propTypes={query:D.a.object.isRequired,queryResult:D.a.object.isRequired,isQueryExecuting:D.a.bool,selectedVisualization:D.a.number,showEditVisualizationButton:D.a.bool,onEditVisualization:D.a.func,extraActions:D.a.node},FE.defaultProps={isQueryExecuting:!1,selectedVisualization:null,showEditVisualizationButton:!1,onEditVisualization:()=>{},extraActions:null};var QE="localOptions:";var WE={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=QE+e;return a in window.localStorage?JSON.parse(window.localStorage.getItem(a)):t},set:function(e,t){var a=QE+e;window.localStorage.setItem(a,JSON.stringify(t))}};function GE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var HE=p()("redash:notifications"),KE=window.Notification||null;KE||HE("HTML5 notifications are not supported.");var YE=Object(l.find)(["hidden","webkitHidden","mozHidden","msHidden"],e=>e in document);var JE={getPermissions:function(){KE&&"default"===KE.permission&&KE.requestPermission()},showNotification:function(e,t){KE&&document[YE]&&"granted"===KE.permission&&(new KE(e,{tag:e+t,body:t,icon:tr.a}).onclick=function(){window.focus(),this.close(),Ke("click","notification")})}};function XE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function $E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ZE(e,t,a[t])})}return e}function ZE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var eO=(e,t)=>$E({},e,t);function tO(e){var t=XE(Object(r.useReducer)(eO,{queryResult:null,isExecuting:!1,loadedInitialResults:!1,executionStatus:null,isCancelling:!1,cancelCallback:null,error:null}),2),a=t[0],n=t[1],o=Object(r.useRef)(null);Object(r.useEffect)(()=>()=>{o.current=null},[]);var i=Object(r.useCallback)(function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;t=i?i():e.getQueryResult(r),Ke("execute","query",e.id),JE.getPermissions(),o.current=t,n({updatedAt:t.getUpdatedAt(),executionStatus:t.getStatus(),isExecuting:!0,cancelCallback:()=>{Ke("cancel_execute","query",e.id),n({isCancelling:!0}),t.cancelExecution()}});t.toPromise(e=>{o.current===t&&n({updatedAt:t.getUpdatedAt(),executionStatus:e})}).then(r=>{o.current===t&&(r&&r.query_result.query===e.query&&(e.latest_query_data_id=r.getId(),e.queryResult=r),a.loadedInitialResults&&JE.showNotification("Redash","".concat(e.name," updated.")),n({queryResult:r,loadedInitialResults:!0,error:null,isExecuting:!1,isCancelling:!1,executionStatus:null}))}).catch(r=>{o.current===t&&(a.loadedInitialResults&&JE.showNotification("Redash","".concat(e.name," failed to run: ").concat(r.getError())),n({queryResult:r,loadedInitialResults:!0,error:r.getError(),isExecuting:!1,isCancelling:!1,executionStatus:Rt.FAILED}))})},[a.loadedInitialResults,e]),l=Object(r.useRef)(e),s=Object(r.useRef)(i);return l.current=e,s.current=i,Object(r.useEffect)(()=>{l.current.hasResult()||l.current.paramsRequired()?s.current(function(){var e=E.search.maxAge;return void 0!==e?e:-1}()):n({loadedInitialResults:!0})},[]),$E({},a,{executeQuery:i})}function aO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function rO(e){var t=aO(Object(r.useState)([]),2),a=t[0],n=t[1],o=aO(Object(r.useState)(!1),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>Object(l.filter)(a,t=>!t.view_only||t.id===e.data_source_id),[a,e.data_source_id]),u=Object(r.useMemo)(()=>Object(l.find)(c,{id:e.data_source_id})||null,[e.data_source_id,c]);return Object(r.useEffect)(()=>{var e=!1;return Gy.query().then(t=>{e||(s(!0),n(t))}),()=>{e=!0}},[]),Object(r.useMemo)(()=>({dataSourcesLoaded:i,dataSources:c,dataSource:u}),[i,c,u])}function nO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function oO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)return Promise.resolve([]);var a=e=>C.get("api/jobs/".concat(e.job.id)).then(e=>e.job.status<3?function(e){return new Promise(t=>setTimeout(t,e))}(1e3).then(()=>a(e)):3===e.job.status?e.job.result:4===e.job.status&&e.job.error.code===Qy?[]:Promise.reject(new Error(e.job.error)));return Gy.fetchSchema(e,t).then(e=>Object(l.has)(e,"job")?a(e):Object(l.has)(e,"schema")?e.schema:Promise.reject()).catch(()=>(vl.error("Schema refresh failed.","Please try again later."),Promise.resolve([])))}function iO(e){return e.tokensCount=Object(l.reduce)(e,(e,t)=>e+t.columns.length,0),e}function lO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function sO(e){var t=Object(r.useMemo)(()=>e.getParametersDefs(),[e]),a=lO(Object(r.useState)(e.getParameters().hasPendingValues()),2),n=a[0],o=a[1],i=Object(r.useCallback)(t=>{t=Object(l.isUndefined)(t)?e.getParameters().hasPendingValues():t,o(t)},[e]);return Object(r.useEffect)(()=>{var t=e.getParameters().hasPendingValues();t!==n&&o(t)},[e,t,n]),Object(r.useMemo)(()=>[t,n,i],[t,n,i])}var cO=a(387),uO=a.n(cO);function dO(e){return(dO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pO(){return(pO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mO(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fO(e){return(fO=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yO(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hO(e,t){return(hO=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var vO=rt.a.weekdaysShort(),EO=rt.a.weekdays(),OO="YYYY-MM-DD",wO="HH:mm",jO=Ln.a.Option,SO=Ln.a.OptGroup;function PO(e){var t=gO(Object(r.useState)(e.defaultValue),2),a=t[0],o=t[1],i=a&&!a.isUTC();return n.a.createElement(n.a.Fragment,null,n.a.createElement(uO.a,{allowClear:!1,value:a,format:wO,minuteStep:5,onChange:function(t){o(t),e.onChange(t)}}),i&&n.a.createElement("span",{className:"utc","data-testid":"utc"},"(",rt.a.utc(a).format(wO)," UTC)"))}PO.propTypes={defaultValue:Br,onChange:D.a.func.isRequired},PO.defaultProps={defaultValue:null};var _O=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return r=this,n=(e=fO(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==dO(n)&&"function"!=typeof n?yO(r):n,bO(yO(a),"state",a.getState()),bO(yO(a),"setTime",e=>{a.newSchedule={time:rt()(e).utc().format(wO)}}),bO(yO(a),"setInterval",e=>{var t=a.state.newSchedule,r=Xr(e).interval;r===Hr.NEVER&&(t.until=null),-1!==[Hr.NEVER,Hr.MINUTES,Hr.HOURS].indexOf(r)&&(t.time=null),r!==Hr.WEEKS&&(t.day_of_week=null),r!==Hr.DAYS&&r!==Hr.WEEKS||a.state.minute&&a.state.hour||(t.time=rt()().hour("00").minute("15").utc().format(wO)),r!==Hr.WEEKS||a.state.dayOfWeek||(t.day_of_week=EO[0]),t.interval=e;var n=gO(t.time?Jr(t.time).split(":"):[null,null],2),o=n[0],i=n[1];a.setState({interval:r,seconds:e,hour:o,minute:i,dayOfWeek:t.day_of_week?vO[EO.indexOf(t.day_of_week)]:null}),a.newSchedule=t}),bO(yO(a),"setScheduleUntil",(e,t)=>{a.newSchedule={until:t}}),bO(yO(a),"setWeekday",e=>{var t=e.target.value;a.setState({dayOfWeek:t}),a.newSchedule={day_of_week:t?EO[vO.indexOf(t)]:null}}),bO(yO(a),"setUntilToggle",e=>{var t=e.target.value?rt()().format(OO):null;a.setScheduleUntil(null,t)}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hO(e,t)}(t,n.a.Component),a=t,(r=[{key:"getState",value:function(){var e=Object(l.clone)(this.props.schedule||t.defaultProps.schedule),a=e.time,r=e.interval,n=e.day_of_week,o=Xr(r).interval,i=gO(a?Jr(a).split(":"):[null,null],2);return{hour:i[0],minute:i[1],seconds:r,interval:o,dayOfWeek:n?vO[EO.indexOf(n)]:null,newSchedule:e}}},{key:"save",value:function(){var e=this.state.newSchedule;(()=>{var t=Object(l.omitBy)(e,l.isNil),a=Object(l.omitBy)(this.props.schedule,l.isNil);return!Object(l.isEqual)(t,a)})()&&(e.interval?this.props.dialog.close(Object(l.clone)(e)):this.props.dialog.close(null)),this.props.dialog.dismiss()}},{key:"render",value:function(){var e=this.props.dialog,t=this.state,a=t.interval,r=t.minute,o=t.hour,i=t.seconds,s=t.newSchedule.until;return n.a.createElement(ke.a,pO({},e.props,{title:"Refresh Schedule",className:"schedule",onOk:()=>this.save()}),n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Refresh every"),n.a.createElement("div",{"data-testid":"interval"},n.a.createElement(Ln.a,{className:"input",value:i,onChange:this.setInterval,dropdownMatchSelectWidth:!1},n.a.createElement(jO,{value:null,key:"never"},"Never"),Object.keys(this.intervals).map(e=>n.a.createElement(SO,{label:Object(l.capitalize)($r(e)),key:e},this.intervals[e].map(e=>{var t=gO(e,2),a=t[0],r=t[1];return n.a.createElement(jO,{value:r,key:a},Zr(r))})))))),-1!==[Hr.DAYS,Hr.WEEKS].indexOf(a)?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On time"),n.a.createElement("div",{"data-testid":"time"},n.a.createElement(PO,{defaultValue:o?rt()().hour(o).minute(r):null,onChange:this.setTime}))):null,Hr.WEEKS===a?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On day"),n.a.createElement("div",{"data-testid":"weekday"},n.a.createElement(Ep.a.Group,{size:"medium",defaultValue:this.state.dayOfWeek,onChange:this.setWeekday},vO.map(e=>n.a.createElement(Ep.a.Button,{value:e,key:e,className:"input"},e[0]))))):null,a!==Hr.NEVER?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Ends"),n.a.createElement("div",{className:"ends","data-testid":"ends"},n.a.createElement(Ep.a.Group,{size:"medium",value:!!s,onChange:this.setUntilToggle},n.a.createElement(Ep.a,{value:!1},"Never"),n.a.createElement(Ep.a,{value:!0},"On")),s?n.a.createElement(ou.a,{size:"small",className:"datepicker",value:rt()(s),allowClear:!1,format:OO,onChange:this.setScheduleUntil}):null)):null)}},{key:"intervals",get:function(){var e=bO({},Hr.NEVER,[]);return this.props.refreshOptions.forEach(t=>{var a=Xr(t),r=a.count,n=a.interval;n in e||(e[n]=[]),e[n].push([r,t])}),Object.defineProperty(this,"intervals",{value:e}),e}},{key:"newSchedule",set:function(e){this.setState(t=>({newSchedule:pO(t.newSchedule,e)}))}}])&&mO(a.prototype,r),o&&mO(a,o),t}();bO(_O,"propTypes",{schedule:xr,refreshOptions:D.a.arrayOf(D.a.number).isRequired,dialog:Te.isRequired}),bO(_O,"defaultProps",{schedule:Rr});var kO=xe(_O);function CO(e,t){var a=yv(e),n=Tv(e,t);return Object(r.useCallback)(()=>{if(a.canEdit&&a.canSchedule){var t=w.queryRefreshIntervals,r=Je.getQueryRefreshIntervals(),o=Object(l.isArray)(r)?Object(l.intersection)(t,r):t;kO.showModal({schedule:e.schedule,refreshOptions:o}).onClose(t=>{Ke("edit_schedule","query",e.id),n({schedule:t})})}},[e.id,e.schedule,a.canEdit,a.canSchedule,n])}var NO={save:e=>C.post((e=>e.id?"api/visualizations/".concat(e.id):"api/visualizations")(e),e),delete:e=>C.delete("api/visualizations/".concat(e.id))};a(1604);function TO(){return(TO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xO(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function RO(e){var t=e.dialog,a=e.visualization,o=e.query,i=e.queryResult,s=Object(r.useRef)(),c=!a,u=$d(i),d=qO(Object(r.useState)(u.filters),2),p=d[0],m=d[1],f=Object(r.useMemo)(()=>({columns:u.columns,rows:Yd(u.rows,p)}),[u,p]),y=Object(r.useMemo)(()=>{var e=a?Ra.registeredVisualizations[a.type]:Object(Ra.getDefaultVisualization)(),t=e.getOptions(c?{}:a.options,u);return{type:e.type,name:c?e.name:a.name,options:t,originalOptions:t}},[u,c,a]),h=qO(Object(r.useState)(y.type),2),b=h[0],g=h[1],v=qO(Object(r.useState)(y.name),2),E=v[0],O=v[1],w=qO(Object(r.useState)(!1),2),j=w[0],S=w[1],P=qO(Object(r.useState)(y.options),2),_=P[0],k=P[1],C=qO(Object(r.useState)(!1),2),N=C[0],T=C[1];function q(e){var t=Ra.registeredVisualizations[b];k(t.getOptions(e,u))}Object(r.useEffect)(()=>{s.current&&s.current.reset()},[u,_]);var x=c?Object(l.filter)(Object(l.sortBy)(Ra.registeredVisualizations,["name"]),e=>!e.isDeprecated):Object(l.pick)(Ra.registeredVisualizations,[b]);return n.a.createElement(ke.a,TO({},t.props,{wrapClassName:"ant-modal-fullscreen",title:"Visualization Editor",okText:"Save",okButtonProps:{loading:N,disabled:N},onOk:function(){T(!0);var e=_;"TABLE"===b&&(e=Object(l.omit)(e,["paginationSize"])),function(e){return e.id?Ke("update","visualization",e.id,{type:e.type}):Ke("create","visualization",null,{type:e.type}),NO.save(e).then(e=>(vl.success("Visualization saved"),e)).catch(e=>(vl.error("Visualization could not be saved"),Promise.reject(e)))}(Object(l.extend)(Object(Ra.newVisualization)(b),a,{name:E,options:e,query_id:o.id})).then(e=>{!function(e,t){var a=Object(l.findIndex)(e.visualizations,e=>e.id===t.id);a>-1?e.visualizations[a]=t:e.visualizations.push(t),e.visualizations=xO(e.visualizations)}(o,e),t.close(e)})},onCancel:function(){var e,a=!Object(l.isEqual)(_,y.originalOptions);(e=j||a,new Promise((t,a)=>{e?ke.a.confirm({title:"Visualization Editor",content:"Are you sure you want to close the editor without saving?",okText:"Yes",cancelText:"No",onOk:()=>t(),onCancel:()=>a()}):t()})).then(t.dismiss)},wrapProps:{"data-test":"EditVisualizationDialog"}}),n.a.createElement("div",{className:"edit-visualization-dialog"},n.a.createElement("div",{className:"visualization-settings"},n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:"visualization-type"},"Visualization Type"),n.a.createElement(Ln.a,{"data-test":"VisualizationType",id:"visualization-type",className:"w-100",disabled:!c,value:b,onChange:function(e){g(e);var t=Ra.registeredVisualizations[e];j||O(t.name),k(t.getOptions(c?{}:a.options,u))}},Object(l.map)(x,e=>n.a.createElement(Ln.a.Option,{key:e.type,"data-test":"VisualizationType."+e.type},e.name)))),n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:"visualization-name"},"Visualization Name"),n.a.createElement(Y.a,{"data-test":"VisualizationName",id:"visualization-name",className:"w-100",value:E,onChange:e=>(function(e){O(e),S(e!==E)})(e.target.value)})),n.a.createElement("div",{"data-test":"VisualizationEditor"},n.a.createElement(ip,{type:b,data:u,options:_,visualizationName:E,onOptionsChange:q}))),n.a.createElement("div",{className:"visualization-preview"},n.a.createElement("label",{htmlFor:"visualization-preview",className:"invisible hidden-xs"},"Preview"),n.a.createElement(Xd,{filters:p,onChange:m}),n.a.createElement("div",{className:"scrollbox","data-test":"VisualizationPreview"},n.a.createElement(op,{type:b,data:f,options:_,visualizationName:E,onOptionsChange:q})))))}RO.propTypes={dialog:Te.isRequired,query:D.a.object.isRequired,visualization:Ra.VisualizationType,queryResult:D.a.object.isRequired},RO.defaultProps={visualization:null};var AO=xe(RO);function DO(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function IO(e,t,a){var n=Object(r.useRef)();return n.current=Object(l.isFunction)(a)?a:()=>{},Object(r.useCallback)(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Object(l.find)(e.visualizations,{id:a})||null;AO.showModal({query:e,visualization:r,queryResult:t}).onClose(t=>{var a=Object(l.filter)(e.visualizations,e=>e.id!==t.id);n.current(Object(l.extend)(e.clone(),{visualizations:[].concat(DO(a),[t])}),t)})},[e,t])}function zO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function MO(e,t){var a=Object(r.useRef)();return a.current=Object(l.isFunction)(t)?t:()=>{},Object(r.useCallback)(t=>NO.delete({id:t}).then(()=>{var r=Object(l.filter)(e.visualizations,e=>e.id!==t);a.current(Object(l.extend)(e.clone(),{visualizations:r}))}).catch(()=>{vl.error("Error deleting visualization.","Maybe it's used in a dashboard?")}),[e])}function VO(e,t){var a=Tv(e,t);return Object(r.useCallback)(t=>{Ke("edit_description","query",e.id),a({description:t})},[e.id,a])}a(1605);function FO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function LO(e){var t=function(e){var t=LE(Object(r.useState)(e),2),a=t[0],n=t[1],o=LE(Object(r.useState)(e.query),2),i=o[0],l=o[1],s=Tv(a,e=>{e.id!==a.id&&We(e.getUrl(!0),!0),n(e),l(e.query)});return Object(r.useMemo)(()=>({query:a,setQuery:n,isDirty:a.query!==i,saveQuery:()=>s()}),[a,i,s])}(e.query),a=t.query,o=t.setQuery,i=t.isDirty,s=t.saveQuery,c=rO(a),u=c.dataSourcesLoaded,d=c.dataSources,p=c.dataSource,m=FO(function(e){var t=nO(Object(r.useState)(iO([])),2),a=t[0],n=t[1],o=Object(r.useRef)(null),i=Object(r.useCallback)(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,a=Math.random().toString(36).substr(2);o.current=a,oO(e,t).then(e=>{o.current===a&&n(iO(e))})},[e]);return Object(r.useEffect)(()=>{i()},[i]),Object(r.useEffect)(()=>()=>{o.current=null},[]),Object(r.useMemo)(()=>[a,i],[a,i])}(p),2),f=m[0],y=m[1],h=yv(a,p),b=FO(sO(a),3),g=b[0],v=b[1],O=b[2],w=FO(BE(a.visualizations),2),j=w[0],S=w[1],P=!Ig()({minWidth:768});!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(r.useRef)();t.current=e,Object(r.useEffect)(()=>{var e="".concat("You will lose your changes if you leave","\n\nAre you sure you want to leave this page?"),a=window.onbeforeunload;window.onbeforeunload=function(){return t.current?"You will lose your changes if you leave":void 0};var r=E.confirmChange((a,r)=>{if(t.current&&a.path!==r.path)return e});return()=>{window.onbeforeunload=a,r()}},[])}(i);var _=tO(a),k=_.queryResult,C=_.isExecuting,N=_.executionStatus,T=_.executeQuery,q=_.error,x=_.cancelCallback,R=_.isCancelling,A=_.updatedAt,D=_.loadedInitialResults,I=$d(k),z=Object(r.useRef)(null),M=FO(function(e){var t=Object(r.useMemo)(()=>e.tokensCount<=5e3,[e]),a=GE(Object(r.useState)(WE.get("liveAutocomplete",!0)),2),n=a[0],o=a[1],i=Object(r.useCallback)(e=>{o(e),WE.set("liveAutocomplete",e)},[]);return Object(r.useMemo)(()=>[t,n,i],[t,n,i])}(f),3),V=M[0],F=M[1],L=M[2],U=FO(Object(Ql.a)(e=>{o(Object(l.extend)(a.clone(),{query:e}))},100),1)[0];Object(r.useEffect)(()=>{Ke("view_source","query",a.id)},[a.id]),Object(r.useEffect)(()=>{document.title=a.name},[a.name]);var Q=Tv(a,o),W=VO(a,o),G=function(e,t,a){var n=Object(r.useRef)();return n.current=Object(l.isFunction)(a)?a:()=>{},Object(r.useCallback)(()=>{Qt.format(t||"sql",e.query).then(t=>{n.current(Object(l.extend)(e.clone(),{query:t}))}).catch(e=>vl.error(Object(l.get)(e,"response.data.message","Failed to format query: unknown error.")))},[e,t])}(a,p?p.syntax:null,o),H=Object(r.useCallback)(e=>{if(e)try{localStorage.setItem("lastSelectedDataSourceId",e)}catch(e){}if(a.data_source_id!==e){Ke("update_data_source","query",a.id,{dataSourceId:e});var t={data_source_id:e,latest_query_data_id:null,latest_query_data:null};o(Object(l.extend)(a.clone(),t)),Q(t,{successMessage:null})}},[a,o,Q]);Object(r.useEffect)(()=>{if(u&&h.isNew){var e=d.length>0?d[0].id:null;H(function(e,t){return e=Object(l.map)(e,e=>parseInt(e,10)),t=Object(l.map)(t,e=>e.id),Object(l.find)(e,e=>Object(l.includes)(t,e))||null}([a.data_source_id,localStorage.getItem("lastSelectedDataSourceId"),e],d))}},[a.data_source_id,h.isNew,u,d,H]);var K=CO(a,o),Y=function(e,t){var a=Object(r.useRef)();return a.current=Object(l.isFunction)(t)?t:()=>{},Object(r.useCallback)(()=>{kd.showModal({parameter:{title:null,name:"",type:"text",value:null},existingParams:Object(l.map)(e.getParameters().get(),e=>e.name)}).onClose(t=>{var r=e.clone();t=r.getParameters().add(t),a.current(r,t)})},[e])}(a,(e,t)=>{z.current&&(z.current.paste(t.toQueryTextFragment()),z.current.focus()),o(e)}),J=Object(r.useCallback)(e=>{z.current&&z.current.paste(e)},[]),X=FO(Object(r.useState)(null),2),$=X[0],ee=X[1],te=Object(r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h.canExecute&&(e||!v&&!C)&&(i||!Object(l.isEmpty)($)?T(null,()=>a.getQueryResultByText(0,$)):T())},[a,h.canExecute,v,C,i,$,T]),ae=FO(Object(r.useState)(!1),2),re=ae[0],ne=ae[1],oe=Object(r.useCallback)(()=>{re||(ne(!0),s().finally(()=>ne(!1)))},[re,s]),ie=function(e,t,a,n){var o=yv(e),i=IO(e,t,n),l=zO(Object(r.useState)(!1),2),s=l[0],c=l[1];return Object(r.useEffect)(()=>{!o.isNew&&s&&(c(!1),i())},[o.isNew,s,i]),Object(r.useCallback)(()=>{o.isNew?(c(!0),a()):i()},[o.isNew,a,i])}(a,k,oe,(e,t)=>{o(e),S(t.id)}),le=IO(a,k,e=>o(e)),se=MO(a,o);return n.a.createElement("div",{className:Z()("query-page-wrapper",{"query-fixed-layout":!P})},n.a.createElement(vE,{query:a,dataSourcesAvailable:!u||d.length>0}),n.a.createElement("div",{className:"container p-b-10"},n.a.createElement(Yv,{query:a,dataSource:p,sourceMode:!0,selectedVisualization:j,onChange:o})),n.a.createElement("main",{className:"query-fullscreen"},n.a.createElement(Bg,{direction:"horizontal",sizeAttribute:"flex-basis",toggleShortcut:"Alt+Shift+D, Alt+D"},n.a.createElement("nav",null,u&&n.a.createElement("div",{className:"editor__left__data-source"},n.a.createElement(Ln.a,{className:"w-100","data-test":"SelectDataSource",placeholder:"Choose data source...",value:p?p.id:void 0,disabled:!h.canEdit||!u||0===d.length,loading:!u,optionFilterProp:"data-name",showSearch:!0,onChange:H},Object(l.map)(d,e=>n.a.createElement(Ln.a.Option,{key:"ds-".concat(e.id),value:e.id,"data-name":e.name,"data-test":"SelectDataSource".concat(e.id)},n.a.createElement("img",{src:"/static/images/db-logos/".concat(e.type,".png"),width:"20",alt:e.name}),n.a.createElement("span",null,e.name))))),n.a.createElement("div",{className:"editor__left__schema"},n.a.createElement(gE,{schema:f,onRefresh:()=>y(!0),onItemSelect:J})),!a.isNew()&&n.a.createElement("div",{className:"query-page-query-description"},n.a.createElement(fy,{isEditable:h.canEdit,markdown:!0,ignoreBlanks:!1,placeholder:"Add description",value:a.description,onDone:W,multiline:!0})),!a.isNew()&&n.a.createElement(Jv,{layout:"table",query:a,onEditSchedule:K}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"flex-fill p-relative"},n.a.createElement("div",{className:"p-absolute d-flex flex-column p-l-15 p-r-15",style:{left:0,top:0,right:0,bottom:0,overflow:"auto"}},n.a.createElement(Bg,{direction:"vertical",sizeAttribute:"flex-basis"},n.a.createElement("div",{className:"row editor"},n.a.createElement("section",{className:"query-editor-wrapper","data-test":"QueryEditor"},n.a.createElement(fv,{ref:z,"data-executing":C?"true":null,syntax:p?p.syntax:null,value:a.query,schema:f,autocompleteEnabled:V&&F,onChange:U,onSelectionChange:ee}),n.a.createElement(fv.Controls,{addParameterButtonProps:{title:"Add New Parameter",shortcut:"mod+p",onClick:Y},formatButtonProps:{title:"Format Query",shortcut:"mod+shift+f",onClick:G},saveButtonProps:h.canEdit&&{text:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"hidden-xs"},"Save"),i&&!re?"*":null),shortcut:"mod+s",onClick:oe,loading:re},executeButtonProps:{disabled:!h.canExecute||C||v,shortcut:"mod+enter, alt+enter, ctrl+enter",onClick:te,text:n.a.createElement("span",{className:"hidden-xs"},null===$?"Execute":"Execute Selected")},autocompleteToggleProps:{available:V,enabled:F,onToggle:L},dataSourceSelectorProps:!!p&&{disabled:!h.canEdit,value:p.id,onChange:H,options:Object(l.map)(d,e=>({value:e.id,label:e.name}))}})))),!h.isNew&&n.a.createElement(Jv,{layout:"horizontal",query:a,onEditSchedule:K}),n.a.createElement("section",{className:"query-results-wrapper"},a.hasParameters()&&n.a.createElement("div",{className:"query-parameters-wrapper"},n.a.createElement(Dd,{editable:h.canEdit,disableUrlUpdate:h.isNew,parameters:g,onPendingValuesChange:()=>O(),onValuesChange:()=>{O(!1),te(!0)},onParametersEdit:()=>{i||s()}})),(q||C)&&n.a.createElement("div",{className:"query-alerts"},n.a.createElement(nE,{status:N,updatedAt:A,error:q,isCancelling:R,onCancel:x})),n.a.createElement(n.a.Fragment,null,I.log.length>0&&n.a.createElement("div",{className:"query-results-log"},n.a.createElement("p",null,"Log Information:"),Object(l.map)(I.log,(e,t)=>n.a.createElement("p",{key:"log-line-".concat(t),className:"query-log-line"},e))),D&&!(h.isNew&&!k)&&n.a.createElement(rE,{queryResult:k,visualizations:a.visualizations,showNewVisualizationButton:h.canEdit&&I.status===Rt.DONE,canDeleteVisualizations:h.canEdit,selectedTab:j,onChangeTab:S,onAddVisualization:ie,onDeleteVisualization:se,refreshButton:n.a.createElement(B.a,{type:"primary",disabled:!h.canExecute||v,loading:C,onClick:te},!C&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now")}))))),k&&!k.getError()&&n.a.createElement("div",{className:"bottom-controller-container"},n.a.createElement(FE,{query:a,queryResult:k,selectedVisualization:j,isQueryExecuting:C,showEditVisualizationButton:!h.isNew&&h.canEdit,onEditVisualization:le})))))}LO.propTypes={query:D.a.object.isRequired};var UO=jE(LO),BO=[mr({path:"/queries/new",render:e=>n.a.createElement(UO,e),bodyClass:"fixed-layout"}),mr({path:"/queries/:queryId([0-9]+)/source",render:e=>n.a.createElement(UO,e),bodyClass:"fixed-layout"})];function QO(){return(QO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function WO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function GO(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function HO(e){var t=e.title,a=e.shortcut,o=e.disabled,i=e.children,l=e.onClick,s=GO(e,["title","shortcut","disabled","children","onClick"]),c=WO(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useMemo)(()=>({onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),[]);return Object(r.useEffect)(()=>{o&&d(!1)},[o]),Object(r.useEffect)(()=>{if(a){var e=function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},a,l);return tu.bind(e),()=>{tu.unbind(e)}}},[a,l]),n.a.createElement(iv,{title:t,shortcut:a,visible:u},n.a.createElement("span",p,n.a.createElement(B.a,QO({"data-test":"ExecuteButton",disabled:o,onClick:l,style:o?{pointerEvents:"none"}:{}},s),i)))}HO.propTypes={className:D.a.string,shortcut:D.a.string,disabled:D.a.bool,children:D.a.node,onClick:D.a.func},HO.defaultProps={className:null,shortcut:null,disabled:!1,children:null,onClick:()=>{}};a(1606);function KO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function YO(e){var t=KO(Object(r.useState)(e.query),2),a=t[0],o=t[1],i=rO(a).dataSource,l=yv(a,i),s=KO(sO(a),3),c=s[0],u=s[1],d=s[2],p=KO(BE(a.visualizations),2),m=p[0],f=p[1],y=Ig()({minWidth:768}),h=Ig()({minHeight:500})&&y,b=KO(Yf(),2),g=b[0],v=b[1],E=KO(Object(r.useState)(!1),2),O=E[0],w=E[1],j=tO(a),S=j.queryResult,P=j.loadedInitialResults,_=j.isExecuting,k=j.executionStatus,C=j.executeQuery,N=j.error,T=j.cancelCallback,q=j.isCancelling,x=j.updatedAt,R=$d(S),A=VO(a,o),D=CO(a,o),I=IO(a,S,(e,t)=>{o(e),f(t.id)}),z=IO(a,S,e=>o(e)),M=MO(a,o),V=Object(r.useCallback)(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];l.canExecute&&(e||!u&&!_)&&C()},[u,C,_,l.canExecute]);return Object(r.useEffect)(()=>{document.title=a.name},[a.name]),n.a.createElement("div",{className:Z()("query-page-wrapper",{"query-view-fullscreen":g,"query-fixed-layout":h})},n.a.createElement("div",{className:"container"},n.a.createElement(Yv,{query:a,dataSource:i,onChange:o,selectedVisualization:m,headerExtra:n.a.createElement(HO,{className:"m-r-5",type:"primary",shortcut:"mod+enter, alt+enter, ctrl+enter",disabled:!l.canExecute||_||u,onClick:V},"Refresh"),tagsExtra:!a.description&&l.canEdit&&!O&&!g&&n.a.createElement("a",{className:"label label-tag hidden-xs",role:"none",onClick:()=>w(!0)},n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5"}),"Add description")}),(a.description||O)&&n.a.createElement("div",{className:Z()("m-t-5",{hidden:g})},n.a.createElement(fy,{className:"w-100",value:a.description,isEditable:l.canEdit,onDone:A,onStopEditing:()=>w(!1),placeholder:"Add description",ignoreBlanks:!1,editorProps:{autosize:{minRows:2,maxRows:4}},defaultEditing:O,multiline:!0}))),n.a.createElement("div",{className:"query-view-content"},a.hasParameters()&&n.a.createElement("div",{className:Z()("bg-white tiled p-15 m-t-15 m-l-15 m-r-15",{hidden:g})},n.a.createElement(Dd,{parameters:c,onValuesChange:()=>{d(!1),V(!0)},onPendingValuesChange:()=>d()})),n.a.createElement("div",{className:"query-results m-t-15"},P&&n.a.createElement(rE,{queryResult:S,visualizations:a.visualizations,showNewVisualizationButton:l.canEdit&&R.status===Rt.DONE,canDeleteVisualizations:l.canEdit,selectedTab:m,onChangeTab:f,onAddVisualization:I,onDeleteVisualization:M,refreshButton:n.a.createElement(B.a,{type:"primary",disabled:!l.canExecute||u,loading:_,onClick:V},!_&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now")}),n.a.createElement("div",{className:"query-results-footer"},S&&!S.getError()&&n.a.createElement(FE,{query:a,queryResult:S,selectedVisualization:m,isQueryExecuting:_,showEditVisualizationButton:l.canEdit,onEditVisualization:z,extraActions:n.a.createElement(HO,{className:"icon-button m-r-5 hidden-xs",title:"Toggle Fullscreen",type:"default",shortcut:"alt+f",onClick:v},n.a.createElement(W.a,{type:g?"fullscreen-exit":"fullscreen"}))}),(N||_)&&n.a.createElement("div",{className:"query-execution-status"},n.a.createElement(nE,{status:k,error:N,isCancelling:q,onCancel:T,updatedAt:x})))),n.a.createElement("div",{className:Z()("p-t-15 p-r-15 p-l-15",{hidden:g})},n.a.createElement(Jv,{layout:"horizontal",query:a,dataSource:i,onEditSchedule:D}))))}YO.propTypes={query:D.a.object.isRequired};var JO=jE(YO),XO=mr({path:"/queries/:queryId([0-9]+)",render:e=>n.a.createElement(JO,e)});function $O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ZO(e){var t=e.queryName,a=e.queryDescription,r=e.visualization;return n.a.createElement("div",{className:"embed-heading p-b-10 p-r-15 p-l-15"},n.a.createElement("h3",null,n.a.createElement("img",{src:tr.a,alt:"Redash Logo",style:{height:"24px",verticalAlign:"text-bottom"}}),n.a.createElement(Vd,{visualization:r})," ",t,a&&n.a.createElement("small",null,n.a.createElement(Gc.a,{className:"markdown text-muted"},Qc.markdown.toHTML(a||"")))))}function ew(e){var t=e.query,a=e.queryResults,r=e.updatedAt,o=e.refreshStartedAt,i=e.queryUrl,l=e.hideTimestamp,s=e.apiKey,c=n.a.createElement(H.a,null,n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"csv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(W.a,{type:"file"})," Download as CSV File")),n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"tsv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(W.a,{type:"file"})," Download as TSV File")),n.a.createElement(H.a.Item,null,n.a.createElement(zE,{fileType:"xlsx",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(W.a,{type:"file-excel"})," Download as Excel File")));return n.a.createElement("div",{className:"tile__bottom-control"},!l&&n.a.createElement("span",null,n.a.createElement("a",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore"})," ",o?n.a.createElement(zd,{from:o}):n.a.createElement(Wr,{date:r})),n.a.createElement("span",{className:"small visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore"})," ",Kr(r))),i&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(X.a,{title:"Open in Redash"},n.a.createElement(B.a,{className:"icon-button",href:i,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link"}))),!t.hasParameters()&&n.a.createElement(L.a,{overlay:c,disabled:!a,trigger:["click"],placement:"topLeft"},n.a.createElement(B.a,{loading:!a&&!!o,className:"m-l-5"},"Download Dataset",n.a.createElement("i",{className:"fa fa-caret-up m-l-5"})))))}function tw(e){var t=e.queryId,a=e.visualizationId,o=e.apiKey,i=e.onError,s=$O(Object(r.useState)(null),2),c=s[0],u=s[1],d=$O(Object(r.useState)(null),2),p=d[0],m=d[1],f=$O(Object(r.useState)(null),2),y=f[0],h=f[1],b=$O(Object(r.useState)(null),2),g=b[0],v=b[1],O=Object(r.useRef)();O.current=i,Object(r.useEffect)(()=>{var e=!1;return Qt.get({id:t}).then(t=>{e||u(t)}).catch(e=>O.current(e)),()=>{e=!0}},[t]);var w=Object(r.useCallback)(()=>{c&&(m(null),h(rt()()),c.getQueryResultPromise().then(e=>{v(e)}).catch(e=>{m(e.getError())}).finally(()=>h(null)))},[c]);if(Object(r.useEffect)(()=>{document.querySelector("body").classList.add("headless"),w()},[w]),!c)return null;var j=Object(l.has)(E.search,"hide_header"),S=Object(l.has)(E.search,"hide_parameters"),P=Object(l.has)(E.search,"hide_link"),_=Object(l.has)(E.search,"hide_timestamp"),k=Object(l.has)(E.search,"showDescription");a=parseInt(a,10);var C=Object(l.find)(c.visualizations,e=>e.id===a);return C?n.a.createElement("div",{className:"tile m-l-10 m-r-10 p-t-10 embed__vis","data-test":"VisualizationEmbed"},!j&&n.a.createElement(ZO,{queryName:c.name,queryDescription:k?c.description:null,visualization:C}),n.a.createElement("div",{className:"col-md-12 query__vis"},!S&&c.hasParameters()&&n.a.createElement("div",{className:"p-t-15 p-b-10"},n.a.createElement(Dd,{parameters:c.getParametersDefs(),onValuesChange:w})),p&&n.a.createElement("div",{className:"alert alert-danger","data-test":"ErrorMessage"},"Error: ".concat(p)),!p&&g&&n.a.createElement(dp,{visualization:C,queryResult:g,context:"widget"}),!g&&y&&n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x"})))),n.a.createElement(ew,{query:c,queryResults:g,updatedAt:g?g.getUpdatedAt():void 0,refreshStartedAt:y,queryUrl:P?null:c.getUrl(),hideTimestamp:_,apiKey:o})):(setTimeout(()=>{i(new Error("Visualization does not exist"))},10),null)}ZO.propTypes={queryName:D.a.string.isRequired,queryDescription:D.a.string,visualization:Ra.VisualizationType.isRequired},ZO.defaultProps={queryDescription:""},ew.propTypes={query:D.a.object.isRequired,queryResults:D.a.object,updatedAt:D.a.string,refreshStartedAt:Br,queryUrl:D.a.string,hideTimestamp:D.a.bool,apiKey:D.a.string},ew.defaultProps={queryResults:null,updatedAt:null,refreshStartedAt:null,queryUrl:null,hideTimestamp:!1,apiKey:null},tw.propTypes={queryId:D.a.string.isRequired,visualizationId:D.a.string,apiKey:D.a.string.isRequired,onError:D.a.func},tw.defaultProps={onError:()=>{}};var aw=Ay({path:"/embed/query/:queryId/visualization/:visualizationId",render:e=>n.a.createElement(tw,e),getApiKey:()=>E.search.api_key});function rw(e){var t=e.page,a=e.searchTerm,r=e.selectedTags;if(""!==a)return n.a.createElement(re,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(r.length>0)return n.a.createElement(Nc,{objectType:"queries",tags:r});switch(t){case"favorites":return n.a.createElement(re,{message:"Mark queries as Favorite to list them here.",icon:"fa-star"});case"archive":return n.a.createElement(re,{message:"Archived queries will be listed here.",icon:"fa-archive"});case"my":return n.a.createElement("div",{className:"tiled bg-white p-15"},n.a.createElement("a",{href:"queries/new",className:"btn btn-primary btn-sm"},"Create your first query")," ","to populate My Queries list. Need help? Check out our"," ",n.a.createElement("a",{href:"https://redash.io/help/user-guide/querying/writing-queries"},"query writing documentation"),".");default:return n.a.createElement(ks,{icon:"fa fa-code",illustration:"query",description:"Getting the data from your datasources.",helpLink:"https://help.redash.io/category/21-querying"})}}rw.propTypes={page:D.a.string.isRequired,searchTerm:D.a.string.isRequired,selectedTags:D.a.array.isRequired};a(1607);function nw(){return(nw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ow(e){return(ow="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function iw(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lw(e){return(lw=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sw(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cw(e,t){return(cw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function uw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var dw=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];return r=this,a=!(o=(e=lw(t)).call.apply(e,[this].concat(l)))||"object"!==ow(o)&&"function"!=typeof o?sw(r):o,uw(sw(a),"sidebarMenu",[{key:"all",href:"queries",title:"All Queries"},{key:"favorites",href:"queries/favorites",title:"Favorites",icon:()=>n.a.createElement(Vi,{icon:"fa fa-star"})},{key:"archive",href:"queries/archive",title:"Archived",icon:()=>n.a.createElement(Vi,{icon:"fa fa-archive"})},{key:"my",href:"queries/my",title:"My Queries",icon:()=>n.a.createElement(Fi,{user:O}),isAvailable:()=>O.hasPermission("create_query")}]),uw(sw(a),"listColumns",[pn.favorites({className:"p-r-0"}),pn.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(io,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),pn.custom((e,t)=>t.user.name,{title:"Created By"}),pn.dateTime.sortable({title:"Created At",field:"created_at"}),pn.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at"}),pn.custom.sortable((e,t)=>n.a.createElement(ho,{schedule:t.schedule,isNew:t.isNew()}),{title:"Refresh Schedule",field:"schedule"})]),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cw(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this.unlistenLocationChanges=E.listen((e,t)=>{var a=E.search.q||"";"PUSH"===t&&a!==this.props.controller.searchTerm&&this.props.controller.updateSearch(a)})}},{key:"componentWillUnmount",value:function(){this.unlistenLocationChanges&&(this.unlistenLocationChanges(),this.unlistenLocationChanges=null)}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(fr,{title:e.params.pageTitle}),n.a.createElement(Cc,{className:"m-l-15 m-r-15"},n.a.createElement(Cc.Sidebar,{className:"m-b-0"},n.a.createElement(zi,{placeholder:"Search Queries...",value:e.searchTerm,onChange:e.updateSearch}),n.a.createElement(Mi,{items:this.sidebarMenu,selected:e.params.currentPage}),n.a.createElement(Li,{url:"api/queries/tags",onChange:e.updateSelectedTags}),n.a.createElement(Ui,{className:"m-b-10",options:e.pageSizeOptions,value:e.itemsPerPage,onChange:t=>e.updatePagination({itemsPerPage:t})})),n.a.createElement(Cc.Content,null,!e.isLoaded&&n.a.createElement(Si,null),e.isLoaded&&e.isEmpty&&n.a.createElement(rw,{page:e.params.currentPage,searchTerm:e.searchTerm,selectedTags:e.selectedTags}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})}))))))}}])&&iw(a.prototype,r),o&&iw(a,o),t}();uw(dw,"propTypes",{controller:Co.isRequired});var pw=No(dw,()=>new di({getResource:function(e){var t=e.params.currentPage;return{all:Qt.query.bind(Qt),my:Qt.myQueries.bind(Qt),favorites:Qt.favorites.bind(Qt),archive:Qt.archive.bind(Qt)}[t]},getItemProcessor:function(){return e=>new Qt(e)}}),()=>new wi({orderByField:"created_at",orderByReverse:!0})),mw=[mr({path:"/queries",title:"Queries",render:e=>n.a.createElement(pw,nw({},e,{currentPage:"all"}))}),mr({path:"/queries/favorites",title:"Favorite Queries",render:e=>n.a.createElement(pw,nw({},e,{currentPage:"favorites"}))}),mr({path:"/queries/archive",title:"Archived Queries",render:e=>n.a.createElement(pw,nw({},e,{currentPage:"archive"}))}),mr({path:"/queries/my",title:"My Queries",render:e=>n.a.createElement(pw,nw({},e,{currentPage:"my"}))})];function fw(){return(fw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function yw(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){hw(e,t,a[t])})}return e}function hw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function bw(e){var t=e.querySnippet,a=e.dialog,o=e.readOnly,i=Object(r.useCallback)((e,r,n)=>{var o=Object(l.get)(t,"id");Object(l.isNil)(e.description)&&(e.description=""),a.close(o?yw({id:o},e):e).then(()=>r("Saved.")).catch(()=>n("Failed saving snippet."))},[a,t]),s=!!Object(l.get)(t,"id"),c=[{name:"trigger",title:"Trigger",type:"text",required:!0,autoFocus:!s},{name:"description",title:"Description",type:"text"},{name:"snippet",title:"Snippet",type:"ace",required:!0}].map(e=>yw({},e,{readOnly:o,initialValue:Object(l.get)(t,e.name,"")}));return n.a.createElement(ke.a,fw({},a.props,{title:s?t.trigger:"Create Query Snippet",footer:[n.a.createElement(B.a,fw({key:"cancel"},a.props.cancelButtonProps,{onClick:a.dismiss}),o?"Close":"Cancel"),!o&&n.a.createElement(B.a,fw({key:"submit"},a.props.okButtonProps,{disabled:o||a.props.okButtonProps.disabled,htmlType:"submit",type:"primary",form:"querySnippetForm","data-test":"SaveQuerySnippetButton"}),s?"Save":"Create")],wrapProps:{"data-test":"QuerySnippetDialog"}}),n.a.createElement(Nh,{id:"querySnippetForm",fields:c,onSubmit:i,hideSubmitButton:!0,feedbackIcons:!0}))}bw.propTypes={dialog:Te.isRequired,querySnippet:D.a.object,readOnly:D.a.bool},bw.defaultProps={querySnippet:null,readOnly:!1};var gw=xe(bw);a(1608);function vw(){return(vw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ew(e){return(Ew="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ow(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ww(e){return(ww=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jw(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sw(e,t){return(Sw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _w=e=>O.isAdmin||O.id===Object(l.get)(e,"user.id"),kw=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=ww(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==Ew(o)&&"function"!=typeof o?jw(r):o,Pw(jw(a),"listColumns",[pn.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("a",{className:"table-main-title clickable",onClick:()=>a.showSnippetDialog(t)},t.trigger)),{title:"Trigger",field:"trigger",className:"text-nowrap"}),pn.custom.sortable(e=>e,{title:"Description",field:"description",className:"text-nowrap"}),pn.custom(e=>n.a.createElement("code",{className:"snippet-content"},e),{title:"Snippet",field:"snippet"}),pn.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),pn.date.sortable({title:"Created At",field:"created_at",className:"text-nowrap",width:"1%"}),pn.custom((e,t)=>_w(t)&&n.a.createElement(B.a,{type:"danger",className:"w-100",onClick:e=>a.deleteQuerySnippet(e,t)},"Delete"),{width:"1%"})]),Pw(jw(a),"saveQuerySnippet",e=>{return(e.id?av.save:av.create)(e)}),Pw(jw(a),"deleteQuerySnippet",(e,t)=>{ke.a.confirm({title:"Delete Query Snippet",content:"Are you sure you want to delete this query snippet?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{av.delete(t).then(()=>{vl.success("Query snippet deleted successfully."),a.props.controller.update()}).catch(()=>{vl.error("Failed deleting query snippet.")})}})}),Pw(jw(a),"showSnippetDialog",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!e||_w(e);We("query_snippets/"+Object(l.get)(e,"id","new"),!0);var r=()=>We("query_snippets",!0);gw.showModal({querySnippet:e,readOnly:!t}).onClose(e=>a.saveQuerySnippet(e).then(()=>{a.props.controller.update(),r()})).onDismiss(r)}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sw(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){var e=this.props.controller.params,t=e.isNewOrEditPage,a=e.querySnippetId;t&&("new"===a?Je.isCreateQuerySnippetEnabled()?this.showSnippetDialog():We("query_snippets",!0):av.get({id:a}).then(this.showSnippetDialog).catch(e=>{this.props.controller.handleError(e)}))}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(B.a,{type:"primary",onClick:()=>this.showSnippetDialog(),disabled:!Je.isCreateQuerySnippetEnabled()},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"New Query Snippet")),!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},"There are no query snippets yet.",Je.isCreateQuerySnippetEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement("a",{className:"clickable",onClick:()=>this.showSnippetDialog()},"Click here")," ","to add one.")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))}}])&&Ow(a.prototype,r),o&&Ow(a,o),t}();Pw(kw,"propTypes",{controller:Co.isRequired});var Cw=Hh({permission:"create_query",title:"Query Snippets",path:"query_snippets",order:5},No(kw,()=>new di({isPlainList:!0,getRequest:function(){return{}},getResource:function(){return av.query.bind(av)}}),()=>new Oi({orderByField:"trigger",itemsPerPage:10}))),Nw=[mr({path:"/query_snippets",title:"Query Snippets",render:e=>n.a.createElement(Cw,vw({},e,{currentPage:"query_snippets"}))}),mr({path:"/query_snippets/:querySnippetId(new|[0-9]+)",title:"Query Snippets",render:e=>n.a.createElement(Cw,vw({},e,{currentPage:"query_snippets",isNewOrEditPage:!0}))})];function Tw(e){return(Tw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qw(){return(qw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xw(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){zw(e,t,a[t])})}return e}function Rw(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Aw(e){return(Aw=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dw(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Iw(e,t){return(Iw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Mw=Ln.a.Option,Vw=function(e){function t(){var e,a,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return r=this,n=(e=Aw(t)).call.apply(e,[this].concat(i)),a=!n||"object"!==Tw(n)&&"function"!=typeof n?Dw(r):n,zw(Dw(a),"state",{settings:{},formValues:{},loading:!0,submitting:!1}),zw(Dw(a),"disablePasswordLoginToggle",()=>!(w.googleLoginEnabled||w.ldapLoginEnabled||a.state.formValues.auth_saml_enabled)),zw(Dw(a),"handleSubmit",e=>{e.preventDefault(),a.state.submitting||(a.setState({submitting:!0}),Sg.save(a.state.formValues).then(e=>{var t=Object(l.get)(e,"settings");a.setState({settings:t,formValues:xw({},t)})}).catch(e=>a.props.onError(e)).finally(()=>a.setState({submitting:!1})))}),zw(Dw(a),"handleChange",(e,t)=>{a.setState(a=>({formValues:qw(a.formValues,zw({},e,t))}),()=>{a.disablePasswordLoginToggle()&&!a.state.formValues.auth_password_login_enabled&&a.handleChange("auth_password_login_enabled",!0)})}),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Iw(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Ke("view","page","org_settings"),Sg.get().then(e=>{var t=Object(l.get)(e,"settings");this.setState({settings:t,formValues:xw({},t),loading:!1})}).catch(e=>this.props.onError(e))}},{key:"renderGoogleLoginOptions",value:function(){var e=this.state.formValues;return n.a.createElement(n.a.Fragment,null,n.a.createElement("h4",null,"Google Login"),n.a.createElement(kl.a.Item,{label:"Allowed Google Apps Domains"},n.a.createElement(Ln.a,{mode:"tags",value:e.auth_google_apps_domains,onChange:e=>this.handleChange("auth_google_apps_domains",e)}),!Object(l.isEmpty)(e.auth_google_apps_domains)&&n.a.createElement(T.a,{message:n.a.createElement("p",null,"Any user registered with a ",n.a.createElement("strong",null,Object(l.join)(e.auth_google_apps_domains,", "))," Google Apps account will be able to login. If they don","'","t have an existing user, a new user will be created and join the ",n.a.createElement("strong",null,"Default")," group."),className:"m-t-15"})))}},{key:"renderSAMLOptions",value:function(){var e=this.state.formValues;return n.a.createElement(n.a.Fragment,null,n.a.createElement("h4",null,"SAML"),n.a.createElement(kl.a.Item,null,n.a.createElement(Uc.a,{name:"auth_saml_enabled",checked:e.auth_saml_enabled,onChange:e=>this.handleChange("auth_saml_enabled",e.target.checked)},"SAML Enabled")),e.auth_saml_enabled&&n.a.createElement("div",null,n.a.createElement(kl.a.Item,{label:"SAML Metadata URL"},n.a.createElement(Y.a,{value:e.auth_saml_metadata_url,onChange:e=>this.handleChange("auth_saml_metadata_url",e.target.value)})),n.a.createElement(kl.a.Item,{label:"SAML Entity ID"},n.a.createElement(Y.a,{value:e.auth_saml_entity_id,onChange:e=>this.handleChange("auth_saml_entity_id",e.target.value)})),n.a.createElement(kl.a.Item,{label:"SAML NameID Format"},n.a.createElement(Y.a,{value:e.auth_saml_nameid_format,onChange:e=>this.handleChange("auth_saml_nameid_format",e.target.value)}))))}},{key:"renderGeneralSettings",value:function(){var e=this.state.formValues;return n.a.createElement(n.a.Fragment,null,n.a.createElement("h3",{className:"m-t-0"},"General"),n.a.createElement("hr",null),n.a.createElement(kl.a.Item,{label:"Date Format"},n.a.createElement(Ln.a,{value:e.date_format,onChange:e=>this.handleChange("date_format",e),"data-test":"DateFormatSelect"},w.dateFormatList.map(e=>n.a.createElement(Mw,{key:e},e)))),n.a.createElement(kl.a.Item,{label:"Time Format"},n.a.createElement(Ln.a,{value:e.time_format,onChange:e=>this.handleChange("time_format",e),"data-test":"TimeFormatSelect"},w.timeFormatList.map(e=>n.a.createElement(Mw,{key:e},e)))),n.a.createElement(kl.a.Item,{label:"Chart Visualization"},n.a.createElement(Uc.a,{name:"hide_plotly_mode_bar",checked:e.hide_plotly_mode_bar,onChange:e=>this.handleChange("hide_plotly_mode_bar",e.target.checked)},"Hide Plotly mode bar")),n.a.createElement(kl.a.Item,{label:"Feature Flags"},n.a.createElement(Uc.a,{name:"feature_show_permissions_control",checked:e.feature_show_permissions_control,onChange:e=>this.handleChange("feature_show_permissions_control",e.target.checked)},"Enable experimental multiple owners support")),n.a.createElement(kl.a.Item,null,n.a.createElement(Uc.a,{name:"send_email_on_failed_scheduled_queries",checked:e.send_email_on_failed_scheduled_queries,onChange:e=>this.handleChange("send_email_on_failed_scheduled_queries",e.target.checked)},"Email query owners when scheduled queries fail")),n.a.createElement(kl.a.Item,null,n.a.createElement(Uc.a,{name:"multi_byte_search_enabled",checked:e.multi_byte_search_enabled,onChange:e=>this.handleChange("multi_byte_search_enabled",e.target.checked)},"Enable multi-byte (Chinese, Japanese, and Korean) search for query names and descriptions (slower)")),n.a.createElement(me,{name:"BeaconConsentSetting"},n.a.createElement(kl.a.Item,{label:n.a.createElement(n.a.Fragment,null,"Anonymous Usage Data Sharing ",n.a.createElement(Pe,{type:"USAGE_DATA_SHARING"}))},n.a.createElement(Uc.a,{name:"beacon_consent",checked:e.beacon_consent,onChange:e=>this.handleChange("beacon_consent",e.target.checked)},"Help Redash improve by automatically sending anonymous usage data"))))}},{key:"renderAuthSettings",value:function(){var e=this.state,t=e.settings,a=e.formValues;return n.a.createElement(n.a.Fragment,null,n.a.createElement("h3",{className:"m-t-0"},"Authentication ",n.a.createElement(Pe,{type:"AUTHENTICATION_OPTIONS"})),n.a.createElement("hr",null),!t.auth_password_login_enabled&&n.a.createElement(T.a,{message:"Password based login is currently disabled and users will be able to login only with the enabled SSO options.",type:"warning",className:"m-t-15 m-b-15"}),n.a.createElement(kl.a.Item,null,n.a.createElement(Uc.a,{checked:a.auth_password_login_enabled,disabled:this.disablePasswordLoginToggle(),onChange:e=>this.handleChange("auth_password_login_enabled",e.target.checked)},n.a.createElement(X.a,{title:this.disablePasswordLoginToggle()?"Password login can be disabled only if another login method is enabled.":null,placement:"right"},"Password Login Enabled"))),w.googleLoginEnabled&&this.renderGoogleLoginOptions(),this.renderSAMLOptions())}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.submitting;return n.a.createElement("div",{className:"row","data-test":"OrganizationSettings"},n.a.createElement("div",{className:"col-md-offset-4 col-md-4"},t?n.a.createElement(Si,{className:""}):n.a.createElement(kl.a,{layout:"vertical",onSubmit:this.handleSubmit},this.renderGeneralSettings(),this.renderAuthSettings(),n.a.createElement(B.a,{className:"w-100",type:"primary",htmlType:"submit",loading:a},"Save"))))}}])&&Rw(a.prototype,r),o&&Rw(a,o),t}();zw(Vw,"propTypes",{onError:D.a.func}),zw(Vw,"defaultProps",{onError:()=>{}});var Fw=Hh({permission:"admin",title:"Settings",path:"settings/organization",order:6},Vw),Lw=mr({path:"/settings/organization",title:"Organization Settings",render:e=>n.a.createElement(Fw,e)});function Uw(e){var t=new URL(e,window.location);return t.protocol=window.location.protocol,t.host=window.location.host,t.toString()}function Bw(e){return(Bw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qw(){return(Qw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ww(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Jw(e,t,a[t])})}return e}function Gw(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hw(e){return(Hw=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kw(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yw(e,t){return(Yw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Xw=function(e){function t(e){var a,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=Hw(t).call(this,e),a=!n||"object"!==Bw(n)&&"function"!=typeof n?Kw(r):n,Jw(Kw(a),"fieldError",(e,t)=>0===t.length?"This field is required.":"currentPassword"!==e&&t.length<6?"This field is too short.":"repeatPassword"===e&&t!==a.state.newPassword.value?"Passwords don't match":null),Jw(Kw(a),"validateFields",e=>{var t=a.state,r=t.currentPassword,n=t.newPassword,o=t.repeatPassword,i={currentPassword:a.fieldError("currentPassword",r.value),newPassword:a.fieldError("newPassword",n.value),repeatPassword:a.fieldError("repeatPassword",o.value)};a.setState({currentPassword:Ww({},r,{error:i.currentPassword}),newPassword:Ww({},n,{error:i.newPassword}),repeatPassword:Ww({},o,{error:i.repeatPassword})}),Object(l.isFunction)(e)&&e(i.currentPassword||i.newPassword||i.repeatPassword?i:null)}),Jw(Kw(a),"updatePassword",()=>{var e=a.state,t=e.currentPassword,r=e.newPassword;e.updatingPassword||a.validateFields(e=>{if(e)a.setState(e=>({currentPassword:Ww({},e.currentPassword,{touched:!0}),newPassword:Ww({},e.newPassword,{touched:!0}),repeatPassword:Ww({},e.repeatPassword,{touched:!0})}));else{var n={id:a.props.user.id,old_password:t.value,password:r.value};a.setState({updatingPassword:!0}),Ef.save(n).then(()=>{vl.success("Saved."),a.props.dialog.close({success:!0})}).catch(e=>{vl.error(Object(l.get)(e,"response.data.message","Failed saving.")),a.setState({updatingPassword:!1})})}})}),Jw(Kw(a),"handleChange",e=>{var t=e.target,r=t.name,n=t.value,o=a.state[r].error;a.setState(Jw({},r,{value:n,error:o,touched:!0}),()=>{a.validateFields()})}),a.state={currentPassword:{value:"",error:null,touched:!1},newPassword:{value:"",error:null,touched:!1},repeatPassword:{value:"",error:null,touched:!1},updatingPassword:!1},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yw(e,t)}(t,n.a.Component),a=t,(r=[{key:"render",value:function(){var e=this.props.dialog,t=this.state,a=t.currentPassword,r=t.newPassword,o=t.repeatPassword,i=t.updatingPassword,l={className:"m-b-10",required:!0},s={onChange:this.handleChange,onPressEnter:this.updatePassword};return n.a.createElement(ke.a,Qw({},e.props,{okButtonProps:{loading:i},onOk:this.updatePassword,title:"Change Password"}),n.a.createElement(kl.a,{layout:"vertical"},n.a.createElement(kl.a.Item,Qw({},l,{validateStatus:a.touched&&a.error?"error":null,help:a.touched?a.error:null,label:"Current Password"}),n.a.createElement(Y.a.Password,Qw({},s,{name:"currentPassword","data-test":"CurrentPassword",autoFocus:!0}))),n.a.createElement(kl.a.Item,Qw({},l,{validateStatus:r.touched&&r.error?"error":null,help:r.touched?r.error:null,label:"New Password"}),n.a.createElement(Y.a.Password,Qw({},s,{name:"newPassword","data-test":"NewPassword"}))),n.a.createElement(kl.a.Item,Qw({},l,{validateStatus:o.touched&&o.error?"error":null,help:o.touched?o.error:null,label:"Repeat New Password"}),n.a.createElement(Y.a.Password,Qw({},s,{name:"repeatPassword","data-test":"RepeatPassword"})))))}}])&&Gw(a.prototype,r),o&&Gw(a,o),t}();Jw(Xw,"propTypes",{user:zr.isRequired,dialog:Te.isRequired});var $w=xe(Xw);function Zw(e){return(Zw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ej(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){oj(e,t,a[t])})}return e}function tj(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function aj(e){return(aj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rj(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nj(e,t){return(nj=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ij=function(e){function t(e){var a,r,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=aj(t).call(this,e),a=!n||"object"!==Zw(n)&&"function"!=typeof n?rj(r):n,oj(rj(a),"changePassword",()=>{$w.showModal({user:a.props.user})}),oj(rj(a),"sendPasswordReset",()=>{a.setState({sendingPasswordEmail:!0}),Ef.sendPasswordReset(a.state.user).then(e=>{a.setState({passwordLink:e})}).finally(()=>{a.setState({sendingPasswordEmail:!1})})}),oj(rj(a),"resendInvitation",()=>{a.setState({resendingInvitation:!0}),Ef.resendInvitation(a.state.user).then(e=>{a.setState({passwordLink:e})}).finally(()=>{a.setState({resendingInvitation:!1})})}),oj(rj(a),"regenerateApiKey",()=>{ke.a.confirm({title:"Regenerate API Key",content:"Are you sure you want to regenerate?",okText:"Regenerate",onOk:()=>{a.setState({regeneratingApiKey:!0}),Ef.regenerateApiKey(a.state.user).then(e=>{if(e){var t=a.state.user;a.setState({user:ej({},t,{apiKey:e})})}}).finally(()=>{a.setState({regeneratingApiKey:!1})})},maskClosable:!0,autoFocusButton:null})}),oj(rj(a),"toggleUser",()=>{var e=a.state.user,t=e.isDisabled?Ef.enableUser:Ef.disableUser;a.setState({togglingUser:!0}),t(e).then(e=>{e&&a.setState({user:Ef.convertUserInfo(e)})}).finally(()=>{a.setState({togglingUser:!1})})}),oj(rj(a),"saveUser",(e,t,r)=>{var n=ej({id:a.props.user.id},e);Ef.save(n).then(e=>{t("Saved."),a.setState({user:Ef.convertUserInfo(e)})}).catch(e=>{r(Object(l.get)(e,"response.data.message","Failed saving."))})}),a.state={user:a.props.user,groups:[],loadingGroups:!0,regeneratingApiKey:!1,sendingPasswordEmail:!1,resendingInvitation:!1,togglingUser:!1},a}var a,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nj(e,t)}(t,n.a.Component),a=t,(o=[{key:"componentDidMount",value:function(){Lb.query().then(e=>{this.setState({groups:e.map(e=>{return{value:e.id,name:e.name}}),loadingGroups:!1})})}},{key:"renderUserInfoForm",value:function(){var e=this.state,t=e.user,a=e.groups,r=e.loadingGroups,o=[{name:"name",title:"Name",type:"text",initialValue:t.name},{name:"email",title:"Email",type:"email",initialValue:t.email},t.isDisabled||O.id===t.id?{name:"group_ids",title:"Groups",type:"content",content:this.renderUserGroups()}:{name:"group_ids",title:"Groups",type:"select",mode:"multiple",options:a,initialValue:a.filter(e=>Object(l.includes)(t.groupIds,e.value)).map(e=>e.value),loading:r,placeholder:r?"Loading...":""}].map(e=>ej({readOnly:t.isDisabled,required:!0},e));return n.a.createElement(Nh,{fields:o,onSubmit:this.saveUser,hideSubmitButton:t.isDisabled})}},{key:"renderUserGroups",value:function(){var e=this.state,t=e.user,a=e.groups;return e.loadingGroups?"Loading...":n.a.createElement("div",{"data-test":"Groups"},a.filter(e=>Object(l.includes)(t.groupIds,e.value)).map(e=>n.a.createElement(gp.a,{className:"m-b-5 m-r-5",key:e.value},n.a.createElement("a",{href:"groups/".concat(e.value)},e.name))))}},{key:"renderApiKey",value:function(){var e=this.state,t=e.user,a=e.regeneratingApiKey;return n.a.createElement(kl.a,{layout:"vertical"},n.a.createElement("hr",null),n.a.createElement(kl.a.Item,{label:"API Key",className:"m-b-10"},n.a.createElement(zf,{id:"apiKey",className:"hide-in-percy",value:t.apiKey,"data-test":"ApiKey",readOnly:!0})),n.a.createElement(B.a,{className:"w-100",onClick:this.regenerateApiKey,loading:a,"data-test":"RegenerateApiKey"},"Regenerate"))}},{key:"renderPasswordLinkAlert",value:function(){var e=this.state,t=e.user,a=e.passwordLink;return n.a.createElement(T.a,{message:"Email not sent!",description:n.a.createElement(r.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,t.name),":"),n.a.createElement(zf,{value:Uw(a),readOnly:!0})),type:"warning",className:"m-t-20",afterClose:()=>{this.setState({passwordLink:null})},closable:!0})}},{key:"renderResendInvitation",value:function(){return n.a.createElement(B.a,{className:"w-100 m-t-10",onClick:this.resendInvitation,loading:this.state.resendingInvitation},"Resend Invitation")}},{key:"renderSendPasswordReset",value:function(){var e=this.state.sendingPasswordEmail;return n.a.createElement(r.Fragment,null,n.a.createElement(B.a,{className:"w-100 m-t-10",onClick:this.sendPasswordReset,loading:e},"Send Password Reset Email"))}},{key:"rendertoggleUser",value:function(){var e=this.state,t=e.user,a=e.togglingUser;return t.isDisabled?n.a.createElement(B.a,{className:"w-100 m-t-10",type:"primary",onClick:this.toggleUser,loading:a},"Enable User"):n.a.createElement(B.a,{className:"w-100 m-t-10",type:"danger",onClick:this.toggleUser,loading:a},"Disable User")}},{key:"render",value:function(){var e=this.state,t=e.user,a=e.passwordLink;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement("img",{alt:"Profile",src:t.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t.name),n.a.createElement("hr",null),this.renderUserInfoForm(),!t.isDisabled&&n.a.createElement(r.Fragment,null,this.renderApiKey(),n.a.createElement("hr",null),n.a.createElement("h5",null,"Password"),t.id===O.id&&n.a.createElement(B.a,{className:"w-100 m-t-10",onClick:this.changePassword,"data-test":"ChangePassword"},"Change Password"),O.isAdmin&&t.id!==O.id&&n.a.createElement(r.Fragment,null,t.isInvitationPending?this.renderResendInvitation():this.renderSendPasswordReset(),a&&this.renderPasswordLinkAlert())),n.a.createElement("hr",null),O.isAdmin&&t.id!==O.id&&this.rendertoggleUser())}}])&&tj(a.prototype,o),i&&tj(a,i),t}();function lj(e){return(lj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sj(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cj(e,t){return!t||"object"!==lj(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function uj(e){return(uj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dj(e,t){return(dj=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}oj(ij,"propTypes",{user:zr.isRequired});var pj=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=cj(this,uj(t).call(this,e))).state={groups:[],loadingGroups:!0},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dj(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){Lb.query().then(e=>{this.setState({groups:e,loadingGroups:!1})})}},{key:"renderUserGroups",value:function(){var e=this.props.user.groupIds,t=this.state.groups;return n.a.createElement("div",null,t.filter(t=>Object(l.includes)(e,t.id)).map(e=>n.a.createElement(gp.a,{className:"m-t-5 m-r-5",key:e.id},n.a.createElement("a",{href:"groups/".concat(e.id)},e.name))))}},{key:"render",value:function(){var e=this.props.user,t=e.name,a=e.email,r=e.profileImageUrl,o=this.state.loadingGroups;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4 profile__container"},n.a.createElement("img",{alt:"profile",src:r,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t),n.a.createElement("hr",null),n.a.createElement("dl",{className:"profile__dl"},n.a.createElement("dt",null,"Name:"),n.a.createElement("dd",null,t),n.a.createElement("dt",null,"Email:"),n.a.createElement("dd",null,a),n.a.createElement("dt",null,"Groups:"),n.a.createElement("dd",null,o?"Loading...":this.renderUserGroups())))}}])&&sj(a.prototype,r),o&&sj(a,o),t}();!function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(pj,"propTypes",{user:zr.isRequired});a(1609);function mj(e){return(mj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fj(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yj(e,t){return!t||"object"!==mj(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hj(e){return(hj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bj(e,t){return(bj=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var vj=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=yj(this,hj(t).call(this,e))).state={user:null},a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bj(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){var e=this.props.userId||O.id;Ef.get({id:e}).then(e=>this.setState({user:Ef.convertUserInfo(e)})).catch(e=>this.props.onError(e))}},{key:"render",value:function(){var e=this.state.user,t=e&&(O.isAdmin||O.id===e.id)?ij:pj;return n.a.createElement(n.a.Fragment,null,n.a.createElement(ss,{featureName:"invite emails",className:"m-b-20",adminOnly:!0}),n.a.createElement("div",{className:"row"},e?n.a.createElement(t,{user:e}):n.a.createElement(Si,{className:""})))}}])&&fj(a.prototype,r),o&&fj(a,o),t}();gj(vj,"propTypes",{userId:D.a.string,onError:D.a.func}),gj(vj,"defaultProps",{userId:null,onError:()=>{}});var Ej=Hh({title:"Account",path:"users/me",order:7},vj),Oj=[mr({path:"/users/me",title:"Account",render:e=>n.a.createElement(Ej,e)}),mr({path:"/users/:userId([0-9]+)",title:"Users",render:e=>n.a.createElement(Ej,e)})];function wj(){return(wj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){Sj(e,t,a[t])})}return e}function Sj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Pj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _j(e){var t=e.dialog,a=Pj(Object(r.useState)(null),2),o=a[0],i=a[1],l=Object(r.useRef)();Object(r.useEffect)(()=>{Ke("view","page","users/new")},[]);var s=Object(r.useCallback)(()=>{l.current&&l.current.validateFieldsAndScroll((e,a)=>{e||t.close(a).catch(i)})},[t]),c=Object(r.useMemo)(()=>{var e={required:!0,props:{onPressEnter:s}};return[jj({},e,{name:"name",title:"Name",type:"text",autoFocus:!0}),jj({},e,{name:"email",title:"Email",type:"email"})]},[s]);return n.a.createElement(ke.a,wj({},t.props,{title:"Create a New User",okText:"Create",onOk:s}),n.a.createElement(Nh,{fields:c,ref:l,hideSubmitButton:!0}),o&&n.a.createElement(T.a,{message:o.message,type:"error",showIcon:!0}))}_j.propTypes={dialog:Te.isRequired};var kj=xe(_j);function Cj(){return(Cj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Nj(e){return(Nj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tj(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qj(e){return(qj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xj(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rj(e,t){return(Rj=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Aj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Dj(e){var t=e.user,a=e.enableUser,r=e.disableUser,o=e.deleteUser;return t.id===O.id?null:t.is_invitation_pending?n.a.createElement(B.a,{type:"danger",className:"w-100",onClick:e=>o(e,t)},"Delete"):t.is_disabled?n.a.createElement(B.a,{type:"primary",className:"w-100",onClick:e=>a(e,t)},"Enable"):n.a.createElement(B.a,{className:"w-100",onClick:e=>r(e,t)},"Disable")}Dj.propTypes={user:D.a.shape({id:D.a.number,is_invitation_pending:D.a.bool,is_disabled:D.a.bool}).isRequired,enableUser:D.a.func.isRequired,disableUser:D.a.func.isRequired,deleteUser:D.a.func.isRequired};var Ij=function(e){function t(){var e,a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,o=(e=qj(t)).call.apply(e,[this].concat(s)),a=!o||"object"!==Nj(o)&&"function"!=typeof o?xj(r):o,Aj(xj(a),"sidebarMenu",[{key:"active",href:"users",title:"Active Users"},{key:"pending",href:"users/pending",title:"Pending Invitations"},{key:"disabled",href:"users/disabled",title:"Disabled Users",isAvailable:()=>Je.canCreateUser()}]),Aj(xj(a),"listColumns",[pn.custom.sortable((e,t)=>n.a.createElement(mf,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),pn.custom.sortable((e,t)=>Object(l.map)(t.groups,e=>n.a.createElement("a",{key:"group"+e.id,className:"label label-tag",href:"groups/"+e.id},e.name)),{title:"Groups",field:"groups"}),pn.timeAgo.sortable({title:"Joined",field:"created_at",className:"text-nowrap",width:"1%"}),pn.timeAgo.sortable({title:"Last Active At",field:"active_at",className:"text-nowrap",width:"1%"}),pn.custom((e,t)=>n.a.createElement(Dj,{user:t,enableUser:a.enableUser,disableUser:a.disableUser,deleteUser:a.deleteUser}),{width:"1%",isAvailable:()=>Je.canCreateUser()})]),Aj(xj(a),"createUser",e=>Ef.create(e).then(e=>{vl.success("Saved."),e.invite_link&&ke.a.warning({title:"Email not sent!",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,e.name),":"),n.a.createElement(zf,{value:Uw(e.invite_link),readOnly:!0}))})}).catch(e=>{var t=Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"message"),"Failed saving."],l.isString);return Promise.reject(new Error(t))})),Aj(xj(a),"showCreateUserDialog",()=>{if(Je.isCreateUserEnabled()){var e=()=>{a.props.controller.params.isNewUserPage&&We("users")};kj.showModal().onClose(t=>a.createUser(t).then(()=>{a.props.controller.update(),e()})).onDismiss(e)}}),Aj(xj(a),"enableUser",(e,t)=>Ef.enableUser(t).then(()=>a.props.controller.update())),Aj(xj(a),"disableUser",(e,t)=>Ef.disableUser(t).then(()=>a.props.controller.update())),Aj(xj(a),"deleteUser",(e,t)=>Ef.deleteUser(t).then(()=>a.props.controller.update())),a}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rj(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){this.props.controller.params.isNewUserPage&&this.showCreateUserDialog()}},{key:"renderPageHeader",value:function(){return Je.canCreateUser()?n.a.createElement("div",{className:"m-b-15"},n.a.createElement(B.a,{type:"primary",disabled:!Je.isCreateUserEnabled(),onClick:this.showCreateUserDialog},n.a.createElement("i",{className:"fa fa-plus m-r-5"}),"New User"),n.a.createElement(me,{name:"UsersListExtra"})):null}},{key:"render",value:function(){var e=this.props.controller;return n.a.createElement(n.a.Fragment,null,this.renderPageHeader(),n.a.createElement(Cc,null,n.a.createElement(Cc.Sidebar,{className:"m-b-0"},n.a.createElement(zi,{value:e.searchTerm,onChange:e.updateSearch}),n.a.createElement(Mi,{items:this.sidebarMenu,selected:e.params.currentPage}),n.a.createElement(Ui,{className:"m-b-10",options:e.pageSizeOptions,value:e.itemsPerPage,onChange:t=>e.updatePagination({itemsPerPage:t})})),n.a.createElement(Cc.Content,null,!e.isLoaded&&n.a.createElement(Si,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(Ky,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive","data-test":"UserList"},n.a.createElement(mn,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vn,{totalCount:e.totalItemsCount,itemsPerPage:e.itemsPerPage,page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}])&&Tj(a.prototype,r),o&&Tj(a,o),t}();Aj(Ij,"propTypes",{controller:Co.isRequired});var zj=Hh({permission:"list_users",title:"Users",path:"users",isActive:e=>e.startsWith("/users")&&"/users/me"!==e,order:2},No(Ij,()=>new di({getRequest:function(e,t){switch(t.params.currentPage){case"active":e.pending=!1;break;case"pending":e.pending=!0;break;case"disabled":e.disabled=!0}return e},getResource:function(){return Ef.query.bind(Ef)}}),()=>new wi({orderByField:"created_at",orderByReverse:!0}))),Mj=[mr({path:"/users/new",title:"Users",render:e=>n.a.createElement(zj,Cj({},e,{currentPage:"active",isNewUserPage:!0}))}),mr({path:"/users",title:"Users",render:e=>n.a.createElement(zj,Cj({},e,{currentPage:"active"}))}),mr({path:"/users/pending",title:"Pending Invitations",render:e=>n.a.createElement(zj,Cj({},e,{currentPage:"pending"}))}),mr({path:"/users/disabled",title:"Disabled Users",render:e=>n.a.createElement(zj,Cj({},e,{currentPage:"disabled"}))})],Vj=Object(l.flatten)([An,$i,ml,Oc,Ms,Fc,Cy,By,rb,pb,wb,qb,eg,mg,jg,Ag,mw,XO,BO,aw,Nw,Lw,Mj,Oj]);function Fj(e){for(var t=e.target;t&&"A"!==t.tagName;)t=t.parentNode;if(t&&t.hasAttribute("href")&&!t.hasAttribute("download")&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var a=t.getAttribute("target");Object(l.isString)(a)&&"_blank"===a.toLowerCase()||(e.preventDefault(),We(t.href))}}function Lj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Uj,Bj,Qj=a(676);a(662);Or.a.setDefaultIndicator(n.a.createElement("i",{className:"fa fa-spinner fa-pulse"})),Qj.options.shouldHandlePushState=((e,t)=>(e=De.parse(e),t=De.parse(t),e.pathname!==t.pathname)),rt.a.updateLocale("en",{relativeTime:{future:"%s",past:"%s",s:"just now",m:"a minute ago",mm:"%d minutes ago",h:"an hour ago",hh:"%d hours ago",d:"a day ago",dd:"%d days ago",M:"a month ago",MM:"%d months ago",y:"a year ago",yy:"%d years ago"}}),(Uj=a(1610)).keys().forEach(Uj),(Bj=a(1690)).keys().map(Bj).map(e=>e.default).filter(l.isFunction).filter(e=>e.init).map(e=>e());var Wj=function(){window.addEventListener("offline",()=>{vl.warning("Please check your Internet connection.",null,{key:"connectionNotification",duration:null}),function(e){window.addEventListener("online",function t(){vl.close(e),window.removeEventListener("online",t)})}("connectionNotification")})};i.a.render(n.a.createElement(function(){var e=Lj(Object(r.useState)(null),2),t=e[0],a=e[1],o=Lj(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{t&&t.title&&(document.title=t.title)},[t]),Object(r.useEffect)(()=>{function e(e){e.preventDefault(),l(e.error)}return document.body.addEventListener("click",Fj,!1),window.addEventListener("error",e,!1),()=>{document.body.removeEventListener("click",Fj,!1),window.removeEventListener("error",e,!1)}},[]),i?n.a.createElement(Ve,{error:i}):n.a.createElement(Qe,{routes:Vj,onRouteChange:a})},null),document.getElementById("application-root"),()=>{Wj()})},389:function(e){e.exports="dev"},595:function(e,t,a){},626:function(e,t,a){},662:function(e,t,a){e.exports=a.p+"images/avatar.svg"},678:function(e,t,a){a(1695),a(1691),e.exports=a(1692)},764:function(e,t,a){var r={"./en-SG":436,"./en-SG.js":436,"./en-au":437,"./en-au.js":437,"./en-ca":438,"./en-ca.js":438,"./en-gb":439,"./en-gb.js":439,"./en-ie":440,"./en-ie.js":440,"./en-il":441,"./en-il.js":441,"./en-nz":442,"./en-nz.js":442};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=764},771:function(e,t,a){},873:function(e,t){}});
//# sourceMappingURL=app.dce0a3ceac9c472d6bc9.js.map